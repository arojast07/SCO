{"version":3,"file":"page-DanbPjTA.js","sources":["../../src/pages/productos/components/CrearArticuloModal.tsx","../../src/pages/productos/components/DetalleComponenteModal.tsx","../../src/pages/productos/components/BuscarArticuloModal.tsx","../../src/pages/productos/components/BOMTable.tsx","../../src/pages/productos/components/ProductosForm.tsx","../../src/pages/productos/components/ProductosTable.tsx","../../src/pages/productos/components/ProductosLayout.tsx","../../src/pages/productos/page.tsx"],"sourcesContent":["\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\n\ninterface Props {\n  nombreInicial: string;\n  onCreado: (articulo: any) => void;\n  onCerrar: () => void;\n}\n\nexport default function CrearArticuloModal({ nombreInicial, onCreado, onCerrar }: Props) {\n  const [formData, setFormData] = useState({\n    codigo_articulo: '',\n    descripcion_articulo: nombreInicial,\n    cantidad_articulo: '0',\n    costo_articulo: '0',\n    ganancia_articulo: '0',\n    categoria_id: '',\n    unidad_base_id: '10'\n  });\n  const [categorias, setCategorias] = useState<any[]>([]);\n  const [unidades, setUnidades] = useState<any[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    cargarDatos();\n  }, []);\n\n  const cargarDatos = async () => {\n    const [categoriasRes, unidadesRes] = await Promise.all([\n      supabase.from('categorias').select('*').order('nombre'),\n      supabase.from('unidades_medida').select('*').order('nombre')\n    ]);\n    \n    setCategorias(categoriasRes.data || []);\n    setUnidades(unidadesRes.data || []);\n  };\n\n  const generarCodigo = () => {\n    const timestamp = Date.now().toString().slice(-6);\n    const random = Math.floor(Math.random() * 100).toString().padStart(2, '0');\n    return `ART${timestamp}${random}`;\n  };\n\n  const validarFormulario = async () => {\n    setError('');\n    \n    if (!formData.codigo_articulo.trim()) {\n      setError('El código del artículo es requerido');\n      return false;\n    }\n    \n    if (!formData.descripcion_articulo.trim()) {\n      setError('La descripción es requerida');\n      return false;\n    }\n    \n    if (!formData.categoria_id) {\n      setError('La categoría es requerida');\n      return false;\n    }\n\n    const costo = parseFloat(formData.costo_articulo);\n    const ganancia = parseFloat(formData.ganancia_articulo);\n    \n    if (isNaN(costo) || costo < 0) {\n      setError('El costo debe ser un número mayor o igual a 0');\n      return false;\n    }\n    \n    if (isNaN(ganancia) || ganancia < 0 || ganancia > 100) {\n      setError('La ganancia debe ser entre 0 y 100%');\n      return false;\n    }\n\n    // Verificar unicidad del código\n    const { data: existente } = await supabase\n      .from('inventario')\n      .select('id')\n      .ilike('codigo_articulo', formData.codigo_articulo.trim())\n      .single();\n\n    if (existente) {\n      setError('Ya existe un artículo con este código');\n      return false;\n    }\n\n    return true;\n  };\n\n  const crearArticulo = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!(await validarFormulario())) return;\n    \n    setLoading(true);\n    \n    try {\n      const costo = parseFloat(formData.costo_articulo);\n      const ganancia = parseFloat(formData.ganancia_articulo);\n      \n      const datosArticulo = {\n        codigo_articulo: formData.codigo_articulo.trim(),\n        descripcion_articulo: formData.descripcion_articulo.trim(),\n        cantidad_articulo: parseFloat(formData.cantidad_articulo),\n        costo_articulo: costo,\n        ganancia_articulo: ganancia,\n        categoria_id: parseInt(formData.categoria_id),\n        unidad_base_id: parseInt(formData.unidad_base_id)\n      };\n\n      const { data, error } = await supabase\n        .from('inventario')\n        .insert(datosArticulo)\n        .select(`\n          *,\n          categoria:categorias(nombre),\n          unidad:unidades_medida(nombre, simbolo)\n        `)\n        .single();\n      \n      if (error) throw error;\n      \n      onCreado(data);\n    } catch (err) {\n      console.error('Error creando artículo:', err);\n      setError('Error al crear el artículo');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Crear Nuevo Artículo\n            </h3>\n            <button\n              onClick={onCerrar}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <i className=\"ri-close-line text-xl\"></i>\n            </button>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n              {error}\n            </div>\n          )}\n\n          <form onSubmit={crearArticulo} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Código del Artículo *\n              </label>\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={formData.codigo_articulo}\n                  onChange={(e) => setFormData({ ...formData, codigo_articulo: e.target.value })}\n                  className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  placeholder=\"Ej: ART001\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setFormData({ ...formData, codigo_articulo: generarCodigo() })}\n                  className=\"bg-gray-100 text-gray-600 px-3 py-2 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap\"\n                  title=\"Generar código automático\"\n                >\n                  <i className=\"ri-refresh-line\"></i>\n                </button>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Descripción *\n              </label>\n              <input\n                type=\"text\"\n                value={formData.descripcion_articulo}\n                onChange={(e) => setFormData({ ...formData, descripcion_articulo: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"Descripción del artículo\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Categoría *\n              </label>\n              <select\n                value={formData.categoria_id}\n                onChange={(e) => setFormData({ ...formData, categoria_id: e.target.value })}\n                className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              >\n                <option value=\"\">Seleccionar categoría</option>\n                {categorias.map(cat => (\n                  <option key={cat.id} value={cat.id}>{cat.nombre}</option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Unidad Base *\n              </label>\n              <select\n                value={formData.unidad_base_id}\n                onChange={(e) => setFormData({ ...formData, unidad_base_id: e.target.value })}\n                className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              >\n                {unidades.map(unidad => (\n                  <option key={unidad.id} value={unidad.id}>\n                    {unidad.nombre} ({unidad.simbolo})\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Cantidad Inicial\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.001\"\n                  min=\"0\"\n                  value={formData.cantidad_articulo}\n                  onChange={(e) => setFormData({ ...formData, cantidad_articulo: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Costo Unitario\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.0001\"\n                  min=\"0\"\n                  value={formData.costo_articulo}\n                  onChange={(e) => setFormData({ ...formData, costo_articulo: e.target.value })}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Ganancia (%)\n              </label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                max=\"100\"\n                value={formData.ganancia_articulo}\n                onChange={(e) => setFormData({ ...formData, ganancia_articulo: e.target.value })}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"0.00\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Precio final: ${(parseFloat(formData.costo_articulo || '0') * (1 + parseFloat(formData.ganancia_articulo || '0') / 100)).toFixed(2)}\n              </p>\n            </div>\n\n            <div className=\"flex gap-3 pt-4\">\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 whitespace-nowrap\"\n              >\n                {loading ? (\n                  <>\n                    <i className=\"ri-loader-line animate-spin mr-2\"></i>\n                    Creando...\n                  </>\n                ) : (\n                  <>\n                    <i className=\"ri-add-line mr-2\"></i>\n                    Crear Artículo\n                  </>\n                )}\n              </button>\n              <button\n                type=\"button\"\n                onClick={onCerrar}\n                className=\"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors whitespace-nowrap\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n","\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\n\ninterface Articulo {\n  id_articulo: number;\n  codigo_articulo: string;\n  descripcion_articulo: string;\n  precio_articulo: number;\n  categoria?: {\n    nombre: string;\n  };\n  unidad?: {\n    nombre: string;\n    simbolo: string;\n  };\n}\n\ninterface Props {\n  articulo: Articulo;\n  onConfirmar: (cantidad: number, unidadId: number, precioAjustado: number) => void;\n  onCerrar: () => void;\n}\n\nexport default function DetalleComponenteModal({ articulo, onConfirmar, onCerrar }: Props) {\n  const [cantidad, setCantidad] = useState('1.00');\n  const [unidadId, setUnidadId] = useState('');\n  const [unidades, setUnidades] = useState<any[]>([]);\n  const [precioAjustado, setPrecioAjustado] = useState(0);\n  const [factorConversion, setFactorConversion] = useState(1);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    cargarUnidades();\n  }, []);\n\n  useEffect(() => {\n    calcularPrecioAjustado();\n  }, [cantidad, unidadId, factorConversion]);\n\n  const cargarUnidades = async () => {\n    const { data } = await supabase\n      .from('unidades_medida')\n      .select('*')\n      .order('grupo, nombre');\n    \n    setUnidades(data || []);\n    \n    // Seleccionar la unidad base del artículo por defecto\n    if (articulo.unidad && data) {\n      const unidadBase = data.find(u => u.nombre === articulo.unidad?.nombre);\n      if (unidadBase) {\n        setUnidadId(unidadBase.id.toString());\n      }\n    }\n  };\n\n  const calcularFactorConversion = async (unidadDestinoId: string) => {\n    if (!unidadDestinoId || !articulo.unidad) return;\n\n    try {\n      // Obtener unidad base del artículo\n      const { data: unidadBase } = await supabase\n        .from('unidades_medida')\n        .select('*')\n        .eq('nombre', articulo.unidad.nombre)\n        .single();\n\n      // Obtener unidad destino\n      const { data: unidadDestino } = await supabase\n        .from('unidades_medida')\n        .select('*')\n        .eq('id', parseInt(unidadDestinoId))\n        .single();\n\n      if (unidadBase && unidadDestino) {\n        // Verificar que sean del mismo grupo\n        if (unidadBase.grupo !== unidadDestino.grupo) {\n          setError(`No se puede convertir de ${unidadBase.grupo} a ${unidadDestino.grupo}`);\n          return;\n        }\n\n        // Calcular factor de conversión\n        // Factor = (cantidad_en_unidad_destino / cantidad_en_unidad_base)\n        const factor = unidadDestino.factor_base / unidadBase.factor_base;\n        setFactorConversion(factor);\n        setError('');\n      }\n    } catch (err) {\n      console.error('Error calculando conversión:', err);\n      setError('Error en la conversión de unidades');\n    }\n  };\n\n  const calcularPrecioAjustado = () => {\n    const cantidadNum = parseFloat(cantidad) || 0;\n    const precioBase = articulo.precio_articulo;\n    \n    // Precio ajustado = cantidad_solicitada * factor_conversion * precio_base\n    const precio = cantidadNum * factorConversion * precioBase;\n    setPrecioAjustado(precio);\n  };\n\n  const manejarCambioUnidad = (nuevaUnidadId: string) => {\n    setUnidadId(nuevaUnidadId);\n    calcularFactorConversion(nuevaUnidadId);\n  };\n\n  const manejarCambioCantidad = (valor: string) => {\n    // Permitir solo números con hasta 2 decimales\n    const regex = /^\\d*\\.?\\d{0,2}$/;\n    if (regex.test(valor) || valor === '') {\n      setCantidad(valor);\n    }\n  };\n\n  const confirmar = () => {\n    const cantidadNum = parseFloat(cantidad);\n    \n    if (!cantidadNum || cantidadNum <= 0) {\n      setError('La cantidad debe ser mayor a 0');\n      return;\n    }\n    \n    if (!unidadId) {\n      setError('Selecciona una unidad');\n      return;\n    }\n    \n    if (error) {\n      return;\n    }\n\n    onConfirmar(cantidadNum, parseInt(unidadId), precioAjustado);\n  };\n\n  const getUnidadesPorGrupo = () => {\n    const grupos: { [key: string]: any[] } = {};\n    unidades.forEach(unidad => {\n      if (!grupos[unidad.grupo]) {\n        grupos[unidad.grupo] = [];\n      }\n      grupos[unidad.grupo].push(unidad);\n    });\n    return grupos;\n  };\n\n  const unidadesPorGrupo = getUnidadesPorGrupo();\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg w-full max-w-lg\">\n        <div className=\"p-6\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Configurar Componente\n            </h3>\n            <button\n              onClick={onCerrar}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <i className=\"ri-close-line text-xl\"></i>\n            </button>\n          </div>\n\n          {/* Información del artículo */}\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-4\">\n            <div className=\"flex justify-between items-start\">\n              <div className=\"flex-1\">\n                <h4 className=\"font-medium text-gray-900 mb-1\">\n                  {articulo.descripcion_articulo}\n                </h4>\n                <div className=\"text-sm text-gray-500\">\n                  Código: {articulo.codigo_articulo}\n                </div>\n                {articulo.categoria && (\n                  <span className=\"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-1\">\n                    {articulo.categoria.nombre}\n                  </span>\n                )}\n              </div>\n              <div className=\"text-right\">\n                <div className=\"font-semibold text-green-600\">\n                  ${articulo.precio_articulo.toLocaleString('es-ES', { \n                    minimumFractionDigits: 2, \n                    maximumFractionDigits: 2 \n                  })}\n                </div>\n                <div className=\"text-xs text-gray-500\">\n                  por {articulo.unidad?.simbolo || 'unidad'}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Cantidad por unidad para {articulo.descripcion_articulo} *\n              </label>\n              <input\n                type=\"text\"\n                value={cantidad}\n                onChange={(e) => manejarCambioCantidad(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"1.00\"\n                required\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Cantidad necesaria de este componente por unidad del producto final (máximo 2 decimales)\n              </p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Unidad de Medida *\n              </label>\n              <select\n                value={unidadId}\n                onChange={(e) => manejarCambioUnidad(e.target.value)}\n                className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              >\n                <option value=\"\">Seleccionar unidad</option>\n                {Object.entries(unidadesPorGrupo).map(([grupo, unidadesGrupo]) => (\n                  <optgroup key={grupo} label={grupo.charAt(0).toUpperCase() + grupo.slice(1)}>\n                    {unidadesGrupo.map(unidad => (\n                      <option key={unidad.id} value={unidad.id}>\n                        {unidad.nombre} ({unidad.simbolo})\n                      </option>\n                    ))}\n                  </optgroup>\n                ))}\n              </select>\n            </div>\n\n            {factorConversion !== 1 && !error && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n                <div className=\"text-sm text-blue-800\">\n                  <i className=\"ri-information-line mr-1\"></i>\n                  Factor de conversión: {factorConversion.toFixed(6)}\n                </div>\n                <div className=\"text-xs text-blue-600 mt-1\">\n                  {cantidad} {unidades.find(u => u.id === parseInt(unidadId))?.simbolo} = {(parseFloat(cantidad) * factorConversion).toFixed(4)} {articulo.unidad?.simbolo}\n                </div>\n              </div>\n            )}\n\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"font-medium text-green-900\">Precio Total del Componente:</span>\n                <span className=\"text-xl font-bold text-green-900\">\n                  ${precioAjustado.toLocaleString('es-ES', { \n                    minimumFractionDigits: 2, \n                    maximumFractionDigits: 2 \n                  })}\n                </span>\n              </div>\n              <div className=\"text-xs text-green-700 mt-1\">\n                {cantidad} × {factorConversion.toFixed(4)} × ${articulo.precio_articulo.toFixed(2)}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex gap-3 pt-6\">\n            <button\n              onClick={confirmar}\n              className=\"flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap\"\n            >\n              <i className=\"ri-check-line mr-2\"></i>\n              Agregar Componente\n            </button>\n            <button\n              onClick={onCerrar}\n              className=\"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors whitespace-nowrap\"\n            >\n              Cancelar\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport CrearArticuloModal from './CrearArticuloModal';\nimport DetalleComponenteModal from './DetalleComponenteModal';\n\ninterface Articulo {\n  id_articulo: number;\n  codigo_articulo: string;\n  descripcion_articulo: string;\n  precio_articulo: number;\n  categoria?: {\n    nombre: string;\n  };\n  unidad?: {\n    nombre: string;\n    simbolo: string;\n  };\n}\n\ninterface Props {\n  onSeleccionar: (articulo: Articulo, cantidad: number, unidadId: number, precioAjustado: number) => void;\n  onCerrar: () => void;\n}\n\nexport default function BuscarArticuloModal({ onSeleccionar, onCerrar }: Props) {\n  const [busqueda, setBusqueda] = useState('');\n  const [articulos, setArticulos] = useState<Articulo[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [showCrearModal, setShowCrearModal] = useState(false);\n  const [showDetalleModal, setShowDetalleModal] = useState(false);\n  const [articuloSeleccionado, setArticuloSeleccionado] = useState<Articulo | null>(null);\n  const timeoutRef = useRef<NodeJS.Timeout>();\n\n  useEffect(() => {\n    if (busqueda.trim().length >= 2) {\n      // Debounced search\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n      \n      timeoutRef.current = setTimeout(() => {\n        buscarArticulos();\n      }, 300);\n    } else {\n      setArticulos([]);\n    }\n\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [busqueda]);\n\n  const buscarArticulos = async () => {\n    setLoading(true);\n    \n    try {\n      const { data, error } = await supabase\n        .from('inventario')\n        .select(`\n          id_articulo,\n          codigo_articulo,\n          descripcion_articulo,\n          precio_articulo,\n          categoria:categorias(nombre),\n          unidad:unidades_medida(nombre, simbolo)\n        `)\n        .or(`descripcion_articulo.ilike.%${busqueda}%,codigo_articulo.ilike.%${busqueda}%,id_articulo.eq.${isNaN(parseInt(busqueda)) ? 0 : parseInt(busqueda)}`)\n        .limit(10);\n\n      if (error) throw error;\n      setArticulos(data || []);\n    } catch (err) {\n      console.error('Error buscando artículos:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const seleccionarArticulo = (articulo: Articulo) => {\n    setArticuloSeleccionado(articulo);\n    setShowDetalleModal(true);\n  };\n\n  const confirmarSeleccion = (cantidad: number, unidadId: number, precioAjustado: number) => {\n    if (articuloSeleccionado) {\n      onSeleccionar(articuloSeleccionado, cantidad, unidadId, precioAjustado);\n    }\n  };\n\n  const onArticuloCreado = (nuevoArticulo: Articulo) => {\n    setShowCrearModal(false);\n    setArticuloSeleccionado(nuevoArticulo);\n    setShowDetalleModal(true);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg w-full max-w-2xl max-h-[80vh] overflow-hidden\">\n        <div className=\"p-6\">\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">\n              Buscar o Crear Artículo/Servicio\n            </h3>\n            <button\n              onClick={onCerrar}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <i className=\"ri-close-line text-xl\"></i>\n            </button>\n          </div>\n\n          {/* Buscador */}\n          <div className=\"relative mb-4\">\n            <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n              <i className=\"ri-search-line text-gray-400\"></i>\n            </div>\n            <input\n              type=\"text\"\n              value={busqueda}\n              onChange={(e) => setBusqueda(e.target.value)}\n              placeholder=\"Buscar por nombre, ID o Código...\"\n              className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\n              autoFocus\n            />\n            {loading && (\n              <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\n              </div>\n            )}\n          </div>\n\n          {/* Resultados */}\n          <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n            {busqueda.trim().length < 2 && (\n              <div className=\"text-center py-8 text-gray-500\">\n                <i className=\"ri-search-line text-3xl mb-2\"></i>\n                <p>Escribe al menos 2 caracteres para buscar</p>\n              </div>\n            )}\n\n            {busqueda.trim().length >= 2 && articulos.length === 0 && !loading && (\n              <div className=\"text-center py-8\">\n                <i className=\"ri-file-search-line text-3xl text-gray-400 mb-2\"></i>\n                <p className=\"text-gray-500 mb-4\">No se encontraron artículos</p>\n                <button\n                  onClick={() => setShowCrearModal(true)}\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap\"\n                >\n                  <i className=\"ri-add-line mr-2\"></i>\n                  Crear Nuevo Artículo\n                </button>\n              </div>\n            )}\n\n            {articulos.map((articulo) => (\n              <div\n                key={articulo.id_articulo}\n                onClick={() => seleccionarArticulo(articulo)}\n                className=\"p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors\"\n              >\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"font-medium text-gray-900\">\n                        {articulo.descripcion_articulo}\n                      </span>\n                      {articulo.categoria && (\n                        <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full\">\n                          {articulo.categoria.nombre}\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm text-gray-500\">\n                      Código: {articulo.codigo_articulo} | ID: {articulo.id_articulo}\n                    </div>\n                    {articulo.unidad && (\n                      <div className=\"text-xs text-gray-400\">\n                        Unidad base: {articulo.unidad.nombre} ({articulo.unidad.simbolo})\n                      </div>\n                    )}\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"font-semibold text-green-600\">\n                      ${articulo.precio_articulo.toLocaleString('es-ES', { \n                        minimumFractionDigits: 2, \n                        maximumFractionDigits: 2 \n                      })}\n                    </div>\n                    <div className=\"text-xs text-gray-500\">por unidad</div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {/* Botón crear nuevo si hay resultados */}\n          {busqueda.trim().length >= 2 && articulos.length > 0 && (\n            <div className=\"mt-4 pt-4 border-t\">\n              <button\n                onClick={() => setShowCrearModal(true)}\n                className=\"w-full bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap\"\n              >\n                <i className=\"ri-add-line mr-2\"></i>\n                ¿No encuentras lo que buscas? Crear nuevo artículo\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Modal crear artículo */}\n      {showCrearModal && (\n        <CrearArticuloModal\n          nombreInicial={busqueda}\n          onCreado={onArticuloCreado}\n          onCerrar={() => setShowCrearModal(false)}\n        />\n      )}\n\n      {/* Modal detalle componente */}\n      {showDetalleModal && articuloSeleccionado && (\n        <DetalleComponenteModal\n          articulo={articuloSeleccionado}\n          onConfirmar={confirmarSeleccion}\n          onCerrar={() => {\n            setShowDetalleModal(false);\n            setArticuloSeleccionado(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}","\nimport { useState } from 'react';\nimport { formatCurrency } from '../../../lib/currency';\n\ninterface BOMItem {\n  id?: number;\n  id_componente: number;\n  nombre_componente: string;\n  cantidad_x_unidad: number;\n  unidad_id: number;\n  precio_unitario_base: number;\n  precio_ajustado: number;\n  categoria_nombre?: string;\n  unidad_nombre?: string;\n  unidad_simbolo?: string;\n}\n\ninterface Props {\n  items: BOMItem[];\n  onEliminar: (index: number) => void;\n  onEditar: (index: number, cantidad: number, unidadId: number, precioAjustado: number) => void;\n}\n\nexport default function BOMTable({ items, onEliminar, onEditar }: Props) {\n  const [editingIndex, setEditingIndex] = useState<number | null>(null);\n  const [editData, setEditData] = useState({\n    cantidad: '',\n    unidadId: '',\n    precioAjustado: 0\n  });\n\n  const iniciarEdicion = (e: React.MouseEvent, index: number, item: BOMItem) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setEditingIndex(index);\n    setEditData({\n      cantidad: item.cantidad_x_unidad.toString(),\n      unidadId: item.unidad_id.toString(),\n      precioAjustado: item.precio_ajustado\n    });\n  };\n\n  const guardarEdicion = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (editingIndex !== null) {\n      const cantidad = parseFloat(editData.cantidad);\n      const unidadId = parseInt(editData.unidadId);\n      \n      if (cantidad > 0 && unidadId) {\n        onEditar(editingIndex, cantidad, unidadId, editData.precioAjustado);\n        cancelarEdicion();\n      }\n    }\n  };\n\n  const cancelarEdicion = (e?: React.MouseEvent) => {\n    if (e) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    setEditingIndex(null);\n    setEditData({ cantidad: '', unidadId: '', precioAjustado: 0 });\n  };\n\n  const eliminarItem = (e: React.MouseEvent, index: number) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onEliminar(index);\n  };\n\n  if (items.length === 0) {\n    return (\n      <div className=\"text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n        <i className=\"ri-list-check-line text-3xl text-gray-400 mb-2\"></i>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-1\">Sin componentes BOM</h3>\n        <p className=\"text-gray-500\">Agrega componentes para construir la lista de materiales</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg border overflow-hidden\">\n      <div className=\"overflow-x-auto\">\n        <table className=\"min-w-full divide-y divide-gray-200\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                ID\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Componente\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Cantidad\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Unidad\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Categoría\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Precio Unitario\n              </th>\n              <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Acciones\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {items.map((item, index) => (\n              <tr key={index} className=\"hover:bg-gray-50\">\n                <td className=\"px-4 py-4 whitespace-nowrap text-sm text-gray-900\">\n                  {item.id_componente}\n                </td>\n                <td className=\"px-4 py-4\">\n                  <div className=\"text-sm font-medium text-gray-900\">\n                    {item.nombre_componente}\n                  </div>\n                </td>\n                <td className=\"px-4 py-4 whitespace-nowrap\">\n                  {editingIndex === index ? (\n                    <input\n                      type=\"number\"\n                      step=\"0.0001\"\n                      min=\"0.0001\"\n                      value={editData.cantidad}\n                      onChange={(e) => setEditData({ ...editData, cantidad: e.target.value })}\n                      className=\"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      onClick={(e) => e.stopPropagation()}\n                    />\n                  ) : (\n                    <div className=\"text-sm text-gray-900\">\n                      {item.cantidad_x_unidad.toLocaleString('es-ES', { \n                        minimumFractionDigits: 4, \n                        maximumFractionDigits: 4 \n                      })}\n                    </div>\n                  )}\n                </td>\n                <td className=\"px-4 py-4 whitespace-nowrap\">\n                  <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full\">\n                    {item.unidad_simbolo || item.unidad_nombre}\n                  </span>\n                </td>\n                <td className=\"px-4 py-4 whitespace-nowrap\">\n                  {item.categoria_nombre && (\n                    <span className=\"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full\">\n                      {item.categoria_nombre}\n                    </span>\n                  )}\n                </td>\n                <td className=\"px-4 py-4 whitespace-nowrap\">\n                  <div className=\"text-sm font-medium text-green-600\">\n                    {formatCurrency(item.precio_ajustado)}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">\n                    Base: {formatCurrency(item.precio_unitario_base)}\n                  </div>\n                </td>\n                <td className=\"px-4 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                  {editingIndex === index ? (\n                    <div className=\"flex gap-1 justify-end\">\n                      <button\n                        type=\"button\"\n                        onClick={guardarEdicion}\n                        className=\"text-green-600 hover:text-green-900 p-1\"\n                        title=\"Guardar\"\n                      >\n                        <i className=\"ri-check-line\"></i>\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={cancelarEdicion}\n                        className=\"text-gray-600 hover:text-gray-900 p-1\"\n                        title=\"Cancelar\"\n                      >\n                        <i className=\"ri-close-line\"></i>\n                      </button>\n                    </div>\n                  ) : (\n                    <div className=\"flex gap-1 justify-end\">\n                      <button\n                        type=\"button\"\n                        onClick={(e) => iniciarEdicion(e, index, item)}\n                        className=\"text-blue-600 hover:text-blue-900 p-1\"\n                        title=\"Editar\"\n                      >\n                        <i className=\"ri-edit-line\"></i>\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => eliminarItem(e, index)}\n                        className=\"text-red-600 hover:text-red-900 p-1\"\n                        title=\"Eliminar\"\n                      >\n                        <i className=\"ri-delete-bin-line\"></i>\n                      </button>\n                    </div>\n                  )}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n","\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { formatCurrency } from '../../../lib/currency';\nimport BuscarArticuloModal from './BuscarArticuloModal';\nimport BOMTable from './BOMTable';\n\ninterface Producto {\n  id_producto?: number;\n  codigo_producto: string;\n  descripcion: string; // Cambiado de descripcion_producto a descripcion\n  categoria_id: number;\n  codigo_sistema?: string;\n  activo?: boolean;\n}\n\ninterface BOMItem {\n  id?: number;\n  id_componente: number;\n  nombre_componente: string;\n  cantidad_x_unidad: number;\n  unidad_id: number;\n  precio_unitario_base: number;\n  precio_ajustado: number;\n  categoria_nombre?: string;\n  unidad_nombre?: string;\n  unidad_simbolo?: string;\n}\n\ninterface Props {\n  producto: Producto | null;\n  onGuardar: () => void;\n  onCerrar: () => void;\n}\n\nexport default function ProductosForm({ producto, onGuardar, onCerrar }: Props) {\n  // Alias para compatibilidad con el código modificado\n  const productoEditar = producto;\n  const onSuccess = onGuardar;\n  const onClose = onCerrar;\n\n  const [formData, setFormData] = useState({\n    codigo_producto: '',\n    descripcion_producto: '',\n    categoria_id: '',\n    codigo_sistema: ''\n  });\n\n  const [categorias, setCategorias] = useState<any[]>([]);\n  const [bomItems, setBomItems] = useState<BOMItem[]>([]);\n  const [showBuscarModal, setShowBuscarModal] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [costoTotal, setCostoTotal] = useState(0);\n\n  useEffect(() => {\n    cargarCategorias();\n\n    if (productoEditar) {\n      setFormData({\n        codigo_producto: productoEditar.codigo_producto || '',\n        descripcion_producto: (productoEditar as any).descripcion_producto || '',\n        categoria_id: productoEditar.categoria_id?.toString() || '',\n        codigo_sistema: productoEditar.codigo_sistema || ''\n      });\n      \n      // Cargar componentes BOM del producto\n      cargarBOMItems(productoEditar.id_producto!);\n    } else {\n      // Al crear nuevo producto, generar código automáticamente\n      generarCodigoProducto();\n      setBomItems([]); // Limpiar componentes para nuevo producto\n    }\n  }, [productoEditar]);\n\n  useEffect(() => {\n    calcularCostoTotal();\n  }, [bomItems]);\n\n  const cargarCategorias = async () => {\n    const { data } = await supabase\n      .from('categorias')\n      .select('*')\n      .order('nombre');\n    setCategorias(data || []);\n  };\n\n  const generarCodigoSistema = async () => {\n    try {\n      const { data } = await supabase\n        .from('productos')\n        .select('codigo_sistema')\n        .not('codigo_sistema', 'is', null)\n        .order('codigo_sistema', { ascending: false })\n        .limit(1);\n\n      let siguienteNumero = 1;\n      \n      if (data && data.length > 0 && data[0].codigo_sistema) {\n        const ultimoCodigo = data[0].codigo_sistema;\n        const numero = parseInt(ultimoCodigo);\n        if (!isNaN(numero)) {\n          siguienteNumero = numero + 1;\n        }\n      }\n\n      // Verificar que el código de sistema no exista\n      let codigoUnico = false;\n      let intentos = 0;\n      let codigoGenerado = '';\n\n      while (!codigoUnico && intentos < 100) {\n        codigoGenerado = (siguienteNumero + intentos).toString().padStart(6, '0');\n        \n        const { data: existente } = await supabase\n          .from('productos')\n          .select('id_producto')\n          .eq('codigo_sistema', codigoGenerado)\n          .single();\n\n        if (!existente) {\n          codigoUnico = true;\n        } else {\n          intentos++;\n        }\n      }\n\n      setFormData(prev => ({\n        ...prev,\n        codigo_sistema: codigoGenerado\n      }));\n    } catch (error) {\n      console.error('Error generando código de sistema:', error);\n      // Fallback con timestamp\n      setFormData(prev => ({\n        ...prev,\n        codigo_sistema: Date.now().toString().slice(-6)\n      }));\n    }\n  };\n\n  const generarCodigoProducto = async () => {\n    try {\n      const { data } = await supabase\n        .from('productos')\n        .select('codigo_producto')\n        .like('codigo_producto', 'PROD-%')\n        .order('codigo_producto', { ascending: false })\n        .limit(1);\n\n      let siguienteNumero = 1;\n      \n      if (data && data.length > 0 && data[0].codigo_producto) {\n        const ultimoCodigo = data[0].codigo_producto;\n        const match = ultimoCodigo.match(/PROD-(\\d+)/);\n        if (match) {\n          const numero = parseInt(match[1]);\n          if (!isNaN(numero)) {\n            siguienteNumero = numero + 1;\n          }\n        }\n      }\n\n      // Verificar que el código no exista antes de asignarlo\n      let codigoUnico = false;\n      let intentos = 0;\n      let codigoGenerado = '';\n\n      while (!codigoUnico && intentos < 100) {\n        codigoGenerado = `PROD-${(siguienteNumero + intentos).toString().padStart(3, '0')}`;\n        \n        const { data: existente } = await supabase\n          .from('productos')\n          .select('id_producto')\n          .eq('codigo_producto', codigoGenerado)\n          .single();\n\n        if (!existente) {\n          codigoUnico = true;\n        } else {\n          intentos++;\n        }\n      }\n\n      setFormData(prev => ({\n        ...prev,\n        codigo_producto: codigoGenerado\n      }));\n    } catch (error) {\n      console.error('Error generando código de producto:', error);\n      // Fallback con timestamp para garantizar unicidad\n      const timestamp = Date.now().toString().slice(-6);\n      setFormData(prev => ({\n        ...prev,\n        codigo_producto: `PROD-${timestamp}`\n      }));\n    }\n  };\n\n  const cargarBOMItems = async (productoId: number) => {\n    try {\n      const { data, error } = await supabase\n        .from('bom_items')\n        .select(`\n          *,\n          inventario:inventario!id_componente(descripcion_articulo, categoria:categorias(nombre)),\n          unidad_medida:unidades_medida!unidad_id(nombre, simbolo)\n        `)\n        .eq('product_id', productoId);\n\n      if (error) {\n        console.error('Error cargando BOM items:', error);\n        return;\n      }\n\n      if (data) {\n        const items = data.map(item => ({\n          id: item.id,\n          id_componente: item.id_componente,\n          nombre_componente: item.nombre_componente,\n          cantidad_x_unidad: item.cantidad_x_unidad,\n          unidad_id: item.unidad_id,\n          precio_unitario_base: item.precio_unitario_base,\n          precio_ajustado: item.precio_ajustado,\n          categoria_nombre: item.inventario?.categoria?.nombre,\n          unidad_nombre: item.unidad_medida?.nombre,\n          unidad_simbolo: item.unidad_medida?.simbolo\n        }));\n        setBomItems(items);\n      }\n    } catch (error) {\n      console.error('Error cargando componentes BOM:', error);\n    }\n  };\n\n  const calcularCostoTotal = () => {\n    const total = bomItems.reduce((sum, item) => sum + item.precio_ajustado, 0);\n    setCostoTotal(total);\n  };\n\n  const validarFormulario = async () => {\n    setError('');\n    \n    if (!formData.codigo_producto.trim()) {\n      setError('El código del producto es requerido');\n      return false;\n    }\n    \n    if (!formData.descripcion_producto.trim()) {\n      setError('La descripción del producto es requerida');\n      return false;\n    }\n    \n    if (!formData.categoria_id || formData.categoria_id === '') {\n      setError('La categoría es requerida');\n      return false;\n    }\n\n    // Validar unicidad del código de producto solo para productos nuevos o si cambió\n    if (!productoEditar || formData.codigo_producto !== (productoEditar as any).codigo_producto) {\n      try {\n        const { data: existente } = await supabase\n          .from('productos')\n          .select('id_producto')\n          .eq('codigo_producto', formData.codigo_producto)\n          .maybeSingle();\n\n        if (existente && (!productoEditar || existente.id_producto !== (productoEditar as any).id_producto)) {\n          setError('El código de producto ya existe. Generando uno nuevo...');\n          await generarCodigoProducto();\n          return false;\n        }\n      } catch (error) {\n        console.error('Error validando código:', error);\n      }\n    }\n\n    // Validar unicidad del código de sistema\n    if (formData.codigo_sistema) {\n      try {\n        const { data: existente } = await supabase\n          .from('productos')\n          .select('id_producto')\n          .eq('codigo_sistema', formData.codigo_sistema)\n          .maybeSingle();\n\n        if (existente && (!productoEditar || existente.id_producto !== (productoEditar as any).id_producto)) {\n          setError('El código de sistema ya existe. Generando uno nuevo...');\n          await generarCodigoSistema();\n          return false;\n        }\n      } catch (error) {\n        console.error('Error validando código de sistema:', error);\n      }\n    }\n\n    return true;\n  };\n\n  // Función auxiliar para verificar código único\n  const verificarCodigoUnico = async (codigo: string): Promise<boolean> => {\n    try {\n      const { data: existente } = await supabase\n        .from('productos')\n        .select('id_producto')\n        .eq('codigo_producto', codigo)\n        .maybeSingle();\n\n      return !existente;\n    } catch (error) {\n      console.error('Error verificando código:', error);\n      return false;\n    }\n  };\n\n  // Función auxiliar para generar código único\n  const generarCodigoUnico = async (): Promise<string> => {\n    try {\n      const { data } = await supabase\n        .from('productos')\n        .select('codigo_producto')\n        .like('codigo_producto', 'PROD-%')\n        .order('codigo_producto', { ascending: false })\n        .limit(1);\n\n      let siguienteNumero = 1;\n      \n      if (data && data.length > 0 && data[0].codigo_producto) {\n        const ultimoCodigo = data[0].codigo_producto;\n        const match = ultimoCodigo.match(/PROD-(\\d+)/);\n        if (match) {\n          const numero = parseInt(match[1]);\n          if (!isNaN(numero)) {\n            siguienteNumero = numero + 1;\n          }\n        }\n      }\n\n      // Verificar que el código no exista antes de asignarlo\n      let codigoUnico = false;\n      let intentos = 0;\n      let codigoGenerado = '';\n\n      while (!codigoUnico && intentos < 100) {\n        codigoGenerado = `PROD-${(siguienteNumero + intentos).toString().padStart(3, '0')}`;\n        \n        const { data: existente } = await supabase\n          .from('productos')\n          .select('id_producto')\n          .eq('codigo_producto', codigoGenerado)\n          .single();\n\n        if (!existente) {\n          codigoUnico = true;\n        } else {\n          intentos++;\n        }\n      }\n\n      return codigoGenerado;\n    } catch (error) {\n      console.error('Error generando código único:', error);\n      // Fallback con timestamp para garantizar unicidad\n      const timestamp = Date.now().toString().slice(-6);\n      return `PROD-${timestamp}`;\n    }\n  };\n\n  // Función para mapear ID de unidad a símbolo válido del enum\n  const mapearUnidad = (unidadId: number): string => {\n    const mapeoUnidades: { [key: number]: string } = {\n      1: 'Uni',    // Unidad\n      2: 'kg',     // Kilogramo\n      3: 'g',      // Gramo\n      4: 'm',      // Metro\n      5: 'cm',     // Centímetro\n      6: 'mm',     // Milímetro\n      7: 'h',      // Hora\n      8: 'min',    // Minuto\n      9: 's',      // Segundo\n      10: 'Uni'    // Por defecto Unidad\n    };\n    return mapeoUnidades[unidadId] || 'Uni';\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // Validar formulario\n      const esValido = await validarFormulario();\n      if (!esValido) {\n        setLoading(false);\n        return;\n      }\n\n      let productoId: number;\n\n      if (productoEditar) {\n        // Actualizar producto existente\n        const { data, error } = await supabase\n          .from('productos')\n          .update({\n            codigo_producto: formData.codigo_producto,\n            descripcion_producto: formData.descripcion_producto,\n            categoria_id: parseInt(formData.categoria_id),\n            codigo_sistema: formData.codigo_sistema,\n            costo_total_bom: costoTotal // Guardar el costo total calculado\n          })\n          .eq('id_producto', productoEditar.id_producto)\n          .select()\n          .single();\n\n        if (error) throw error;\n        productoId = data.id_producto;\n\n        // Eliminar componentes existentes del BOM antes de insertar los nuevos\n        const { error: deleteError } = await supabase\n          .from('bom_items')\n          .delete()\n          .eq('product_id', productoId);\n\n        if (deleteError) throw deleteError;\n      } else {\n        // Crear nuevo producto\n        const { data, error } = await supabase\n          .from('productos')\n          .insert({\n            codigo_producto: formData.codigo_producto,\n            descripcion_producto: formData.descripcion_producto,\n            categoria_id: parseInt(formData.categoria_id),\n            codigo_sistema: formData.codigo_sistema,\n            costo_total_bom: costoTotal // Guardar el costo total calculado\n          })\n          .select()\n          .single();\n\n        if (error) throw error;\n        productoId = data.id_producto;\n      }\n\n      // Guardar componentes del BOM si existen\n      if (bomItems.length > 0) {\n        const bomData = bomItems.map(comp => ({\n          product_id: productoId,\n          id_componente: comp.id_componente,\n          nombre_componente: comp.nombre_componente,\n          cantidad_x_unidad: comp.cantidad_x_unidad,\n          unidad_id: comp.unidad_id,\n          unidad: mapearUnidad(comp.unidad_id),\n          precio_unitario_base: comp.precio_unitario_base,\n          precio_ajustado: comp.precio_ajustado\n        }));\n\n        const { error: bomError } = await supabase\n          .from('bom_items')\n          .insert(bomData);\n\n        if (bomError) throw bomError;\n      }\n\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error('Error guardando producto:', error);\n      setError('Error al guardar el producto. Por favor, intenta nuevamente.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const agregarComponente = (articulo: any, cantidad: number, unidadId: number, precioAjustado: number) => {\n    if (!articulo?.id_articulo || !unidadId || cantidad <= 0) {\n      setError('Datos incompletos para agregar el componente');\n      return;\n    }\n\n    const nuevoItem: BOMItem = {\n      id_componente: articulo.id_articulo,\n      nombre_componente: articulo.descripcion_articulo,\n      cantidad_x_unidad: cantidad,\n      unidad_id: unidadId,\n      precio_unitario_base: articulo.precio_articulo,\n      precio_ajustado: precioAjustado,\n      categoria_nombre: articulo.categoria?.nombre,\n      unidad_nombre: articulo.unidad?.nombre,\n      unidad_simbolo: articulo.unidad?.simbolo\n    };\n\n    setBomItems([...bomItems, nuevoItem]);\n    setShowBuscarModal(false);\n  };\n\n  const eliminarComponente = (index: number) => {\n    setBomItems(bomItems.filter((_, i) => i !== index));\n  };\n\n  const editarComponente = (index: number, cantidad: number, unidadId: number, precioAjustado: number) => {\n    const items = [...bomItems];\n    if (index >= 0 && index < items.length) {\n      items[index] = {\n        ...items[index],\n        cantidad_x_unidad: cantidad,\n        unidad_id: unidadId,\n        precio_ajustado: precioAjustado\n      };\n      setBomItems(items);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"p-6\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-xl font-semibold text-gray-900\">\n              {producto ? 'Editar Producto' : 'Nuevo Producto'}\n            </h2>\n            <button\n              onClick={onCerrar}\n              className=\"text-gray-400 hover:text-gray-600\"\n            >\n              <i className=\"ri-close-line text-xl\"></i>\n            </button>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n              {error}\n            </div>\n          )}\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {/* Información básica del producto */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Código del Producto * (Autoincremental)\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.codigo_producto}\n                  readOnly\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 cursor-not-allowed\"\n                  placeholder=\"Se genera automáticamente\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Este código se genera automáticamente (PROD-001, PROD-002, etc.)\n                </p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Categoría *\n                </label>\n                <select\n                  value={formData.categoria_id}\n                  onChange={(e) => setFormData({ ...formData, categoria_id: e.target.value })}\n                  className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  required\n                >\n                  <option value=\"\">Seleccionar categoría</option>\n                  {categorias.map(cat => (\n                    <option key={cat.id} value={cat.id}>{cat.nombre}</option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Descripción del Producto *\n                </label>\n                <textarea\n                  value={formData.descripcion_producto}\n                  onChange={(e) => setFormData({...formData, descripcion_producto: e.target.value})}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  rows={3}\n                  required\n                  placeholder=\"Descripción detallada del producto\"\n                />\n              </div>\n\n              <div className=\"md:col-span-2\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Código de Sistema {!producto && '*'}\n                </label>\n                <div className=\"flex gap-2\">\n                  <input\n                    type=\"text\"\n                    value={formData.codigo_sistema}\n                    onChange={(e) => setFormData({ ...formData, codigo_sistema: e.target.value })}\n                    readOnly={!!producto}\n                    className={`flex-1 px-3 py-2 border border-gray-300 rounded-lg ${\n                      producto \n                        ? 'bg-gray-50 text-gray-600 cursor-not-allowed' \n                        : 'focus:ring-2 focus:ring-blue-500 focus:border-transparent'\n                    }`}\n                    placeholder={producto ? \"Código asignado\" : \"Ingrese código de sistema\"}\n                    required={!producto}\n                  />\n                  {!producto && (\n                    <button\n                      type=\"button\"\n                      onClick={generarCodigoSistema}\n                      className=\"bg-blue-100 text-blue-600 px-3 py-2 rounded-lg hover:bg-blue-200 transition-colors whitespace-nowrap\"\n                      title=\"Generar código automático\"\n                    >\n                      <i className=\"ri-refresh-line\"></i>\n                    </button>\n                  )}\n                </div>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {producto \n                    ? \"El código de sistema no se puede modificar al editar\" \n                    : \"Ingrese un código único o genere uno automáticamente\"\n                  }\n                </p>\n              </div>\n            </div>\n\n            {/* Sección BOM */}\n            <div className=\"border-t pt-6\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-lg font-medium text-gray-900\">\n                  Lista de Materiales (BOM)\n                </h3>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowBuscarModal(true)}\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap\"\n                >\n                  <i className=\"ri-add-line mr-2\"></i>\n                  Agregar Componente\n                </button>\n              </div>\n\n              <BOMTable\n                items={bomItems}\n                onEliminar={eliminarComponente}\n                onEditar={editarComponente}\n              />\n\n              {bomItems.length > 0 && (\n                <div className=\"mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"font-medium text-blue-900\">Costo Total del Producto:</span>\n                    <span className=\"text-xl font-bold text-blue-900\">\n                      {formatCurrency(costoTotal)}\n                    </span>\n                  </div>\n                  <p className=\"text-xs text-blue-700 mt-1\">\n                    Suma de todos los componentes BOM\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Botones */}\n            <div className=\"flex gap-3 pt-4 border-t\">\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-770 transition-colors disabled:opacity-50 whitespace-nowrap\"\n              >\n                {loading ? (\n                  <>\n                    <i className=\"ri-loader-line animate-spin mr-2\"></i>\n                    Guardando...\n                  </>\n                ) : (\n                  <>\n                    <i className=\"ri-save-line mr-2\"></i>\n                    {producto ? 'Actualizar' : 'Crear'} Producto\n                  </>\n                )}\n              </button>\n              <button\n                type=\"button\"\n                onClick={onCerrar}\n                className=\"flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors whitespace-nowrap\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n\n      {/* Modal de búsqueda de artículos */}\n      {showBuscarModal && (\n        <BuscarArticuloModal\n          onSeleccionar={agregarComponente}\n          onCerrar={() => setShowBuscarModal(false)}\n        />\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { PermissionButton } from '../../../components/base/PermissionButton';\n\ninterface Producto {\n  id_producto: number;\n  codigo_producto: string;\n  descripcion: string;\n  categoria_id: number;\n  codigo_sistema?: string;\n  activo?: boolean;\n  categoria?: {\n    nombre: string;\n  };\n  created_at: string;\n}\n\ninterface Props {\n  productos: Producto[];\n  loading?: boolean;\n  onEdit: (producto: Producto) => void;\n  onEliminar: (id: number) => void;\n  onInactivar: (id: number) => void;\n}\n\nexport default function ProductosTable({ productos, loading, onEdit, onEliminar, onInactivar }: Props) {\n  return (\n    <div className=\"overflow-x-auto\">\n      <table className=\"min-w-full divide-y divide-gray-200\">\n        <thead className=\"bg-gray-50\">\n          <tr>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Estado\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Código\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Descripción\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Categoría\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Código Sistema\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Costo Total BOM\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Fecha Creación\n            </th>\n            <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Acciones\n            </th>\n          </tr>\n        </thead>\n        <tbody className=\"bg-white divide-y divide-gray-200\">\n          {productos.map((producto) => (\n            <tr \n              key={producto.id_producto} \n              className={`border-b hover:bg-gray-50 ${!producto.activo ? 'bg-red-50' : ''}`}\n            >\n              {/* Estado */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <span className={`px-2 py-1 rounded-full text-xs ${\n                    producto.activo \n                      ? 'bg-green-100 text-green-800' \n                      : 'bg-red-100 text-red-800'\n                  }`}>\n                    {producto.activo ? 'Activo' : 'Inactivo'}\n                  </span>\n                </div>\n              </td>\n              \n              {/* Código */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                {producto.codigo_producto}\n              </td>\n              \n              {/* Descripción */}\n              <td className=\"px-6 py-4 text-sm text-gray-900\">\n                {(producto as any).descripcion_producto || producto.descripcion}\n              </td>\n              \n              {/* Categoría */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                {(producto as any).categorias?.nombre || producto.categoria?.nombre || 'Sin categoría'}\n              </td>\n              \n              {/* Código Sistema */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                {producto.codigo_sistema || '-'}\n              </td>\n              \n              {/* Costo Total BOM */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                {new Intl.NumberFormat('es-CR', {\n                  style: 'currency',\n                  currency: 'CRC',\n                  minimumFractionDigits: 2,\n                  maximumFractionDigits: 2\n                }).format((producto as any).costo_total_bom || 0)}\n              </td>\n              \n              {/* Fecha Creación */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                {producto.created_at ? new Date(producto.created_at).toLocaleDateString('es-ES') : 'Sin fecha'}\n              </td>\n              \n              {/* Acciones */}\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                <div className=\"flex space-x-2 justify-end\">\n                  <PermissionButton\n                    permission=\"productos:edit\"\n                    variant=\"icon\"\n                    onClick={() => onEdit(producto)}\n                    title=\"Editar producto\"\n                    className=\"text-blue-600 hover:bg-blue-50\"\n                  >\n                    <i className=\"ri-edit-line w-4 h-4 flex items-center justify-center\"></i>\n                  </PermissionButton>\n                  \n                  <PermissionButton\n                    permission=\"productos:edit\"\n                    variant=\"icon\"\n                    onClick={() => onInactivar(producto.id_producto)}\n                    title={producto.activo ? 'Inactivar producto' : 'Activar producto'}\n                    className={producto.activo \n                      ? 'text-orange-600 hover:bg-orange-50' \n                      : 'text-green-600 hover:bg-green-50'\n                    }\n                  >\n                    <i className={`${producto.activo ? 'ri-pause-line' : 'ri-play-line'} w-4 h-4 flex items-center justify-center`}></i>\n                  </PermissionButton>\n                  \n                  <PermissionButton\n                    permission=\"productos:delete\"\n                    variant=\"icon\"\n                    onClick={() => onEliminar(producto.id_producto)}\n                    title=\"Eliminar permanentemente\"\n                    className=\"text-red-600 hover:bg-red-50\"\n                  >\n                    <i className=\"ri-delete-bin-line w-4 h-4 flex items-center justify-center\"></i>\n                  </PermissionButton>\n                </div>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n","\nimport { ReactNode, useState } from 'react';\nimport Sidebar from '../../../components/feature/Sidebar';\nimport TopBar from '../../../components/feature/TopBar';\nimport MobileNav from '../../../components/feature/MobileNav';\n\ninterface ProductosLayoutProps {\n  children: ReactNode;\n}\n\nexport default function ProductosLayout({ children }: ProductosLayoutProps) {\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex\">\n      {/* Sidebar */}\n      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n\n      {/* Contenido principal */}\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        {/* TopBar */}\n        <TopBar onMenuClick={() => setSidebarOpen(true)} />\n        \n        {/* Contenido */}\n        <main className=\"flex-1 p-4 lg:p-6 pb-20 lg:pb-6 overflow-auto\">\n          <div className=\"max-w-7xl mx-auto\">\n            {children}\n          </div>\n        </main>\n      </div>\n\n      {/* Navegación móvil */}\n      <MobileNav />\n    </div>\n  );\n}\n","\nimport { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport ProductosForm from './components/ProductosForm';\nimport ProductosTable from './components/ProductosTable';\nimport ProductosLayout from './components/ProductosLayout';\nimport { PermissionButton } from '../../components/base/PermissionButton';\n\ninterface Producto {\n  id_producto: number;\n  codigo_producto: string;\n  descripcion_producto: string;\n  categoria_id: number;\n  codigo_sistema?: string;\n  activo?: boolean;\n  categoria?: {\n    nombre: string;\n  };\n  created_at: string;\n}\n\ninterface Categoria {\n  id: number;\n  nombre: string;\n}\n\nexport default function ProductosPage() {\n  const [productos, setProductos] = useState<Producto[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showForm, setShowForm] = useState(false);\n  const [editingProducto, setEditingProducto] = useState<Producto | null>(null);\n  const [categorias, setCategorias] = useState<Categoria[]>([]);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n  \n  // Estados para filtros con búsqueda en tiempo real\n  const [filtros, setFiltros] = useState({\n    busqueda: '',\n    categoria: null as number | null,\n    mostrarInactivos: false,\n    ordenar: 'codigo_producto' as keyof Producto\n  });\n\n  // Estados para paginación\n  const [paginaActual, setPaginaActual] = useState(1);\n  const [registrosPorPagina, setRegistrosPorPagina] = useState(10);\n  const [totalRegistros, setTotalRegistros] = useState(0);\n\n  // Cargar datos iniciales\n  useEffect(() => {\n    cargarProductos();\n    cargarCategorias();\n  }, []);\n\n  // Cargar productos cuando cambian los filtros o la paginación\n  useEffect(() => {\n    cargarProductos();\n  }, [filtros.busqueda, filtros.categoria, filtros.mostrarInactivos, filtros.ordenar, refreshTrigger, paginaActual, registrosPorPagina]);\n\n  const cargarCategorias = async () => {\n    const { data } = await supabase\n      .from('categorias')\n      .select('*')\n      .order('nombre');\n    setCategorias(data as Categoria[] || []);\n  };\n\n  const cargarProductos = async () => {\n    setLoading(true);\n    try {\n      // Primero obtener el total de registros para la paginación\n      let countQuery = supabase\n        .from('productos')\n        .select('*', { count: 'exact', head: true });\n\n      // Aplicar los mismos filtros para el conteo\n      if (filtros.busqueda.trim()) {\n        countQuery = countQuery.or(`codigo_producto.ilike.%${filtros.busqueda}%,descripcion_producto.ilike.%${filtros.busqueda}%,codigo_sistema.ilike.%${filtros.busqueda}%`);\n      }\n\n      if (filtros.categoria) {\n        countQuery = countQuery.eq('categoria_id', filtros.categoria);\n      }\n\n      if (!filtros.mostrarInactivos) {\n        countQuery = countQuery.eq('activo', true);\n      }\n\n      const { count } = await countQuery;\n      setTotalRegistros(count || 0);\n\n      // Ahora obtener los datos con paginación\n      const desde = (paginaActual - 1) * registrosPorPagina;\n      const hasta = desde + registrosPorPagina - 1;\n\n      let query = supabase\n        .from('productos')\n        .select(`\n          *,\n          categorias(nombre),\n          costo_total_bom:bom_items(precio_ajustado)\n        `)\n        .range(desde, hasta);\n\n      // Filtro de búsqueda\n      if (filtros.busqueda.trim()) {\n        query = query.or(`codigo_producto.ilike.%${filtros.busqueda}%,descripcion_producto.ilike.%${filtros.busqueda}%,codigo_sistema.ilike.%${filtros.busqueda}%`);\n      }\n\n      // Filtro de categoría\n      if (filtros.categoria) {\n        query = query.eq('categoria_id', filtros.categoria);\n      }\n\n      // Filtro de activos/inactivos\n      if (!filtros.mostrarInactivos) {\n        query = query.eq('activo', true);\n      }\n\n      query = query.order(filtros.ordenar);\n\n      const { data, error } = await query;\n      \n      if (error) throw error;\n      \n      // Calcular el costo total BOM para cada producto\n      const productosConCosto = (data || []).map(producto => {\n        const costoTotal = producto.costo_total_bom?.reduce((sum: number, item: any) => sum + (item.precio_ajustado || 0), 0) || 0;\n        return {\n          ...producto,\n          costo_total_bom: costoTotal\n        };\n      });\n      \n      setProductos(productosConCosto as Producto[] || []);\n    } catch (err) {\n      console.error('Error cargando productos:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Función de búsqueda en tiempo real (sin debounce)\n  const handleBusquedaChange = (valor: string) => {\n    setFiltros(prev => ({ ...prev, busqueda: valor }));\n    setPaginaActual(1); // Resetear a la primera página al buscar\n  };\n\n  const handleEliminarProducto = async (id: number) => {\n    if (!confirm('¿Estás seguro de eliminar permanentemente este producto? Esta acción no se puede deshacer.')) return;\n\n    try {\n      const { data: bomItems } = await supabase\n        .from('bom_items')\n        .select('id')\n        .eq('producto_id', id);\n\n      if (bomItems && bomItems.length > 0) {\n        alert('No se puede eliminar este producto porque tiene componentes BOM asociados. Considera inactivarlo en su lugar.');\n        return;\n      }\n\n      const { error } = await supabase\n        .from('productos')\n        .delete()\n        .eq('id_producto', id);\n\n      if (error) throw error;\n      \n      cargarProductos();\n      alert('Producto eliminado exitosamente');\n    } catch (err) {\n      console.error('Error eliminando producto:', err);\n      alert('Error al eliminar el producto');\n    }\n  };\n\n  const handleInactivarProducto = async (id: number) => {\n    try {\n      const { data: producto } = await supabase\n        .from('productos')\n        .select('activo')\n        .eq('id_producto', id)\n        .single();\n\n      const nuevoEstado = !producto?.activo;\n      const accion = nuevoEstado ? 'activar' : 'inactivar';\n      \n      if (!confirm(`¿Estás seguro de ${accion} este producto?`)) return;\n\n      const { error } = await supabase\n        .from('productos')\n        .update({ activo: nuevoEstado })\n        .eq('id_producto', id);\n      \n      if (error) throw error;\n      await cargarProductos();\n      alert(`Producto ${nuevoEstado ? 'activado' : 'inactivado'} correctamente`);\n    } catch (err) {\n      console.error('Error cambiando estado del producto:', err);\n      alert('Error al cambiar el estado del producto');\n    }\n  };\n\n  const handleEditarProducto = (producto: Producto) => {\n    setEditingProducto(producto);\n    setShowForm(true);\n  };\n\n  const cerrarForm = () => {\n    setShowForm(false);\n    setEditingProducto(null);\n  };\n\n  const handleGuardarProducto = () => {\n    cargarProductos();\n    cerrarForm();\n  };\n\n  // Calcular información de paginación\n  const totalPaginas = Math.ceil(totalRegistros / registrosPorPagina);\n  const registroDesde = totalRegistros === 0 ? 0 : (paginaActual - 1) * registrosPorPagina + 1;\n  const registroHasta = Math.min(paginaActual * registrosPorPagina, totalRegistros);\n\n  if (loading && productos.length === 0) {\n    return (\n      <ProductosLayout>\n        <div className=\"flex justify-center items-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n        </div>\n      </ProductosLayout>\n    );\n  }\n\n  return (\n    <ProductosLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex justify-between items-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Gestión de Productos</h1>\n          <PermissionButton\n            permission=\"productos:create\"\n            variant=\"primary\"\n            onClick={() => setShowForm(true)}\n          >\n            <i className=\"ri-add-line mr-2\"></i>\n            Nuevo Producto\n          </PermissionButton>\n        </div>\n\n        {/* Filtros */}\n        <div className=\"bg-white rounded-lg shadow p-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {/* Búsqueda en tiempo real */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Buscar\n              </label>\n              <div className=\"relative\">\n                <input\n                  type=\"text\"\n                  value={filtros.busqueda}\n                  onChange={(e) => handleBusquedaChange(e.target.value)}\n                  placeholder=\"Código, descripción o código sistema...\"\n                  className=\"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n                <i className=\"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\"></i>\n                {loading && filtros.busqueda && (\n                  <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\"></div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Categoría */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Categoría\n              </label>\n              <select\n                value={filtros.categoria || ''}\n                onChange={(e) => {\n                  setFiltros(prev => ({ \n                    ...prev, \n                    categoria: e.target.value ? parseInt(e.target.value) : null \n                  }));\n                  setPaginaActual(1);\n                }}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8\"\n              >\n                <option value=\"\">Todas las categorías</option>\n                {categorias.map(categoria => (\n                  <option key={categoria.id} value={categoria.id}>\n                    {categoria.nombre}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            {/* Ordenar por */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Ordenar por\n              </label>\n              <select\n                value={filtros.ordenar}\n                onChange={(e) => setFiltros(prev => ({ \n                  ...prev, \n                  ordenar: e.target.value as keyof Producto \n                }))}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8\"\n              >\n                <option value=\"codigo_producto\">Código Producto</option>\n                <option value=\"descripcion_producto\">Descripción</option>\n                <option value=\"codigo_sistema\">Código Sistema</option>\n                <option value=\"created_at\">Fecha Creación</option>\n              </select>\n            </div>\n\n            {/* Mostrar inactivos */}\n            <div className=\"flex items-end\">\n              <label className=\"flex items-center space-x-2 cursor-pointer\">\n                <input\n                  type=\"checkbox\"\n                  checked={filtros.mostrarInactivos}\n                  onChange={(e) => {\n                    setFiltros(prev => ({ \n                      ...prev, \n                      mostrarInactivos: e.target.checked \n                    }));\n                    setPaginaActual(1);\n                  }}\n                  className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                />\n                <span className=\"text-sm text-gray-700\">Mostrar inactivos</span>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        {/* Información de paginación y selector de registros */}\n        <div className=\"bg-white rounded-lg shadow p-4\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-gray-700\">Mostrar</span>\n              <select\n                value={registrosPorPagina}\n                onChange={(e) => {\n                  setRegistrosPorPagina(Number(e.target.value));\n                  setPaginaActual(1);\n                }}\n                className=\"px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8\"\n              >\n                <option value={10}>10</option>\n                <option value={50}>50</option>\n                <option value={100}>100</option>\n              </select>\n              <span className=\"text-sm text-gray-700\">registros</span>\n            </div>\n\n            <div className=\"text-sm text-gray-700\">\n              Mostrando {registroDesde} a {registroHasta} de {totalRegistros} registros\n            </div>\n\n            {/* Controles de paginación */}\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={() => setPaginaActual(1)}\n                disabled={paginaActual === 1}\n                className=\"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Primera página\"\n              >\n                <i className=\"ri-skip-back-mini-line\"></i>\n              </button>\n              <button\n                onClick={() => setPaginaActual(prev => Math.max(1, prev - 1))}\n                disabled={paginaActual === 1}\n                className=\"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Página anterior\"\n              >\n                <i className=\"ri-arrow-left-s-line\"></i>\n              </button>\n              \n              <span className=\"px-4 py-1 text-sm text-gray-700\">\n                Página {paginaActual} de {totalPaginas || 1}\n              </span>\n              \n              <button\n                onClick={() => setPaginaActual(prev => Math.min(totalPaginas, prev + 1))}\n                disabled={paginaActual >= totalPaginas}\n                className=\"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Página siguiente\"\n              >\n                <i className=\"ri-arrow-right-s-line\"></i>\n              </button>\n              <button\n                onClick={() => setPaginaActual(totalPaginas)}\n                disabled={paginaActual >= totalPaginas}\n                className=\"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n                title=\"Última página\"\n              >\n                <i className=\"ri-skip-forward-mini-line\"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Formulario Modal */}\n        {showForm && (\n          <ProductosForm\n            producto={editingProducto}\n            onGuardar={handleGuardarProducto}\n            onCerrar={() => {\n              setShowForm(false);\n              setEditingProducto(null);\n            }}\n          />\n        )}\n\n        {/* Tabla de productos */}\n        <ProductosTable\n          productos={productos}\n          loading={loading}\n          onEdit={handleEditarProducto}\n          onInactivar={handleInactivarProducto}\n          onEliminar={handleEliminarProducto}\n        />\n      </div>\n    </ProductosLayout>\n  );\n}\n"],"names":["CrearArticuloModal","nombreInicial","onCreado","onCerrar","formData","setFormData","useState","categorias","setCategorias","unidades","setUnidades","loading","setLoading","error","setError","useEffect","cargarDatos","categoriasRes","unidadesRes","supabase","generarCodigo","timestamp","random","validarFormulario","costo","ganancia","existente","crearArticulo","e","datosArticulo","data","err","jsx","jsxs","cat","unidad","Fragment","DetalleComponenteModal","articulo","onConfirmar","cantidad","setCantidad","unidadId","setUnidadId","precioAjustado","setPrecioAjustado","factorConversion","setFactorConversion","cargarUnidades","calcularPrecioAjustado","unidadBase","u","calcularFactorConversion","unidadDestinoId","unidadDestino","factor","cantidadNum","precioBase","precio","manejarCambioUnidad","nuevaUnidadId","manejarCambioCantidad","valor","confirmar","unidadesPorGrupo","grupos","grupo","unidadesGrupo","BuscarArticuloModal","onSeleccionar","busqueda","setBusqueda","articulos","setArticulos","showCrearModal","setShowCrearModal","showDetalleModal","setShowDetalleModal","articuloSeleccionado","setArticuloSeleccionado","timeoutRef","useRef","buscarArticulos","seleccionarArticulo","confirmarSeleccion","onArticuloCreado","nuevoArticulo","BOMTable","items","onEliminar","onEditar","editingIndex","setEditingIndex","editData","setEditData","iniciarEdicion","index","item","guardarEdicion","cancelarEdicion","eliminarItem","formatCurrency","ProductosForm","producto","onGuardar","productoEditar","onSuccess","onClose","bomItems","setBomItems","showBuscarModal","setShowBuscarModal","costoTotal","setCostoTotal","cargarCategorias","cargarBOMItems","generarCodigoProducto","calcularCostoTotal","generarCodigoSistema","siguienteNumero","ultimoCodigo","numero","codigoUnico","intentos","codigoGenerado","prev","match","productoId","total","sum","mapearUnidad","handleSubmit","deleteError","bomData","comp","bomError","agregarComponente","nuevoItem","eliminarComponente","_","i","editarComponente","ProductosTable","productos","onEdit","onInactivar","PermissionButton","ProductosLayout","children","sidebarOpen","setSidebarOpen","Sidebar","TopBar","MobileNav","ProductosPage","setProductos","showForm","setShowForm","editingProducto","setEditingProducto","refreshTrigger","setRefreshTrigger","filtros","setFiltros","paginaActual","setPaginaActual","registrosPorPagina","setRegistrosPorPagina","totalRegistros","setTotalRegistros","cargarProductos","countQuery","count","desde","hasta","query","productosConCosto","handleBusquedaChange","handleEliminarProducto","id","handleInactivarProducto","nuevoEstado","handleEditarProducto","cerrarForm","handleGuardarProducto","totalPaginas","registroDesde","registroHasta","categoria"],"mappings":"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"}