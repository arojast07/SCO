import{r as i,u as x,j as e,s}from"./index-Xz42BvxI.js";function b(){const[d,m]=i.useState(!0),[n,t]=i.useState(null),o=x();return i.useEffect(()=>{(async()=>{try{console.log("Procesando callback de autenticación...");const{data:a,error:l}=await s.auth.getSession();if(l){console.error("Error en callback:",l),t("Error al confirmar el correo electrónico");return}if(a.session?.user){console.log("Usuario confirmado exitosamente:",a.session.user.id);try{const r=a.session.user,{data:u}=await s.from("usuarios").select("id").eq("email",r.email).single(),c={id:r.id,email:r.email,nombre_completo:r.user_metadata?.nombre_completo||r.email||"Usuario",rol:"Usuario",activo:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};u?(console.log("Usuario ya existe en BD, actualizando información..."),await s.from("usuarios").update({nombre_completo:c.nombre_completo,updated_at:new Date().toISOString()}).eq("email",r.email)):(console.log("Creando perfil en BD..."),await s.from("usuarios").insert([c])),console.log("Perfil creado/actualizado exitosamente")}catch(r){console.error("Error creando perfil en BD:",r)}setTimeout(()=>{o("/dashboard",{replace:!0})},2e3)}else console.log("No hay sesión activa"),t("No se pudo confirmar el correo electrónico")}catch(a){console.error("Error procesando callback:",a),t("Error inesperado al confirmar el correo")}finally{m(!1)}})()},[o]),d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Confirmando tu correo electrónico..."}),e.jsx("p",{className:"text-gray-600",children:"Por favor espera mientras procesamos tu confirmación"})]})}):n?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("i",{className:"ri-error-warning-line text-red-600 text-xl"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error de Confirmación"}),e.jsx("p",{className:"text-gray-600 mb-4",children:n}),e.jsx("button",{onClick:()=>o("/login"),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Ir al Login"})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:e.jsx("i",{className:"ri-check-line text-green-600 text-xl"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"¡Correo Confirmado Exitosamente!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Tu cuenta ha sido verificada. Redirigiendo al dashboard..."}),e.jsx("div",{className:"animate-pulse text-blue-600",children:"Redirigiendo en unos segundos..."})]})})}export{b as default};
//# sourceMappingURL=CallbackPage-DOvhzRP0.js.map
