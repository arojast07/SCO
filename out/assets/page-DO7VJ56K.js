import{j as i,r as b,s as C,u as le}from"./index-Xz42BvxI.js";import{f as ce}from"./currency-BmxXlzML.js";import{u as ue,S as me,T as he}from"./TopBar-BLe2nnBZ.js";function fe({children:r}){return i.jsx("div",{className:"min-h-screen bg-gray-50",children:i.jsxs("div",{className:"max-w-[1920px] mx-auto",children:[i.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Seguimiento de Pedidos"}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitorea el progreso de producción y entrega de tus pedidos en tiempo real"})]})})}),i.jsx("div",{className:"p-6",children:r})]})})}function ge({estados:r,seguimientos:t,onUpdateEstado:e,onViewDetails:a}){const[n,o]=b.useState(null),s=d=>(t||[]).filter(u=>u.estado_actual===d),l=d=>{o(d)},c=d=>{d.preventDefault()},m=d=>{n&&n.estado_actual!==d&&e(n.id,d),o(null)};return!t||t.length===0?i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx("i",{className:"ri-inbox-line text-4xl mb-2"}),i.jsx("p",{children:"No hay solicitudes para mostrar"})]}):i.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:r.map(d=>{const u=s(d.codigo);return i.jsxs("div",{className:"flex-shrink-0 w-80 bg-gray-50 rounded-lg",onDragOver:c,onDrop:()=>m(d.codigo),children:[i.jsx("div",{className:"p-4 border-b border-gray-200",style:{backgroundColor:d.color+"20"},children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:d.nombre}),i.jsx("span",{className:"bg-white px-2 py-1 rounded-full text-sm font-medium",children:u.length})]})}),i.jsx("div",{className:"p-4 space-y-3 min-h-[200px]",children:u.map(h=>i.jsxs("div",{draggable:!0,onDragStart:()=>l(h),className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 cursor-move hover:shadow-md transition-shadow",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("span",{className:"font-semibold text-gray-900",children:h.codigo}),i.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium",style:{backgroundColor:d.color+"20",color:d.color},children:d.nombre})]}),i.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:h.descripcion}),i.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[i.jsxs("span",{children:[i.jsx("i",{className:"ri-user-line mr-1"}),h.cliente_nombre||"Sin cliente"]}),i.jsx("span",{children:h.prioridad&&i.jsx("span",{className:`px-2 py-1 rounded ${h.prioridad==="urgente"?"bg-red-100 text-red-700":h.prioridad==="alta"?"bg-orange-100 text-orange-700":h.prioridad==="media"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:h.prioridad})})]}),i.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 flex gap-2",children:i.jsxs("button",{onClick:()=>a(h),className:"flex-1 px-3 py-1.5 bg-blue-50 text-blue-600 rounded text-sm font-medium hover:bg-blue-100 transition-colors",children:[i.jsx("i",{className:"ri-eye-line mr-1"}),"Ver Detalle"]})})]},h.id))})]},d.id)})})}function X(r){"@babel/helpers - typeof";return X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(r)}function W(r){if(r===null||r===!0||r===!1)return NaN;var t=Number(r);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function p(r,t){if(t.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+t.length+" present")}function M(r){p(1,arguments);var t=Object.prototype.toString.call(r);return r instanceof Date||X(r)==="object"&&t==="[object Date]"?new Date(r.getTime()):typeof r=="number"||t==="[object Number]"?new Date(r):((typeof r=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function ve(r,t){p(2,arguments);var e=M(r).getTime(),a=W(t);return new Date(e+a)}var be={};function I(){return be}function xe(r){var t=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return t.setUTCFullYear(r.getFullYear()),r.getTime()-t.getTime()}function ye(r){return p(1,arguments),r instanceof Date||X(r)==="object"&&Object.prototype.toString.call(r)==="[object Date]"}function pe(r){if(p(1,arguments),!ye(r)&&typeof r!="number")return!1;var t=M(r);return!isNaN(Number(t))}function we(r,t){p(2,arguments);var e=W(t);return ve(r,-e)}var je=864e5;function Ne(r){p(1,arguments);var t=M(r),e=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var a=t.getTime(),n=e-a;return Math.floor(n/je)+1}function A(r){p(1,arguments);var t=1,e=M(r),a=e.getUTCDay(),n=(a<t?7:0)+a-t;return e.setUTCDate(e.getUTCDate()-n),e.setUTCHours(0,0,0,0),e}function K(r){p(1,arguments);var t=M(r),e=t.getUTCFullYear(),a=new Date(0);a.setUTCFullYear(e+1,0,4),a.setUTCHours(0,0,0,0);var n=A(a),o=new Date(0);o.setUTCFullYear(e,0,4),o.setUTCHours(0,0,0,0);var s=A(o);return t.getTime()>=n.getTime()?e+1:t.getTime()>=s.getTime()?e:e-1}function Ce(r){p(1,arguments);var t=K(r),e=new Date(0);e.setUTCFullYear(t,0,4),e.setUTCHours(0,0,0,0);var a=A(e);return a}var Te=6048e5;function De(r){p(1,arguments);var t=M(r),e=A(t).getTime()-Ce(t).getTime();return Math.round(e/Te)+1}function V(r,t){var e,a,n,o,s,l,c,m;p(1,arguments);var d=I(),u=W((e=(a=(n=(o=t?.weekStartsOn)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&n!==void 0?n:d.weekStartsOn)!==null&&a!==void 0?a:(c=d.locale)===null||c===void 0||(m=c.options)===null||m===void 0?void 0:m.weekStartsOn)!==null&&e!==void 0?e:0);if(!(u>=0&&u<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=M(r),v=h.getUTCDay(),x=(v<u?7:0)+v-u;return h.setUTCDate(h.getUTCDate()-x),h.setUTCHours(0,0,0,0),h}function Z(r,t){var e,a,n,o,s,l,c,m;p(1,arguments);var d=M(r),u=d.getUTCFullYear(),h=I(),v=W((e=(a=(n=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:h.firstWeekContainsDate)!==null&&a!==void 0?a:(c=h.locale)===null||c===void 0||(m=c.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&e!==void 0?e:1);if(!(v>=1&&v<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setUTCFullYear(u+1,0,v),x.setUTCHours(0,0,0,0);var j=V(x,t),g=new Date(0);g.setUTCFullYear(u,0,v),g.setUTCHours(0,0,0,0);var N=V(g,t);return d.getTime()>=j.getTime()?u+1:d.getTime()>=N.getTime()?u:u-1}function Me(r,t){var e,a,n,o,s,l,c,m;p(1,arguments);var d=I(),u=W((e=(a=(n=(o=t?.firstWeekContainsDate)!==null&&o!==void 0?o:t==null||(s=t.locale)===null||s===void 0||(l=s.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&n!==void 0?n:d.firstWeekContainsDate)!==null&&a!==void 0?a:(c=d.locale)===null||c===void 0||(m=c.options)===null||m===void 0?void 0:m.firstWeekContainsDate)!==null&&e!==void 0?e:1),h=Z(r,t),v=new Date(0);v.setUTCFullYear(h,0,u),v.setUTCHours(0,0,0,0);var x=V(v,t);return x}var Pe=6048e5;function _e(r,t){p(1,arguments);var e=M(r),a=V(e,t).getTime()-Me(e,t).getTime();return Math.round(a/Pe)+1}function f(r,t){for(var e=r<0?"-":"",a=Math.abs(r).toString();a.length<t;)a="0"+a;return e+a}var S={y:function(t,e){var a=t.getUTCFullYear(),n=a>0?a:1-a;return f(e==="yy"?n%100:n,e.length)},M:function(t,e){var a=t.getUTCMonth();return e==="M"?String(a+1):f(a+1,2)},d:function(t,e){return f(t.getUTCDate(),e.length)},a:function(t,e){var a=t.getUTCHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];default:return a==="am"?"a.m.":"p.m."}},h:function(t,e){return f(t.getUTCHours()%12||12,e.length)},H:function(t,e){return f(t.getUTCHours(),e.length)},m:function(t,e){return f(t.getUTCMinutes(),e.length)},s:function(t,e){return f(t.getUTCSeconds(),e.length)},S:function(t,e){var a=e.length,n=t.getUTCMilliseconds(),o=Math.floor(n*Math.pow(10,a-3));return f(o,e.length)}},Y={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Se={G:function(t,e,a){var n=t.getUTCFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});default:return a.era(n,{width:"wide"})}},y:function(t,e,a){if(e==="yo"){var n=t.getUTCFullYear(),o=n>0?n:1-n;return a.ordinalNumber(o,{unit:"year"})}return S.y(t,e)},Y:function(t,e,a,n){var o=Z(t,n),s=o>0?o:1-o;if(e==="YY"){var l=s%100;return f(l,2)}return e==="Yo"?a.ordinalNumber(s,{unit:"year"}):f(s,e.length)},R:function(t,e){var a=K(t);return f(a,e.length)},u:function(t,e){var a=t.getUTCFullYear();return f(a,e.length)},Q:function(t,e,a){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return f(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,a){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return f(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,a){var n=t.getUTCMonth();switch(e){case"M":case"MM":return S.M(t,e);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,a){var n=t.getUTCMonth();switch(e){case"L":return String(n+1);case"LL":return f(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,a,n){var o=_e(t,n);return e==="wo"?a.ordinalNumber(o,{unit:"week"}):f(o,e.length)},I:function(t,e,a){var n=De(t);return e==="Io"?a.ordinalNumber(n,{unit:"week"}):f(n,e.length)},d:function(t,e,a){return e==="do"?a.ordinalNumber(t.getUTCDate(),{unit:"date"}):S.d(t,e)},D:function(t,e,a){var n=Ne(t);return e==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):f(n,e.length)},E:function(t,e,a){var n=t.getUTCDay();switch(e){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,a,n){var o=t.getUTCDay(),s=(o-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return f(s,2);case"eo":return a.ordinalNumber(s,{unit:"day"});case"eee":return a.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(o,{width:"short",context:"formatting"});default:return a.day(o,{width:"wide",context:"formatting"})}},c:function(t,e,a,n){var o=t.getUTCDay(),s=(o-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return f(s,e.length);case"co":return a.ordinalNumber(s,{unit:"day"});case"ccc":return a.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(o,{width:"narrow",context:"standalone"});case"cccccc":return a.day(o,{width:"short",context:"standalone"});default:return a.day(o,{width:"wide",context:"standalone"})}},i:function(t,e,a){var n=t.getUTCDay(),o=n===0?7:n;switch(e){case"i":return String(o);case"ii":return f(o,e.length);case"io":return a.ordinalNumber(o,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,a){var n=t.getUTCHours(),o=n/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(o,{width:"narrow",context:"formatting"});default:return a.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(t,e,a){var n=t.getUTCHours(),o;switch(n===12?o=Y.noon:n===0?o=Y.midnight:o=n/12>=1?"pm":"am",e){case"b":case"bb":return a.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(o,{width:"narrow",context:"formatting"});default:return a.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(t,e,a){var n=t.getUTCHours(),o;switch(n>=17?o=Y.evening:n>=12?o=Y.afternoon:n>=4?o=Y.morning:o=Y.night,e){case"B":case"BB":case"BBB":return a.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(o,{width:"narrow",context:"formatting"});default:return a.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(t,e,a){if(e==="ho"){var n=t.getUTCHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return S.h(t,e)},H:function(t,e,a){return e==="Ho"?a.ordinalNumber(t.getUTCHours(),{unit:"hour"}):S.H(t,e)},K:function(t,e,a){var n=t.getUTCHours()%12;return e==="Ko"?a.ordinalNumber(n,{unit:"hour"}):f(n,e.length)},k:function(t,e,a){var n=t.getUTCHours();return n===0&&(n=24),e==="ko"?a.ordinalNumber(n,{unit:"hour"}):f(n,e.length)},m:function(t,e,a){return e==="mo"?a.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):S.m(t,e)},s:function(t,e,a){return e==="so"?a.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):S.s(t,e)},S:function(t,e){return S.S(t,e)},X:function(t,e,a,n){var o=n._originalDate||t,s=o.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return G(s);case"XXXX":case"XX":return O(s);default:return O(s,":")}},x:function(t,e,a,n){var o=n._originalDate||t,s=o.getTimezoneOffset();switch(e){case"x":return G(s);case"xxxx":case"xx":return O(s);default:return O(s,":")}},O:function(t,e,a,n){var o=n._originalDate||t,s=o.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+B(s,":");default:return"GMT"+O(s,":")}},z:function(t,e,a,n){var o=n._originalDate||t,s=o.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+B(s,":");default:return"GMT"+O(s,":")}},t:function(t,e,a,n){var o=n._originalDate||t,s=Math.floor(o.getTime()/1e3);return f(s,e.length)},T:function(t,e,a,n){var o=n._originalDate||t,s=o.getTime();return f(s,e.length)}};function B(r,t){var e=r>0?"-":"+",a=Math.abs(r),n=Math.floor(a/60),o=a%60;if(o===0)return e+String(n);var s=t;return e+String(n)+s+f(o,2)}function G(r,t){if(r%60===0){var e=r>0?"-":"+";return e+f(Math.abs(r)/60,2)}return O(r,t)}function O(r,t){var e=t||"",a=r>0?"-":"+",n=Math.abs(r),o=f(Math.floor(n/60),2),s=f(n%60,2);return a+o+e+s}var z=function(t,e){switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},ee=function(t,e){switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},ke=function(t,e){var a=t.match(/(P+)(p+)?/)||[],n=a[1],o=a[2];if(!o)return z(t,e);var s;switch(n){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;default:s=e.dateTime({width:"full"});break}return s.replace("{{date}}",z(n,e)).replace("{{time}}",ee(o,e))},Ee={p:ee,P:ke},Oe=["D","DD"],We=["YY","YYYY"];function $e(r){return Oe.indexOf(r)!==-1}function Ue(r){return We.indexOf(r)!==-1}function J(r,t,e){if(r==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(r==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(e,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Ye={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},qe=function(t,e,a){var n,o=Ye[t];return typeof o=="string"?n=o:e===1?n=o.one:n=o.other.replace("{{count}}",e.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+n:n+" ago":n};function q(r){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.width?String(t.width):r.defaultWidth,a=r.formats[e]||r.formats[r.defaultWidth];return a}}var Fe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},He={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Le={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Re={date:q({formats:Fe,defaultWidth:"full"}),time:q({formats:He,defaultWidth:"full"}),dateTime:q({formats:Le,defaultWidth:"full"})},Xe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ae=function(t,e,a,n){return Xe[t]};function T(r){return function(t,e){var a=e!=null&&e.context?String(e.context):"standalone",n;if(a==="formatting"&&r.formattingValues){var o=r.defaultFormattingWidth||r.defaultWidth,s=e!=null&&e.width?String(e.width):o;n=r.formattingValues[s]||r.formattingValues[o]}else{var l=r.defaultWidth,c=e!=null&&e.width?String(e.width):r.defaultWidth;n=r.values[c]||r.values[l]}var m=r.argumentCallback?r.argumentCallback(t):t;return n[m]}}var Ve={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ie={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Qe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Be={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ge={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ze={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Je=function(t,e){var a=Number(t),n=a%100;if(n>20||n<10)switch(n%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Ke={ordinalNumber:Je,era:T({values:Ve,defaultWidth:"wide"}),quarter:T({values:Ie,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:T({values:Qe,defaultWidth:"wide"}),day:T({values:Be,defaultWidth:"wide"}),dayPeriod:T({values:Ge,defaultWidth:"wide",formattingValues:ze,defaultFormattingWidth:"wide"})};function D(r){return function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=e.width,n=a&&r.matchPatterns[a]||r.matchPatterns[r.defaultMatchWidth],o=t.match(n);if(!o)return null;var s=o[0],l=a&&r.parsePatterns[a]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(l)?et(l,function(u){return u.test(s)}):Ze(l,function(u){return u.test(s)}),m;m=r.valueCallback?r.valueCallback(c):c,m=e.valueCallback?e.valueCallback(m):m;var d=t.slice(s.length);return{value:m,rest:d}}}function Ze(r,t){for(var e in r)if(r.hasOwnProperty(e)&&t(r[e]))return e}function et(r,t){for(var e=0;e<r.length;e++)if(t(r[e]))return e}function te(r){return function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=t.match(r.matchPattern);if(!a)return null;var n=a[0],o=t.match(r.parsePattern);if(!o)return null;var s=r.valueCallback?r.valueCallback(o[0]):o[0];s=e.valueCallback?e.valueCallback(s):s;var l=t.slice(n.length);return{value:s,rest:l}}}var tt=/^(\d+)(th|st|nd|rd)?/i,at=/\d+/i,rt={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},nt={any:[/^b/i,/^(a|c)/i]},it={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ot={any:[/1/i,/2/i,/3/i,/4/i]},st={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},dt={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},lt={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ct={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ut={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},mt={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ht={ordinalNumber:te({matchPattern:tt,parsePattern:at,valueCallback:function(t){return parseInt(t,10)}}),era:D({matchPatterns:rt,defaultMatchWidth:"wide",parsePatterns:nt,defaultParseWidth:"any"}),quarter:D({matchPatterns:it,defaultMatchWidth:"wide",parsePatterns:ot,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:D({matchPatterns:st,defaultMatchWidth:"wide",parsePatterns:dt,defaultParseWidth:"any"}),day:D({matchPatterns:lt,defaultMatchWidth:"wide",parsePatterns:ct,defaultParseWidth:"any"}),dayPeriod:D({matchPatterns:ut,defaultMatchWidth:"any",parsePatterns:mt,defaultParseWidth:"any"})},ft={code:"en-US",formatDistance:qe,formatLong:Re,formatRelative:Ae,localize:Ke,match:ht,options:{weekStartsOn:0,firstWeekContainsDate:1}},gt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,vt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,bt=/^'([^]*?)'?$/,xt=/''/g,yt=/[a-zA-Z]/;function ae(r,t,e){var a,n,o,s,l,c,m,d,u,h,v,x,j,g,N,P,$,U;p(2,arguments);var Q=String(t),k=I(),y=(a=(n=e?.locale)!==null&&n!==void 0?n:k.locale)!==null&&a!==void 0?a:ft,E=W((o=(s=(l=(c=e?.firstWeekContainsDate)!==null&&c!==void 0?c:e==null||(m=e.locale)===null||m===void 0||(d=m.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&l!==void 0?l:k.firstWeekContainsDate)!==null&&s!==void 0?s:(u=k.locale)===null||u===void 0||(h=u.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&o!==void 0?o:1);if(!(E>=1&&E<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var F=W((v=(x=(j=(g=e?.weekStartsOn)!==null&&g!==void 0?g:e==null||(N=e.locale)===null||N===void 0||(P=N.options)===null||P===void 0?void 0:P.weekStartsOn)!==null&&j!==void 0?j:k.weekStartsOn)!==null&&x!==void 0?x:($=k.locale)===null||$===void 0||(U=$.options)===null||U===void 0?void 0:U.weekStartsOn)!==null&&v!==void 0?v:0);if(!(F>=0&&F<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!y.localize)throw new RangeError("locale must contain localize property");if(!y.formatLong)throw new RangeError("locale must contain formatLong property");var H=M(r);if(!pe(H))throw new RangeError("Invalid time value");var ie=xe(H),oe=we(H,ie),se={firstWeekContainsDate:E,weekStartsOn:F,locale:y,_originalDate:H},de=Q.match(vt).map(function(w){var _=w[0];if(_==="p"||_==="P"){var L=Ee[_];return L(w,y.formatLong)}return w}).join("").match(gt).map(function(w){if(w==="''")return"'";var _=w[0];if(_==="'")return pt(w);var L=Se[_];if(L)return!(e!=null&&e.useAdditionalWeekYearTokens)&&Ue(w)&&J(w,t,String(r)),!(e!=null&&e.useAdditionalDayOfYearTokens)&&$e(w)&&J(w,t,String(r)),L(oe,w,y.localize,se);if(_.match(yt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+_+"`");return w}).join("");return de}function pt(r){var t=r.match(bt);return t?t[1].replace(xt,"'"):r}var wt={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},jt=function(t,e,a){var n,o=wt[t];return typeof o=="string"?n=o:e===1?n=o.one:n=o.other.replace("{{count}}",e.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"en "+n:"hace "+n:n},Nt={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},Ct={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Tt={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dt={date:q({formats:Nt,defaultWidth:"full"}),time:q({formats:Ct,defaultWidth:"full"}),dateTime:q({formats:Tt,defaultWidth:"full"})},Mt={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},Pt={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},_t=function(t,e,a,n){return e.getUTCHours()!==1?Pt[t]:Mt[t]},St={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},kt={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},Et={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},Ot={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},Wt={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},$t={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},Ut=function(t,e){var a=Number(t);return a+"º"},Yt={ordinalNumber:Ut,era:T({values:St,defaultWidth:"wide"}),quarter:T({values:kt,defaultWidth:"wide",argumentCallback:function(t){return Number(t)-1}}),month:T({values:Et,defaultWidth:"wide"}),day:T({values:Ot,defaultWidth:"wide"}),dayPeriod:T({values:Wt,defaultWidth:"wide",formattingValues:$t,defaultFormattingWidth:"wide"})},qt=/^(\d+)(º)?/i,Ft=/\d+/i,Ht={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},Lt={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},Rt={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},Xt={any:[/1/i,/2/i,/3/i,/4/i]},At={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},Vt={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},It={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},Qt={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},Bt={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},Gt={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},zt={ordinalNumber:te({matchPattern:qt,parsePattern:Ft,valueCallback:function(t){return parseInt(t,10)}}),era:D({matchPatterns:Ht,defaultMatchWidth:"wide",parsePatterns:Lt,defaultParseWidth:"any"}),quarter:D({matchPatterns:Rt,defaultMatchWidth:"wide",parsePatterns:Xt,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:D({matchPatterns:At,defaultMatchWidth:"wide",parsePatterns:Vt,defaultParseWidth:"any"}),day:D({matchPatterns:It,defaultMatchWidth:"wide",parsePatterns:Qt,defaultParseWidth:"any"}),dayPeriod:D({matchPatterns:Bt,defaultMatchWidth:"any",parsePatterns:Gt,defaultParseWidth:"any"})},re={code:"es",formatDistance:jt,formatLong:Dt,formatRelative:_t,localize:Yt,match:zt,options:{weekStartsOn:1,firstWeekContainsDate:1}};function ne({historial:r,estados:t}){const e=a=>t.find(n=>n.codigo===a);return r.length===0?i.jsxs("div",{className:"text-center py-8 text-gray-400",children:[i.jsx("i",{className:"ri-time-line text-4xl mb-2"}),i.jsx("p",{children:"No hay historial de cambios"})]}):i.jsx("div",{className:"space-y-4",children:r.map((a,n)=>{const o=e(a.estado_nuevo),s=n===r.length-1;return i.jsxs("div",{className:"flex gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:o?.color||"#3B82F6",opacity:s?1:.7},children:i.jsx("i",{className:`${o?.icono||"ri-checkbox-circle-line"} text-white text-lg`})}),!s&&i.jsx("div",{className:"w-0.5 flex-1 min-h-[60px]",style:{backgroundColor:o?.color||"#3B82F6",opacity:.3}})]}),i.jsx("div",{className:"flex-1 pb-8",children:i.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-900",children:o?.nombre_publico||a.estado_nuevo}),a.estado_anterior&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Desde: ",e(a.estado_anterior)?.nombre_publico||a.estado_anterior]})]}),s&&i.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full whitespace-nowrap",children:"Estado actual"})]}),i.jsxs("div",{className:"space-y-2 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[i.jsx("i",{className:"ri-user-line"}),i.jsx("span",{children:a.responsable?.nombre_completo||"Usuario desconocido"})]}),i.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[i.jsx("i",{className:"ri-calendar-line"}),i.jsx("span",{children:ae(new Date(a.created_at),"dd 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:re})})]}),a.duracion_minutos&&i.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[i.jsx("i",{className:"ri-time-line"}),i.jsxs("span",{children:["Duración: ",a.duracion_minutos," minutos"]})]})]}),a.comentario&&i.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:i.jsx("p",{className:"text-sm text-gray-700",children:a.comentario})})]})})]},a.id)})})}class Jt{async getSolicitudes(t){return this.getSeguimientos(t)}async getSeguimientos(t){try{let e=C.from("solicitudes").select("*").order("created_at",{ascending:!1});t?.estado_id&&(e=e.eq("estado_id",t.estado_id)),t?.busqueda&&(e=e.or(`codigo.ilike.%${t.busqueda}%,descripcion.ilike.%${t.busqueda}%`)),t?.fecha_desde&&(e=e.gte("created_at",t.fecha_desde)),t?.fecha_hasta&&(e=e.lte("created_at",t.fecha_hasta));const{data:a,error:n}=await e;if(n)throw n;const o=new Map,{data:s}=await C.from("solicitud_estados").select("*");return s&&s.forEach(c=>{o.set(c.id,c)}),(a||[]).map(c=>{const m=o.get(c.estado_id);return{...c,estado:m||{id:c.estado_id,nombre:c.estado_id,color:"#6B7280",orden:0}}})}catch(e){throw console.error("Error obteniendo seguimientos:",e),e}}async getSolicitudById(t){try{const{data:e,error:a}=await C.from("solicitudes").select("*").eq("id",t).single();if(a)throw a;const{data:n}=await C.from("solicitud_estados").select("*").eq("id",e.estado_id).single();return{...e,estado:n||{id:e.estado_id,nombre:e.estado_id,color:"#6B7280",orden:0}}}catch(e){return console.error("Error obteniendo solicitud:",e),null}}async getEstados(){try{const{data:t,error:e}=await C.from("solicitud_estados").select("*").order("orden");if(e)throw e;return t||[]}catch(t){throw console.error("Error obteniendo estados:",t),t}}async cambiarEstado(t,e,a){try{const{data:n}=await C.from("solicitudes").select("estado_id").eq("id",t).single();if(!n)throw new Error("Solicitud no encontrada");const{error:o}=await C.from("solicitudes").update({estado_id:e,updated_at:new Date().toISOString()}).eq("id",t);if(o)throw o;try{await C.from("solicitud_historial").insert({solicitud_id:t,estado_anterior_id:n.estado_id,estado_nuevo_id:e,observaciones:a||null,created_at:new Date().toISOString()})}catch(s){console.warn("No se pudo registrar en historial:",s)}}catch(n){throw console.error("Error cambiando estado:",n),n}}async getHistorialEstados(t){try{const{data:e,error:a}=await C.from("solicitud_historial").select("*").eq("solicitud_id",t).order("created_at",{ascending:!1});return a?(console.warn("Error obteniendo historial:",a),[]):e||[]}catch(e){return console.error("Error obteniendo historial:",e),[]}}async getTransiciones(){try{const t=await this.getEstados(),e=[];for(let a=0;a<t.length-1;a++)e.push({id:`${t[a].id}-${t[a+1].id}`,estado_origen:t[a].id,estado_destino:t[a+1].id,nombre:`${t[a].nombre} → ${t[a+1].nombre}`,requiere_comentario:!1,activo:!0});return e}catch(t){throw console.error("Error obteniendo transiciones:",t),t}}async updateEstado(t){return this.cambiarEstado(t.seguimiento_id,t.estado_nuevo,t.comentario)}async getStats(){try{const{data:t,error:e}=await C.from("solicitudes").select("estado_id, created_at");if(e)throw e;const a=t?.length||0,n=t?.filter(l=>l.estado_id!=="completado"&&l.estado_id!=="cancelado").length||0,o=t?.filter(l=>l.estado_id==="completado").length||0,s=t?.filter(l=>Math.floor((Date.now()-new Date(l.created_at).getTime())/864e5)>7&&l.estado_id!=="completado").length||0;return{total:a,en_proceso:n,completados:o,atrasados:s}}catch(t){throw console.error("Error obteniendo estadísticas:",t),t}}}const R=new Jt;function Kt({isOpen:r,onClose:t,seguimiento:e,estados:a,onCambiarEstado:n}){const[o,s]=b.useState([]),[l,c]=b.useState(!1);b.useEffect(()=>{r&&e&&m()},[r,e]);const m=async()=>{if(e){c(!0);try{const u=await R.getHistorial(e.id);s(u)}catch(u){console.error("Error cargando historial:",u)}finally{c(!1)}}};if(!r||!e)return null;const d=a.find(u=>u.codigo===e.estado_actual);return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Seguimiento - ",e.pedido?.codigo||`Pedido #${e.pedido_id}`]}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.pedido?.cliente?.nombre||"Cliente no especificado"})]}),i.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:i.jsx("i",{className:"ri-close-line text-xl text-gray-600"})})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[i.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Estado Actual"}),i.jsxs("div",{className:"p-4 rounded-lg flex items-center gap-3",style:{backgroundColor:`${d?.color}15`},children:[i.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:d?.color},children:i.jsx("i",{className:`${d?.icono} text-white text-xl`})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"font-semibold text-gray-900",children:d?.nombre_publico||e.estado_actual}),i.jsxs("p",{className:"text-sm text-gray-600",children:[e.progreso_porcentaje,"% completado"]})]})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:i.jsx("div",{className:"h-3 rounded-full transition-all",style:{width:`${e.progreso_porcentaje}%`,backgroundColor:d?.color}})})}),i.jsxs("button",{onClick:n,className:"w-full mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium cursor-pointer whitespace-nowrap",children:[i.jsx("i",{className:"ri-arrow-right-line mr-2"}),"Cambiar Estado"]})]}),i.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[i.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Información del Pedido"}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Total:"}),i.jsx("span",{className:"font-semibold text-gray-900",children:e.pedido?.total?ce(e.pedido.total):"N/A"})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Estado Pedido:"}),i.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:e.pedido?.estado||"N/A"})]}),i.jsxs("div",{className:"pt-3 border-t border-gray-100",children:[i.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[i.jsx("i",{className:"ri-calendar-line"}),i.jsx("span",{children:"Inicio:"})]}),i.jsx("p",{className:"text-gray-900 text-xs",children:ae(new Date(e.fecha_inicio),"dd 'de' MMMM 'de' yyyy",{locale:re})})]}),e.responsable&&i.jsxs("div",{className:"pt-3 border-t border-gray-100",children:[i.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[i.jsx("i",{className:"ri-user-line"}),i.jsx("span",{children:"Responsable:"})]}),i.jsx("p",{className:"text-gray-900 text-xs",children:e.responsable.nombre_completo}),i.jsx("p",{className:"text-gray-600 text-xs",children:e.responsable.email})]})]})]})]}),i.jsx("div",{className:"lg:col-span-2",children:i.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Historial de Cambios"}),l?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("i",{className:"ri-loader-4-line animate-spin text-3xl text-blue-600"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Cargando historial..."})]}):i.jsx(ne,{historial:o,estados:a})]})})]})})]})})}function Zt({isOpen:r,onClose:t,estadoActual:e,estadosDisponibles:a,transicionesDisponibles:n,onConfirm:o}){const[s,l]=b.useState(""),[c,m]=b.useState(""),[d,u]=b.useState(!1);if(!r)return null;const v=n.find(g=>g.estado_destino===s)?.requiere_comentario||!1,x=async g=>{if(g.preventDefault(),!s){alert("Por favor selecciona un estado");return}if(v&&!c.trim()){alert("Este cambio de estado requiere un comentario");return}u(!0);try{await o(s,c||void 0),l(""),m(""),t()}catch(N){console.error("Error cambiando estado:",N),alert("Error al cambiar el estado")}finally{u(!1)}},j=a.filter(g=>n.some(N=>N.estado_destino===g.codigo));return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[i.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Cambiar Estado"}),i.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors cursor-pointer",children:i.jsx("i",{className:"ri-close-line text-xl text-gray-600"})})]}),i.jsxs("form",{onSubmit:x,className:"p-6 space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado Actual"}),i.jsx("div",{className:"px-4 py-3 bg-gray-50 rounded-lg border border-gray-200",children:i.jsx("span",{className:"text-gray-900 font-medium",children:a.find(g=>g.codigo===e)?.nombre_publico||e})})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nuevo Estado ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsxs("select",{value:s,onChange:g=>l(g.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[i.jsx("option",{value:"",children:"Seleccionar estado..."}),j.map(g=>i.jsx("option",{value:g.codigo,children:g.nombre_publico},g.id))]})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Comentario ",v&&i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("textarea",{value:c,onChange:g=>m(g.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Agrega un comentario sobre este cambio...",required:v}),v&&i.jsxs("p",{className:"mt-1 text-xs text-amber-600",children:[i.jsx("i",{className:"ri-information-line"})," Este cambio de estado requiere un comentario obligatorio"]})]}),i.jsxs("div",{className:"flex gap-3 pt-4",children:[i.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium cursor-pointer whitespace-nowrap",children:"Cancelar"}),i.jsx("button",{type:"submit",disabled:d||!s,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer whitespace-nowrap",children:d?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Actualizando..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"ri-check-line mr-2"}),"Confirmar Cambio"]})})]})]})]})})}const ra=()=>{const r=le(),{hasPermission:t}=ue(),[e,a]=b.useState("kanban"),[n,o]=b.useState([]),[s,l]=b.useState([]),[c,m]=b.useState(!0),[d,u]=b.useState(null),[h,v]=b.useState(!1),[x,j]=b.useState(!1),[g,N]=b.useState({busqueda:"",estado_id:"",fecha_desde:"",fecha_hasta:""});b.useEffect(()=>{t("seguimiento:view")||r("/dashboard")},[t,r]),b.useEffect(()=>{P()},[g]);const P=async()=>{try{m(!0);const[y,E]=await Promise.all([R.getSolicitudes(g),R.getEstados()]);o(y),l(E)}catch(y){console.error("Error cargando datos:",y)}finally{m(!1)}},$=y=>{u(y),v(!0)},U=y=>{if(!t("seguimiento:edit")){alert("No tienes permisos para cambiar estados");return}u(y),j(!0)},Q=()=>{P(),j(!1)},k=async(y,E)=>{if(!t("seguimiento:edit")){alert("No tienes permisos para cambiar estados");return}try{await R.cambiarEstado(y,E,"Cambio mediante arrastre"),P()}catch(F){console.error("Error cambiando estado:",F),alert("Error al cambiar el estado")}};return t("seguimiento:view")?i.jsxs("div",{className:"flex h-screen bg-gray-50",children:[i.jsx(me,{}),i.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[i.jsx(he,{}),i.jsx("main",{className:"flex-1 overflow-y-auto",children:i.jsx(fe,{vista:e,onVistaChange:a,filtros:g,onFiltrosChange:N,onRefresh:P,children:c?i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsxs("div",{className:"text-center",children:[i.jsx("i",{className:"ri-loader-4-line text-4xl text-teal-600 animate-spin mb-4"}),i.jsx("p",{className:"text-gray-600",children:"Cargando seguimiento..."})]})}):e==="kanban"?i.jsx(ge,{solicitudes:n,estados:s,onVerDetalle:$,onCambiarEstado:U,onDragEnd:k}):i.jsx(ne,{solicitudes:n,onVerDetalle:$,onCambiarEstado:U})})})]}),h&&d&&i.jsx(Kt,{solicitud:d,onClose:()=>v(!1)}),x&&d&&i.jsx(Zt,{solicitud:d,estados:s,onClose:()=>j(!1),onEstadoCambiado:Q})]}):null};export{ra as default};
//# sourceMappingURL=page-DO7VJ56K.js.map
