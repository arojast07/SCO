import{j as e,r as x,s as A}from"./index-Bb3NupjY.js";import{f as F}from"./currency-BmxXlzML.js";import{h as R}from"./haciendaService-CkwWVDHi.js";import{S as T,T as z}from"./TopBar-BP5RF_Jd.js";function D({facturas:t,loading:p,onEdit:i,onFirmar:g,onEnviar:u,onConsultarEstado:c}){const N=(o,v)=>{const _=v||o,r={borrador:"bg-gray-100 text-gray-800",firmado:"bg-blue-100 text-blue-800",enviado:"bg-yellow-100 text-yellow-800",recibido:"bg-orange-100 text-orange-800",aceptado:"bg-green-100 text-green-800",rechazado:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${r[_]||"bg-gray-100 text-gray-800"}`,children:_.charAt(0).toUpperCase()+_.slice(1)})},b=o=>new Date(o).toLocaleDateString("es-CR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return p?e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando facturas..."})]})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Consecutivo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("i",{className:"ri-file-text-line text-4xl mb-4 block"}),"No hay facturas registradas"]})}):t.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.consecutivo}),e.jsx("div",{className:"text-sm text-gray-500",children:o.clave})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:o.cliente?.razon_social||o.cliente?.nombre_completo||"Sin cliente"}),e.jsx("div",{className:"text-sm text-gray-500",children:o.cliente?.identificacion})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:b(o.fecha_emision)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:F(o.total)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:N(o.estado_local,o.estado_hacienda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>i(o),className:"text-blue-600 hover:text-blue-900",title:"Editar",children:e.jsx("i",{className:"ri-edit-line"})}),o.estado_local==="borrador"&&e.jsx("button",{onClick:()=>g(o),className:"text-green-600 hover:text-green-900",title:"Firmar",children:e.jsx("i",{className:"ri-shield-check-line"})}),o.estado_local==="firmado"&&e.jsx("button",{onClick:()=>u(o),className:"text-orange-600 hover:text-orange-900",title:"Enviar a Hacienda",children:e.jsx("i",{className:"ri-send-plane-line"})}),o.estado_local==="enviado"&&e.jsx("button",{onClick:()=>c(o),className:"text-purple-600 hover:text-purple-900",title:"Consultar Estado",children:e.jsx("i",{className:"ri-refresh-line"})}),e.jsx("button",{onClick:()=>window.open(`/facturacion/${o.id}/print`,"_blank"),className:"text-gray-600 hover:text-gray-900",title:"Imprimir",children:e.jsx("i",{className:"ri-printer-line"})})]})})]},o.id))})]})})})}function P({filters:t,onFiltersChange:p}){const[i]=x.useState([{id:1,razon_social:"Cliente Demo 1",identificacion:"1-1234-5678"},{id:2,razon_social:"Cliente Demo 2",identificacion:"2-2345-6789"}]),g=(c,N)=>{p({...t,[c]:N})},u=()=>{p({fecha_desde:"",fecha_hasta:"",estado_local:"",cliente_id:null})};return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Desde"}),e.jsx("input",{type:"date",value:t.fecha_desde,onChange:c=>g("fecha_desde",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Hasta"}),e.jsx("input",{type:"date",value:t.fecha_hasta,onChange:c=>g("fecha_hasta",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),e.jsxs("select",{value:t.estado_local,onChange:c=>g("estado_local",c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"firmado",children:"Firmado"}),e.jsx("option",{value:"enviado",children:"Enviado"}),e.jsx("option",{value:"aceptado",children:"Aceptado"}),e.jsx("option",{value:"rechazado",children:"Rechazado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliente"}),e.jsxs("select",{value:t.cliente_id||"",onChange:c=>g("cliente_id",c.target.value?parseInt(c.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Todos"}),i.map(c=>e.jsx("option",{value:c.id,children:c.razon_social},c.id))]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:u,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Limpiar Filtros"]})})]})}const O={"01":"Factura Electr√≥nica","02":"Nota D√©bito","03":"Nota Cr√©dito","04":"Tiquete Electr√≥nico","05":"Factura Compra","06":"Factura Exportaci√≥n","07":"Recibo Electr√≥nico"},L={"01":"Contado","02":"Cr√©dito","03":"Consignaci√≥n","04":"Apartado","05":"Arrendamiento con opci√≥n de compra","06":"Arrendamiento en funci√≥n financiera",99:"Otros"},q={"01":"Efectivo","02":"Tarjeta","03":"Cheque","04":"Transferencia","05":"Recaudado por terceros",99:"Otros"};function U({factura:t,onClose:p}){const[i,g]=x.useState({tipo_documento:"01",fecha_emision:new Date().toISOString().split("T")[0],moneda:"CRC",tipo_cambio:1,condicion_venta:"01",plazo_credito:0,medio_pago:"01",estado_local:"borrador",subtotal:0,descuento_total:0,impuesto_total:0,total:0}),[u,c]=x.useState([]),[N]=x.useState([{id:1,razon_social:"Cliente Demo 1",identificacion:"1-1234-5678"},{id:2,razon_social:"Cliente Demo 2",identificacion:"2-2345-6789"}]),[b]=x.useState([{id:1,codigo:"PROD001",descripcion:"Producto Demo 1",precio_venta:1e4,unidad_medida:"Unid"},{id:2,codigo:"PROD002",descripcion:"Producto Demo 2",precio_venta:2e4,unidad_medida:"Unid"}]),[o,v]=x.useState(!1);x.useEffect(()=>{t&&(g(t),c(t.lineas||[]))},[t]),x.useEffect(()=>{_()},[u]);const _=()=>{const a=u.reduce((y,w)=>y+w.subtotal_linea,0),d=u.reduce((y,w)=>y+w.descuento_monto,0),n=u.reduce((y,w)=>y+w.impuesto_monto,0),j=a-d+n;g(y=>({...y,subtotal:a,descuento_total:d,impuesto_total:n,total:j}))},r=()=>{const a={numero_linea:u.length+1,descripcion:"",unidad_medida:"Unid",cantidad:1,precio_unitario:0,descuento_porcentaje:0,descuento_monto:0,subtotal_linea:0,impuesto_porcentaje:13,impuesto_monto:0,total_linea:0};c([...u,a])},l=(a,d,n)=>{const j=[...u];j[a]={...j[a],[d]:n};const y=j[a],w=y.cantidad*y.precio_unitario,S=w*y.descuento_porcentaje/100,m=w-S,C=m*y.impuesto_porcentaje/100,k=m+C;j[a]={...y,subtotal_linea:w,descuento_monto:S,impuesto_monto:C,total_linea:k},c(j)},E=a=>{const d=u.filter((n,j)=>j!==a);d.forEach((n,j)=>{n.numero_linea=j+1}),c(d)},s=(a,d)=>{const n=b.find(j=>j.id===parseInt(d));n&&(l(a,"codigo_articulo",n.codigo),l(a,"descripcion",n.descripcion),l(a,"precio_unitario",n.precio_venta||0),l(a,"unidad_medida",n.unidad_medida||"Unid"))},f=async a=>{a.preventDefault(),v(!0);try{if(u.length===0){alert("Debe agregar al menos una l√≠nea");return}console.log("Guardando factura:",{formData:i,lineas:u}),alert("Factura guardada exitosamente (modo demo)"),p()}catch(d){console.error("Error guardando factura:",d),alert("Error guardando factura")}finally{v(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Editar Factura":"Nueva Factura"}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci√≥n General"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Documento"}),e.jsx("select",{value:i.tipo_documento,onChange:a=>g({...i,tipo_documento:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0,children:Object.entries(O).map(([a,d])=>e.jsx("option",{value:a,children:d},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliente"}),e.jsxs("select",{value:i.cliente_id||"",onChange:a=>g({...i,cliente_id:parseInt(a.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar cliente"}),N.map(a=>e.jsxs("option",{value:a.id,children:[a.razon_social," - ",a.identificacion]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Emisi√≥n"}),e.jsx("input",{type:"date",value:i.fecha_emision?.split("T")[0],onChange:a=>g({...i,fecha_emision:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Condici√≥n de Venta"}),e.jsx("select",{value:i.condicion_venta,onChange:a=>g({...i,condicion_venta:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:Object.entries(L).map(([a,d])=>e.jsx("option",{value:a,children:d},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Medio de Pago"}),e.jsx("select",{value:i.medio_pago,onChange:a=>g({...i,medio_pago:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:Object.entries(q).map(([a,d])=>e.jsx("option",{value:a,children:d},a))})]}),i.condicion_venta==="02"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plazo de Cr√©dito (d√≠as)"}),e.jsx("input",{type:"number",value:i.plazo_credito,onChange:a=>g({...i,plazo_credito:parseInt(a.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",min:"0"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"L√≠neas de Detalle"}),e.jsxs("button",{type:"button",onClick:r,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Agregar L√≠nea"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Producto"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripci√≥n"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Cantidad"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Precio"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Descuento %"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{onChange:n=>s(d,n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Seleccionar"}),b.map(n=>e.jsxs("option",{value:n.id,children:[n.codigo," - ",n.descripcion]},n.id))]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:a.descripcion,onChange:n=>l(d,"descripcion",n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",required:!0})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:a.cantidad,onChange:n=>l(d,"cantidad",parseFloat(n.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",min:"0",step:"0.01",required:!0})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:a.precio_unitario,onChange:n=>l(d,"precio_unitario",parseFloat(n.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",min:"0",step:"0.01",required:!0})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:a.descuento_porcentaje,onChange:n=>l(d,"descuento_porcentaje",parseFloat(n.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500",min:"0",max:"100",step:"0.01"})}),e.jsx("td",{className:"px-3 py-2 text-sm font-medium",children:F(a.total_linea)}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{type:"button",onClick:()=>E(d),className:"text-red-600 hover:text-red-900 cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line"})})})]},d))})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Resumen"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Subtotal"}),e.jsx("p",{className:"text-lg font-semibold",children:F(i.subtotal||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Descuento"}),e.jsxs("p",{className:"text-lg font-semibold text-red-600",children:["-",F(i.descuento_total||0)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Impuesto"}),e.jsx("p",{className:"text-lg font-semibold",children:F(i.impuesto_total||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsx("p",{className:"text-xl font-bold text-orange-600",children:F(i.total||0)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:p,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap cursor-pointer",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap cursor-pointer",children:o?"Guardando...":"Guardar Factura"})]})]})]})}function M(){const[t,p]=x.useState({cedula_emisor:"",codigo_actividad_economica:"",sucursal:"001",terminal:"00001",ambiente:"sandbox",usuario_idp:"",password_idp_encrypted:"",certificado_p12_path:"",certificado_password_encrypted:"",proveedor_sistema:"OLO Sistema de Gesti√≥n",activo:!0}),[i,g]=x.useState(!1),[u,c]=x.useState(!1),[N,b]=x.useState(null);x.useEffect(()=>{o()},[]);const o=async()=>{try{const r=await R.getSettings();r&&p(r)}catch(r){console.error("Error cargando configuraci√≥n:",r)}},v=async r=>{r.preventDefault(),g(!0);try{await R.saveSettings(t)?(alert("Configuraci√≥n guardada exitosamente"),o()):alert("Error guardando configuraci√≥n")}catch(l){console.error("Error:",l),alert("Error guardando configuraci√≥n")}finally{g(!1)}},_=async()=>{c(!0),b(null);try{const r=await R.testConnection();b(r)}catch{b({success:!1,message:"Error probando conexi√≥n"})}finally{c(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Configuraci√≥n de Hacienda"}),e.jsx("button",{onClick:_,disabled:u,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 whitespace-nowrap",children:u?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Probando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-wifi-line mr-2"}),"Probar Conexi√≥n"]})})]}),N&&e.jsx("div",{className:`p-4 rounded-lg ${N.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:`${N.success?"ri-check-line":"ri-error-warning-line"} mr-2`}),N.message]})}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci√≥n del Emisor"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C√©dula Jur√≠dica del Emisor *"}),e.jsx("input",{type:"text",value:t.cedula_emisor,onChange:r=>p({...t,cedula_emisor:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"3-101-123456",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Formato: 3-101-123456"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C√≥digo de Actividad Econ√≥mica *"}),e.jsx("input",{type:"text",value:t.codigo_actividad_economica,onChange:r=>p({...t,codigo_actividad_economica:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"123456",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"C√≥digo asignado por Hacienda"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sucursal"}),e.jsx("input",{type:"text",value:t.sucursal,onChange:r=>p({...t,sucursal:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"001",maxLength:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Terminal"}),e.jsx("input",{type:"text",value:t.terminal,onChange:r=>p({...t,terminal:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"00001",maxLength:5})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Configuraci√≥n de Ambiente"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ambiente *"}),e.jsxs("select",{value:t.ambiente,onChange:r=>p({...t,ambiente:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",required:!0,children:[e.jsx("option",{value:"sandbox",children:"Sandbox (Pruebas)"}),e.jsx("option",{value:"produccion",children:"Producci√≥n"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proveedor del Sistema"}),e.jsx("input",{type:"text",value:t.proveedor_sistema,onChange:r=>p({...t,proveedor_sistema:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"OLO Sistema de Gesti√≥n"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Credenciales IdP (Identity Provider)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Usuario IdP *"}),e.jsx("input",{type:"text",value:t.usuario_idp,onChange:r=>p({...t,usuario_idp:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"usuario@empresa.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contrase√±a IdP *"}),e.jsx("input",{type:"password",value:t.password_idp_encrypted,onChange:r=>p({...t,password_idp_encrypted:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-information-line text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Importante:"}),e.jsx("p",{children:"Las credenciales del IdP son proporcionadas por Hacienda al registrar su empresa para facturaci√≥n electr√≥nica."})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Certificado Digital"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ruta del Certificado .p12"}),e.jsx("input",{type:"text",value:t.certificado_p12_path,onChange:r=>p({...t,certificado_p12_path:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"/ruta/al/certificado.p12"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contrase√±a del Certificado"}),e.jsx("input",{type:"password",value:t.certificado_password_encrypted,onChange:r=>p({...t,certificado_password_encrypted:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-shield-check-line text-blue-600 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Certificado Digital:"}),e.jsx("p",{children:"El certificado .p12 es necesario para firmar digitalmente los comprobantes electr√≥nicos. Debe ser emitido por una autoridad certificadora reconocida por Costa Rica."})]})]})})]}),e.jsx("div",{className:"flex justify-end space-x-4",children:e.jsx("button",{type:"submit",disabled:i,className:"px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 whitespace-nowrap",children:i?"Guardando...":"Guardar Configuraci√≥n"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informaci√≥n Adicional"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"URLs de Ambiente Sandbox:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ API Recepci√≥n: https://api.comprobanteselectronicos.go.cr/recepcion-sandbox/v1"}),e.jsx("li",{children:"‚Ä¢ IdP: https://idp.comprobanteselectronicos.go.cr/auth/realms/rut-stag/protocol/openid-connect/token"})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"URLs de Ambiente Producci√≥n:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ API Recepci√≥n: https://api.comprobanteselectronicos.go.cr/recepcion/v1"}),e.jsx("li",{children:"‚Ä¢ IdP: https://idp.comprobanteselectronicos.go.cr/auth/realms/rut/protocol/openid-connect/token"})]})]}),e.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-900 mb-2",children:"Pasos para Configuraci√≥n:"}),e.jsxs("ol",{className:"text-sm text-orange-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Registrarse en el portal de Hacienda para facturaci√≥n electr√≥nica"}),e.jsx("li",{children:"Obtener credenciales del IdP (usuario y contrase√±a)"}),e.jsx("li",{children:"Adquirir certificado digital de una autoridad certificadora"}),e.jsx("li",{children:"Configurar los datos en esta pantalla"}),e.jsx("li",{children:"Probar la conexi√≥n en ambiente sandbox"}),e.jsx("li",{children:"Solicitar paso a producci√≥n a Hacienda"})]})]})]})]})]})}function $(){const[t,p]=x.useState([]),[i,g]=x.useState(!0),[u,c]=x.useState(null),[N,b]=x.useState(!1);x.useEffect(()=>{o()},[]);const o=async()=>{g(!0);try{const{data:s,error:f}=await A.from("comprobantes_recibidos").select("*").order("fecha_emision",{ascending:!1});if(f)throw f;p(s||[])}catch(s){console.error("Error cargando comprobantes:",s)}finally{g(!1)}},v=async s=>{try{const f=await r(s,"aceptado");await A.from("comprobantes_recibidos").update({estado_receptor:"aceptado",fecha_respuesta:new Date().toISOString(),xml_respuesta:f}).eq("id",s.id),o(),alert("Comprobante aceptado exitosamente")}catch(f){console.error("Error aceptando comprobante:",f),alert("Error aceptando comprobante")}},_=async(s,f)=>{try{const a=await r(s,"rechazado",f);await A.from("comprobantes_recibidos").update({estado_receptor:"rechazado",fecha_respuesta:new Date().toISOString(),xml_respuesta:a,observaciones:f}).eq("id",s.id),o(),b(!1),alert("Comprobante rechazado exitosamente")}catch(a){console.error("Error rechazando comprobante:",a),alert("Error rechazando comprobante")}},r=async(s,f,a)=>(new Date().toISOString(),`<?xml version="1.0" encoding="UTF-8"?>
<MensajeReceptor xmlns="https://cdn.comprobanteselectronicos.go.cr/xml-schemas/v4.3/mensajeReceptor">
  <Clave>${s.clave}</Clave>
  <NumeroCedulaEmisor>${s.emisor_cedula}</NumeroCedulaEmisor>
  <FechaEmisionDoc>${s.fecha_emision}</FechaEmisionDoc>
  <Mensaje>${f==="aceptado"?"1":"2"}</Mensaje>
  ${a?`<DetalleMensaje>${a}</DetalleMensaje>`:""}
  <MontoTotalImpuesto>${s.total||0}</MontoTotalImpuesto>
  <TotalFactura>${s.total||0}</TotalFactura>
</MensajeReceptor>`),l=s=>{const f={pendiente:"bg-yellow-100 text-yellow-800",aceptado:"bg-green-100 text-green-800",rechazado:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${f[s]}`,children:s.charAt(0).toUpperCase()+s.slice(1)})},E=s=>new Date(s).toLocaleDateString("es-CR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return i?e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando comprobantes recibidos..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Comprobantes Recibidos"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Total: ",t.length," comprobantes"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clave"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Emisor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Emisi√≥n"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("i",{className:"ri-inbox-line text-4xl mb-4 block"}),"No hay comprobantes recibidos"]})}):t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.clave}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Tipo: ",s.tipo_documento]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.emisor_nombre||"Sin nombre"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.emisor_cedula})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E(s.fecha_emision)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.total?F(s.total):"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l(s.estado_receptor)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[s.estado_receptor==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>v(s),className:"text-green-600 hover:text-green-900",title:"Aceptar",children:e.jsx("i",{className:"ri-check-line"})}),e.jsx("button",{onClick:()=>{c(s),b(!0)},className:"text-red-600 hover:text-red-900",title:"Rechazar",children:e.jsx("i",{className:"ri-close-line"})})]}),e.jsx("button",{onClick:()=>window.open(`/facturacion/comprobante/${s.id}/print`,"_blank"),className:"text-gray-600 hover:text-gray-900",title:"Ver/Imprimir",children:e.jsx("i",{className:"ri-eye-line"})})]})})]},s.id))})]})})}),N&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Rechazar Comprobante"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Clave: ",u.clave]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Emisor: ",u.emisor_nombre]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Raz√≥n del rechazo:"}),e.jsx("textarea",{id:"razon-rechazo",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Ingrese la raz√≥n del rechazo..."})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{onClick:()=>{const s=document.getElementById("razon-rechazo").value;s.trim()?_(u,s):alert("Debe ingresar una raz√≥n para el rechazo")},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors whitespace-nowrap",children:"Rechazar"})]})]})})]})}function J(){const[t,p]=x.useState("facturas"),[i,g]=x.useState([]),[u,c]=x.useState(!1),[N,b]=x.useState(!1),[o,v]=x.useState(null),[_,r]=x.useState(!1),[l,E]=x.useState({fecha_desde:"",fecha_hasta:"",estado_local:"",cliente_id:null});x.useEffect(()=>{s()},[l]);const s=async()=>{c(!0);try{console.log("üîç [FACTURACI√ìN] Cargando facturas desde la base de datos..."),console.log("üîç [FACTURACI√ìN] Filtros aplicados:",l);let m=A.from("facturas_electronicas").select(`
          id,
          numero_consecutivo,
          clave_numerica,
          tipo_documento,
          fecha_emision,
          cliente_id,
          estado,
          subtotal,
          descuento_total,
          impuesto_total,
          total_general,
          moneda,
          tipo_cambio,
          condicion_venta,
          medio_pago,
          notas,
          created_at,
          clientes!inner(
            id,
            nombre_razon_social,
            identificacion
          )
        `).order("created_at",{ascending:!1});l.fecha_desde&&(m=m.gte("fecha_emision",l.fecha_desde),console.log("üîç [FACTURACI√ìN] Filtro fecha_desde:",l.fecha_desde)),l.fecha_hasta&&(m=m.lte("fecha_emision",l.fecha_hasta),console.log("üîç [FACTURACI√ìN] Filtro fecha_hasta:",l.fecha_hasta)),l.estado_local&&(m=m.eq("estado",l.estado_local),console.log("üîç [FACTURACI√ìN] Filtro estado:",l.estado_local)),l.cliente_id&&(m=m.eq("cliente_id",l.cliente_id),console.log("üîç [FACTURACI√ìN] Filtro cliente_id:",l.cliente_id));const{data:C,error:k}=await m;if(k)throw console.error("‚ùå [FACTURACI√ìN] Error cargando facturas:",k),k;console.log("‚úÖ [FACTURACI√ìN] Facturas obtenidas:",C?.length||0);const I=(C||[]).map(h=>({id:h.id,consecutivo:h.numero_consecutivo,clave:h.clave_numerica,tipo_documento:h.tipo_documento||"01",fecha_emision:h.fecha_emision,cliente_id:h.cliente_id,cliente:{razon_social:h.clientes?.nombre_razon_social,identificacion:h.clientes?.identificacion},estado_local:h.estado||"borrador",estado_hacienda:void 0,subtotal:Number(h.subtotal)||0,descuento_total:Number(h.descuento_total)||0,impuesto_total:Number(h.impuesto_total)||0,total:Number(h.total_general)||0,moneda:h.moneda||"CRC",tipo_cambio:Number(h.tipo_cambio)||1,condicion_venta:h.condicion_venta||"01",medio_pago:h.medio_pago||"01",plazo_credito:0,observaciones:h.notas,created_at:h.created_at}));console.log("‚úÖ [FACTURACI√ìN] Facturas formateadas:",I.length),g(I)}catch(m){console.error("‚ùå [FACTURACI√ìN] Error cargando facturas:",m),g([])}finally{c(!1)}},f=()=>{v(null),b(!0)},a=m=>{v(m),b(!0)},d=()=>{b(!1),v(null),s()},n=m=>{E(m)},j=async m=>{try{alert("Funcionalidad de firma requiere configuraci√≥n de Hacienda")}catch(C){console.error("Error firmando factura:",C),alert("Error firmando factura")}},y=async m=>{try{alert("Funcionalidad de env√≠o requiere configuraci√≥n de Hacienda")}catch(C){console.error("Error enviando factura:",C),alert("Error enviando factura a Hacienda")}},w=async m=>{try{alert("Funcionalidad de consulta requiere configuraci√≥n de Hacienda")}catch(C){console.error("Error consultando estado:",C),alert("Error consultando estado en Hacienda")}},S=[{id:"facturas",label:"Facturas Electr√≥nicas",icon:"ri-file-text-line"},{id:"recibidos",label:"Comprobantes Recibidos",icon:"ri-inbox-line"},{id:"configuracion",label:"Configuraci√≥n Hacienda",icon:"ri-settings-3-line"}];return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(T,{isOpen:_,onClose:()=>r(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(z,{onMenuClick:()=>r(!_)}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:S.map(m=>e.jsxs("button",{onClick:()=>p(m.id),className:`py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap cursor-pointer ${t===m.id?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("i",{className:`${m.icon} mr-2`}),m.label]},m.id))})}),t==="facturas"&&e.jsx("div",{className:"space-y-6",children:N?e.jsx(U,{factura:o,onClose:d}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Facturaci√≥n Electr√≥nica"}),e.jsxs("button",{onClick:f,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nueva Factura"]})]}),e.jsx(P,{filters:l,onFiltersChange:n}),e.jsx(D,{facturas:i,loading:u,onEdit:a,onFirmar:j,onEnviar:y,onConsultarEstado:w})]})}),t==="recibidos"&&e.jsx($,{}),t==="configuracion"&&e.jsx(M,{})]})})})]})]})}export{J as default};
//# sourceMappingURL=page-BffD2Ryd.js.map
