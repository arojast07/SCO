{"version":3,"mappings":"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","names":["INGEST_ENDPOINT","extractTextFromPDF","file","pdfjsLib","__vitePreload","arrayBuffer","pdfDocument","fullText","pageNum","pageText","item","str","preview","error","ingestPDFFromFile","sourceId","roleScope","pageScope","metadata","session","sessionError","supabase","textContent","payload","response","errorText","errorMessage","data","getCostBotChunksStats","chunks","uniqueDocuments","c","byRole","byContext","chunk","stats","listCostBotDocuments","documentsMap","existing","documents","deleteCostBotDocument","deletedChunks","CostBotAdmin","showNotification","useNotification","setStats","useState","setDocuments","loading","setLoading","uploading","setUploading","sidebarOpen","setSidebarOpen","deleteDialog","setDeleteDialog","selectedFile","setSelectedFile","setSourceId","setRoleScope","setPageScope","description","setDescription","useEffect","loadData","statsData","docsData","handleFileChange","e","fileName","handleUpload","result","handleDeleteClick","docSourceId","confirmDelete","deletedCount","cancelDelete","jsxs","jsx","Sidebar","TopBar","Fragment","doc","ConfirmationDialog"],"ignoreList":[],"sources":["../../src/services/costbotIngestService.ts","../../src/components/costbot/CostBotAdmin.tsx"],"sourcesContent":["import { supabase } from '../lib/supabase';\n\nexport interface IngestPDFRequest {\n  textContent: string;   // Texto plano extra√≠do del PDF\n  sourceId: string;      // ID l√≥gico del documento\n  sourceType: 'pdf';\n  roleScope: string;     // 'public', 'Admin', etc\n  pageScope: string;     // 'general', 'optimizador_cortes', etc\n  metadata?: Record<string, any>;\n}\n\nexport interface IngestPDFResponse {\n  success: boolean;\n  sourceId: string;\n  deletedChunks: number;\n  createdChunks: number;\n  message?: string;\n}\n\nconst INGEST_ENDPOINT = `${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/costbot-ingest-pdf`;\n\n/**\n * Extrae texto de un PDF usando pdf.js en el navegador\n */\nasync function extractTextFromPDF(file: File): Promise<string> {\n  console.log('üìÑ [PDF] Iniciando extracci√≥n de texto del PDF...');\n  console.log('üìÑ [PDF] Archivo:', { name: file.name, size: file.size, type: file.type });\n\n  try {\n    // Importar pdfjs-dist din√°micamente\n    console.log('üì¶ [PDF] Importando pdfjs-dist...');\n    const pdfjsLib = await import('pdfjs-dist');\n    \n    // Configurar el worker\n    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;\n    console.log('‚úÖ [PDF] Worker configurado');\n\n    // Leer el archivo como ArrayBuffer\n    console.log('üì• [PDF] Leyendo archivo...');\n    const arrayBuffer = await file.arrayBuffer();\n    console.log('‚úÖ [PDF] Archivo le√≠do:', arrayBuffer.byteLength, 'bytes');\n\n    // Cargar el documento PDF\n    console.log('üîÑ [PDF] Cargando documento PDF...');\n    const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });\n    const pdfDocument = await loadingTask.promise;\n    console.log('‚úÖ [PDF] Documento cargado:', pdfDocument.numPages, 'p√°gina(s)');\n\n    let fullText = '';\n\n    // Extraer texto de cada p√°gina\n    for (let pageNum = 1; pageNum <= pdfDocument.numPages; pageNum++) {\n      console.log(`üìÑ [PDF] Procesando p√°gina ${pageNum}/${pdfDocument.numPages}...`);\n      \n      const page = await pdfDocument.getPage(pageNum);\n      const textContent = await page.getTextContent();\n      \n      // Concatenar todos los items de texto\n      const pageText = textContent.items\n        .map((item: any) => {\n          if (item && typeof item.str === 'string') {\n            return item.str;\n          }\n          return '';\n        })\n        .filter((str: string) => str.length > 0)\n        .join(' ')\n        .trim();\n      \n      console.log(`  ‚úÖ [PDF] P√°gina ${pageNum}: ${pageText.length} caracteres extra√≠dos`);\n      \n      if (pageText.length > 0) {\n        fullText += (fullText ? '\\n\\n' : '') + pageText;\n      }\n    }\n\n    console.log('‚úÖ [PDF] Extracci√≥n completada');\n    console.log(`üìä [PDF] Total de texto extra√≠do: ${fullText.length} caracteres`);\n\n    // Mostrar preview del texto extra√≠do\n    const preview = fullText.substring(0, 300).replace(/\\s+/g, ' ').trim();\n    console.log(`üìù [PDF] Preview del texto extra√≠do (primeros 300 caracteres):`);\n    console.log(`\"${preview}...\"`);\n\n    if (fullText.length === 0) {\n      throw new Error('No se pudo extraer texto del PDF. Verifica que el PDF contenga texto seleccionable (no sea una imagen escaneada).');\n    }\n\n    return fullText;\n\n  } catch (error: any) {\n    console.error('‚ùå [PDF] Error al extraer texto:', error);\n    throw new Error(\n      `No se pudo extraer texto del PDF. ` +\n      `Verifica que: (1) El PDF contenga texto seleccionable (no sea una imagen escaneada), ` +\n      `(2) El PDF no est√© protegido o encriptado, ` +\n      `(3) El PDF tenga un formato est√°ndar. ` +\n      `Error t√©cnico: ${error.message}`\n    );\n  }\n}\n\n/**\n * Ingesta un PDF en CostBot a partir de un File del input.\n */\nexport async function ingestPDFFromFile(\n  file: File,\n  sourceId: string,\n  roleScope: string,\n  pageScope: string,\n  metadata?: Record<string, any>\n): Promise<IngestPDFResponse> {\n  if (!file) {\n    throw new Error('No se seleccion√≥ ning√∫n archivo PDF.');\n  }\n  if (!sourceId) {\n    throw new Error('Debes indicar un ID de documento (sourceId).');\n  }\n\n  console.log('üì§ [INGEST] Iniciando ingesta de PDF:', {\n    fileName: file.name,\n    fileSize: file.size,\n    sourceId,\n    roleScope,\n    pageScope\n  });\n\n  // 1. Obtener sesi√≥n de Supabase para sacar el access_token\n  console.log('üîê [INGEST] Obteniendo sesi√≥n de autenticaci√≥n...');\n  const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n  if (sessionError) {\n    console.error('‚ùå [INGEST] Error al obtener sesi√≥n:', sessionError);\n    throw new Error('Error al obtener la sesi√≥n de usuario.');\n  }\n\n  if (!session) {\n    console.error('‚ùå [INGEST] No hay sesi√≥n activa');\n    throw new Error('No hay sesi√≥n activa. Por favor, inicia sesi√≥n.');\n  }\n\n  if (!session.access_token) {\n    console.error('‚ùå [INGEST] No hay access_token en la sesi√≥n');\n    throw new Error('No se pudo obtener el token de acceso.');\n  }\n\n  console.log('‚úÖ [INGEST] Sesi√≥n obtenida correctamente:', {\n    userId: session.user.id,\n    email: session.user.email,\n    hasAccessToken: !!session.access_token\n  });\n\n  // 2. Extraer texto del PDF en el frontend (navegador)\n  console.log('üìÑ [INGEST] Extrayendo texto del PDF en el navegador...');\n  const textContent = await extractTextFromPDF(file);\n  console.log('‚úÖ [INGEST] Texto extra√≠do exitosamente:', {\n    textLength: textContent.length,\n    preview: textContent.substring(0, 100) + '...'\n  });\n\n  // 3. Armar el payload con el texto plano\n  const payload: IngestPDFRequest = {\n    textContent,          // <-- TEXTO PLANO, no base64\n    sourceId,\n    sourceType: 'pdf',\n    roleScope: roleScope || 'public',\n    pageScope: pageScope || 'general',\n    metadata: {\n      ...metadata,\n      filename: file.name,\n      fileSize: file.size\n    },\n  };\n\n  console.log('üì° [INGEST] Enviando payload a costbot-ingest-pdf...', {\n    sourceId: payload.sourceId,\n    roleScope: payload.roleScope,\n    pageScope: payload.pageScope,\n    textLength: textContent.length,\n    hasMetadata: !!metadata\n  });\n\n  // 4. Llamar a la Edge Function\n  const response = await fetch(INGEST_ENDPOINT, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`\n    },\n    body: JSON.stringify(payload)\n  });\n\n  console.log('üì• [INGEST] Respuesta recibida:', {\n    status: response.status,\n    statusText: response.statusText,\n    ok: response.ok\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    console.error('‚ùå [INGEST] Error del servidor:', errorText);\n    \n    let errorMessage = `Error ${response.status}: ${response.statusText}`;\n    \n    try {\n      const errorJson = JSON.parse(errorText);\n      errorMessage = errorJson.error || errorMessage;\n    } catch {\n      // Si no es JSON, usar el texto tal cual\n      errorMessage = errorText || errorMessage;\n    }\n    \n    throw new Error(errorMessage);\n  }\n\n  const data: IngestPDFResponse = await response.json();\n\n  console.log('‚úÖ [INGEST] PDF ingestado exitosamente:', {\n    sourceId: data.sourceId,\n    deletedChunks: data.deletedChunks,\n    createdChunks: data.createdChunks\n  });\n\n  return data;\n}\n\n/**\n * Obtiene estad√≠sticas de documentos ingresados\n */\nexport async function getIngestedDocumentsStats() {\n  const { data, error } = await supabase\n    .from('costbot_chunks')\n    .select('source_id, role_scope, page_scope, metadata')\n    .order('created_at', { ascending: false });\n\n  if (error) {\n    console.error('Error al obtener estad√≠sticas:', error);\n    throw error;\n  }\n\n  // Agrupar por source_id\n  const documentsMap = new Map<string, {\n    sourceId: string;\n    roleScope: string;\n    pageScope: string;\n    chunksCount: number;\n    metadata?: any;\n  }>();\n\n  data.forEach(chunk => {\n    const existing = documentsMap.get(chunk.source_id);\n    if (existing) {\n      existing.chunksCount++;\n    } else {\n      documentsMap.set(chunk.source_id, {\n        sourceId: chunk.source_id,\n        roleScope: chunk.role_scope,\n        pageScope: chunk.page_scope,\n        chunksCount: 1,\n        metadata: chunk.metadata\n      });\n    }\n  });\n\n  return Array.from(documentsMap.values());\n}\n\n/**\n * Elimina un documento y todos sus chunks\n */\nexport async function deleteIngestedDocument(sourceId: string) {\n  const { error } = await supabase\n    .from('costbot_chunks')\n    .delete()\n    .eq('source_id', sourceId);\n\n  if (error) {\n    console.error('Error al eliminar documento:', error);\n    throw error;\n  }\n\n  console.log('‚úÖ [INGEST] Documento eliminado:', sourceId);\n}\n\n/**\n * Obtiene estad√≠sticas de los chunks almacenados en CostBot\n */\nexport async function getCostBotChunksStats(): Promise<{\n  totalChunks: number;\n  totalDocuments: number;\n  byRole: Record<string, number>;\n  byContext: Record<string, number>;\n}> {\n  console.log('üìä [STATS] Obteniendo estad√≠sticas de chunks...');\n\n  const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n  if (sessionError || !session) {\n    console.error('üîê [STATS] Error de sesi√≥n:', sessionError);\n    throw new Error('No se pudo obtener la sesi√≥n de usuario.');\n  }\n\n  try {\n    // Obtener todos los chunks\n    const { data: chunks, error } = await supabase\n      .from('costbot_chunks')\n      .select('source_id, role_scope, page_scope');\n\n    if (error) {\n      console.error('‚ùå [STATS] Error al obtener chunks:', error);\n      throw new Error('Error al obtener estad√≠sticas de chunks');\n    }\n\n    // Calcular estad√≠sticas\n    const uniqueDocuments = new Set(chunks?.map(c => c.source_id) || []);\n    const byRole: Record<string, number> = {};\n    const byContext: Record<string, number> = {};\n\n    chunks?.forEach(chunk => {\n      byRole[chunk.role_scope] = (byRole[chunk.role_scope] || 0) + 1;\n      byContext[chunk.page_scope] = (byContext[chunk.page_scope] || 0) + 1;\n    });\n\n    const stats = {\n      totalChunks: chunks?.length || 0,\n      totalDocuments: uniqueDocuments.size,\n      byRole,\n      byContext\n    };\n\n    console.log('‚úÖ [STATS] Estad√≠sticas obtenidas:', stats);\n    return stats;\n  } catch (error) {\n    console.error('‚ùå [STATS] Error:', error);\n    throw error;\n  }\n}\n\n/**\n * Lista todos los documentos ingresados en CostBot\n */\nexport async function listCostBotDocuments(): Promise<Array<{\n  sourceId: string;\n  roleScope: string;\n  pageScope: string;\n  chunksCount: number;\n  createdAt: string;\n}>> {\n  console.log('üìã [LIST] Listando documentos...');\n\n  const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n  if (sessionError || !session) {\n    console.error('üîê [LIST] Error de sesi√≥n:', sessionError);\n    throw new Error('No se pudo obtener la sesi√≥n de usuario.');\n  }\n\n  try {\n    // Obtener todos los chunks agrupados por source_id\n    const { data: chunks, error } = await supabase\n      .from('costbot_chunks')\n      .select('source_id, role_scope, page_scope, created_at')\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      console.error('‚ùå [LIST] Error al obtener chunks:', error);\n      throw new Error('Error al listar documentos');\n    }\n\n    // Agrupar por source_id\n    const documentsMap = new Map<string, {\n      sourceId: string;\n      roleScope: string;\n      pageScope: string;\n      chunksCount: number;\n      createdAt: string;\n    }>();\n\n    chunks?.forEach(chunk => {\n      const existing = documentsMap.get(chunk.source_id);\n      if (existing) {\n        existing.chunksCount++;\n      } else {\n        documentsMap.set(chunk.source_id, {\n          sourceId: chunk.source_id,\n          roleScope: chunk.role_scope,\n          pageScope: chunk.page_scope,\n          chunksCount: 1,\n          createdAt: chunk.created_at\n        });\n      }\n    });\n\n    const documents = Array.from(documentsMap.values());\n    console.log('‚úÖ [LIST] Documentos listados:', documents.length);\n    return documents;\n  } catch (error) {\n    console.error('‚ùå [LIST] Error:', error);\n    throw error;\n  }\n}\n\n/**\n * Elimina un documento y todos sus chunks de CostBot\n */\nexport async function deleteCostBotDocument(sourceId: string): Promise<{ success: boolean; deletedChunks: number }> {\n  console.log('üóëÔ∏è [DELETE] Eliminando documento:', sourceId);\n\n  const { data: { session }, error: sessionError } = await supabase.auth.getSession();\n\n  if (sessionError || !session) {\n    console.error('üîê [DELETE] Error de sesi√≥n:', sessionError);\n    throw new Error('No se pudo obtener la sesi√≥n de usuario.');\n  }\n\n  try {\n    // Eliminar todos los chunks del documento\n    const { data, error } = await supabase\n      .from('costbot_chunks')\n      .delete()\n      .eq('source_id', sourceId)\n      .select();\n\n    if (error) {\n      console.error('‚ùå [DELETE] Error al eliminar chunks:', error);\n      throw new Error('Error al eliminar documento');\n    }\n\n    const deletedChunks = data?.length || 0;\n    console.log('‚úÖ [DELETE] Documento eliminado:', { sourceId, deletedChunks });\n    \n    return {\n      success: true,\n      deletedChunks\n    };\n  } catch (error) {\n    console.error('‚ùå [DELETE] Error:', error);\n    throw error;\n  }\n}\n","import { useState, useEffect } from 'react';\nimport { \n  ingestPDFFromFile, \n  getCostBotChunksStats, \n  listCostBotDocuments,\n  deleteCostBotDocument \n} from '../../services/costbotIngestService';\nimport { useNotification } from '../../hooks/useNotification';\nimport Sidebar from '../feature/Sidebar';\nimport TopBar from '../feature/TopBar';\nimport ConfirmationDialog from '../base/ConfirmationDialog';\nimport type { CostBotChunksStats } from '../../types/costbot';\n\nexport default function CostBotAdmin() {\n  const { showNotification } = useNotification();\n  \n  const [stats, setStats] = useState<CostBotChunksStats | null>(null);\n  const [documents, setDocuments] = useState<any[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  \n  // Estados para di√°logos de confirmaci√≥n\n  const [deleteDialog, setDeleteDialog] = useState<{\n    isOpen: boolean;\n    sourceId: string;\n    documentName: string;\n  }>({\n    isOpen: false,\n    sourceId: '',\n    documentName: ''\n  });\n  \n  // Formulario de ingesta\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [sourceId, setSourceId] = useState('');\n  const [roleScope, setRoleScope] = useState<'public' | 'admin' | 'supervisor' | 'operador'>('public');\n  const [pageScope, setPageScope] = useState('general');\n  const [description, setDescription] = useState('');\n\n  useEffect(() => {\n    loadData();\n  }, []);\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      const [statsData, docsData] = await Promise.all([\n        getCostBotChunksStats(),\n        listCostBotDocuments()\n      ]);\n      \n      setStats(statsData);\n      setDocuments(docsData);\n    } catch (error) {\n      console.error('Error al cargar datos:', error);\n      showNotification('error', 'Error al cargar datos de CostBot');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.type !== 'application/pdf') {\n        showNotification('error', 'Solo se permiten archivos PDF');\n        return;\n      }\n      setSelectedFile(file);\n      \n      // Auto-generar sourceId desde el nombre del archivo\n      if (!sourceId) {\n        const fileName = file.name.replace('.pdf', '').replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();\n        setSourceId(fileName);\n      }\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile || !sourceId) {\n      showNotification('error', 'Selecciona un archivo y proporciona un ID de documento');\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const result = await ingestPDFFromFile(\n        selectedFile,\n        sourceId,\n        roleScope,\n        pageScope,\n        {\n          description,\n          version: '1.0'\n        }\n      );\n\n      showNotification('success', `PDF ingestado: ${result.chunksInserted} fragmentos creados`);\n      \n      // Limpiar formulario\n      setSelectedFile(null);\n      setSourceId('');\n      setDescription('');\n      \n      // Recargar datos\n      loadData();\n      \n    } catch (error: any) {\n      console.error('Error al ingestar PDF:', error);\n      showNotification('error', error.message || 'Error al ingestar PDF');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDeleteClick = (docSourceId: string) => {\n    setDeleteDialog({\n      isOpen: true,\n      sourceId: docSourceId,\n      documentName: docSourceId\n    });\n  };\n\n  const confirmDelete = async () => {\n    const { sourceId: docSourceId } = deleteDialog;\n    \n    setDeleteDialog({ isOpen: false, sourceId: '', documentName: '' });\n\n    try {\n      const deletedCount = await deleteCostBotDocument(docSourceId);\n      showNotification('success', `Documento eliminado: ${deletedCount} fragmentos eliminados`);\n      loadData();\n    } catch (error: any) {\n      console.error('Error al eliminar documento:', error);\n      showNotification('error', error.message || 'Error al eliminar documento');\n    }\n  };\n\n  const cancelDelete = () => {\n    setDeleteDialog({ isOpen: false, sourceId: '', documentName: '' });\n  };\n\n  return (\n    <div className=\"flex h-screen bg-gray-50\">\n      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n      \n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        <TopBar onToggleSidebar={() => setSidebarOpen(!sidebarOpen)} />\n        \n        <main className=\"flex-1 overflow-y-auto\">\n          <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div className=\"space-y-6\">\n              {/* Header */}\n              <div className=\"bg-white rounded-lg shadow-sm p-6\">\n                <div className=\"flex items-center gap-3 mb-4\">\n                  <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                    <i className=\"ri-robot-2-line text-2xl text-blue-600\"></i>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-900\">Administraci√≥n de CostBot</h2>\n                    <p className=\"text-sm text-gray-600\">Gestiona documentos y conocimiento del asistente</p>\n                  </div>\n                </div>\n\n                {/* Estad√≠sticas */}\n                {stats && (\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6\">\n                    <div className=\"bg-blue-50 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm text-blue-600 font-medium\">Total Fragmentos</p>\n                          <p className=\"text-2xl font-bold text-blue-900\">{stats.total_chunks}</p>\n                        </div>\n                        <i className=\"ri-file-text-line text-3xl text-blue-400\"></i>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-green-50 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm text-green-600 font-medium\">Documentos</p>\n                          <p className=\"text-2xl font-bold text-green-900\">{stats.sources_count}</p>\n                        </div>\n                        <i className=\"ri-folder-line text-3xl text-green-400\"></i>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-purple-50 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm text-purple-600 font-medium\">Roles</p>\n                          <p className=\"text-2xl font-bold text-purple-900\">\n                            {Object.keys(stats.role_scopes || {}).length}\n                          </p>\n                        </div>\n                        <i className=\"ri-shield-user-line text-3xl text-purple-400\"></i>\n                      </div>\n                    </div>\n\n                    <div className=\"bg-orange-50 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm text-orange-600 font-medium\">Contextos</p>\n                          <p className=\"text-2xl font-bold text-orange-900\">\n                            {Object.keys(stats.page_scopes || {}).length}\n                          </p>\n                        </div>\n                        <i className=\"ri-pages-line text-3xl text-orange-400\"></i>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Formulario de ingesta */}\n              <div className=\"bg-white rounded-lg shadow-sm p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2\">\n                  <i className=\"ri-upload-cloud-line text-blue-600\"></i>\n                  Ingestar Nuevo Documento PDF\n                </h3>\n\n                <div className=\"space-y-4\">\n                  {/* Selector de archivo */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Archivo PDF\n                    </label>\n                    <div className=\"flex items-center gap-3\">\n                      <label className=\"flex-1 flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition-colors\">\n                        <div className=\"text-center\">\n                          {selectedFile ? (\n                            <>\n                              <i className=\"ri-file-pdf-line text-3xl text-red-500 mb-1\"></i>\n                              <p className=\"text-sm text-gray-700 font-medium\">{selectedFile.name}</p>\n                              <p className=\"text-xs text-gray-500\">{(selectedFile.size / 1024).toFixed(2)} KB</p>\n                            </>\n                          ) : (\n                            <>\n                              <i className=\"ri-upload-cloud-2-line text-3xl text-gray-400 mb-1\"></i>\n                              <p className=\"text-sm text-gray-600\">Haz clic para seleccionar un PDF</p>\n                            </>\n                          )}\n                        </div>\n                        <input\n                          type=\"file\"\n                          accept=\"application/pdf\"\n                          onChange={handleFileChange}\n                          className=\"hidden\"\n                        />\n                      </label>\n                      \n                      {selectedFile && (\n                        <button\n                          onClick={() => setSelectedFile(null)}\n                          className=\"px-4 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors cursor-pointer\"\n                        >\n                          <i className=\"ri-close-line\"></i>\n                        </button>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* ID del documento */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      ID del Documento *\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={sourceId}\n                      onChange={(e) => setSourceId(e.target.value)}\n                      placeholder=\"ej: manual_optimizador_v1\"\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Identificador √∫nico para este documento (sin espacios)\n                    </p>\n                  </div>\n\n                  {/* Alcance por rol */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Alcance por Rol\n                    </label>\n                    <select\n                      value={roleScope}\n                      onChange={(e) => setRoleScope(e.target.value as any)}\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer\"\n                    >\n                      <option value=\"public\">P√∫blico (todos los usuarios)</option>\n                      <option value=\"operador\">Operador</option>\n                      <option value=\"supervisor\">Supervisor</option>\n                      <option value=\"admin\">Administrador</option>\n                    </select>\n                  </div>\n\n                  {/* Alcance por p√°gina */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Contexto de P√°gina\n                    </label>\n                    <select\n                      value={pageScope}\n                      onChange={(e) => setPageScope(e.target.value)}\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer\"\n                    >\n                      <option value=\"general\">General (todas las p√°ginas)</option>\n                      <option value=\"dashboard\">Dashboard</option>\n                      <option value=\"optimizador_cortes\">Optimizador de Cortes</option>\n                      <option value=\"bom\">BOM / Productos</option>\n                      <option value=\"inventario\">Inventario</option>\n                      <option value=\"cotizaciones\">Cotizaciones</option>\n                      <option value=\"pedidos\">Pedidos</option>\n                      <option value=\"facturacion\">Facturaci√≥n</option>\n                      <option value=\"tareas\">Tareas</option>\n                    </select>\n                  </div>\n\n                  {/* Descripci√≥n */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      Descripci√≥n (opcional)\n                    </label>\n                    <textarea\n                      value={description}\n                      onChange={(e) => setDescription(e.target.value)}\n                      placeholder=\"Descripci√≥n del contenido del documento...\"\n                      rows={3}\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    />\n                  </div>\n\n                  {/* Bot√≥n de ingesta */}\n                  <button\n                    onClick={handleUpload}\n                    disabled={!selectedFile || !sourceId || uploading}\n                    className=\"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-medium cursor-pointer whitespace-nowrap\"\n                  >\n                    {uploading ? (\n                      <>\n                        <i className=\"ri-loader-4-line animate-spin\"></i>\n                        Procesando PDF...\n                      </>\n                    ) : (\n                      <>\n                        <i className=\"ri-upload-line\"></i>\n                        Ingestar Documento\n                      </>\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              {/* Lista de documentos */}\n              <div className=\"bg-white rounded-lg shadow-sm p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n                    <i className=\"ri-file-list-line text-blue-600\"></i>\n                    Documentos Ingestados\n                  </h3>\n                  <button\n                    onClick={loadData}\n                    disabled={loading}\n                    className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 cursor-pointer whitespace-nowrap\"\n                  >\n                    <i className={`ri-refresh-line ${loading ? 'animate-spin' : ''}`}></i>\n                  </button>\n                </div>\n\n                {loading ? (\n                  <div className=\"text-center py-8\">\n                    <i className=\"ri-loader-4-line text-3xl text-blue-600 animate-spin\"></i>\n                    <p className=\"text-sm text-gray-600 mt-2\">Cargando documentos...</p>\n                  </div>\n                ) : documents.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <i className=\"ri-file-forbid-line text-4xl text-gray-400 mb-2\"></i>\n                    <p className=\"text-sm text-gray-600\">No hay documentos ingestados</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {documents.map((doc) => (\n                      <div\n                        key={doc.source_id}\n                        className=\"border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors\"\n                      >\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <i className=\"ri-file-pdf-line text-xl text-red-500\"></i>\n                              <h4 className=\"font-semibold text-gray-900\">{doc.source_id}</h4>\n                            </div>\n                            \n                            <div className=\"flex flex-wrap gap-2 mb-2\">\n                              <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded\">\n                                {doc.chunks_count} fragmentos\n                              </span>\n                              <span className=\"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded\">\n                                Rol: {doc.role_scope}\n                              </span>\n                              <span className=\"text-xs bg-green-100 text-green-700 px-2 py-1 rounded\">\n                                Contexto: {doc.page_scope}\n                              </span>\n                            </div>\n\n                            {doc.metadata?.description && (\n                              <p className=\"text-sm text-gray-600\">{doc.metadata.description}</p>\n                            )}\n                            \n                            {doc.metadata?.filename && (\n                              <p className=\"text-xs text-gray-500 mt-1\">\n                                Archivo: {doc.metadata.filename}\n                              </p>\n                            )}\n                          </div>\n\n                          <button\n                            onClick={() => handleDeleteClick(doc.source_id)}\n                            className=\"ml-4 px-3 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors cursor-pointer whitespace-nowrap\"\n                            title=\"Eliminar documento\"\n                          >\n                            <i className=\"ri-delete-bin-line\"></i>\n                          </button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Instrucciones */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-6\">\n                <h4 className=\"font-semibold text-blue-900 mb-3 flex items-center gap-2\">\n                  <i className=\"ri-information-line\"></i>\n                  Instrucciones de Uso\n                </h4>\n                <ul className=\"space-y-2 text-sm text-blue-800\">\n                  <li className=\"flex items-start gap-2\">\n                    <i className=\"ri-checkbox-circle-line text-blue-600 mt-0.5\"></i>\n                    <span>Sube documentos PDF con informaci√≥n relevante para CostBot</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <i className=\"ri-checkbox-circle-line text-blue-600 mt-0.5\"></i>\n                    <span>Configura el alcance por rol para controlar qui√©n puede ver cada documento</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <i className=\"ri-checkbox-circle-line text-blue-600 mt-0.5\"></i>\n                    <span>Asigna un contexto de p√°gina para que CostBot use el documento en secciones espec√≠ficas</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <i className=\"ri-checkbox-circle-line text-blue-600 mt-0.5\"></i>\n                    <span>Los documentos se dividen autom√°ticamente en fragmentos y se generan embeddings</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <i className=\"ri-checkbox-circle-line text-blue-600 mt-0.5\"></i>\n                    <span>CostBot usar√° estos documentos para responder preguntas de forma contextual</span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </main>\n      </div>\n\n      {/* Di√°logo de confirmaci√≥n para eliminar */}\n      <ConfirmationDialog\n        isOpen={deleteDialog.isOpen}\n        type=\"danger\"\n        title=\"Eliminar Documento\"\n        message={`¬øEst√° seguro que desea eliminar el documento \"${deleteDialog.documentName}\"? Esta acci√≥n eliminar√° todos los fragmentos asociados y no se puede deshacer.`}\n        confirmText=\"S√≠, Eliminar\"\n        cancelText=\"Cancelar\"\n        onConfirm={confirmDelete}\n        onCancel={cancelDelete}\n      />\n    </div>\n  );\n}\n"],"file":"CostBotAdmin-BaL-gepf.js"}