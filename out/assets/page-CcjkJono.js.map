{"version":3,"file":"page-CcjkJono.js","sources":["../../src/pages/tareas/components/TareasLayout.tsx","../../src/pages/tareas/components/TareasDeadline.tsx","../../src/services/tareaService.ts","../../src/pages/tareas/components/TareaFormModal.tsx","../../src/pages/tareas/components/TareaProcesarModal.tsx","../../src/pages/tareas/components/ConfigEncargadosModal.tsx","../../src/pages/tareas/components/ColaboradoresModal.tsx","../../src/pages/tareas/page.tsx"],"sourcesContent":["import { ReactNode } from 'react';\nimport type { TareaStats } from '../../../types/tarea';\n\ninterface TareasLayoutProps {\n  children: ReactNode;\n  stats: TareaStats | null;\n  onNuevaTarea: () => void;\n  onConfigEncargados: () => void;\n  onConfigColaboradores: () => void;\n  onExportar: () => void;\n  canCreate: boolean;\n  canManage: boolean;\n}\n\nexport default function TareasLayout({\n  children,\n  stats,\n  onNuevaTarea,\n  onConfigEncargados,\n  onConfigColaboradores,\n  onExportar,\n  canCreate,\n  canManage\n}: TareasLayoutProps) {\n  return (\n    <main className=\"flex-1 overflow-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Tareas</h1>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              Gesti√≥n de √≥rdenes de trabajo y seguimiento de producci√≥n\n            </p>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {/* Bot√≥n Exportar */}\n            <button\n              onClick={onExportar}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 whitespace-nowrap cursor-pointer\"\n            >\n              <i className=\"ri-download-line\"></i>\n              Exportar\n            </button>\n            \n            {/* Bot√≥n Colaboradores */}\n            {canManage && (\n              <button\n                onClick={onConfigColaboradores}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 whitespace-nowrap cursor-pointer\"\n              >\n                <i className=\"ri-team-line\"></i>\n                Colaboradores\n              </button>\n            )}\n            \n            {/* Bot√≥n Encargados */}\n            {canManage && (\n              <button\n                onClick={onConfigEncargados}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 whitespace-nowrap cursor-pointer\"\n              >\n                <i className=\"ri-user-settings-line\"></i>\n                Encargados\n              </button>\n            )}\n            \n            {/* Bot√≥n Nueva Tarea */}\n            {canCreate && (\n              <button\n                onClick={onNuevaTarea}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 whitespace-nowrap cursor-pointer\"\n              >\n                <i className=\"ri-add-line\"></i>\n                Nueva Tarea\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n      \n      {/* Stats Cards */}\n      {stats && (\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6\">\n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-gray-400\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.en_cola}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">En Cola</div>\n          </div>\n          \n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.en_proceso}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">En Proceso</div>\n          </div>\n          \n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-purple-500\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.produciendo}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">Produciendo</div>\n          </div>\n          \n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-yellow-500\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.esperando_suministros}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">Esperando</div>\n          </div>\n          \n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.terminado}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">Terminado</div>\n          </div>\n          \n          <div className=\"bg-white rounded-lg shadow-sm p-4 border-l-4 border-gray-600\">\n            <div className=\"text-2xl font-bold text-gray-900\">{stats.finalizado}</div>\n            <div className=\"text-xs text-gray-500 mt-1\">Finalizado</div>\n          </div>\n        </div>\n      )}\n      \n      {/* Contenido principal */}\n      {children}\n    </main>\n  );\n}\n","import { useState } from 'react';\nimport type { Tarea, TareaFilters, TareaEstado } from '../../../types/tarea';\n\ninterface TareasDeadlineProps {\n  tareas: Tarea[];\n  loading: boolean;\n  filtros: TareaFilters;\n  onFiltroChange: (filtros: TareaFilters) => void;\n  onProcesar: (tarea: Tarea) => void;\n  onRefresh: () => void;\n}\n\nconst ESTADOS: TareaEstado[] = [\n  'En Cola',\n  'En Proceso',\n  'Produciendo',\n  'Esperando suministros',\n  'Terminado',\n  'Finalizado'\n];\n\nconst getEstadoColor = (estado: TareaEstado): string => {\n  const colores: Record<TareaEstado, string> = {\n    'En Cola': 'bg-gray-100 text-gray-800',\n    'En Proceso': 'bg-blue-100 text-blue-800',\n    'Produciendo': 'bg-purple-100 text-purple-800',\n    'Esperando suministros': 'bg-yellow-100 text-yellow-800',\n    'Terminado': 'bg-green-100 text-green-800',\n    'Finalizado': 'bg-gray-200 text-gray-600'\n  };\n  return colores[estado] || 'bg-gray-100 text-gray-800';\n};\n\nexport default function TareasDeadline({\n  tareas,\n  loading,\n  filtros,\n  onFiltroChange,\n  onProcesar,\n  onRefresh\n}: TareasDeadlineProps) {\n  const [busqueda, setBusqueda] = useState(filtros.busqueda || '');\n\n  const handleBusquedaChange = (value: string) => {\n    setBusqueda(value);\n    onFiltroChange({ ...filtros, busqueda: value });\n  };\n\n  const handleEstadoChange = (estado: string) => {\n    onFiltroChange({ ...filtros, estado: estado as TareaEstado | '' });\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm\">\n      {/* Filtros */}\n      <div className=\"p-4 border-b border-gray-200\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          {/* B√∫squeda */}\n          <div className=\"flex-1\">\n            <div className=\"relative\">\n              <i className=\"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"></i>\n              <input\n                type=\"text\"\n                placeholder=\"Buscar por consecutivo o descripci√≥n...\"\n                value={busqueda}\n                onChange={(e) => handleBusquedaChange(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              />\n            </div>\n          </div>\n          \n          {/* Filtro por estado */}\n          <div className=\"sm:w-48\">\n            <select\n              value={filtros.estado || ''}\n              onChange={(e) => handleEstadoChange(e.target.value)}\n              className=\"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n            >\n              <option value=\"\">Todos (sin Finalizado)</option>\n              {ESTADOS.map(estado => (\n                <option key={estado} value={estado}>{estado}</option>\n              ))}\n            </select>\n          </div>\n          \n          {/* Bot√≥n refrescar */}\n          <button\n            onClick={onRefresh}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 whitespace-nowrap cursor-pointer\"\n          >\n            <i className=\"ri-refresh-line\"></i>\n            Refrescar\n          </button>\n        </div>\n      </div>\n      \n      {/* Tabla */}\n      <div className=\"overflow-x-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Tarea\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Fecha Estimada\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Solicitante\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Cantidad\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Descripci√≥n\n              </th>\n              <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Estado\n              </th>\n              <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Acciones\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-gray-200\">\n            {loading ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center\">\n                  <div className=\"flex items-center justify-center gap-2 text-gray-500\">\n                    <i className=\"ri-loader-4-line animate-spin\"></i>\n                    Cargando tareas...\n                  </div>\n                </td>\n              </tr>\n            ) : tareas.length === 0 ? (\n              <tr>\n                <td colSpan={7} className=\"px-4 py-8 text-center text-gray-500\">\n                  No hay tareas para mostrar\n                </td>\n              </tr>\n            ) : (\n              tareas.map((tarea) => (\n                <tr key={tarea.id} className=\"hover:bg-gray-50\">\n                  {/* Consecutivo */}\n                  <td className=\"px-4 py-3\">\n                    <button\n                      onClick={() => onProcesar(tarea)}\n                      className=\"text-blue-600 hover:text-blue-800 font-medium cursor-pointer\"\n                    >\n                      {tarea.consecutivo}\n                    </button>\n                    <div className=\"text-xs text-gray-500\">\n                      {new Date(tarea.created_at).toLocaleDateString()}\n                    </div>\n                  </td>\n                  \n                  {/* Fecha Estimada */}\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">\n                    {tarea.fecha_estimada_entrega ? (\n                      <span className={\n                        new Date(tarea.fecha_estimada_entrega) < new Date() \n                          ? 'text-red-600 font-medium' \n                          : ''\n                      }>\n                        {new Date(tarea.fecha_estimada_entrega).toLocaleDateString()}\n                      </span>\n                    ) : (\n                      <span className=\"text-gray-400\">Sin definir</span>\n                    )}\n                  </td>\n                  \n                  {/* Solicitante */}\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">\n                    {tarea.email_solicitante}\n                  </td>\n                  \n                  {/* Cantidad */}\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">\n                    {tarea.cantidad_unidades || '-'}\n                  </td>\n                  \n                  {/* Descripci√≥n */}\n                  <td className=\"px-4 py-3 text-sm text-gray-900 max-w-xs truncate\">\n                    {tarea.descripcion_breve || '-'}\n                  </td>\n                  \n                  {/* Estado */}\n                  <td className=\"px-4 py-3\">\n                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${getEstadoColor(tarea.estado)}`}>\n                      {tarea.estado}\n                    </span>\n                  </td>\n                  \n                  {/* Acciones */}\n                  <td className=\"px-4 py-3 text-right\">\n                    <button\n                      onClick={() => onProcesar(tarea)}\n                      className=\"px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap\"\n                    >\n                      Procesar\n                    </button>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n      \n      {/* Footer con total */}\n      {!loading && tareas.length > 0 && (\n        <div className=\"px-4 py-3 border-t border-gray-200 text-sm text-gray-500\">\n          Mostrando {tareas.length} tarea{tareas.length !== 1 ? 's' : ''}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { supabase } from '../lib/supabase';\nimport type { \n  Tarea, \n  TareaItem, \n  TareaConfigCampo, \n  TareaEncargado, \n  TareaColaborador,\n  CreateTareaData,\n  UpdateTareaData,\n  TareaFilters,\n  TareaStats\n} from '../types/tarea';\n\n/**\n * Servicio para gesti√≥n de tareas\n * Incluye multi-tienda, RLS y consecutivo autom√°tico\n */\nclass TareaService {\n  \n  // =====================================================\n  // TAREAS - CRUD\n  // =====================================================\n  \n  /**\n   * Obtener lista de tareas con filtros\n   */\n  async getTareas(filters?: TareaFilters): Promise<Tarea[]> {\n    try {\n      // Obtener usuario autenticado\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      // Obtener tienda actual\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      // Construir query base - SIN JOIN a usuarios\n      let query = supabase\n        .from('tareas')\n        .select(`\n          *,\n          items:tareas_items(\n            id,\n            producto_id,\n            inventario_id,\n            descripcion,\n            cantidad,\n            costo_unitario,\n            costo_total\n          ),\n          personal_asignado:tareas_personal_asignado(\n            id,\n            colaborador_id,\n            colaborador:tareas_colaboradores(\n              id,\n              nombre,\n              email,\n              telefono\n            )\n          )\n        `)\n        .eq('tienda_id', tiendaActual.tienda_id)\n        .order('created_at', { ascending: false });\n\n      // Aplicar filtros\n      if (filters?.estado) {\n        query = query.eq('estado', filters.estado);\n      }\n\n      if (filters?.fecha_desde) {\n        query = query.gte('created_at', filters.fecha_desde);\n      }\n\n      if (filters?.fecha_hasta) {\n        query = query.lte('created_at', filters.fecha_hasta);\n      }\n\n      if (filters?.busqueda) {\n        query = query.or(`consecutivo.ilike.%${filters.busqueda}%,descripcion_breve.ilike.%${filters.busqueda}%`);\n      }\n\n      if (filters?.solicitante_id) {\n        query = query.eq('solicitante_id', filters.solicitante_id);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n\n      return data || [];\n    } catch (error) {\n      console.error('‚ùå Error obteniendo tareas:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Obtener tarea por ID\n   */\n  async getTareaById(id: string): Promise<Tarea | null> {\n    try {\n      const { data, error } = await supabase\n        .from('tareas')\n        .select(`\n          *,\n          items:tareas_items(\n            id,\n            producto_id,\n            inventario_id,\n            descripcion,\n            cantidad,\n            costo_unitario,\n            costo_total\n          ),\n          personal_asignado:tareas_personal_asignado(\n            id,\n            colaborador_id,\n            colaborador:tareas_colaboradores(\n              id,\n              nombre,\n              email,\n              telefono\n            )\n          )\n        `)\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      return data;\n    } catch (error) {\n      console.error('‚ùå Error obteniendo tarea:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Crear nueva tarea\n   */\n  async createTarea(data: CreateTareaData): Promise<Tarea> {\n    try {\n      // Obtener usuario actual\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      // Obtener tienda actual\n      const { data: tiendaData } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaData) throw new Error('No hay tienda asignada');\n\n      // Crear tarea (el consecutivo se genera autom√°ticamente por trigger)\n      const { data: tarea, error: tareaError } = await supabase\n        .from('tareas')\n        .insert({\n          tienda_id: tiendaData.tienda_id,\n          solicitante_id: user.id,\n          email_solicitante: user.email || '',\n          datos_formulario: data.datos_formulario,\n          cotizacion_id: data.cotizacion_id,\n          fecha_estimada_entrega: data.fecha_estimada_entrega,\n          cantidad_unidades: data.cantidad_unidades,\n          descripcion_breve: data.descripcion_breve,\n          estado: 'En Cola',\n          total_costo: 0,\n          created_by: user.id\n        })\n        .select()\n        .single();\n\n      if (tareaError) throw tareaError;\n\n      console.log('‚úÖ Tarea creada:', tarea.consecutivo);\n\n      // Enviar notificaciones por correo (completamente opcional, no bloquea)\n      this.enviarNotificacionSegura(tarea.id, 'En Cola');\n\n      return this.getTareaById(tarea.id) as Promise<Tarea>;\n    } catch (error) {\n      console.error('‚ùå Error creando tarea:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Actualizar tarea\n   */\n  async updateTarea(id: string, data: UpdateTareaData): Promise<Tarea> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      // Obtener estado anterior para notificaci√≥n\n      const { data: tareaAnterior } = await supabase\n        .from('tareas')\n        .select('estado')\n        .eq('id', id)\n        .single();\n\n      const estadoAnterior = tareaAnterior?.estado;\n\n      // Calcular total de costos si hay items\n      let totalCosto = 0;\n      if (data.items) {\n        totalCosto = data.items.reduce((sum, item) => sum + (item.cantidad * item.costo_unitario), 0);\n      }\n\n      // Actualizar tarea principal\n      const { error: tareaError } = await supabase\n        .from('tareas')\n        .update({\n          fecha_estimada_entrega: data.fecha_estimada_entrega,\n          cantidad_unidades: data.cantidad_unidades,\n          descripcion_breve: data.descripcion_breve,\n          cantidad_personas: data.cantidad_personas,\n          fecha_inicio: data.fecha_inicio,\n          fecha_cierre: data.fecha_cierre,\n          entregado_a: data.entregado_a,\n          estado: data.estado,\n          total_costo: data.items ? totalCosto : undefined,\n          updated_by: user.id\n        })\n        .eq('id', id);\n\n      if (tareaError) throw tareaError;\n\n      // Actualizar items si se proporcionan\n      if (data.items) {\n        // Eliminar items existentes\n        await supabase.from('tareas_items').delete().eq('tarea_id', id);\n\n        // Crear nuevos items\n        if (data.items.length > 0) {\n          const items = data.items.map(item => ({\n            tarea_id: id,\n            producto_id: item.producto_id,\n            inventario_id: item.inventario_id,\n            descripcion: item.descripcion,\n            cantidad: item.cantidad,\n            costo_unitario: item.costo_unitario\n          }));\n\n          const { error: itemsError } = await supabase\n            .from('tareas_items')\n            .insert(items);\n\n          if (itemsError) throw itemsError;\n        }\n      }\n\n      // Actualizar personal asignado si se proporciona\n      if (data.personal_asignado) {\n        // Eliminar asignaciones existentes\n        await supabase.from('tareas_personal_asignado').delete().eq('tarea_id', id);\n\n        // Crear nuevas asignaciones\n        if (data.personal_asignado.length > 0) {\n          const asignaciones = data.personal_asignado.map(colaboradorId => ({\n            tarea_id: id,\n            colaborador_id: colaboradorId\n          }));\n\n          const { error: asignacionError } = await supabase\n            .from('tareas_personal_asignado')\n            .insert(asignaciones);\n\n          if (asignacionError) throw asignacionError;\n        }\n      }\n\n      console.log('‚úÖ Tarea actualizada:', id);\n\n      // Enviar notificaci√≥n si cambi√≥ el estado (completamente opcional)\n      if (data.estado && estadoAnterior && data.estado !== estadoAnterior) {\n        this.enviarNotificacionCambioEstadoSegura(id, estadoAnterior, data.estado);\n      }\n\n      return this.getTareaById(id) as Promise<Tarea>;\n    } catch (error) {\n      console.error('‚ùå Error actualizando tarea:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Eliminar tarea\n   */\n  async deleteTarea(id: string): Promise<void> {\n    const { error } = await supabase\n      .from('tareas')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n      throw new Error(`Error eliminando tarea: ${JSON.stringify(error)}`);\n    }\n  }\n\n  /**\n   * Obtener estad√≠sticas de tareas\n   */\n  async getStats(): Promise<TareaStats> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { data, error } = await supabase\n        .from('tareas')\n        .select('estado')\n        .eq('tienda_id', tiendaActual.tienda_id);\n\n      if (error) throw error;\n\n      const stats: TareaStats = {\n        total: data?.length || 0,\n        en_cola: data?.filter(t => t.estado === 'En Cola').length || 0,\n        en_proceso: data?.filter(t => t.estado === 'En Proceso').length || 0,\n        produciendo: data?.filter(t => t.estado === 'Produciendo').length || 0,\n        esperando_suministros: data?.filter(t => t.estado === 'Esperando suministros').length || 0,\n        terminado: data?.filter(t => t.estado === 'Terminado').length || 0,\n        finalizado: data?.filter(t => t.estado === 'Finalizado').length || 0\n      };\n\n      return stats;\n    } catch (error) {\n      console.error('‚ùå Error obteniendo estad√≠sticas:', error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // CONFIGURACI√ìN DE CAMPOS\n  // =====================================================\n\n  /**\n   * Obtener configuraci√≥n de campos del formulario\n   */\n  async getConfigCampos(): Promise<TareaConfigCampo[]> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { data, error } = await supabase\n        .from('tareas_config_campos')\n        .select('*')\n        .eq('tienda_id', tiendaActual.tienda_id)\n        .eq('activo', true)\n        .order('orden', { ascending: true });\n\n      if (error) throw error;\n\n      return data || [];\n    } catch (error) {\n      console.error('‚ùå Error obteniendo configuraci√≥n de campos:', error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // ENCARGADOS/L√çDERES\n  // =====================================================\n\n  /**\n   * Obtener encargados de la tienda\n   */\n  async getEncargados(): Promise<TareaEncargado[]> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { data, error } = await supabase\n        .from('tareas_encargados')\n        .select('*')\n        .eq('tienda_id', tiendaActual.tienda_id);\n\n      if (error) throw error;\n\n      return data || [];\n    } catch (error) {\n      console.error('‚ùå Error obteniendo encargados:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Agregar encargado\n   */\n  async addEncargado(usuarioId: string): Promise<void> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { error } = await supabase\n        .from('tareas_encargados')\n        .insert({\n          tienda_id: tiendaActual.tienda_id,\n          usuario_id: usuarioId,\n          created_by: user.id\n        });\n\n      if (error) throw error;\n\n      console.log('‚úÖ Encargado agregado');\n    } catch (error) {\n      console.error('‚ùå Error agregando encargado:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remover encargado\n   */\n  async removeEncargado(encargadoId: string): Promise<void> {\n    try {\n      const { error } = await supabase\n        .from('tareas_encargados')\n        .delete()\n        .eq('id', encargadoId);\n\n      if (error) throw error;\n\n      console.log('‚úÖ Encargado removido');\n    } catch (error) {\n      console.error('‚ùå Error removiendo encargado:', error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // COLABORADORES\n  // =====================================================\n\n  /**\n   * Obtener colaboradores de la tienda\n   */\n  async getColaboradores(): Promise<TareaColaborador[]> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { data, error } = await supabase\n        .from('tareas_colaboradores')\n        .select('*')\n        .eq('tienda_id', tiendaActual.tienda_id)\n        .eq('activo', true)\n        .order('nombre', { ascending: true });\n\n      if (error) throw error;\n\n      return data || [];\n    } catch (error) {\n      console.error('‚ùå Error obteniendo colaboradores:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Crear colaborador\n   */\n  async createColaborador(data: { nombre: string; email?: string; telefono?: string }): Promise<void> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) throw new Error('No hay tienda asignada');\n\n      const { error } = await supabase\n        .from('tareas_colaboradores')\n        .insert({\n          tienda_id: tiendaActual.tienda_id,\n          nombre: data.nombre,\n          email: data.email,\n          telefono: data.telefono,\n          activo: true\n        });\n\n      if (error) throw error;\n\n      console.log('‚úÖ Colaborador creado');\n    } catch (error) {\n      console.error('‚ùå Error creando colaborador:', error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // NOTIFICACIONES\n  // =====================================================\n\n  /**\n   * Enviar notificaci√≥n de nueva tarea\n   */\n  private async enviarNotificacionNuevaTarea(tareaId: string, estadoNuevo: string): Promise<void> {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        console.warn('‚ö†Ô∏è No hay sesi√≥n activa para enviar notificaci√≥n');\n        return;\n      }\n\n      const response = await supabase.functions.invoke('enviar-notificacion-tarea', {\n        body: {\n          tarea_id: tareaId,\n          estado_nuevo: estadoNuevo\n        }\n      });\n\n      if (response.error) {\n        console.error('‚ùå Error en Edge Function:', response.error);\n      } else {\n        console.log('‚úÖ Notificaci√≥n enviada:', response.data);\n      }\n    } catch (error) {\n      console.error('‚ùå Error enviando notificaci√≥n:', error);\n      // No lanzar error para no bloquear la creaci√≥n de la tarea\n    }\n  }\n\n  /**\n   * Enviar notificaci√≥n de cambio de estado\n   */\n  private async enviarNotificacionCambioEstado(\n    tareaId: string,\n    estadoAnterior: string,\n    estadoNuevo: string\n  ): Promise<void> {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) {\n        console.warn('‚ö†Ô∏è No hay sesi√≥n activa para enviar notificaci√≥n');\n        return;\n      }\n\n      const response = await supabase.functions.invoke('enviar-notificacion-tarea', {\n        body: {\n          tarea_id: tareaId,\n          estado_anterior: estadoAnterior,\n          estado_nuevo: estadoNuevo\n        }\n      });\n\n      if (response.error) {\n        console.error('‚ùå Error en Edge Function:', response.error);\n      } else {\n        console.log('‚úÖ Notificaci√≥n de cambio de estado enviada:', response.data);\n      }\n    } catch (error) {\n      console.error('‚ùå Error enviando notificaci√≥n:', error);\n      // No lanzar error para no bloquear la actualizaci√≥n\n    }\n  }\n\n  // =====================================================\n  // NOTIFICACIONES (COMPLETAMENTE OPCIONALES)\n  // =====================================================\n\n  /**\n   * Enviar notificaci√≥n de forma segura (no bloquea si falla)\n   */\n  private enviarNotificacionSegura(tareaId: string, estadoNuevo: string): void {\n    // Ejecutar en background sin esperar\n    setTimeout(async () => {\n      try {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session) {\n          console.log('‚ÑπÔ∏è No hay sesi√≥n para enviar notificaci√≥n');\n          return;\n        }\n\n        const response = await supabase.functions.invoke('enviar-notificacion-tarea', {\n          body: {\n            tarea_id: tareaId,\n            estado_nuevo: estadoNuevo\n          }\n        });\n\n        if (response.error) {\n          console.log('‚ÑπÔ∏è No se pudo enviar notificaci√≥n (no cr√≠tico):', response.error.message);\n        } else {\n          console.log('‚úÖ Notificaci√≥n enviada');\n        }\n      } catch (error) {\n        // Error silencioso - las notificaciones son opcionales\n        console.log('‚ÑπÔ∏è Notificaci√≥n no enviada (servicio no disponible)');\n      }\n    }, 0);\n  }\n\n  /**\n   * Enviar notificaci√≥n de cambio de estado de forma segura\n   */\n  private enviarNotificacionCambioEstadoSegura(\n    tareaId: string,\n    estadoAnterior: string,\n    estadoNuevo: string\n  ): void {\n    // Ejecutar en background sin esperar\n    setTimeout(async () => {\n      try {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session) {\n          console.log('‚ÑπÔ∏è No hay sesi√≥n para enviar notificaci√≥n');\n          return;\n        }\n\n        const response = await supabase.functions.invoke('enviar-notificacion-tarea', {\n          body: {\n            tarea_id: tareaId,\n            estado_anterior: estadoAnterior,\n            estado_nuevo: estadoNuevo\n          }\n        });\n\n        if (response.error) {\n          console.log('‚ÑπÔ∏è No se pudo enviar notificaci√≥n (no cr√≠tico):', response.error.message);\n        } else {\n          console.log('‚úÖ Notificaci√≥n de cambio de estado enviada');\n        }\n      } catch (error) {\n        // Error silencioso - las notificaciones son opcionales\n        console.log('‚ÑπÔ∏è Notificaci√≥n no enviada (servicio no disponible)');\n      }\n    }, 0);\n  }\n\n  // =====================================================\n  // IMPORTAR DESDE COTIZACI√ìN\n  // =====================================================\n\n  /**\n   * Importar items desde cotizaci√≥n\n   */\n  async importarDesdeCotizacion(cotizacionId: string): Promise<TareaItem[]> {\n    try {\n      const { data, error } = await supabase\n        .from('cotizacion_items')\n        .select('*')\n        .eq('cotizacion_id', cotizacionId);\n\n      if (error) throw error;\n\n      // Convertir items de cotizaci√≥n a items de tarea\n      const items: TareaItem[] = (data || []).map(item => ({\n        id: '',\n        tarea_id: '',\n        producto_id: item.producto_id,\n        inventario_id: null,\n        descripcion: item.descripcion,\n        cantidad: item.cantidad,\n        costo_unitario: item.precio_unitario,\n        costo_total: item.subtotal,\n        created_at: new Date().toISOString()\n      }));\n\n      return items;\n    } catch (error) {\n      console.error('‚ùå Error importando desde cotizaci√≥n:', error);\n      throw error;\n    }\n  }\n}\n\n// Exportar instancia del servicio\nconst tareaService = new TareaService();\nexport default tareaService;\nexport { tareaService };\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { tareaService } from '../../../services/tareaService';\nimport type { CreateTareaData, DepartamentoSolicitante, ClienteType, SolicitudEPA, SolicitudCOFERSA, TipoTrabajo, ItemTablaSimple, ItemTablaCompleta, TareaColaborador } from '../../../types/tarea';\nimport * as XLSX from 'xlsx';\nimport { usePermissions } from '../../../hooks/usePermissions';\n\ninterface TareaFormModalProps {\n  onClose: () => void;\n  onSave: () => void;\n}\n\ninterface CotizacionOption {\n  id: number;\n  codigo: string;\n  cliente_nombre: string;\n  total: number;\n  items: any[];\n}\n\nexport default function TareaFormModal({ onClose, onSave }: TareaFormModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [usuarioActual, setUsuarioActual] = useState<any>(null);\n  const { hasPermission } = usePermissions();\n  \n  // B√∫squeda de cotizaci√≥n\n  const [cotizacionBusqueda, setCotizacionBusqueda] = useState('');\n  const [cotizacionSeleccionada, setCotizacionSeleccionada] = useState<CotizacionOption | null>(null);\n  const [cotizacionesOpciones, setCotizacionesOpciones] = useState<CotizacionOption[]>([]);\n  const [mostrarOpciones, setMostrarOpciones] = useState(false);\n  const [buscandoCotizaciones, setBuscandoCotizaciones] = useState(false);\n  \n  // Formulario din√°mico\n  const [departamento, setDepartamento] = useState<DepartamentoSolicitante | ''>('');\n  const [cliente, setCliente] = useState<ClienteType | ''>('');\n  const [solicitudEPA, setSolicitudEPA] = useState<SolicitudEPA | ''>('');\n  const [solicitudCOFERSA, setSolicitudCOFERSA] = useState<SolicitudCOFERSA | ''>('');\n  const [tipoTrabajo, setTipoTrabajo] = useState<TipoTrabajo | ''>('');\n  \n  // Tablas din√°micas\n  const [itemsTablaSimple, setItemsTablaSimple] = useState<ItemTablaSimple[]>([{ codigo: '', cantidad: 0 }]);\n  const [itemsTablaCompleta, setItemsTablaCompleta] = useState<ItemTablaCompleta[]>([{ descripcion: '', cantidad: 0, motivo: '' }]);\n  \n  // Personal asignado (para calcular cantidad de personas)\n  const [personalAsignado, setPersonalAsignado] = useState<string[]>([]);\n  const [mostrarModalPersonal, setMostrarModalPersonal] = useState(false);\n  const [colaboradoresDisponibles, setColaboradoresDisponibles] = useState<TareaColaborador[]>([]);\n  const [busquedaColaborador, setBusquedaColaborador] = useState('');\n  \n  // Archivo Excel\n  const [archivoExcel, setArchivoExcel] = useState<File | null>(null);\n  \n  // Campos adicionales\n  const [fechaEstimada, setFechaEstimada] = useState('');\n  const [descripcionBreve, setDescripcionBreve] = useState('');\n\n  const fechaMinima = new Date().toISOString().split('T')[0];\n\n  // Calcular cantidad de personas autom√°ticamente\n  const cantidadPersonas = personalAsignado.length;\n\n  useEffect(() => {\n    cargarUsuarioActual();\n    cargarColaboradores();\n  }, []);\n\n  useEffect(() => {\n    if (cotizacionBusqueda.length >= 3) {\n      const timer = setTimeout(() => {\n        buscarCotizaciones(cotizacionBusqueda);\n      }, 300);\n      return () => clearTimeout(timer);\n    } else {\n      setCotizacionesOpciones([]);\n      setMostrarOpciones(false);\n    }\n  }, [cotizacionBusqueda]);\n\n  const cargarUsuarioActual = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        setUsuarioActual(user);\n      }\n    } catch (error) {\n      console.error('Error cargando usuario:', error);\n    }\n  };\n\n  const buscarCotizaciones = async (termino: string) => {\n    if (termino.length < 3) {\n      setCotizacionesOpciones([]);\n      return;\n    }\n\n    try {\n      setBuscandoCotizaciones(true);\n\n      // ‚úÖ Obtener tienda actual del usuario\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', usuarioActual?.id)\n        .single();\n\n      console.log('üîç Buscando cotizaciones con t√©rmino:', termino);\n      console.log('üë§ Usuario ID:', usuarioActual?.id);\n      console.log('üè™ Tienda actual:', tiendaActual?.tienda_id);\n\n      // ‚úÖ Construir query base - SIN filtro de tienda\n      let queryPorCodigo = supabase\n        .from('cotizaciones')\n        .select(`\n          id,\n          codigo,\n          total,\n          tienda_id,\n          clientes!cotizaciones_cliente_id_fkey(nombre_razon_social),\n          cotizacion_items(*)\n        `)\n        .ilike('codigo', `%${termino}%`)\n        .order('created_at', { ascending: false })\n        .limit(10);\n\n      let queryPorCliente = supabase\n        .from('cotizaciones')\n        .select(`\n          id,\n          codigo,\n          total,\n          tienda_id,\n          clientes!cotizaciones_cliente_id_fkey(nombre_razon_social),\n          cotizacion_items(*)\n        `)\n        .ilike('clientes.nombre_razon_social', `%${termino}%`)\n        .order('created_at', { ascending: false })\n        .limit(10);\n\n      // ‚úÖ OPCIONAL: Filtrar por tienda solo si el usuario tiene una tienda asignada\n      // Si quieres que muestre TODAS las cotizaciones sin importar la tienda, comenta estas l√≠neas:\n      /*\n      if (tiendaActual?.tienda_id) {\n        queryPorCodigo = queryPorCodigo.eq('tienda_id', tiendaActual.tienda_id);\n        queryPorCliente = queryPorCliente.eq('tienda_id', tiendaActual.tienda_id);\n      }\n      */\n\n      // Ejecutar b√∫squedas\n      const [resultadoCodigo, resultadoCliente] = await Promise.all([\n        queryPorCodigo,\n        queryPorCliente\n      ]);\n\n      console.log('üìä Resultados por c√≥digo:', resultadoCodigo.data?.length || 0);\n      console.log('üìä Resultados por cliente:', resultadoCliente.data?.length || 0);\n\n      if (resultadoCodigo.error) {\n        console.error('‚ùå Error en b√∫squeda por c√≥digo:', resultadoCodigo.error);\n      }\n      if (resultadoCliente.error) {\n        console.error('‚ùå Error en b√∫squeda por cliente:', resultadoCliente.error);\n      }\n\n      // Combinar resultados y eliminar duplicados\n      const resultadosCombinados = [\n        ...(resultadoCodigo.data || []),\n        ...(resultadoCliente.data || [])\n      ];\n\n      console.log('üì¶ Total combinados:', resultadosCombinados.length);\n\n      const idsUnicos = new Set();\n      const resultadosUnicos = resultadosCombinados.filter(cot => {\n        if (idsUnicos.has(cot.id)) {\n          return false;\n        }\n        idsUnicos.add(cot.id);\n        return true;\n      });\n\n      console.log('‚úÖ Resultados √∫nicos:', resultadosUnicos.length);\n\n      // Filtrar cotizaciones sin cliente y mapear a opciones\n      const opciones: CotizacionOption[] = resultadosUnicos\n        .filter(cot => cot.clientes !== null) // Filtrar cotizaciones sin cliente\n        .map(cot => ({\n          id: cot.id,\n          codigo: cot.codigo,\n          cliente_nombre: cot.clientes?.nombre_razon_social || 'Sin cliente',\n          total: cot.total,\n          items: cot.cotizacion_items || []\n        }));\n\n      setCotizacionesOpciones(opciones);\n      setMostrarOpciones(opciones.length > 0);\n      \n      if (opciones.length === 0) {\n        console.log('‚ö†Ô∏è No se encontraron cotizaciones con el t√©rmino:', termino);\n      }\n    } catch (error) {\n      console.error('‚ùå Error en buscarCotizaciones:', error);\n    } finally {\n      setBuscandoCotizaciones(false);\n    }\n  };\n\n  const seleccionarCotizacion = async (cotizacion: CotizacionOption) => {\n    setCotizacionSeleccionada(cotizacion);\n    setCotizacionBusqueda(`${cotizacion.codigo} - ${cotizacion.cliente_nombre}`);\n    setMostrarOpciones(false);\n    \n    // Autocompletar descripci√≥n breve\n    if (!descripcionBreve) {\n      setDescripcionBreve(`Cotizaci√≥n ${cotizacion.codigo} - ${cotizacion.cliente_nombre}`);\n    }\n\n    // ‚úÖ NUEVO: Cargar items de BOM desde la cotizaci√≥n\n    try {\n      console.log('üîÑ Cargando items de la cotizaci√≥n:', cotizacion.id);\n      \n      // Obtener los productos de la cotizaci√≥n con sus BOM\n      const { data: cotizacionItems, error: itemsError } = await supabase\n        .from('cotizacion_items')\n        .select('producto_id, cantidad')\n        .eq('cotizacion_id', cotizacion.id);\n\n      if (itemsError) {\n        console.error('Error obteniendo items de cotizaci√≥n:', itemsError);\n        return;\n      }\n\n      console.log('üì¶ Items de cotizaci√≥n encontrados:', cotizacionItems?.length || 0);\n\n      if (!cotizacionItems || cotizacionItems.length === 0) {\n        console.log('‚ÑπÔ∏è La cotizaci√≥n no tiene productos');\n        return;\n      }\n\n      // Para cada producto, obtener sus componentes BOM\n      const todosLosComponentes: any[] = [];\n\n      for (const item of cotizacionItems) {\n        if (!item.producto_id) continue;\n\n        console.log('üîç Buscando BOM para producto:', item.producto_id);\n\n        // Para cada item de la cotizaci√≥n, buscar sus componentes BOM\n        const { data: bomItems, error: bomError } = await supabase\n          .from('bom_items')\n          .select(`\n            id_componente,\n            cantidad_x_unidad,\n            inventario!bom_items_id_componente_fkey(\n              id_articulo,\n              codigo_articulo,\n              descripcion_articulo,\n              costo_articulo\n            )\n          `)\n          .eq('product_id', item.producto_id);\n\n        if (bomError) {\n          console.error('Error obteniendo BOM:', bomError);\n          continue;\n        }\n\n        if (bomItems && bomItems.length > 0) {\n          console.log('‚úÖ BOM encontrado:', bomItems.length, 'componentes');\n          \n          // Multiplicar las cantidades del BOM por la cantidad del producto en la cotizaci√≥n\n          bomItems.forEach((bomItem: any) => {\n            const cantidadTotal = bomItem.cantidad_x_unidad * item.cantidad;\n            const costoUnitario = bomItem.inventario.costo_articulo || 0;\n            \n            // Buscar si ya existe este componente en la lista\n            const existente = todosLosComponentes.find(\n              comp => comp.id_articulo === bomItem.inventario.id_articulo\n            );\n\n            if (existente) {\n              // Si ya existe, sumar la cantidad\n              existente.cantidad += cantidadTotal;\n            } else {\n              // Si no existe, agregarlo\n              todosLosComponentes.push({\n                id_articulo: bomItem.inventario.id_articulo,\n                codigo: bomItem.inventario.codigo_articulo,\n                descripcion: bomItem.inventario.descripcion_articulo,\n                cantidad: cantidadTotal,\n                costo_unitario: costoUnitario,\n                tipo: 'inventario'\n              });\n            }\n          });\n        }\n      }\n\n      console.log('üìä Total de componentes √∫nicos:', todosLosComponentes.length);\n\n      if (todosLosComponentes.length > 0) {\n        // ‚úÖ Cargar en la tabla simple (C√≥digo | Cantidad)\n        const itemsSimples: ItemTablaSimple[] = todosLosComponentes.map(comp => ({\n          id_articulo: comp.id_articulo,\n          codigo: comp.codigo,\n          descripcion: comp.descripcion,\n          cantidad: comp.cantidad,\n          tipo: 'inventario'\n        }));\n        setItemsTablaSimple(itemsSimples);\n\n        // ‚úÖ Cargar en la tabla completa (Descripci√≥n | Cantidad | Motivo)\n        // Formato: \"CODIGO - Descripci√≥n\" | Cantidad | \"Cotizaci√≥n COT-XXXXX\"\n        const itemsCompletos: ItemTablaCompleta[] = todosLosComponentes.map(comp => ({\n          descripcion: `${comp.codigo} - ${comp.descripcion}`,\n          cantidad: comp.cantidad,\n          motivo: `Cotizaci√≥n ${cotizacion.codigo}`,\n          precio: comp.costo_unitario\n        }));\n        setItemsTablaCompleta(itemsCompletos);\n\n        console.log(`‚úÖ Se cargaron ${todosLosComponentes.length} componentes en ambas tablas`);\n        \n        // Mostrar mensaje de √©xito\n        alert(`‚úÖ Se cargaron ${todosLosComponentes.length} componentes desde la cotizaci√≥n\\n\\n` +\n              `Los productos se han agregado a:\\n` +\n              `‚Ä¢ √çtems consumidos (C√≥digo y Cantidad)\\n` +\n              `‚Ä¢ Consumo de Inventario (Descripci√≥n, Cantidad y Precio)`);\n      } else {\n        console.log('‚ÑπÔ∏è Los productos de la cotizaci√≥n no tienen componentes BOM definidos');\n        alert('‚ÑπÔ∏è Los productos de la cotizaci√≥n no tienen componentes BOM definidos');\n      }\n\n    } catch (error) {\n      console.error('Error cargando items de BOM:', error);\n      alert('Error al cargar los componentes de la cotizaci√≥n');\n    }\n  };\n\n  const limpiarCotizacion = () => {\n    setCotizacionSeleccionada(null);\n    setCotizacionBusqueda('');\n    setCotizacionesOpciones([]);\n  };\n\n  const abrirCotizacion = () => {\n    if (cotizacionSeleccionada) {\n      window.open(`/cotizaciones/${cotizacionSeleccionada.id}`, '_blank');\n    }\n  };\n\n  // Manejo de tabla simple (C√≥digo | Cantidad)\n  const agregarFilaSimple = () => {\n    setItemsTablaSimple([...itemsTablaSimple, { codigo: '', cantidad: 0 }]);\n  };\n\n  const eliminarFilaSimple = (index: number) => {\n    if (itemsTablaSimple.length > 1) {\n      setItemsTablaSimple(itemsTablaSimple.filter((_, i) => i !== index));\n    }\n  };\n\n  const actualizarFilaSimple = (index: number, campo: keyof ItemTablaSimple, valor: any) => {\n    const nuevosItems = [...itemsTablaSimple];\n    nuevosItems[index] = { ...nuevosItems[index], [campo]: valor };\n    setItemsTablaSimple(nuevosItems);\n  };\n\n  // Manejo de tabla completa (Descripci√≥n | Cantidad | Motivo)\n  const agregarFilaCompleta = () => {\n    setItemsTablaCompleta([...itemsTablaCompleta, { descripcion: '', cantidad: 0, motivo: '' }]);\n  };\n\n  const eliminarFilaCompleta = (index: number) => {\n    if (itemsTablaCompleta.length > 1) {\n      setItemsTablaCompleta(itemsTablaCompleta.filter((_, i) => i !== index));\n    }\n  };\n\n  const actualizarFilaCompleta = (index: number, campo: keyof ItemTablaCompleta, valor: any) => {\n    const nuevosItems = [...itemsTablaCompleta];\n    nuevosItems[index] = { ...nuevosItems[index], [campo]: valor };\n    setItemsTablaCompleta(nuevosItems);\n  };\n\n  // Manejo de archivo Excel\n  const handleArchivoExcel = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    try {\n      const data = await file.arrayBuffer();\n      const workbook = XLSX.read(data);\n      const worksheet = workbook.Sheets[workbook.SheetNames[0]];\n      const jsonData = XLSX.utils.sheet_to_json(worksheet);\n\n      // Detectar tipo de tabla seg√∫n columnas\n      if (jsonData.length > 0) {\n        const primeraFila: any = jsonData[0];\n        \n        if ('Codigo' in primeraFila || 'codigo' in primeraFila) {\n          // Tabla simple\n          const items: ItemTablaSimple[] = jsonData.map((row: any) => ({\n            codigo: row.Codigo || row.codigo || '',\n            cantidad: parseFloat(row.Cantidad || row.cantidad || 0)\n          }));\n          setItemsTablaSimple(items);\n        } else if ('Descripcion' in primeraFila || 'descripcion' in primeraFila) {\n          // Tabla completa\n          const items: ItemTablaCompleta[] = jsonData.map((row: any) => ({\n            descripcion: row.Descripcion || row.descripcion || '',\n            cantidad: parseFloat(row.Cantidad || row.cantidad || 0),\n            motivo: row.Motivo || row.motivo || ''\n          }));\n          setItemsTablaCompleta(items);\n        }\n      }\n\n      setArchivoExcel(file);\n      alert('Archivo Excel cargado exitosamente');\n    } catch (error) {\n      console.error('Error procesando Excel:', error);\n      alert('Error al procesar el archivo Excel');\n    }\n  };\n\n  // Descargar plantilla Excel\n  const descargarPlantillaExcel = () => {\n    // Determinar qu√© tipo de plantilla descargar\n    const esTablaSimple = mostrarTablaSimple();\n    const esTablaCompleta = mostrarTablaCompleta();\n\n    let worksheet: XLSX.WorkSheet;\n    let nombreArchivo: string;\n\n    if (esTablaSimple) {\n      // Plantilla para tabla simple (C√≥digo | Cantidad)\n      const datosPlantilla = [\n        { Codigo: 'PROD-001', Cantidad: 100 },\n        { Codigo: 'PROD-002', Cantidad: 50 },\n        { Codigo: 'PROD-003', Cantidad: 75 }\n      ];\n      worksheet = XLSX.utils.json_to_sheet(datosPlantilla);\n      nombreArchivo = 'Plantilla_Codigos_Cantidades.xlsx';\n    } else if (esTablaCompleta) {\n      // Plantilla para tabla completa (Descripci√≥n | Cantidad | Motivo)\n      const datosPlantilla = [\n        { Descripcion: 'Pallets de madera', Cantidad: 50, Motivo: 'Exportaci√≥n' },\n        { Descripcion: 'Contenedores pl√°sticos', Cantidad: 20, Motivo: 'Almacenamiento' },\n        { Descripcion: 'Cajas de cart√≥n', Cantidad: 100, Motivo: 'Empaque' }\n      ];\n      worksheet = XLSX.utils.json_to_sheet(datosPlantilla);\n      nombreArchivo = 'Plantilla_Descripcion_Cantidad_Motivo.xlsx';\n    } else {\n      // Plantilla gen√©rica\n      const datosPlantilla = [\n        { Codigo: 'PROD-001', Cantidad: 100 }\n      ];\n      worksheet = XLSX.utils.json_to_sheet(datosPlantilla);\n      nombreArchivo = 'Plantilla_Productos.xlsx';\n    }\n\n    // Crear libro de trabajo\n    const workbook = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Datos');\n\n    // Descargar archivo\n    XLSX.writeFile(workbook, nombreArchivo);\n  };\n\n  // Determinar qu√© tipo de tabla mostrar\n  const mostrarTablaSimple = () => {\n    if (departamento === 'Servicio al Cliente' && cliente === 'EPA') {\n      return ['C√≥digos de Barra', 'Registros sanitarios', 'Traducci√≥n', 'Usos Delta Plus'].includes(solicitudEPA);\n    }\n    if (departamento === 'Servicio al Cliente' && cliente === 'COFERSA') {\n      return true; // Siempre muestra tabla simple para COFERSA\n    }\n    return false;\n  };\n\n  const mostrarTablaCompleta = () => {\n    if (departamento === 'Servicio al Cliente' && cliente === 'EPA') {\n      return ['Licencias / contenedores / Pallets', 'Suministros'].includes(solicitudEPA);\n    }\n    return false;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validaciones\n    if (!departamento) {\n      alert('Debe seleccionar un departamento solicitante');\n      return;\n    }\n\n    if (departamento === 'Servicio al Cliente' && !cliente) {\n      alert('Debe seleccionar un cliente');\n      return;\n    }\n\n    if (departamento === 'Servicio al Cliente' && cliente === 'EPA' && !solicitudEPA) {\n      alert('Debe seleccionar qu√© desea solicitar');\n      return;\n    }\n\n    if (departamento === 'Servicio al Cliente' && cliente === 'COFERSA' && !solicitudCOFERSA) {\n      alert('Debe seleccionar qu√© desea solicitar');\n      return;\n    }\n\n    if (departamento === 'Servicio al Cliente' && cliente === 'COFERSA' && !tipoTrabajo) {\n      alert('Debe seleccionar el tipo de trabajo');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const user = usuarioActual;\n      if (!user) throw new Error('Usuario no autenticado');\n\n      const tiendaActual = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual.data) throw new Error('No hay tienda seleccionada');\n\n      // Construir datos del formulario\n      const datosFormulario: any = {\n        departamento_solicitante: departamento,\n        cliente: cliente || null,\n        solicitud_epa: solicitudEPA || null,\n        solicitud_cofersa: solicitudCOFERSA || null,\n        tipo_trabajo: tipoTrabajo || null\n      };\n\n      // Agregar items seg√∫n el tipo de tabla\n      if (mostrarTablaSimple()) {\n        datosFormulario.items_tabla_simple = itemsTablaSimple.filter(item => item.codigo && item.cantidad > 0);\n      }\n\n      if (mostrarTablaCompleta()) {\n        datosFormulario.items_tabla_completa = itemsTablaCompleta.filter(item => item.descripcion && item.cantidad > 0);\n      }\n\n      // Calcular cantidad total de unidades (convertir a entero)\n      let cantidadTotal = 0;\n      if (datosFormulario.items_tabla_simple) {\n        cantidadTotal = datosFormulario.items_tabla_simple.reduce((sum: number, item: ItemTablaSimple) => sum + item.cantidad, 0);\n      }\n      if (datosFormulario.items_tabla_completa) {\n        cantidadTotal += datosFormulario.items_tabla_completa.reduce((sum: number, item: ItemTablaCompleta) => sum + item.cantidad, 0);\n      }\n\n      // Convertir a entero (redondear)\n      const cantidadTotalEntero = Math.round(cantidadTotal);\n\n      // Generar descripci√≥n breve autom√°tica si no existe\n      let descripcionBreveFinal = descripcionBreve;\n      if (!descripcionBreveFinal) {\n        if (cotizacionSeleccionada) {\n          descripcionBreveFinal = `Cotizaci√≥n ${cotizacionSeleccionada.codigo}`;\n        } else {\n          descripcionBreveFinal = `${departamento} - ${cliente || 'General'}`;\n          if (solicitudEPA) descripcionBreveFinal += ` - ${solicitudEPA}`;\n          if (solicitudCOFERSA) descripcionBreveFinal += ` - ${solicitudCOFERSA}`;\n        }\n      }\n\n      if (descripcionBreveFinal.length > 100) {\n        descripcionBreveFinal = descripcionBreveFinal.substring(0, 97) + '...';\n      }\n\n      const tareaData: CreateTareaData = {\n        tienda_id: tiendaActual.data.tienda_id,\n        solicitante_id: user.id,\n        email_solicitante: user.email || '',\n        datos_formulario: datosFormulario,\n        estado: 'En Cola',\n        cotizacion_id: cotizacionSeleccionada?.id,\n        fecha_estimada_entrega: fechaEstimada || undefined,\n        cantidad_unidades: cantidadTotalEntero > 0 ? cantidadTotalEntero : undefined,\n        descripcion_breve: descripcionBreveFinal,\n        personal_asignado: personalAsignado // ‚úÖ Guardar personal asignado\n      };\n\n      await tareaService.createTarea(tareaData);\n      \n      console.log('‚úÖ Tarea creada exitosamente');\n      onSave();\n    } catch (error) {\n      console.error('Error creando tarea:', error);\n      alert('Error al crear la tarea: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const cargarColaboradores = async () => {\n    try {\n      const data = await tareaService.getColaboradores();\n      setColaboradoresDisponibles(data.filter(c => c.activo));\n    } catch (error) {\n      console.error('Error cargando colaboradores:', error);\n    }\n  };\n\n  const agregarPersonal = (colaboradorId: string) => {\n    if (!personalAsignado.includes(colaboradorId)) {\n      setPersonalAsignado([...personalAsignado, colaboradorId]);\n    }\n  };\n\n  const eliminarPersonal = (colaboradorId: string) => {\n    setPersonalAsignado(personalAsignado.filter(id => id !== colaboradorId));\n  };\n\n  const colaboradoresFiltrados = colaboradoresDisponibles.filter(c => \n    c.nombre.toLowerCase().includes(busquedaColaborador.toLowerCase()) ||\n    (c.email && c.email.toLowerCase().includes(busquedaColaborador.toLowerCase()))\n  );\n\n  const colaboradoresSeleccionados = colaboradoresDisponibles.filter(c => \n    personalAsignado.includes(c.id)\n  );\n\n  // Funci√≥n para manejar la carga de Excel\n  const handleCargarExcel = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    try {\n      // Importar la librer√≠a xlsx din√°micamente\n      const XLSX = await import('xlsx');\n      \n      const reader = new FileReader();\n      reader.onload = (event) => {\n        try {\n          const data = event.target?.result;\n          const workbook = XLSX.read(data, { type: 'binary' });\n          const sheetName = workbook.SheetNames[0];\n          const worksheet = workbook.Sheets[sheetName];\n          const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 }) as any[][];\n\n          if (jsonData.length < 2) {\n            alert('El archivo Excel est√° vac√≠o o no tiene datos v√°lidos');\n            return;\n          }\n\n          // Obtener encabezados (primera fila)\n          const headers = jsonData[0].map((h: any) => String(h).toLowerCase().trim());\n          \n          // Detectar tipo de tabla seg√∫n las columnas\n          const tieneDescripcion = headers.includes('descripcion') || headers.includes('descripci√≥n');\n          const tieneMotivo = headers.includes('motivo');\n          const tieneCodigo = headers.includes('codigo') || headers.includes('c√≥digo');\n          const tieneCantidad = headers.includes('cantidad');\n\n          if (!tieneCantidad) {\n            alert('El archivo Excel debe tener una columna \"Cantidad\"');\n            return;\n          }\n\n          // Procesar filas de datos (desde la segunda fila)\n          const nuevasFilas: any[] = [];\n          for (let i = 1; i < jsonData.length; i++) {\n            const row = jsonData[i];\n            if (!row || row.length === 0) continue;\n\n            const fila: any = {};\n            \n            // Mapear datos seg√∫n el tipo de tabla\n            if (tieneDescripcion && tieneMotivo) {\n              // Tabla completa: Descripci√≥n | Cantidad | Motivo\n              const descripcionIdx = headers.findIndex(h => h === 'descripcion' || h === 'descripci√≥n');\n              const cantidadIdx = headers.findIndex(h => h === 'cantidad');\n              const motivoIdx = headers.findIndex(h => h === 'motivo');\n\n              fila.descripcion = row[descripcionIdx] || '';\n              fila.cantidad = Number(row[cantidadIdx]) || 0;\n              fila.motivo = row[motivoIdx] || '';\n            } else if (tieneCodigo) {\n              // Tabla simple: C√≥digo | Cantidad\n              const codigoIdx = headers.findIndex(h => h === 'codigo' || h === 'c√≥digo');\n              const cantidadIdx = headers.findIndex(h => h === 'cantidad');\n\n              fila.codigo = row[codigoIdx] || '';\n              fila.cantidad = Number(row[cantidadIdx]) || 0;\n            } else {\n              alert('El archivo Excel debe tener las columnas correctas seg√∫n el tipo de solicitud');\n              return;\n            }\n\n            // Solo agregar filas con datos v√°lidos\n            if ((fila.codigo || fila.descripcion) && fila.cantidad > 0) {\n              nuevasFilas.push(fila);\n            }\n          }\n\n          if (nuevasFilas.length === 0) {\n            alert('No se encontraron datos v√°lidos en el archivo Excel');\n            return;\n          }\n\n          // Reemplazar las filas actuales con las del Excel\n          if (tieneDescripcion && tieneMotivo) {\n            setItemsTablaCompleta(nuevasFilas);\n          } else {\n            setItemsTablaSimple(nuevasFilas);\n          }\n\n          alert(`‚úÖ Se importaron ${nuevasFilas.length} productos correctamente`);\n          \n          // Limpiar el input para permitir cargar el mismo archivo nuevamente\n          e.target.value = '';\n        } catch (error) {\n          console.error('Error procesando Excel:', error);\n          alert('Error al procesar el archivo Excel. Verifique que el formato sea correcto.');\n        }\n      };\n\n      reader.onerror = () => {\n        alert('Error al leer el archivo');\n      };\n\n      reader.readAsBinaryString(file);\n    } catch (error) {\n      console.error('Error cargando Excel:', error);\n      alert('Error al cargar el archivo Excel');\n    }\n  };\n\n  const cargarComponentesDesdeCotizacion = async (cotizacionId: number) => {\n    try {\n      // 1. Obtener los items de la cotizaci√≥n\n      const { data: cotizacionItems, error: itemsError } = await supabase\n        .from('cotizacion_items')\n        .select('producto_id, cantidad')\n        .eq('cotizacion_id', cotizacionId);\n\n      if (itemsError) {\n        console.error('Error obteniendo items de cotizaci√≥n:', itemsError);\n        return;\n      }\n\n      if (!cotizacionItems || cotizacionItems.length === 0) {\n        alert('La cotizaci√≥n no tiene productos asociados');\n        return;\n      }\n\n      // 2. Para cada producto, obtener sus componentes BOM\n      const todosLosComponentes: any[] = [];\n\n      for (const item of cotizacionItems) {\n        // Obtener los componentes BOM del producto\n        const { data: bomItems, error: bomError } = await supabase\n          .from('bom_items')\n          .select(`\n            id_componente,\n            cantidad_x_unidad,\n            inventario!bom_items_id_componente_fkey(\n              id_articulo,\n              codigo_articulo,\n              descripcion_articulo,\n              costo_articulo\n            )\n          `)\n          .eq('product_id', item.producto_id);\n\n        if (bomError) {\n          console.error('Error obteniendo BOM:', bomError);\n          continue;\n        }\n\n        if (bomItems && bomItems.length > 0) {\n          // Multiplicar las cantidades del BOM por la cantidad del producto en la cotizaci√≥n\n          bomItems.forEach((bomItem: any) => {\n            const cantidadTotal = bomItem.cantidad_x_unidad * item.cantidad;\n            const costoUnitario = bomItem.inventario.costo_articulo || 0;\n            \n            // Buscar si ya existe este componente en la lista\n            const existente = todosLosComponentes.find(\n              (c) => c.id === bomItem.id_componente\n            );\n\n            if (existente) {\n              // Si ya existe, sumar la cantidad\n              existente.cantidad += cantidadTotal;\n            } else {\n              // Si no existe, agregarlo\n              todosLosComponentes.push({\n                id: bomItem.id_componente,\n                tipo: 'Inventario',\n                descripcion: `${bomItem.inventario.codigo_articulo} - ${bomItem.inventario.descripcion_articulo}`,\n                cantidad: cantidadTotal,\n                costo_unitario: costoUnitario\n              });\n            }\n          });\n        }\n      }\n\n      if (todosLosComponentes.length === 0) {\n        alert('Los productos de la cotizaci√≥n no tienen componentes BOM definidos');\n        return;\n      }\n\n      // 3. Cargar los componentes en la tabla de productos\n      const nuevosProductos = todosLosComponentes.map((comp) => ({\n        codigo: comp.descripcion,\n        descripcion: comp.descripcion,\n        cantidad: comp.cantidad\n      }));\n\n      setFormData((prev) => ({\n        ...prev,\n        productos: [...prev.productos, ...nuevosProductos]\n      }));\n\n      alert(`Se cargaron ${todosLosComponentes.length} componentes desde la cotizaci√≥n`);\n    } catch (error) {\n      console.error('Error al cargar componentes:', error);\n      alert('Error al cargar los componentes de la cotizaci√≥n');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Nueva Solicitud de Trabajo</h2>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              Solicitante: {usuarioActual?.email || 'Cargando...'}\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            type=\"button\"\n            className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n          >\n            <i className=\"ri-close-line text-xl\"></i>\n          </button>\n        </div>\n\n        {/* Formulario */}\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n          {/* B√∫squeda de Cotizaci√≥n */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h3 className=\"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2\">\n              <i className=\"ri-file-list-3-line\"></i>\n              ¬øDesea importar datos desde una cotizaci√≥n existente?\n            </h3>\n            <div className=\"relative\">\n              <input\n                type=\"text\"\n                value={cotizacionBusqueda}\n                onChange={(e) => {\n                  setCotizacionBusqueda(e.target.value);\n                  if (!e.target.value) {\n                    limpiarCotizacion();\n                  }\n                }}\n                onFocus={() => cotizacionesOpciones.length > 0 && setMostrarOpciones(true)}\n                placeholder=\"Buscar por c√≥digo de cotizaci√≥n o nombre del cliente...\"\n                className=\"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              />\n              {buscandoCotizaciones && (\n                <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                  <i className=\"ri-loader-4-line animate-spin text-gray-400\"></i>\n                </div>\n              )}\n              {cotizacionSeleccionada && (\n                <button\n                  type=\"button\"\n                  onClick={limpiarCotizacion}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 cursor-pointer\"\n                >\n                  <i className=\"ri-close-circle-line text-xl\"></i>\n                </button>\n              )}\n            </div>\n\n            {/* Dropdown de opciones */}\n            {mostrarOpciones && cotizacionesOpciones.length > 0 && (\n              <div className=\"absolute z-20 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                {cotizacionesOpciones.map((cotizacion) => (\n                  <button\n                    key={cotizacion.id}\n                    type=\"button\"\n                    onClick={() => seleccionarCotizacion(cotizacion)}\n                    className=\"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 cursor-pointer transition-colors\"\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"font-medium text-gray-900\">\n                          {cotizacion.codigo}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">\n                          {cotizacion.cliente_nombre}\n                        </div>\n                      </div>\n                      <div className=\"text-sm font-semibold text-blue-600\">\n                        ‚Ç°{cotizacion.total.toLocaleString('es-CR', { minimumFractionDigits: 2 })}\n                      </div>\n                    </div>\n                  </button>\n                ))}\n              </div>\n            )}\n\n            {cotizacionBusqueda.length >= 3 && !buscandoCotizaciones && cotizacionesOpciones.length === 0 && (\n              <div className=\"mt-2 text-sm text-gray-500 text-center\">\n                No se encontraron cotizaciones\n              </div>\n            )}\n\n            {cotizacionSeleccionada && (\n              <div className=\"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <div className=\"flex items-center gap-2 text-green-800\">\n                  <i className=\"ri-checkbox-circle-line\"></i>\n                  <span className=\"text-sm font-medium\">\n                    Cotizaci√≥n seleccionada: {cotizacionSeleccionada.codigo}\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Formulario Din√°mico */}\n          <div className=\"space-y-6 border-t border-gray-200 pt-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900\">Informaci√≥n de la Solicitud</h3>\n\n            {/* 1. Departamento Solicitante */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Departamento Solicitante <span className=\"text-red-500\">*</span>\n              </label>\n              <select\n                value={departamento}\n                onChange={(e) => {\n                  setDepartamento(e.target.value as DepartamentoSolicitante);\n                  setCliente('');\n                  setSolicitudEPA('');\n                  setSolicitudCOFERSA('');\n                  setTipoTrabajo('');\n                }}\n                required\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n              >\n                <option value=\"\">Seleccionar departamento...</option>\n                <option value=\"Servicio al Cliente\">Servicio al Cliente</option>\n                <option value=\"Zona Franca\">Zona Franca</option>\n                <option value=\"Otros\">Otros</option>\n              </select>\n            </div>\n\n            {/* 2. Cliente (solo si es Servicio al Cliente) */}\n            {departamento === 'Servicio al Cliente' && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Cliente <span className=\"text-red-500\">*</span>\n                </label>\n                <select\n                  value={cliente}\n                  onChange={(e) => {\n                    setCliente(e.target.value as ClienteType);\n                    setSolicitudEPA('');\n                    setSolicitudCOFERSA('');\n                    setTipoTrabajo('');\n                  }}\n                  required\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                >\n                  <option value=\"\">Seleccionar cliente...</option>\n                  <option value=\"EPA\">EPA</option>\n                  <option value=\"COFERSA\">COFERSA</option>\n                </select>\n              </div>\n            )}\n\n            {/* 3. Solicitud EPA */}\n            {departamento === 'Servicio al Cliente' && cliente === 'EPA' && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  ¬øQu√© deseas solicitar? <span className=\"text-red-500\">*</span>\n                </label>\n                <select\n                  value={solicitudEPA}\n                  onChange={(e) => setSolicitudEPA(e.target.value as SolicitudEPA)}\n                  required\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                >\n                  <option value=\"\">Seleccionar tipo de solicitud...</option>\n                  <option value=\"C√≥digos de Barra\">C√≥digos de Barra</option>\n                  <option value=\"Registros sanitarios\">Registros sanitarios</option>\n                  <option value=\"Licencias / contenedores / Pallets\">Licencias / contenedores / Pallets</option>\n                  <option value=\"Traducci√≥n\">Traducci√≥n</option>\n                  <option value=\"Suministros\">Suministros</option>\n                  <option value=\"Usos Delta Plus\">Usos Delta Plus</option>\n                  <option value=\"Armado de sillas\">Armado de sillas</option>\n                </select>\n              </div>\n            )}\n\n            {/* 4. Solicitud COFERSA */}\n            {departamento === 'Servicio al Cliente' && cliente === 'COFERSA' && (\n              <>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    ¬øQu√© deseas solicitar? <span className=\"text-red-500\">*</span>\n                  </label>\n                  <select\n                    value={solicitudCOFERSA}\n                    onChange={(e) => setSolicitudCOFERSA(e.target.value as SolicitudCOFERSA)}\n                    required\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  >\n                    <option value=\"\">Seleccionar tipo de solicitud...</option>\n                    <option value=\"Etiquetado\">Etiquetado</option>\n                    <option value=\"Cambio de imagen\">Cambio de imagen</option>\n                    <option value=\"Licencias\">Licencias</option>\n                    <option value=\"Suministros\">Suministros</option>\n                    <option value=\"Re-empacar productos\">Re-empacar productos</option>\n                  </select>\n                </div>\n\n                {solicitudCOFERSA && (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      El siguiente trabajo es para: <span className=\"text-red-500\">*</span>\n                    </label>\n                    <select\n                      value={tipoTrabajo}\n                      onChange={(e) => setTipoTrabajo(e.target.value as TipoTrabajo)}\n                      required\n                      className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    >\n                      <option value=\"\">Seleccionar tipo de trabajo...</option>\n                      <option value=\"Trabajo Interno (Stock)\">Trabajo Interno (Stock)</option>\n                      <option value=\"Clientes de Cofersa\">Clientes de Cofersa</option>\n                    </select>\n                  </div>\n                )}\n              </>\n            )}\n\n            {/* Tabla Simple: C√≥digo | Cantidad */}\n            {mostrarTablaSimple() && (\n              <div className=\"border border-gray-300 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <label className=\"text-sm font-medium text-gray-700\">\n                    {cliente === 'COFERSA' ? 'C√≥digo y cantidades a etiquetar' : 'C√≥digo y cantidades'} <span className=\"text-red-500\">*</span>\n                  </label>\n                  <div className=\"flex gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={descargarPlantillaExcel}\n                      className=\"px-3 py-1.5 text-xs font-medium text-green-600 bg-green-50 border border-green-200 rounded cursor-pointer hover:bg-green-100 transition-colors whitespace-nowrap\"\n                    >\n                      <i className=\"ri-download-2-line mr-1\"></i>\n                      Descargar Plantilla\n                    </button>\n                    <label className=\"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded cursor-pointer hover:bg-blue-100 transition-colors whitespace-nowrap\">\n                      <i className=\"ri-file-excel-2-line mr-1\"></i>\n                      Cargar Excel\n                      <input\n                        type=\"file\"\n                        accept=\".xlsx,.xls\"\n                        onChange={handleArchivoExcel}\n                        className=\"hidden\"\n                      />\n                    </label>\n                    <button\n                      type=\"button\"\n                      onClick={agregarFilaSimple}\n                      className=\"px-3 py-1.5 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700 transition-colors cursor-pointer whitespace-nowrap\"\n                    >\n                      <i className=\"ri-add-line mr-1\"></i>\n                      Agregar Fila\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse\">\n                    <thead>\n                      <tr className=\"bg-gray-50\">\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700 border border-gray-300\">C√≥digo</th>\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700 border border-gray-300\">Cantidad</th>\n                        <th className=\"px-3 py-2 text-center text-xs font-medium text-gray-700 border border-gray-300 w-20\">Acciones</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {itemsTablaSimple.map((item, index) => (\n                        <tr key={index} className=\"hover:bg-gray-50\">\n                          <td className=\"border border-gray-300 p-1\">\n                            <input\n                              type=\"text\"\n                              value={item.codigo}\n                              onChange={(e) => actualizarFilaSimple(index, 'codigo', e.target.value)}\n                              placeholder=\"C√≥digo del producto\"\n                              className=\"w-full px-2 py-1 text-sm border-0 focus:ring-1 focus:ring-blue-500\"\n                            />\n                          </td>\n                          <td className=\"border border-gray-300 p-1\">\n                            <input\n                              type=\"number\"\n                              value={item.cantidad}\n                              onChange={(e) => actualizarFilaSimple(index, 'cantidad', parseFloat(e.target.value) || 0)}\n                              placeholder=\"0\"\n                              min=\"0\"\n                              step=\"0.01\"\n                              className=\"w-full px-2 py-1 text-sm border-0 focus:ring-1 focus:ring-blue-500\"\n                            />\n                          </td>\n                          <td className=\"border border-gray-300 p-1 text-center\">\n                            <button\n                              type=\"button\"\n                              onClick={() => eliminarFilaSimple(index)}\n                              disabled={itemsTablaSimple.length === 1}\n                              className=\"text-red-600 hover:text-red-800 disabled:text-gray-300 disabled:cursor-not-allowed cursor-pointer\"\n                            >\n                              <i className=\"ri-delete-bin-line\"></i>\n                            </button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-2\">\n                  Formato Excel: Columnas \"Codigo\" y \"Cantidad\"\n                </p>\n              </div>\n            )}\n\n            {/* Tabla Completa: Descripci√≥n | Cantidad | Motivo */}\n            {mostrarTablaCompleta() && (\n              <div className=\"border border-gray-300 rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <label className=\"text-sm font-medium text-gray-700\">\n                    Descripci√≥n, cantidad y motivo <span className=\"text-red-500\">*</span>\n                  </label>\n                  <div className=\"flex gap-2\">\n                    <button\n                      type=\"button\"\n                      onClick={descargarPlantillaExcel}\n                      className=\"px-3 py-1.5 text-xs font-medium text-green-600 bg-green-50 border border-green-200 rounded cursor-pointer hover:bg-green-100 transition-colors whitespace-nowrap\"\n                    >\n                      <i className=\"ri-download-2-line mr-1\"></i>\n                      Descargar Plantilla\n                    </button>\n                    <label className=\"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded cursor-pointer hover:bg-blue-100 transition-colors whitespace-nowrap\">\n                      <i className=\"ri-file-excel-2-line mr-1\"></i>\n                      Cargar Excel\n                      <input\n                        type=\"file\"\n                        accept=\".xlsx,.xls\"\n                        onChange={handleArchivoExcel}\n                        className=\"hidden\"\n                      />\n                    </label>\n                    <button\n                      type=\"button\"\n                      onClick={agregarFilaCompleta}\n                      className=\"px-3 py-1.5 text-xs font-medium text-white bg-green-600 rounded hover:bg-green-700 transition-colors cursor-pointer whitespace-nowrap\"\n                    >\n                      <i className=\"ri-add-line mr-1\"></i>\n                      Agregar Fila\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full border-collapse\">\n                    <thead>\n                      <tr className=\"bg-gray-50\">\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700 border border-gray-300\">Descripci√≥n</th>\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700 border border-gray-300\">Cantidad</th>\n                        <th className=\"px-3 py-2 text-left text-xs font-medium text-gray-700 border border-gray-300\">Motivo</th>\n                        <th className=\"px-3 py-2 text-center text-xs font-medium text-gray-700 border border-gray-300 w-20\">Acciones</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {itemsTablaCompleta.map((item, index) => (\n                        <tr key={index} className=\"hover:bg-gray-50\">\n                          <td className=\"border border-gray-300 p-1\">\n                            <input\n                              type=\"text\"\n                              value={item.descripcion}\n                              onChange={(e) => actualizarFilaCompleta(index, 'descripcion', e.target.value)}\n                              placeholder=\"Descripci√≥n del item\"\n                              className=\"w-full px-2 py-1 text-sm border-0 focus:ring-1 focus:ring-blue-500\"\n                            />\n                          </td>\n                          <td className=\"border border-gray-300 p-1\">\n                            <input\n                              type=\"number\"\n                              value={item.cantidad}\n                              onChange={(e) => actualizarFilaCompleta(index, 'cantidad', parseFloat(e.target.value) || 0)}\n                              placeholder=\"0\"\n                              min=\"0\"\n                              step=\"0.01\"\n                              className=\"w-full px-2 py-1 text-sm border-0 focus:ring-1 focus:ring-blue-500\"\n                            />\n                          </td>\n                          <td className=\"border border-gray-300 p-1\">\n                            <input\n                              type=\"text\"\n                              value={item.motivo}\n                              onChange={(e) => actualizarFilaCompleta(index, 'motivo', e.target.value)}\n                              placeholder=\"Motivo de la solicitud\"\n                              className=\"w-full px-2 py-1 text-sm border-0 focus:ring-1 focus:ring-blue-500\"\n                            />\n                          </td>\n                          <td className=\"border border-gray-300 p-1 text-center\">\n                            <button\n                              type=\"button\"\n                              onClick={() => eliminarFilaCompleta(index)}\n                              disabled={itemsTablaCompleta.length === 1}\n                              className=\"text-red-600 hover:text-red-800 disabled:text-gray-300 disabled:cursor-not-allowed cursor-pointer\"\n                            >\n                              <i className=\"ri-delete-bin-line\"></i>\n                            </button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-2\">\n                  Formato Excel: Columnas \"Descripcion\", \"Cantidad\" y \"Motivo\"\n                </p>\n              </div>\n            )}\n\n            {/* Campos Adicionales */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-200 pt-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Fecha Estimada de Entrega\n                </label>\n                <input\n                  type=\"date\"\n                  value={fechaEstimada}\n                  onChange={(e) => setFechaEstimada(e.target.value)}\n                  min={fechaMinima}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                />\n              </div>\n\n              {/* Campo \"Cantidad de Personas\" eliminado - solo se asigna en Procesar */}\n            </div>\n\n            {/* Descripci√≥n Breve y Bot√≥n Ver Cotizaci√≥n */}\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Descripci√≥n Breve\n                </label>\n                <input\n                  type=\"text\"\n                  value={descripcionBreve}\n                  onChange={(e) => setDescripcionBreve(e.target.value)}\n                  placeholder=\"Resumen de la solicitud...\"\n                  maxLength={100}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {descripcionBreve.length}/100 caracteres\n                </p>\n              </div>\n\n              {/* Bot√≥n Ver Cotizaci√≥n */}\n              {cotizacionSeleccionada && hasPermission('cotizaciones:read') && (\n                <div>\n                  <button\n                    type=\"button\"\n                    onClick={abrirCotizacion}\n                    className=\"w-full px-4 py-3 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-300 rounded-lg hover:bg-blue-100 transition-colors cursor-pointer flex items-center justify-center gap-2\"\n                  >\n                    <i className=\"ri-external-link-line\"></i>\n                    Ver Cotizaci√≥n Completa\n                  </button>\n                  <p className=\"text-xs text-gray-500 mt-2 text-center\">\n                    Se abrir√° en una nueva pesta√±a para revisar o modificar\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Botones */}\n          <div className=\"flex justify-end gap-3 border-t border-gray-200 pt-6 sticky bottom-0 bg-white\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap\"\n            >\n              Cancelar\n            </button>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap\"\n            >\n              {loading ? (\n                <div className=\"flex items-center gap-2\">\n                  <i className=\"ri-loader-4-line animate-spin\"></i>\n                  Guardando...\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-2\">\n                  <i className=\"ri-save-line\"></i>\n                  Guardar y Enviar\n                </div>\n              )}\n            </button>\n          </div>\n        </form>\n\n        {/* Modal de Asignar Personal */}\n        {mostrarModalPersonal && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4\">\n            <div className=\"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n                <div>\n                  <h3 className=\"text-lg font-bold text-gray-900\">Asignar Personal</h3>\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    Seleccione el personal que trabajar√° en esta tarea\n                  </p>\n                </div>\n                <button\n                  onClick={() => setMostrarModalPersonal(false)}\n                  type=\"button\"\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n                >\n                  <i className=\"ri-close-line text-xl\"></i>\n                </button>\n              </div>\n\n              {/* B√∫squeda */}\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"relative\">\n                  <input\n                    type=\"text\"\n                    value={busquedaColaborador}\n                    onChange={(e) => setBusquedaColaborador(e.target.value)}\n                    placeholder=\"Buscar por nombre o email...\"\n                    className=\"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                  <i className=\"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"></i>\n                </div>\n              </div>\n\n              {/* Personal Seleccionado */}\n              {colaboradoresSeleccionados.length > 0 && (\n                <div className=\"p-4 bg-blue-50 border-b border-blue-200\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <h4 className=\"text-sm font-semibold text-blue-900\">\n                      Personal Asignado ({colaboradoresSeleccionados.length})\n                    </h4>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {colaboradoresSeleccionados.map((colaborador) => (\n                      <div\n                        key={colaborador.id}\n                        className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-white border border-blue-300 rounded-lg text-sm\"\n                      >\n                        <i className=\"ri-user-line text-blue-600\"></i>\n                        <span className=\"text-gray-900\">{colaborador.nombre}</span>\n                        <button\n                          type=\"button\"\n                          onClick={() => eliminarPersonal(colaborador.id)}\n                          className=\"text-red-500 hover:text-red-700 cursor-pointer\"\n                        >\n                          <i className=\"ri-close-line\"></i>\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Lista de Colaboradores Disponibles */}\n              <div className=\"flex-1 overflow-y-auto p-4\">\n                {colaboradoresFiltrados.length === 0 ? (\n                  <div className=\"text-center text-gray-500 py-8\">\n                    <i className=\"ri-user-search-line text-4xl text-gray-300 mb-2\"></i>\n                    <p>No se encontraron colaboradores</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {colaboradoresFiltrados.map((colaborador) => {\n                      const estaAsignado = personalAsignado.includes(colaborador.id);\n                      return (\n                        <div\n                          key={colaborador.id}\n                          className={`p-4 border rounded-lg transition-all cursor-pointer ${\n                            estaAsignado\n                              ? 'border-blue-500 bg-blue-50'\n                              : 'border-gray-300 hover:border-blue-300 hover:bg-gray-50'\n                          }`}\n                          onClick={() => {\n                            if (estaAsignado) {\n                              eliminarPersonal(colaborador.id);\n                            } else {\n                              agregarPersonal(colaborador.id);\n                            }\n                          }}\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <h4 className=\"text-sm font-medium text-gray-900\">\n                                  {colaborador.nombre}\n                                </h4>\n                                {estaAsignado && (\n                                  <i className=\"ri-checkbox-circle-fill text-blue-600\"></i>\n                                )}\n                              </div>\n                              {colaborador.email && (\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  <i className=\"ri-mail-line mr-1\"></i>\n                                  {colaborador.email}\n                                </p>\n                              )}\n                              {colaborador.telefono && (\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  <i className=\"ri-phone-line mr-1\"></i>\n                                  {colaborador.telefono}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n\n              {/* Footer */}\n              <div className=\"flex justify-between items-center p-4 border-t border-gray-200 bg-gray-50\">\n                <div className=\"text-sm text-gray-600\">\n                  {colaboradoresSeleccionados.length} persona{colaboradoresSeleccionados.length !== 1 ? 's' : ''} seleccionada{colaboradoresSeleccionados.length !== 1 ? 's' : ''}\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={() => setMostrarModalPersonal(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap\"\n                >\n                  Confirmar Selecci√≥n\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","import React, { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { tareaService } from '../../../services/tareaService';\nimport { useAuth } from '../../../hooks/useAuth';\nimport { formatCurrency } from '../../../lib/currency';\nimport { useNotification } from '../../../hooks/useNotification';\nimport NotificationPopup from '../../../components/base/NotificationPopup';\nimport ConfirmationDialog from '../../../components/base/ConfirmationDialog';\nimport type { \n  Tarea, \n  TareaEstado, \n  TareaItem, \n  TareaColaborador,\n  UpdateTareaData \n} from '../../../types/tarea';\n\ninterface TareaProcesarModalProps {\n  tarea: Tarea;\n  onClose: () => void;\n  onSave: () => void;\n}\n\ninterface ItemOption {\n  tipo: 'inventario' | 'producto';\n  id: number;\n  codigo: string;\n  nombre: string;\n  precio: number;\n}\n\ninterface CotizacionOption {\n  tipo: 'cotizacion';\n  id: number;\n  codigo: string;\n  nombre: string;\n  precio: number;\n}\n\ntype OpcionBusqueda = ItemOption | CotizacionOption;\n\n// ‚úÖ Interfaz para opciones de cotizaci√≥n\ninterface CotizacionOption {\n  id: number;\n  codigo: string;\n  cliente_nombre: string;\n  total: number;\n}\n\n// ‚úÖ Interfaz para componentes BOM\ninterface BOMComponent {\n  id_componente: number;\n  codigo_articulo: string;\n  descripcion_articulo: string;\n  cantidad_x_unidad: number;\n  cantidad_total: number;\n}\n\nconst ESTADOS: TareaEstado[] = [\n  'En Cola',\n  'En Proceso',\n  'Produciendo',\n  'Esperando suministros',\n  'Terminado',\n  'Finalizado'\n];\n\nexport default function TareaProcesarModal({ tarea, onClose, onSave }: TareaProcesarModalProps) {\n  const { tiendaActual } = useAuth();\n  \n  // ‚úÖ AGREGAR EL HOOK DE NOTIFICACIONES\n  const { notification, showNotification, hideNotification, confirmation, showConfirmation, hideConfirmation } = useNotification();\n  \n  const [loading, setLoading] = useState(false);\n  const [activeTab, setActiveTab] = useState<'info' | 'consumo' | 'personal'>('info');\n  \n  // Estados del formulario\n  const [fechaEstimada, setFechaEstimada] = useState(tarea.fecha_estimada_entrega || '');\n  const [cantidadUnidades, setCantidadUnidades] = useState(tarea.cantidad_unidades?.toString() || '');\n  const [descripcionBreve, setDescripcionBreve] = useState(tarea.descripcion_breve || '');\n  const [fechaInicio, setFechaInicio] = useState(\n    tarea.fecha_inicio ? new Date(tarea.fecha_inicio).toISOString().split('T')[0] : ''\n  );\n  const [fechaCierre, setFechaCierre] = useState(\n    tarea.fecha_cierre ? new Date(tarea.fecha_cierre).toISOString().split('T')[0] : ''\n  );\n  const [entregadoA, setEntregadoA] = useState(tarea.entregado_a || '');\n  const [estado, setEstado] = useState<TareaEstado>(tarea.estado);\n  \n  // Estados para items y personal\n  const [items, setItems] = useState<TareaItem[]>(tarea.items || []);\n  const [colaboradores, setColaboradores] = useState<TareaColaborador[]>([]);\n  \n  // ‚úÖ Cargar personal asignado desde la tarea\n  const [personalSeleccionado, setPersonalSeleccionado] = useState<string[]>(\n    tarea.personal_asignado?.map(p => p.colaborador_id) || []\n  );\n  \n  // ‚úÖ Estados para el modal de asignar personal\n  const [mostrarModalPersonal, setMostrarModalPersonal] = useState(false);\n  const [busquedaColaborador, setBusquedaColaborador] = useState('');\n  \n  // Estado para expandir/contraer detalle de productos\n  const [detalleProductosExpandido, setDetalleProductosExpandido] = useState(false);\n  \n  // ‚úÖ Estados para el modal de ver componentes BOM\n  const [mostrarModalBOM, setMostrarModalBOM] = useState(false);\n  const [componentesBOM, setComponentesBOM] = useState<BOMComponent[]>([]);\n  const [cargandoBOM, setCargandoBOM] = useState(false);\n  const [productoSeleccionadoBOM, setProductoSeleccionadoBOM] = useState<string>('');\n  \n  // Nuevo item\n  const [nuevoItem, setNuevoItem] = useState({\n    descripcion: '',\n    cantidad: 0,\n    costo_unitario: 0,\n    item_type: 'inventario' as 'inventario' | 'producto' | 'cotizacion',\n    producto_id: null as number | null,\n    inventario_id: null as number | null\n  });\n\n  // Estados para el buscador de items\n  const [itemBusqueda, setItemBusqueda] = useState('');\n  const [itemsOpciones, setItemsOpciones] = useState<ItemOption[]>([]);\n  const [mostrarItemsOpciones, setMostrarItemsOpciones] = useState(false);\n  const [buscandoItems, setBuscandoItems] = useState(false);\n\n  // ‚úÖ Estados para b√∫squeda de cotizaciones\n  const [cotizacionesOpciones, setCotizacionesOpciones] = useState<CotizacionOption[]>([]);\n  const [mostrarCotizacionesOpciones, setMostrarCotizacionesOpciones] = useState(false);\n\n  // ‚úÖ Constantes de b√∫squeda\n  const MIN_CHARS = 2;\n  const DEBOUNCE_MS = 400;\n\n  // ‚úÖ CARGAR COMPONENTES BOM AUTOM√ÅTICAMENTE AL ABRIR EL MODAL\n  useEffect(() => {\n    const cargarComponentesBOMAutomatico = async () => {\n      // Solo cargar si hay cotizaci√≥n ligada y no hay items ya cargados\n      if (!tarea.cotizacion_id || items.length > 0) {\n        return;\n      }\n\n      console.log('='.repeat(50));\n      console.log('üîÑ CARGANDO COMPONENTES BOM AUTOM√ÅTICAMENTE');\n      console.log('='.repeat(50));\n      console.log('üì¶ Cotizaci√≥n ID:', tarea.cotizacion_id);\n\n      try {\n        console.log('üì° Consultando items de cotizaci√≥n en Supabase...');\n        const { data: itemsCotizacion, error: errorItems } = await supabase\n          .from('cotizacion_items')\n          .select('producto_id, cantidad')\n          .eq('cotizacion_id', tarea.cotizacion_id);\n\n        console.log('üì• Respuesta de items recibida');\n        console.log('   - Error:', errorItems);\n        console.log('   - Data:', itemsCotizacion);\n        console.log('   - Cantidad de items:', itemsCotizacion?.length || 0);\n\n        if (errorItems) {\n          console.error('‚ùå ERROR AL OBTENER ITEMS DE COTIZACI√ìN:', errorItems);\n          return;\n        }\n\n        if (!itemsCotizacion || itemsCotizacion.length === 0) {\n          console.log('‚ö†Ô∏è La cotizaci√≥n no tiene items asociados');\n          return;\n        }\n\n        console.log('üîÑ Procesando items de cotizaci√≥n...');\n        const componentesMap = new Map<number, { cantidad: number; costo: number; codigo: string; descripcion: string }>();\n\n        for (const item of itemsCotizacion) {\n          console.log('='.repeat(50));\n          console.log('üì¶ Procesando item de cotizaci√≥n');\n          console.log('   - Producto ID:', item.producto_id);\n          console.log('   - Cantidad:', item.cantidad);\n\n          console.log('üì° Consultando BOM del producto...');\n          const { data: bomItems, error: errorBom } = await supabase\n            .from('bom_items')\n            .select(`\n              id_componente,\n              cantidad_x_unidad,\n              inventario!bom_items_id_componente_fkey(\n                id_articulo,\n                codigo_articulo,\n                descripcion_articulo,\n                costo_articulo\n              )\n            `)\n            .eq('product_id', item.producto_id);\n\n          console.log('üì• Respuesta de BOM recibida');\n          console.log('   - Error:', errorBom);\n          console.log('   - Data:', bomItems);\n          console.log('   - Cantidad de componentes:', bomItems?.length || 0);\n\n          if (errorBom) {\n            console.error('‚ùå ERROR AL OBTENER BOM:', errorBom);\n            continue;\n          }\n\n          if (!bomItems || bomItems.length === 0) {\n            console.log('‚ö†Ô∏è El producto no tiene BOM definido');\n            continue;\n          }\n\n          console.log('üîÑ Procesando componentes BOM...');\n          for (const bomItem of bomItems) {\n            if (!bomItem.inventario) {\n              console.log('‚ö†Ô∏è Componente sin inventario asociado:', bomItem.id_componente);\n              continue;\n            }\n\n            const cantidadTotal = item.cantidad * bomItem.cantidad_x_unidad;\n            const articuloId = bomItem.inventario.id_articulo;\n\n            console.log('   üì¶ Componente:', {\n              id: articuloId,\n              codigo: bomItem.inventario.codigo_articulo,\n              descripcion: bomItem.inventario.descripcion_articulo,\n              cantidadPorUnidad: bomItem.cantidad_x_unidad,\n              cantidadProducto: item.cantidad,\n              cantidadTotal,\n              costo: bomItem.inventario.costo_articulo\n            });\n\n            if (componentesMap.has(articuloId)) {\n              const existing = componentesMap.get(articuloId)!;\n              console.log('   ‚ôªÔ∏è Componente duplicado, sumando cantidades');\n              console.log('      - Cantidad anterior:', existing.cantidad);\n              console.log('      - Cantidad a sumar:', cantidadTotal);\n              console.log('      - Cantidad nueva:', existing.cantidad + cantidadTotal);\n              componentesMap.set(articuloId, {\n                ...existing,\n                cantidad: existing.cantidad + cantidadTotal\n              });\n            } else {\n              console.log('   ‚úÖ Nuevo componente agregado al mapa');\n              componentesMap.set(articuloId, {\n                cantidad: cantidadTotal,\n                costo: bomItem.inventario.costo_articulo || 0,\n                codigo: bomItem.inventario.codigo_articulo,\n                descripcion: bomItem.inventario.descripcion_articulo\n              });\n            }\n          }\n        }\n\n        console.log('='.repeat(50));\n        console.log('üìä RESUMEN DE COMPONENTES');\n        console.log('='.repeat(50));\n        console.log('Total de componentes √∫nicos:', componentesMap.size);\n        console.log('Detalle:');\n        componentesMap.forEach((comp, id) => {\n          console.log(`   - ${comp.codigo}: ${comp.cantidad} unidades @ ${formatCurrency(comp.costo)}`);\n        });\n\n        console.log('üîÑ Convirtiendo mapa a array de items...');\n        const nuevosItems: TareaItem[] = Array.from(componentesMap.entries()).map(([id, comp]) => {\n          const item = {\n            id: `temp-${Date.now()}-${Math.random()}`,\n            tarea_id: tarea.id,\n            item_type: 'inventario' as const,\n            inventario_id: id,\n            producto_id: null,\n            descripcion: comp.descripcion,\n            cantidad: comp.cantidad,\n            costo_unitario: comp.costo,\n            total: comp.cantidad * comp.costo,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          };\n          console.log('   ‚úÖ Item creado:', item);\n          return item;\n        });\n\n        console.log('üìä Total de items a agregar:', nuevosItems.length);\n        setItems(nuevosItems);\n        console.log('‚úÖ COMPONENTES BOM CARGADOS AUTOM√ÅTICAMENTE');\n        console.log('='.repeat(50));\n\n      } catch (error) {\n        console.error('üí• ERROR CR√çTICO EN CARGA AUTOM√ÅTICA:', error);\n      }\n    };\n\n    cargarComponentesBOMAutomatico();\n  }, [tarea.cotizacion_id, tarea.id]);\n\n  // ‚úÖ Buscar items seg√∫n el tipo - MEJORADO Y CORREGIDO\n  useEffect(() => {\n    console.log('='.repeat(50));\n    console.log('üîÑ useEffect de b√∫squeda ejecutado');\n    console.log('üìù Estado actual:', {\n      itemBusqueda,\n      tipo: nuevoItem.item_type,\n      tiendaActual: tiendaActual?.tienda_id,\n      tiendaActualCompleto: tiendaActual,\n      longitudBusqueda: itemBusqueda.length,\n      MIN_CHARS,\n      DEBOUNCE_MS\n    });\n\n    // Validaci√≥n 1: Texto vac√≠o o muy corto\n    if (!itemBusqueda || itemBusqueda.length < MIN_CHARS) {\n      console.log('‚è∏Ô∏è B√öSQUEDA CANCELADA: Texto muy corto o vac√≠o');\n      console.log('   - itemBusqueda:', itemBusqueda);\n      console.log('   - Longitud:', itemBusqueda.length);\n      console.log('   - M√≠nimo requerido:', MIN_CHARS);\n      setItemsOpciones([]);\n      setMostrarItemsOpciones(false);\n      setCotizacionesOpciones([]);\n      setMostrarCotizacionesOpciones(false);\n      console.log('='.repeat(50));\n      return;\n    }\n\n    // ‚úÖ VALIDACI√ìN MEJORADA: Solo requerir tienda para inventario y productos\n    // Si no hay tienda, intentar buscar sin filtro de tienda\n    if (nuevoItem.item_type !== 'cotizacion') {\n      if (!tiendaActual?.tienda_id) {\n        console.log('‚ö†Ô∏è ADVERTENCIA: Sin tienda actual, buscando sin filtro de tienda');\n        console.log('   - Tipo:', nuevoItem.item_type);\n        console.log('   - Tienda actual:', tiendaActual);\n        console.log('   - Se proceder√° con la b√∫squeda sin filtro de tienda');\n      } else {\n        console.log('‚úÖ Tienda actual encontrada:', tiendaActual.tienda_id);\n      }\n    }\n\n    console.log('‚úÖ Validaciones pasadas, iniciando debounce...');\n    console.log('‚è±Ô∏è Esperando', DEBOUNCE_MS, 'ms antes de buscar');\n\n    const timer = setTimeout(async () => {\n      console.log('='.repeat(50));\n      console.log('üöÄ INICIANDO B√öSQUEDA');\n      console.log('üìä Par√°metros de b√∫squeda:', {\n        tipo: nuevoItem.item_type,\n        termino: itemBusqueda,\n        tienda: tiendaActual?.tienda_id || 'SIN TIENDA'\n      });\n\n      setBuscandoItems(true);\n      console.log('‚è≥ Estado loading activado');\n\n      try {\n        const termino = itemBusqueda.trim();\n        console.log('üî§ T√©rmino limpio:', termino);\n\n        // ============================================\n        // B√öSQUEDA DE COTIZACIONES\n        // ============================================\n        if (nuevoItem.item_type === 'cotizacion') {\n          console.log('='.repeat(50));\n          console.log('üîç B√öSQUEDA EN COTIZACIONES');\n          console.log('='.repeat(50));\n\n          console.log('üì° Construyendo query de Supabase...');\n          console.log('   - Tabla: cotizaciones');\n          console.log('   - Select: id, codigo, total, clientes');\n          console.log('   - Filtro: codigo.ilike.%' + termino + '%');\n          console.log('   - Order: created_at DESC');\n          console.log('   - Limit: 10');\n\n          const { data, error } = await supabase\n            .from('cotizaciones')\n            .select(`\n              id,\n              codigo,\n              total,\n              clientes!cotizaciones_cliente_id_fkey(\n                id,\n                nombre_razon_social\n              )\n            `)\n            .or(`codigo.ilike.%${termino}%`)\n            .order('created_at', { ascending: false })\n            .limit(10);\n\n          console.log('üì• Respuesta de Supabase recibida');\n          console.log('   - Error:', error);\n          console.log('   - Data:', data);\n          console.log('   - Cantidad de resultados:', data?.length || 0);\n\n          if (error) {\n            console.log('='.repeat(50));\n            console.error('‚ùå ERROR EN B√öSQUEDA DE COTIZACIONES:', error);\n            console.error('   - Mensaje:', error.message);\n            console.error('   - C√≥digo:', error.code);\n            console.error('   - Detalles:', error.details);\n            console.log('='.repeat(50));\n            return;\n          }\n\n          console.log('üîÑ Procesando resultados...');\n          const opciones: CotizacionOption[] = (data || [])\n            .filter(cot => {\n              const tieneCliente = cot.clientes !== null;\n              console.log('   - Cotizaci√≥n', cot.codigo, '‚Üí Cliente:', tieneCliente ? cot.clientes?.nombre_razon_social : 'NULL');\n              return tieneCliente;\n            })\n            .map(cot => {\n              const opcion = {\n                id: cot.id,\n                codigo: cot.codigo,\n                cliente_nombre: cot.clientes?.nombre_razon_social || 'Sin cliente',\n                total: cot.total\n              };\n              console.log('   ‚úÖ Opci√≥n creada:', opcion);\n              return opcion;\n            });\n\n          console.log('üìä Total de opciones procesadas:', opciones.length);\n          console.log('üìã Opciones finales:', opciones);\n\n          setCotizacionesOpciones(opciones);\n          setMostrarCotizacionesOpciones(opciones.length > 0);\n          console.log('‚úÖ Estado actualizado');\n          console.log('   - Opciones:', opciones.length);\n          console.log('   - Dropdown visible:', opciones.length > 0);\n        }\n\n        // ============================================\n        // B√öSQUEDA DE INVENTARIO\n        // ============================================\n        else if (nuevoItem.item_type === 'inventario') {\n          console.log('üîç Buscando en inventario con t√©rmino:', termino);\n\n          let query = supabase\n            .from('inventario')\n            .select('id_articulo, codigo_articulo, descripcion_articulo, costo_articulo');\n\n          // Si hay tienda, filtra por tienda\n          if (tiendaActual?.tienda_id) {\n            console.log('   - Filtro tienda: tienda_id =', tiendaActual.tienda_id);\n            query = query.eq('tienda_id', tiendaActual.tienda_id);\n          } else {\n            console.log('   - ‚ö†Ô∏è SIN FILTRO DE TIENDA (buscando en todas las tiendas)');\n          }\n\n          const { data, error } = await query\n            .or(`codigo_articulo.ilike.%${termino}%,descripcion_articulo.ilike.%${termino}%`)\n            .limit(10);\n\n          console.log('üì• Respuesta de Supabase recibida');\n          console.log('   - Error:', error);\n          console.log('   - Data:', data);\n          console.log('   - Cantidad de resultados:', data?.length || 0);\n\n          if (error) {\n            console.log('='.repeat(50));\n            console.error('‚ùå ERROR EN B√öSQUEDA DE INVENTARIO');\n            console.error('   - Mensaje:', error.message);\n            console.error('   - C√≥digo:', error.code);\n            console.error('   - Detalles:', error);\n            console.log('='.repeat(50));\n            setItemsOpciones([]);\n            setMostrarItemsOpciones(false);\n            return;\n          }\n\n          console.log('üîÑ Procesando resultados...');\n          const opciones = (data || []).map((item) => {\n            const opcion = {\n              tipo: 'inventario' as const,\n              id: item.id_articulo,\n              codigo: item.codigo_articulo,\n              nombre: item.descripcion_articulo,\n              precio: item.costo_articulo || 0\n            };\n            console.log('   ‚úÖ Opci√≥n creada:', opcion);\n            return opcion;\n          });\n\n          console.log('üìä Total de opciones procesadas:', opciones.length);\n          console.log('üìã Opciones finales:', opciones);\n\n          setItemsOpciones(opciones);\n          setMostrarItemsOpciones(opciones.length > 0);\n\n          console.log('‚úÖ Estado actualizado');\n          console.log('   - Opciones:', opciones.length);\n          console.log('   - Dropdown visible:', opciones.length > 0);\n        }\n\n        // ============================================\n        // B√öSQUEDA DE PRODUCTOS\n        // ============================================\n        else {\n          console.log('üîç Buscando en productos con t√©rmino:', termino);\n\n          let query = supabase\n            .from('productos')\n            .select('id_producto, codigo_producto, descripcion_producto, costo_total_bom');\n\n          console.log('üì° Construyendo query de Supabase...');\n          console.log('   - Tabla: productos');\n          console.log('   - Select: id_producto, codigo_producto, descripcion_producto, costo_total_bom');\n\n          // Filtrar por tienda si existe\n          if (tiendaActual?.tienda_id) {\n            query = query.eq('tienda_id', tiendaActual.tienda_id);\n            console.log('   - Filtro tienda: tienda_id =', tiendaActual.tienda_id);\n          } else {\n            console.log('   - ‚ö†Ô∏è SIN FILTRO DE TIENDA (buscando en todas las tiendas)');\n          }\n\n          const { data, error } = await query\n            .or(`codigo_producto.ilike.%${termino}%,descripcion_producto.ilike.%${termino}%`)\n            .limit(10);\n\n          console.log('   - Filtro b√∫squeda: codigo_producto.ilike.%' + termino + '% OR descripcion_producto.ilike.%' + termino + '%');\n          console.log('   - Limit: 10');\n\n          console.log('üì• Respuesta de Supabase recibida');\n          console.log('   - Error:', error);\n          console.log('   - Data:', data);\n          console.log('   - Cantidad de resultados:', data?.length || 0);\n\n          if (error) {\n            console.log('='.repeat(50));\n            console.error('‚ùå ERROR EN B√öSQUEDA DE PRODUCTOS');\n            console.error('   - Mensaje:', error.message);\n            console.error('   - C√≥digo:', error.code);\n            console.error('   - Detalles:', error);\n            console.log('='.repeat(50));\n            setItemsOpciones([]);\n            setMostrarItemsOpciones(false);\n            return;\n          }\n\n          console.log('üîÑ Procesando resultados...');\n          const opciones = (data || []).map((item) => {\n            const opcion = {\n              tipo: 'producto' as const,\n              id: item.id_producto,\n              codigo: item.codigo_producto,\n              nombre: item.descripcion_producto,\n              precio: item.costo_total_bom || 0\n            };\n            console.log('   ‚úÖ Opci√≥n creada:', opcion);\n            return opcion;\n          });\n\n          console.log('üìä Total de opciones procesadas:', opciones.length);\n          console.log('üìã Opciones finales:', opciones);\n\n          setItemsOpciones(opciones);\n          setMostrarItemsOpciones(opciones.length > 0);\n\n          console.log('‚úÖ Estado actualizado');\n          console.log('   - Opciones:', opciones.length);\n          console.log('   - Dropdown visible:', opciones.length > 0);\n        }\n\n      } catch (error) {\n        console.log('='.repeat(50));\n        console.error('‚ùå Error buscando items:', error);\n      } finally {\n        setBuscandoItems(false);\n      }\n    }, DEBOUNCE_MS);\n\n    console.log('üîÑ Timer creado, ID:', timer);\n    console.log('='.repeat(50));\n\n    return () => {\n      console.log('üßπ Cleanup: Cancelando timer', timer);\n      clearTimeout(timer);\n    };\n  }, [itemBusqueda, nuevoItem.item_type, tiendaActual]);\n\n  useEffect(() => {\n    cargarColaboradores();\n  }, []);\n\n  const cargarColaboradores = async () => {\n    try {\n      const colaboradoresData = await tareaService.getColaboradores();\n      setColaboradores(colaboradoresData);\n    } catch (error) {\n      console.error('Error cargando colaboradores:', error);\n    }\n  };\n\n  // ‚úÖ Funci√≥n para ver componentes BOM de un producto - CON POPUP\n  const verComponentesBOM = async (item: TareaItem) => {\n    if (item.item_type !== 'producto' || !item.producto_id) {\n      showNotification('warning', 'Este item no es un producto o no tiene ID de producto');\n      return;\n    }\n\n    setCargandoBOM(true);\n    setMostrarModalBOM(true);\n    setProductoSeleccionadoBOM(item.descripcion);\n\n    try {\n      const { data: bomItems, error } = await supabase\n        .from('bom_items')\n        .select(`\n          id_componente,\n          cantidad_x_unidad,\n          inventario!bom_items_id_componente_fkey(\n            id_articulo,\n            codigo_articulo,\n            descripcion_articulo\n          )\n        `)\n        .eq('product_id', item.producto_id);\n\n      if (error) {\n        console.error('Error obteniendo BOM:', error);\n        showNotification('error', 'Error al cargar los componentes del producto');\n        setMostrarModalBOM(false);\n        return;\n      }\n\n      if (!bomItems || bomItems.length === 0) {\n        setComponentesBOM([]);\n        return;\n      }\n\n      // Calcular cantidad total de cada componente\n      const componentes: BOMComponent[] = bomItems.map((bomItem: any) => ({\n        id_componente: bomItem.id_componente,\n        codigo_articulo: bomItem.inventario.codigo_articulo,\n        descripcion_articulo: bomItem.inventario.descripcion_articulo,\n        cantidad_x_unidad: bomItem.cantidad_x_unidad,\n        cantidad_total: bomItem.cantidad_x_unidad * item.cantidad\n      }));\n\n      setComponentesBOM(componentes);\n    } catch (error) {\n      console.error('Error cargando BOM:', error);\n      showNotification('error', 'Error al cargar los componentes del producto');\n      setMostrarModalBOM(false);\n    } finally {\n      setCargandoBOM(false);\n    }\n  };\n\n  // ============================================\n  // üéØ SELECCI√ìN DE ITEM CON LOGS\n  // ============================================\n  const seleccionarItem = (item: ItemOption) => {\n    console.log('='.repeat(50));\n    console.log('üéØ ITEM SELECCIONADO');\n    console.log('='.repeat(50));\n    console.log('üì¶ Item:', item);\n    console.log('   - Tipo:', item.tipo);\n    console.log('   - ID:', item.id);\n    console.log('   - C√≥digo:', item.codigo);\n    console.log('   - Nombre:', item.nombre);\n    console.log('   - Precio:', item.precio);\n\n    setNuevoItem({\n      ...nuevoItem,\n      descripcion: item.nombre,\n      costo_unitario: item.precio,\n      producto_id: item.tipo === 'producto' ? item.id : null,\n      inventario_id: item.tipo === 'inventario' ? item.id : null\n    });\n\n    console.log('‚úÖ Estado nuevoItem actualizado:', {\n      ...nuevoItem,\n      descripcion: item.nombre,\n      costo_unitario: item.precio\n    });\n\n    setItemBusqueda(item.codigo);\n    setMostrarItemsOpciones(false);\n    setItemsOpciones([]);\n\n    console.log('‚úÖ Estados de b√∫squeda limpiados');\n    console.log('   - itemBusqueda:', item.codigo);\n    console.log('   - mostrarItemsOpciones: false');\n    console.log('   - itemsOpciones: []');\n    console.log('='.repeat(50));\n  };\n\n  // ============================================\n  // üéØ SELECCI√ìN DE COTIZACI√ìN CON LOGS\n  // ============================================\n  const seleccionarCotizacion = async (cotizacion: CotizacionOption) => {\n    console.log('='.repeat(50));\n    console.log('üéØ COTIZACI√ìN SELECCIONADA');\n    console.log('='.repeat(50));\n    console.log('üì¶ Cotizaci√≥n:', cotizacion);\n    console.log('   - ID:', cotizacion.id);\n    console.log('   - C√≥digo:', cotizacion.codigo);\n    console.log('   - Cliente:', cotizacion.cliente_nombre);\n    console.log('   - Total:', cotizacion.total);\n\n    setItemBusqueda(cotizacion.codigo);\n    setMostrarCotizacionesOpciones(false);\n    setCotizacionesOpciones([]);\n\n    console.log('‚úÖ Estados de b√∫squeda limpiados');\n    console.log('üîÑ Iniciando importaci√≥n de items de cotizaci√≥n...');\n\n    try {\n      console.log('üì° Consultando items de cotizaci√≥n en Supabase...');\n      console.log('   - Tabla: cotizacion_items');\n      console.log('   - Filtro: cotizacion_id =', cotizacion.id);\n\n      const { data: itemsCotizacion, error: errorItems } = await supabase\n        .from('cotizacion_items')\n        .select('producto_id, cantidad')\n        .eq('cotizacion_id', cotizacion.id);\n\n      console.log('üì• Respuesta de items recibida');\n      console.log('   - Error:', errorItems);\n      console.log('   - Data:', itemsCotizacion);\n      console.log('   - Cantidad de items:', itemsCotizacion?.length || 0);\n\n      if (errorItems) {\n        console.log('='.repeat(50));\n        console.error('‚ùå ERROR AL OBTENER ITEMS DE COTIZACI√ìN:', errorItems);\n        console.error('   - Mensaje:', errorItems.message);\n        console.error('   - C√≥digo:', errorItems.code);\n        console.log('='.repeat(50));\n        return;\n      }\n\n      if (!itemsCotizacion || itemsCotizacion.length === 0) {\n        console.log('‚ö†Ô∏è La cotizaci√≥n no tiene items asociados');\n        console.log('='.repeat(50));\n        return;\n      }\n\n      console.log('üîÑ Procesando items de cotizaci√≥n...');\n      const componentesMap = new Map<number, { cantidad: number; costo: number; codigo: string; descripcion: string }>();\n\n      for (const item of itemsCotizacion) {\n        console.log('='.repeat(50));\n        console.log('üì¶ Procesando item de cotizaci√≥n');\n        console.log('   - Producto ID:', item.producto_id);\n        console.log('   - Cantidad:', item.cantidad);\n\n        console.log('üì° Consultando BOM del producto...');\n        console.log('   - Tabla: bom_items');\n        console.log('   - Filtro: producto_id =', item.producto_id);\n\n        const { data: bomItems, error: errorBom } = await supabase\n          .from('bom_items')\n          .select(`\n            id_componente,\n            cantidad_x_unidad,\n            inventario!bom_items_id_componente_fkey(\n              id_articulo,\n              codigo_articulo,\n              descripcion_articulo,\n              costo_articulo\n            )\n          `)\n          .eq('product_id', item.producto_id);\n\n        console.log('üì• Respuesta de BOM recibida');\n        console.log('   - Error:', errorBom);\n        console.log('   - Data:', bomItems);\n        console.log('   - Cantidad de componentes:', bomItems?.length || 0);\n\n        if (errorBom) {\n          console.log('='.repeat(50));\n          console.error('‚ùå ERROR AL OBTENER BOM:', errorBom);\n          console.error('   - Mensaje:', errorBom.message);\n          console.error('   - C√≥digo:', errorBom.code);\n          continue;\n        }\n\n        if (!bomItems || bomItems.length === 0) {\n          console.log('‚ö†Ô∏è El producto no tiene BOM definido');\n          continue;\n        }\n\n        console.log('üîÑ Procesando componentes BOM...');\n        for (const bomItem of bomItems) {\n          if (!bomItem.inventario) {\n            console.log('‚ö†Ô∏è Componente sin inventario asociado:', bomItem.id_componente);\n            continue;\n          }\n\n          const cantidadTotal = item.cantidad * bomItem.cantidad_x_unidad;\n          const articuloId = bomItem.inventario.id_articulo;\n\n          console.log('   üì¶ Componente:', {\n            id: articuloId,\n            codigo: bomItem.inventario.codigo_articulo,\n            descripcion: bomItem.inventario.descripcion_articulo,\n            cantidadPorUnidad: bomItem.cantidad_x_unidad,\n            cantidadProducto: item.cantidad,\n            cantidadTotal,\n            costo: bomItem.inventario.costo_articulo\n          });\n\n          if (componentesMap.has(articuloId)) {\n            const existing = componentesMap.get(articuloId)!;\n            console.log('   ‚ôªÔ∏è Componente duplicado, sumando cantidades');\n            console.log('      - Cantidad anterior:', existing.cantidad);\n            console.log('      - Cantidad a sumar:', cantidadTotal);\n            console.log('      - Cantidad nueva:', existing.cantidad + cantidadTotal);\n            componentesMap.set(articuloId, {\n              ...existing,\n              cantidad: existing.cantidad + cantidadTotal\n            });\n          } else {\n            console.log('   ‚úÖ Nuevo componente agregado al mapa');\n            componentesMap.set(articuloId, {\n              cantidad: cantidadTotal,\n              costo: bomItem.inventario.costo_articulo || 0,\n              codigo: bomItem.inventario.codigo_articulo,\n              descripcion: bomItem.inventario.descripcion_articulo\n            });\n          }\n        }\n      }\n\n      console.log('='.repeat(50));\n      console.log('üìä RESUMEN DE COMPONENTES');\n      console.log('='.repeat(50));\n      console.log('Total de componentes √∫nicos:', componentesMap.size);\n      console.log('Detalle:');\n      componentesMap.forEach((comp, id) => {\n        console.log(`   - ${comp.codigo}: ${comp.cantidad} unidades @ ${formatCurrency(comp.costo)}`);\n      });\n\n      console.log('üîÑ Convirtiendo mapa a array de items...');\n      const nuevosItems: TareaItem[] = Array.from(componentesMap.entries()).map(([id, comp]) => {\n        const item = {\n          id: `temp-${Date.now()}-${Math.random()}`,\n          tarea_id: tarea.id,\n          item_type: 'inventario' as const,\n          inventario_id: id,\n          producto_id: null,\n          descripcion: comp.descripcion,\n          cantidad: comp.cantidad,\n          costo_unitario: comp.costo,\n          total: comp.cantidad * comp.costo,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        };\n        console.log('   ‚úÖ Item creado:', item);\n        return item;\n      });\n\n      console.log('üìä Total de items a agregar:', nuevosItems.length);\n      console.log('üìã Items finales:', nuevosItems);\n\n      setItems(prev => {\n        const updated = [...prev, ...nuevosItems];\n        console.log('‚úÖ Estado items actualizado');\n        console.log('   - Items anteriores:', prev.length);\n        console.log('   - Items nuevos:', nuevosItems.length);\n        console.log('   - Total items:', updated.length);\n        return updated;\n      });\n\n      console.log('‚úÖ IMPORTACI√ìN COMPLETADA EXITOSAMENTE');\n      console.log('='.repeat(50));\n      \n      // ‚úÖ POPUP EN LUGAR DE ALERT\n      showNotification('success', `Se importaron ${nuevosItems.length} componentes desde la cotizaci√≥n`);\n\n    } catch (error) {\n      console.log('='.repeat(50));\n      console.error('üí• ERROR CR√çTICO EN IMPORTACI√ìN');\n      console.error('Error:', error);\n      console.error('Stack:', error instanceof Error ? error.stack : 'No stack trace');\n      console.log('='.repeat(50));\n    }\n  };\n\n  const limpiarBusqueda = () => {\n    setItemBusqueda('');\n    setItemsOpciones([]);\n    setMostrarItemsOpciones(false);\n    setCotizacionesOpciones([]);\n    setMostrarCotizacionesOpciones(false);\n    setNuevoItem({\n      descripcion: '',\n      costo_unitario: 0,\n      producto_id: null,\n      inventario_id: null\n    });\n  };\n\n  const handleAgregarItem = () => {\n    if (!nuevoItem.descripcion || nuevoItem.cantidad <= 0) {\n      showNotification('warning', 'Complete todos los campos del item');\n      return;\n    }\n\n    const item: TareaItem = {\n      id: `temp-${Date.now()}`,\n      tarea_id: tarea.id,\n      item_type: nuevoItem.item_type,\n      producto_id: nuevoItem.producto_id,\n      inventario_id: nuevoItem.inventario_id,\n      descripcion: nuevoItem.descripcion,\n      cantidad: nuevoItem.cantidad,\n      costo_unitario: nuevoItem.costo_unitario,\n      total: nuevoItem.cantidad * nuevoItem.costo_unitario,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString()\n    };\n\n    setItems(prev => [...prev, item]);\n    setNuevoItem({\n      descripcion: '',\n      cantidad: 0,\n      costo_unitario: 0,\n      item_type: 'inventario',\n      producto_id: null,\n      inventario_id: null\n    });\n    setItemBusqueda('');\n  };\n\n  const handleEliminarItem = (index: number) => {\n    setItems(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleImportarCotizacion = async () => {\n    if (!tarea.cotizacion_id) {\n      showNotification('warning', 'Esta tarea no tiene una cotizaci√≥n asociada');\n      return;\n    }\n\n    console.log('='.repeat(50));\n    console.log('üîÑ IMPORTANDO COMPONENTES BOM DESDE COTIZACI√ìN');\n    console.log('='.repeat(50));\n    console.log('üì¶ Cotizaci√≥n ID:', tarea.cotizacion_id);\n\n    try {\n      console.log('üì° Consultando items de cotizaci√≥n en Supabase...');\n      const { data: itemsCotizacion, error: errorItems } = await supabase\n        .from('cotizacion_items')\n        .select('producto_id, cantidad')\n        .eq('cotizacion_id', tarea.cotizacion_id);\n\n      console.log('üì• Respuesta de items recibida');\n      console.log('   - Error:', errorItems);\n      console.log('   - Data:', itemsCotizacion);\n      console.log('   - Cantidad de items:', itemsCotizacion?.length || 0);\n\n      if (errorItems) {\n        console.error('‚ùå ERROR AL OBTENER ITEMS DE COTIZACI√ìN:', errorItems);\n        showNotification('error', 'Error al obtener items de la cotizaci√≥n');\n        return;\n      }\n\n      if (!itemsCotizacion || itemsCotizacion.length === 0) {\n        console.log('‚ö†Ô∏è La cotizaci√≥n no tiene items asociados');\n        showNotification('warning', 'La cotizaci√≥n no tiene items asociados');\n        return;\n      }\n\n      console.log('üîÑ Procesando items de cotizaci√≥n...');\n      const componentesMap = new Map<number, { cantidad: number; costo: number; codigo: string; descripcion: string }>();\n\n      for (const item of itemsCotizacion) {\n        console.log('='.repeat(50));\n        console.log('üì¶ Procesando item de cotizaci√≥n');\n        console.log('   - Producto ID:', item.producto_id);\n        console.log('   - Cantidad:', item.cantidad);\n\n        console.log('üì° Consultando BOM del producto...');\n        const { data: bomItems, error: errorBom } = await supabase\n          .from('bom_items')\n          .select(`\n            id_componente,\n            cantidad_x_unidad,\n            inventario!bom_items_id_componente_fkey(\n              id_articulo,\n              codigo_articulo,\n              descripcion_articulo,\n              costo_articulo\n            )\n          `)\n          .eq('product_id', item.producto_id);\n\n        console.log('üì• Respuesta de BOM recibida');\n        console.log('   - Error:', errorBom);\n        console.log('   - Data:', bomItems);\n        console.log('   - Cantidad de componentes:', bomItems?.length || 0);\n\n        if (errorBom) {\n          console.error('‚ùå ERROR AL OBTENER BOM:', errorBom);\n          continue;\n        }\n\n        if (!bomItems || bomItems.length === 0) {\n          console.log('‚ö†Ô∏è El producto no tiene BOM definido');\n          continue;\n        }\n\n        console.log('üîÑ Procesando componentes BOM...');\n        for (const bomItem of bomItems) {\n          if (!bomItem.inventario) {\n            console.log('‚ö†Ô∏è Componente sin inventario asociado:', bomItem.id_componente);\n            continue;\n          }\n\n          const cantidadTotal = item.cantidad * bomItem.cantidad_x_unidad;\n          const articuloId = bomItem.inventario.id_articulo;\n\n          console.log('   üì¶ Componente:', {\n            id: articuloId,\n            codigo: bomItem.inventario.codigo_articulo,\n            descripcion: bomItem.inventario.descripcion_articulo,\n            cantidadPorUnidad: bomItem.cantidad_x_unidad,\n            cantidadProducto: item.cantidad,\n            cantidadTotal,\n            costo: bomItem.inventario.costo_articulo\n          });\n\n          if (componentesMap.has(articuloId)) {\n            const existing = componentesMap.get(articuloId)!;\n            console.log('   ‚ôªÔ∏è Componente duplicado, sumando cantidades');\n            console.log('      - Cantidad anterior:', existing.cantidad);\n            console.log('      - Cantidad a sumar:', cantidadTotal);\n            console.log('      - Cantidad nueva:', existing.cantidad + cantidadTotal);\n            componentesMap.set(articuloId, {\n              ...existing,\n              cantidad: existing.cantidad + cantidadTotal\n            });\n          } else {\n            console.log('   ‚úÖ Nuevo componente agregado al mapa');\n            componentesMap.set(articuloId, {\n              cantidad: cantidadTotal,\n              costo: bomItem.inventario.costo_articulo || 0,\n              codigo: bomItem.inventario.codigo_articulo,\n              descripcion: bomItem.inventario.descripcion_articulo\n            });\n          }\n        }\n      }\n\n      console.log('='.repeat(50));\n      console.log('üìä RESUMEN DE COMPONENTES');\n      console.log('='.repeat(50));\n      console.log('Total de componentes √∫nicos:', componentesMap.size);\n      console.log('Detalle:');\n      componentesMap.forEach((comp, id) => {\n        console.log(`   - ${comp.codigo}: ${comp.cantidad} unidades @ ${formatCurrency(comp.costo)}`);\n      });\n\n      console.log('üîÑ Convirtiendo mapa a array de items...');\n      const nuevosItems: TareaItem[] = Array.from(componentesMap.entries()).map(([id, comp]) => {\n        const item = {\n          id: `temp-${Date.now()}-${Math.random()}`,\n          tarea_id: tarea.id,\n          item_type: 'inventario' as const,\n          inventario_id: id,\n          producto_id: null,\n          descripcion: comp.descripcion,\n          cantidad: comp.cantidad,\n          costo_unitario: comp.costo,\n          total: comp.cantidad * comp.costo,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        };\n        console.log('   ‚úÖ Item creado:', item);\n        return item;\n      });\n\n      console.log('üìä Total de items a agregar:', nuevosItems.length);\n      setItems(prev => [...prev, ...nuevosItems]);\n      console.log('‚úÖ IMPORTACI√ìN COMPLETADA EXITOSAMENTE');\n      console.log('='.repeat(50));\n      \n      // ‚úÖ POPUP EN LUGAR DE ALERT\n      showNotification('success', `Se importaron ${nuevosItems.length} componentes desde la cotizaci√≥n`);\n\n    } catch (error) {\n      console.error('üí• ERROR CR√çTICO EN IMPORTACI√ìN:', error);\n      showNotification('error', 'Error al importar componentes de la cotizaci√≥n');\n    }\n  };\n\n  const handlePersonalChange = (colaboradorId: string, selected: boolean) => {\n    if (selected) {\n      setPersonalSeleccionado(prev => [...prev, colaboradorId]);\n    } else {\n      setPersonalSeleccionado(prev => prev.filter(id => id !== colaboradorId));\n    }\n  };\n\n  const agregarPersonal = (colaboradorId: string) => {\n    if (!personalSeleccionado.includes(colaboradorId)) {\n      setPersonalSeleccionado([...personalSeleccionado, colaboradorId]);\n    }\n  };\n\n  const eliminarPersonal = (colaboradorId: string) => {\n    setPersonalSeleccionado(personalSeleccionado.filter(id => id !== colaboradorId));\n  };\n\n  // ‚úÖ Calcular total correctamente\n  const calcularTotalCosto = () => {\n    return items.reduce((sum, item) => {\n      const total = item.cantidad * item.costo_unitario;\n      return sum + total;\n    }, 0);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (loading) return;\n    \n    try {\n      setLoading(true);\n\n      const updateData: UpdateTareaData = {\n        fecha_estimada_entrega: fechaEstimada || undefined,\n        cantidad_unidades: cantidadUnidades ? parseFloat(cantidadUnidades) : undefined,\n        descripcion_breve: descripcionBreve || undefined,\n        cantidad_personas: personalSeleccionado.length,\n        fecha_inicio: fechaInicio || undefined,\n        fecha_cierre: fechaCierre || undefined,\n        entregado_a: entregadoA || undefined,\n        estado,\n        items: items.map(item => ({\n          item_type: item.item_type,\n          item_id: item.item_id,\n          descripcion: item.descripcion,\n          cantidad: item.cantidad,\n          costo_unitario: item.costo_unitario\n        })),\n        personal_asignado: personalSeleccionado\n      };\n\n      await tareaService.updateTarea(tarea.id, updateData);\n      \n      console.log('‚úÖ Tarea actualizada exitosamente');\n      onSave();\n    } catch (error) {\n      console.error('Error actualizando tarea:', error);\n      showNotification('error', 'Error al actualizar la tarea: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ‚úÖ Calcular cantidad de personas autom√°ticamente desde el personal seleccionado\n  const cantidadPersonasCalculada = personalSeleccionado.length;\n\n  // Filtrar colaboradores para b√∫squeda\n  const colaboradoresFiltrados = colaboradores.filter(c => \n    c.nombre.toLowerCase().includes(busquedaColaborador.toLowerCase()) ||\n    (c.email && c.email.toLowerCase().includes(busquedaColaborador.toLowerCase()))\n  );\n\n  const colaboradoresSeleccionados = colaboradores.filter(c => \n    personalSeleccionado.includes(c.id)\n  );\n\n  // Verificar si el detalle de productos es largo (m√°s de 5 filas)\n  const detalleProductosLargo = \n    (tarea.datos_formulario?.items_tabla_simple && tarea.datos_formulario.items_tabla_simple.length > 5) ||\n    (tarea.datos_formulario?.items_tabla_completa && tarea.datos_formulario.items_tabla_completa.length > 5);\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Procesar Orden: {tarea.consecutivo}</h2>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              Solicitante: {tarea.email_solicitante} ‚Ä¢ Creada: {new Date(tarea.created_at).toLocaleDateString()}\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n          >\n            <i className=\"ri-close-line text-xl\"></i>\n          </button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex border-b border-gray-200\">\n          <button\n            onClick={() => setActiveTab('info')}\n            className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors cursor-pointer ${\n              activeTab === 'info'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <i className=\"ri-information-line mr-2\"></i>\n            Informaci√≥n General\n          </button>\n          <button\n            onClick={() => setActiveTab('consumo')}\n            className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors cursor-pointer ${\n              activeTab === 'consumo'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <i className=\"ri-shopping-cart-line mr-2\"></i>\n            Consumo e Inventario\n          </button>\n          <button\n            onClick={() => setActiveTab('personal')}\n            className={`px-6 py-3 text-sm font-medium border-b-2 transition-colors cursor-pointer ${\n              activeTab === 'personal'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            <i className=\"ri-team-line mr-2\"></i>\n            Personal Asignado\n          </button>\n        </div>\n\n        {/* Contenido */}\n        <form onSubmit={handleSubmit} className=\"flex-1 overflow-y-auto\">\n          {/* Tab: Informaci√≥n General */}\n          {activeTab === 'info' && (\n            <div className=\"p-6 space-y-6\">\n              {/* Informaci√≥n original de la solicitud */}\n              <div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Solicitud Original</h3>\n                <div className=\"bg-gray-50 rounded-lg p-6 space-y-4\">\n                  {/* N√∫mero de Caso */}\n                  <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                    <span className=\"text-sm font-semibold text-gray-700 w-48\">N√∫mero de Caso:</span>\n                    <span className=\"text-sm text-gray-900\">{tarea.consecutivo || 'N/A'}</span>\n                  </div>\n\n                  {/* Estado */}\n                  <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                    <span className=\"text-sm font-semibold text-gray-700 w-48\">Estado:</span>\n                    <span className={`text-sm px-2 py-1 rounded ${\n                      tarea.estado === 'Completado' ? 'bg-green-100 text-green-800' :\n                      tarea.estado === 'En Proceso' ? 'bg-blue-100 text-blue-800' :\n                      tarea.estado === 'En Cola' ? 'bg-yellow-100 text-yellow-800' :\n                      'bg-gray-100 text-gray-800'\n                    }`}>\n                      {tarea.estado}\n                    </span>\n                  </div>\n\n                  {/* Cliente */}\n                  {tarea.datos_formulario?.cliente && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Cliente:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.datos_formulario.cliente}</span>\n                    </div>\n                  )}\n\n                  {/* Departamento Solicitante */}\n                  {tarea.datos_formulario?.departamento_solicitante && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Departamento Solicitante:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.datos_formulario.departamento_solicitante}</span>\n                    </div>\n                  )}\n\n                  {/* Solicitud EPA */}\n                  {tarea.datos_formulario?.solicitud_epa && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Tipo de Solicitud:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.datos_formulario.solicitud_epa}</span>\n                    </div>\n                  )}\n\n                  {/* Solicitud COFERSA */}\n                  {tarea.datos_formulario?.solicitud_cofersa && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Tipo de Solicitud:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.datos_formulario.solicitud_cofersa}</span>\n                    </div>\n                  )}\n\n                  {/* Tipo de Trabajo */}\n                  {tarea.datos_formulario?.tipo_trabajo && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Tipo de Trabajo:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.datos_formulario.tipo_trabajo}</span>\n                    </div>\n                  )}\n\n                  {/* Cantidad de Etiquetas */}\n                  {tarea.cantidad_unidades && (\n                    <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Cantidad de Etiquetas:</span>\n                      <span className=\"text-sm text-gray-900\">{tarea.cantidad_unidades.toLocaleString()}</span>\n                    </div>\n                  )}\n\n                  {/* Personal a cargo */}\n                  <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                    <span className=\"text-sm font-semibold text-gray-700 w-48\">Personal a cargo:</span>\n                    <span className=\"text-sm text-gray-900\">\n                      {tarea.encargado_nombre || tarea.encargado_email || 'No especificado'}\n                    </span>\n                  </div>\n\n                  {/* Entregado a */}\n                  <div className=\"flex items-start border-b border-gray-200 pb-3\">\n                    <span className=\"text-sm font-semibold text-gray-700 w-48\">Entregado a:</span>\n                    <span className=\"text-sm text-gray-900\">\n                      {tarea.solicitante_nombre || tarea.email_solicitante || 'No especificado'}\n                    </span>\n                  </div>\n\n                  {/* Observaciones */}\n                  {tarea.datos_formulario?.observaciones && (\n                    <div className=\"flex items-start\">\n                      <span className=\"text-sm font-semibold text-gray-700 w-48\">Observaciones:</span>\n                      <span className=\"text-sm text-gray-900 flex-1\">{tarea.datos_formulario.observaciones}</span>\n                    </div>\n                  )}\n\n                  {/* Items de la tabla simple */}\n                  {tarea.datos_formulario?.items_tabla_simple && tarea.datos_formulario.items_tabla_simple.length > 0 && (\n                    <div className=\"mt-6\">\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <h4 className=\"text-sm font-semibold text-gray-700\">Detalle de Productos:</h4>\n                        {detalleProductosLargo && (\n                          <button\n                            type=\"button\"\n                            onClick={() => setDetalleProductosExpandido(!detalleProductosExpandido)}\n                            className=\"flex items-center gap-2 px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors cursor-pointer\"\n                          >\n                            <i className={`${detalleProductosExpandido ? 'ri-eye-off-line' : 'ri-eye-line'}`}></i>\n                            {detalleProductosExpandido ? 'Ocultar' : 'Ver todo'}\n                          </button>\n                        )}\n                      </div>\n                      <div className=\"overflow-x-auto\">\n                        <table className=\"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg\">\n                          <thead className=\"bg-gray-100\">\n                            <tr>\n                              <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                                C√≥digo\n                              </th>\n                              <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                                Cantidad\n                              </th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"bg-white divide-y divide-gray-200\">\n                            {(detalleProductosExpandido \n                              ? tarea.datos_formulario.items_tabla_simple \n                              : tarea.datos_formulario.items_tabla_simple.slice(0, 5)\n                            ).map((item: any, index: number) => (\n                              <tr key={index} className=\"hover:bg-gray-50\">\n                                <td className=\"px-4 py-2 text-sm text-gray-900\">{item.codigo}</td>\n                                <td className=\"px-4 py-2 text-sm text-gray-900\">{item.cantidad.toLocaleString()}</td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                        {!detalleProductosExpandido && tarea.datos_formulario.items_tabla_simple.length > 5 && (\n                          <div className=\"text-center py-2 text-xs text-gray-500 bg-gray-50 border-t border-gray-200\">\n                            Mostrando 5 de {tarea.datos_formulario.items_tabla_simple.length} productos\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Items de la tabla completa */}\n                  {tarea.datos_formulario?.items_tabla_completa && tarea.datos_formulario.items_tabla_completa.length > 0 && (\n                    <div className=\"mt-6\">\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <h4 className=\"text-sm font-semibold text-gray-700\">Detalle de Productos:</h4>\n                        {detalleProductosLargo && (\n                          <button\n                            type=\"button\"\n                            onClick={() => setDetalleProductosExpandido(!detalleProductosExpandido)}\n                            className=\"flex items-center gap-2 px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-colors cursor-pointer\"\n                          >\n                            <i className={`${detalleProductosExpandido ? 'ri-eye-off-line' : 'ri-eye-line'}`}></i>\n                            {detalleProductosExpandido ? 'Ocultar' : 'Ver todo'}\n                          </button>\n                        )}\n                      </div>\n                      <div className=\"overflow-x-auto\">\n                        <table className=\"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg\">\n                          <thead className=\"bg-gray-100\">\n                            <tr>\n                              <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                                Descripci√≥n\n                              </th>\n                              <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                                Cantidad\n                              </th>\n                              <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                                Motivo\n                              </th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"bg-white divide-y divide-gray-200\">\n                            {(detalleProductosExpandido \n                              ? tarea.datos_formulario.items_tabla_completa \n                              : tarea.datos_formulario.items_tabla_completa.slice(0, 5)\n                            ).map((item: any, index: number) => (\n                              <tr key={index} className=\"hover:bg-gray-50\">\n                                <td className=\"px-4 py-2 text-sm text-gray-900\">{item.descripcion}</td>\n                                <td className=\"px-4 py-2 text-sm text-gray-900\">{item.cantidad.toLocaleString()}</td>\n                                <td className=\"px-4 py-2 text-sm text-gray-900\">{item.motivo}</td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                        {!detalleProductosExpandido && tarea.datos_formulario.items_tabla_completa.length > 5 && (\n                          <div className=\"text-center py-2 text-xs text-gray-500 bg-gray-50 border-t border-gray-200\">\n                            Mostrando 5 de {tarea.datos_formulario.items_tabla_completa.length} productos\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Campos de procesamiento */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Fecha Estimada de Entrega\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={fechaEstimada}\n                    onChange={(e) => setFechaEstimada(e.target.value)}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Cantidad de Unidades\n                  </label>\n                  <input\n                    type=\"number\"\n                    value={cantidadUnidades}\n                    onChange={(e) => setCantidadUnidades(e.target.value)}\n                    min=\"0\"\n                    step=\"0.01\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Descripci√≥n Breve\n                  </label>\n                  <textarea\n                    value={descripcionBreve}\n                    onChange={(e) => setDescripcionBreve(e.target.value)}\n                    rows={2}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none\"\n                  />\n                </div>\n              </div>\n\n              {/* Campos de an√°lisis */}\n              <div className=\"border-t border-gray-200 pt-6\">\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">An√°lisis y Seguimiento</h3>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Cantidad de Personas\n                    </label>\n                    <div className=\"flex gap-2\">\n                      <div className=\"relative flex-1\">\n                        <input\n                          type=\"text\"\n                          value={`${cantidadPersonasCalculada} ${cantidadPersonasCalculada === 1 ? 'persona' : 'personas'}`}\n                          readOnly\n                          className=\"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed\"\n                        />\n                        <div className=\"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none\">\n                          <i className=\"ri-team-line text-gray-400 text-lg\"></i>\n                        </div>\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => setMostrarModalPersonal(true)}\n                        className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap flex items-center gap-2\"\n                      >\n                        <i className=\"ri-user-add-line\"></i>\n                        Asignar Personal\n                      </button>\n                    </div>\n                    <p className=\"mt-1 text-xs text-gray-500\">\n                      <i className=\"ri-information-line mr-1\"></i>\n                      Se calcula autom√°ticamente seg√∫n el personal asignado\n                    </p>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Estado\n                    </label>\n                    <select\n                      value={estado}\n                      onChange={(e) => setEstado(e.target.value as TareaEstado)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    >\n                      {ESTADOS.map(est => (\n                        <option key={est} value={est}>{est}</option>\n                      ))}\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Fecha de Inicio\n                    </label>\n                    <input\n                      type=\"date\"\n                      value={fechaInicio}\n                      onChange={(e) => setFechaInicio(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Fecha de Cierre\n                    </label>\n                    <input\n                      type=\"date\"\n                      value={fechaCierre}\n                      onChange={(e) => setFechaCierre(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n\n                  <div className=\"md:col-span-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Entregado A\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={entregadoA}\n                      onChange={(e) => setEntregadoA(e.target.value)}\n                      placeholder=\"Nombre de la persona que recibe\"\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Tab: Consumo e Inventario */}\n          {activeTab === 'consumo' && (\n            <div className=\"p-6 space-y-6\">\n              {/* Bot√≥n importar cotizaci√≥n */}\n              {tarea.cotizacion_id && (\n                <div className=\"flex justify-end\">\n                  <button\n                    type=\"button\"\n                    onClick={handleImportarCotizacion}\n                    className=\"px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 border border-blue-300 rounded-lg hover:bg-blue-200 transition-colors cursor-pointer whitespace-nowrap\"\n                  >\n                    <i className=\"ri-download-line mr-2\"></i>\n                    Importar desde Cotizaci√≥n Asociada\n                  </button>\n                </div>\n              )}\n\n              {/* Nuevo item con buscador */}\n              <div className=\"border border-gray-200 rounded-lg p-4\">\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Agregar Item</h3>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Tipo</label>\n                    <select\n                      value={nuevoItem.item_type}\n                      onChange={(e) => {\n                        const tipo = e.target.value as 'inventario' | 'producto' | 'cotizacion';\n                        setNuevoItem(prev => ({ \n                          ...prev, \n                          item_type: tipo,\n                          descripcion: '',\n                          costo_unitario: 0,\n                          producto_id: null,\n                          inventario_id: null\n                        }));\n                        setItemBusqueda('');\n                        setItemsOpciones([]);\n                        setMostrarItemsOpciones(false);\n                        setCotizacionesOpciones([]);\n                        setMostrarCotizacionesOpciones(false);\n                      }}\n                      className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                    >\n                      <option value=\"inventario\">Inventario</option>\n                      <option value=\"producto\">Productos</option>\n                      <option value=\"cotizacion\">Cotizaci√≥n</option>\n                    </select>\n                  </div>\n\n                  <div className=\"md:col-span-2 relative\">\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {nuevoItem.item_type === 'cotizacion' ? 'Buscar Cotizaci√≥n' : 'Descripci√≥n'}\n                      <span className=\"text-xs text-gray-500 ml-2\">\n                        {nuevoItem.item_type === 'cotizacion' \n                          ? '(Buscar por c√≥digo)' \n                          : nuevoItem.item_type === 'inventario' \n                          ? 'Buscar en inventario...' \n                          : 'Buscar en productos...'}\n                      </span>\n                    </label>\n                    \n                    <div className=\"relative\">\n                      <input\n                        type=\"text\"\n                        value={itemBusqueda}\n                        onChange={(e) => setItemBusqueda(e.target.value)}\n                        placeholder={\n                          nuevoItem.item_type === 'cotizacion' \n                            ? 'Buscar cotizaci√≥n...' \n                            : nuevoItem.item_type === 'inventario' \n                            ? 'Buscar en inventario...' \n                            : 'Buscar en productos...'\n                        }\n                        className=\"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm backdrop-blur-sm bg-white/90\"\n                      />\n                      {buscandoItems && (\n                        <div className=\"absolute right-3 top-1/2 -translate-y-1/2\">\n                          <i className=\"ri-loader-4-line animate-spin text-gray-400\"></i>\n                        </div>\n                      )}\n                      {itemBusqueda && !buscandoItems && (\n                        <button\n                          type=\"button\"\n                          onClick={limpiarBusqueda}\n                          className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 cursor-pointer\"\n                        >\n                          <i className=\"ri-close-line\"></i>\n                        </button>\n                      )}\n\n                      {/* ‚úÖ Dropdown de cotizaciones */}\n                      {mostrarCotizacionesOpciones && cotizacionesOpciones.length > 0 && (\n                        <div className=\"absolute z-50 w-full mt-1 bg-white/95 backdrop-blur-md border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                          {cotizacionesOpciones.map((cotizacion) => (\n                            <button\n                              key={cotizacion.id}\n                              type=\"button\"\n                              onClick={() => seleccionarCotizacion(cotizacion)}\n                              className=\"w-full px-3 py-2 text-left hover:bg-blue-50 border-b border-gray-100 last:border-b-0 transition-colors cursor-pointer\"\n                            >\n                              <div className=\"flex justify-between items-start\">\n                                <div className=\"flex-1\">\n                                  <div className=\"font-medium text-gray-900 text-sm\">{cotizacion.codigo}</div>\n                                  <div className=\"text-xs text-gray-600\">{cotizacion.cliente_nombre}</div>\n                                </div>\n                                <div className=\"text-sm font-semibold text-blue-600 ml-2\">\n                                  {formatCurrency(cotizacion.total)}\n                                </div>\n                              </div>\n                            </button>\n                          ))}\n                        </div>\n                      )}\n\n                      {/* ‚úÖ Dropdown de items (inventario/productos) */}\n                      {mostrarItemsOpciones && itemsOpciones.length > 0 && (\n                        <div className=\"absolute z-50 w-full mt-1 bg-white/95 backdrop-blur-md border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto\">\n                          {itemsOpciones.map((item) => (\n                            <button\n                              key={item.id}\n                              type=\"button\"\n                              onClick={() => seleccionarItem(item)}\n                              className=\"w-full px-3 py-2 text-left hover:bg-blue-50 border-b border-gray-100 last:border-b-0 transition-colors cursor-pointer\"\n                            >\n                              <div className=\"flex justify-between items-start\">\n                                <div className=\"flex-1\">\n                                  <div className=\"font-medium text-gray-900 text-sm\">{item.codigo}</div>\n                                  <div className=\"text-xs text-gray-600\">{item.nombre}</div>\n                                </div>\n                                <div className=\"text-sm font-semibold text-blue-600 ml-2\">\n                                  {formatCurrency(item.precio)}\n                                </div>\n                              </div>\n                            </button>\n                          ))}\n                        </div>\n                      )}\n\n                      {/* Mensaje cuando no hay resultados */}\n                      {itemBusqueda.length >= 2 && !buscandoItems && \n                       itemsOpciones.length === 0 && \n                       cotizacionesOpciones.length === 0 && (\n                        <div className=\"absolute z-50 w-full mt-1 bg-white/95 backdrop-blur-md border border-gray-300 rounded-lg shadow-lg p-3\">\n                          <div className=\"text-sm text-gray-500 text-center\">\n                            <i className=\"ri-search-line mr-1\"></i>\n                            No se encontraron resultados\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Cantidad</label>\n                    <input\n                      type=\"number\"\n                      value={nuevoItem.cantidad || ''}\n                      onChange={(e) => setNuevoItem(prev => ({ ...prev, cantidad: parseFloat(e.target.value) || 0 }))}\n                      min=\"0\"\n                      step=\"0.001\"\n                      placeholder=\"0\"\n                      disabled={nuevoItem.item_type === 'cotizacion'}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Costo Unit.</label>\n                    <input\n                      type=\"text\"\n                      value={formatCurrency(nuevoItem.costo_unitario)}\n                      readOnly\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 cursor-not-allowed\"\n                      title=\"El costo unitario se obtiene autom√°ticamente del registro seleccionado\"\n                    />\n                  </div>\n                </div>\n\n                {nuevoItem.item_type !== 'cotizacion' && (\n                  <div className=\"flex justify-between items-center mt-4\">\n                    <div className=\"text-sm text-gray-600\">\n                      <span className=\"font-medium\">Total:</span> {formatCurrency(nuevoItem.cantidad * nuevoItem.costo_unitario)}\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={handleAgregarItem}\n                      disabled={!nuevoItem.descripcion || nuevoItem.cantidad <= 0}\n                      className=\"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap\"\n                    >\n                      <i className=\"ri-add-line mr-2\"></i>\n                      Agregar\n                    </button>\n                  </div>\n                )}\n\n                {nuevoItem.item_type === 'cotizacion' && (\n                  <div className=\"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <i className=\"ri-information-line text-blue-600 mt-0.5\"></i>\n                      <div className=\"text-sm text-blue-800\">\n                        <p className=\"font-medium\">Importar desde Cotizaci√≥n</p>\n                        <p className=\"text-xs mt-1\">\n                          Busca una cotizaci√≥n y selecci√≥nala para importar autom√°ticamente todos sus componentes BOM.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Lista de items */}\n              <div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Items Consumidos</h3>\n                \n                {items.length === 0 ? (\n                  <div className=\"text-center text-gray-500 py-8 border border-gray-200 rounded-lg bg-gray-50\">\n                    <i className=\"ri-inbox-line text-4xl text-gray-300 mb-2\"></i>\n                    <p>No hay items agregados</p>\n                    <p className=\"text-xs mt-1\">Agregue items usando el formulario de arriba</p>\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto border border-gray-200 rounded-lg\">\n                    <table className=\"w-full\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">Tipo</th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">Descripci√≥n</th>\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider\">Cantidad</th>\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider\">Costo Unit.</th>\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider\">Total</th>\n                          <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider w-24\">Acci√≥n</th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {items.map((item, index) => (\n                          <tr key={item.id} className=\"hover:bg-gray-50\">\n                            <td className=\"px-4 py-3 text-sm text-gray-900 capitalize\">\n                              {item.item_type === 'inventario' ? 'Inventario' : 'Producto'}\n                            </td>\n                            <td className=\"px-4 py-3 text-sm text-gray-900\">{item.descripcion}</td>\n                            <td className=\"px-4 py-3 text-sm text-gray-900 text-right\">{item.cantidad.toLocaleString()}</td>\n                            <td className=\"px-4 py-3 text-sm text-gray-900 text-right\">\n                              {formatCurrency(item.costo_unitario)}\n                            </td>\n                            <td className=\"px-4 py-3 text-sm font-medium text-gray-900 text-right\">\n                              {formatCurrency(item.cantidad * item.costo_unitario)}\n                            </td>\n                            <td className=\"px-4 py-3 text-center\">\n                              <div className=\"flex items-center justify-center gap-2\">\n                                {/* ‚úÖ Bot√≥n de ojito para ver componentes BOM */}\n                                {item.item_type === 'producto' && item.producto_id && (\n                                  <button\n                                    type=\"button\"\n                                    onClick={() => verComponentesBOM(item)}\n                                    className=\"text-blue-600 hover:text-blue-800 transition-colors cursor-pointer p-1\"\n                                    title=\"Ver componentes BOM\"\n                                  >\n                                    <i className=\"ri-eye-line text-lg\"></i>\n                                  </button>\n                                )}\n                                <button\n                                  type=\"button\"\n                                  onClick={() => handleEliminarItem(index)}\n                                  className=\"text-red-600 hover:text-red-800 transition-colors cursor-pointer p-1\"\n                                  title=\"Eliminar item\"\n                                >\n                                  <i className=\"ri-delete-bin-line text-lg\"></i>\n                                </button>\n                              </div>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                      <tfoot className=\"bg-gray-50 border-t-2 border-gray-300\">\n                        <tr>\n                          <td colSpan={4} className=\"px-4 py-3 text-sm font-bold text-gray-900 text-right\">\n                            Total General:\n                          </td>\n                          <td className=\"px-4 py-3 text-sm font-bold text-blue-600 text-right\">\n                            {formatCurrency(calcularTotalCosto())}\n                          </td>\n                          <td></td>\n                        </tr>\n                      </tfoot>\n                    </table>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Tab: Personal Asignado */}\n          {activeTab === 'personal' && (\n            <div className=\"p-6\">\n              <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Asignar Personal</h3>\n              \n              {colaboradores.length === 0 ? (\n                <div className=\"text-center text-gray-500 py-8\">\n                  <i className=\"ri-team-line text-4xl text-gray-300 mb-2\"></i>\n                  <p>No hay colaboradores disponibles.</p>\n                  <p className=\"text-sm\">Configure colaboradores en el m√≥dulo de gesti√≥n.</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {colaboradores.map((colaborador) => (\n                    <label\n                      key={colaborador.id}\n                      className=\"flex items-start p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={personalSeleccionado.includes(colaborador.id)}\n                        onChange={(e) => handlePersonalChange(colaborador.id, e.target.checked)}\n                        className=\"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                      />\n                      <div className=\"ml-3 flex-1\">\n                        <div className=\"text-sm font-medium text-gray-900\">\n                          {colaborador.nombre}\n                        </div>\n                        {colaborador.email && (\n                          <div className=\"text-xs text-gray-500\">\n                            {colaborador.email}\n                          </div>\n                        )}\n                        {colaborador.telefono && (\n                          <div className=\"text-xs text-gray-500\">\n                            {colaborador.telefono}\n                          </div>\n                        )}\n                      </div>\n                    </label>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Footer con botones */}\n          <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50\">\n            <div className=\"text-sm text-gray-600\">\n              {activeTab === 'consumo' && (\n                <span>Total de costos: {formatCurrency(calcularTotalCosto())}</span>\n              )}\n              {activeTab === 'personal' && (\n                <span>{personalSeleccionado.length} colaborador{personalSeleccionado.length !== 1 ? 'es' : ''} seleccionado{personalSeleccionado.length !== 1 ? 's' : ''}</span>\n              )}\n            </div>\n            \n            <div className=\"flex gap-3\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer whitespace-nowrap\"\n              >\n                Cancelar\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap\"\n              >\n                {loading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <i className=\"ri-loader-4-line animate-spin\"></i>\n                    Guardando...\n                  </div>\n                ) : (\n                  'Guardar Cambios'\n                )}\n              </button>\n            </div>\n          </div>\n        </form>\n\n        {/* ‚úÖ Modal para ver componentes BOM */}\n        {mostrarModalBOM && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4\">\n            <div className=\"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n                <div>\n                  <h3 className=\"text-lg font-bold text-gray-900\">Componentes del Producto</h3>\n                  <p className=\"text-sm text-gray-500 mt-1\">{productoSeleccionadoBOM}</p>\n                </div>\n                <button\n                  onClick={() => setMostrarModalBOM(false)}\n                  type=\"button\"\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n                >\n                  <i className=\"ri-close-line text-xl\"></i>\n                </button>\n              </div>\n\n              {/* Contenido */}\n              <div className=\"flex-1 overflow-y-auto p-6\">\n                {cargandoBOM ? (\n                  <div className=\"flex items-center justify-center py-12\">\n                    <div className=\"text-center\">\n                      <i className=\"ri-loader-4-line animate-spin text-4xl text-blue-600 mb-4\"></i>\n                      <p className=\"text-gray-600\">Cargando componentes...</p>\n                    </div>\n                  </div>\n                ) : componentesBOM.length === 0 ? (\n                  <div className=\"text-center text-gray-500 py-12\">\n                    <i className=\"ri-inbox-line text-4xl text-gray-300 mb-2\"></i>\n                    <p>Este producto no tiene componentes BOM definidos</p>\n                  </div>\n                ) : (\n                  <div className=\"overflow-x-auto border border-gray-200 rounded-lg\">\n                    <table className=\"w-full\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                            C√≥digo\n                          </th>\n                          <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                            Descripci√≥n\n                          </th>\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                            Cant. x Unidad\n                          </th>\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider\">\n                            Cantidad Total\n                          </th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {componentesBOM.map((componente) => (\n                          <tr key={componente.id_componente} className=\"hover:bg-gray-50\">\n                            <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">\n                              {componente.codigo_articulo}\n                            </td>\n                            <td className=\"px-4 py-3 text-sm text-gray-900\">\n                              {componente.descripcion_articulo}\n                            </td>\n                            <td className=\"px-4 py-3 text-sm text-gray-900 text-right\">\n                              {componente.cantidad_x_unidad.toLocaleString()}\n                            </td>\n                            <td className=\"px-4 py-3 text-sm font-medium text-blue-600 text-right\">\n                              {componente.cantidad_total.toLocaleString()}\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                )}\n              </div>\n\n              {/* Footer */}\n              <div className=\"flex justify-end p-4 border-t border-gray-200 bg-gray-50\">\n                <button\n                  type=\"button\"\n                  onClick={() => setMostrarModalBOM(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap\"\n                >\n                  Cerrar\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Modal de Asignar Personal (igual que en TareaFormModal) */}\n        {mostrarModalPersonal && (\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4\">\n            <div className=\"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n                <div>\n                  <h3 className=\"text-lg font-bold text-gray-900\">Asignar Personal</h3>\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    Seleccione el personal que trabajar√° en esta tarea\n                  </p>\n                </div>\n                <button\n                  onClick={() => setMostrarModalPersonal(false)}\n                  type=\"button\"\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n                >\n                  <i className=\"ri-close-line text-xl\"></i>\n                </button>\n              </div>\n\n              {/* B√∫squeda */}\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"relative\">\n                  <input\n                    type=\"text\"\n                    value={busquedaColaborador}\n                    onChange={(e) => setBusquedaColaborador(e.target.value)}\n                    placeholder=\"Buscar por nombre o email...\"\n                    className=\"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                  <i className=\"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"></i>\n                </div>\n              </div>\n\n              {/* Personal Seleccionado */}\n              {colaboradoresSeleccionados.length > 0 && (\n                <div className=\"p-4 bg-blue-50 border-b border-blue-200\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <h4 className=\"text-sm font-semibold text-blue-900\">\n                      Personal Asignado ({colaboradoresSeleccionados.length})\n                    </h4>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {colaboradoresSeleccionados.map((colaborador) => (\n                      <div\n                        key={colaborador.id}\n                        className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-white border border-blue-300 rounded-lg text-sm\"\n                      >\n                        <i className=\"ri-user-line text-blue-600\"></i>\n                        <span className=\"text-gray-900\">{colaborador.nombre}</span>\n                        <button\n                          type=\"button\"\n                          onClick={() => eliminarPersonal(colaborador.id)}\n                          className=\"text-red-500 hover:text-red-700 cursor-pointer\"\n                        >\n                          <i className=\"ri-close-line\"></i>\n                        </button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Lista de Colaboradores Disponibles */}\n              <div className=\"flex-1 overflow-y-auto p-4\">\n                {colaboradoresFiltrados.length === 0 ? (\n                  <div className=\"text-center text-gray-500 py-8\">\n                    <i className=\"ri-user-search-line text-4xl text-gray-300 mb-2\"></i>\n                    <p>No se encontraron colaboradores</p>\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {colaboradoresFiltrados.map((colaborador) => {\n                      const estaAsignado = personalSeleccionado.includes(colaborador.id);\n                      return (\n                        <div\n                          key={colaborador.id}\n                          className={`p-4 border rounded-lg transition-all cursor-pointer ${\n                            estaAsignado\n                              ? 'border-blue-500 bg-blue-50'\n                              : 'border-gray-300 hover:border-blue-300 hover:bg-gray-50'\n                          }`}\n                          onClick={() => {\n                            if (estaAsignado) {\n                              eliminarPersonal(colaborador.id);\n                            } else {\n                              agregarPersonal(colaborador.id);\n                            }\n                          }}\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <h4 className=\"text-sm font-medium text-gray-900\">\n                                  {colaborador.nombre}\n                                </h4>\n                                {estaAsignado && (\n                                  <i className=\"ri-checkbox-circle-fill text-blue-600\"></i>\n                                )}\n                              </div>\n                              {colaborador.email && (\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  <i className=\"ri-mail-line mr-1\"></i>\n                                  {colaborador.email}\n                                </p>\n                              )}\n                              {colaborador.telefono && (\n                                <p className=\"text-xs text-gray-500 mt-1\">\n                                  <i className=\"ri-phone-line mr-1\"></i>\n                                  {colaborador.telefono}\n                                </p>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n\n              {/* Footer */}\n              <div className=\"flex justify-between items-center p-4 border-t border-gray-200 bg-gray-50\">\n                <div className=\"text-sm text-gray-600\">\n                  {colaboradoresSeleccionados.length} persona{colaboradoresSeleccionados.length !== 1 ? 's' : ''} seleccionada{colaboradoresSeleccionados.length !== 1 ? 's' : ''}\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={() => setMostrarModalPersonal(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer whitespace-nowrap\"\n                >\n                  Confirmar Selecci√≥n\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* ‚úÖ POPUPS DE NOTIFICACI√ìN Y CONFIRMACI√ìN */}\n        <NotificationPopup\n          isOpen={notification.isOpen}\n          type={notification.type}\n          message={notification.message}\n          onClose={hideNotification}\n        />\n\n        <ConfirmationDialog\n          isOpen={confirmation.isOpen}\n          type={confirmation.type}\n          title={confirmation.title}\n          message={confirmation.message}\n          onConfirm={confirmation.onConfirm}\n          onCancel={confirmation.onCancel}\n        />\n      </div>\n    </div>\n  );\n}","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { tareaService } from '../../../services/tareaService';\nimport type { TareaEncargado } from '../../../types/tarea';\n\ninterface ConfigEncargadosModalProps {\n  onClose: () => void;\n}\n\ninterface Usuario {\n  id: string;\n  email: string;\n  nombre?: string;\n}\n\nexport default function ConfigEncargadosModal({ onClose }: ConfigEncargadosModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [usuarios, setUsuarios] = useState<Usuario[]>([]);\n  const [encargados, setEncargados] = useState<TareaEncargado[]>([]);\n  const [selectedUsuarios, setSelectedUsuarios] = useState<string[]>([]);\n\n  useEffect(() => {\n    cargarDatos();\n  }, []);\n\n  const cargarDatos = async () => {\n    try {\n      setLoading(true);\n      \n      // Cargar usuarios de la tienda actual\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const { data: tiendaActual } = await supabase\n        .from('usuario_tienda_actual')\n        .select('tienda_id')\n        .eq('usuario_id', user.id)\n        .single();\n\n      if (!tiendaActual) return;\n\n      // Obtener usuarios de la tienda\n      const { data: usuariosData, error: usuariosError } = await supabase\n        .from('usuario_tiendas')\n        .select(`\n          usuario_id,\n          usuarios!inner(\n            id,\n            email\n          )\n        `)\n        .eq('tienda_id', tiendaActual.tienda_id);\n\n      if (usuariosError) throw usuariosError;\n\n      const usuariosList: Usuario[] = (usuariosData || []).map(ut => ({\n        id: ut.usuarios.id,\n        email: ut.usuarios.email\n      }));\n\n      setUsuarios(usuariosList);\n\n      // Cargar encargados actuales\n      const encargadosData = await tareaService.getEncargados();\n      setEncargados(encargadosData);\n      setSelectedUsuarios(encargadosData.map(e => e.usuario_id));\n\n    } catch (error) {\n      console.error('Error cargando datos:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleUsuarioChange = (usuarioId: string, selected: boolean) => {\n    if (selected) {\n      setSelectedUsuarios(prev => [...prev, usuarioId]);\n    } else {\n      setSelectedUsuarios(prev => prev.filter(id => id !== usuarioId));\n    }\n  };\n\n  const handleGuardar = async () => {\n    try {\n      setLoading(true);\n\n      // Obtener encargados actuales\n      const encargadosActuales = encargados.map(e => e.usuario_id);\n      \n      // Usuarios a agregar\n      const usuariosAgregar = selectedUsuarios.filter(id => !encargadosActuales.includes(id));\n      \n      // Usuarios a remover\n      const usuariosRemover = encargadosActuales.filter(id => !selectedUsuarios.includes(id));\n\n      // Agregar nuevos encargados\n      for (const usuarioId of usuariosAgregar) {\n        await tareaService.addEncargado(usuarioId);\n      }\n\n      // Remover encargados\n      for (const usuarioId of usuariosRemover) {\n        const encargado = encargados.find(e => e.usuario_id === usuarioId);\n        if (encargado) {\n          await tareaService.removeEncargado(encargado.id);\n        }\n      }\n\n      console.log('‚úÖ Configuraci√≥n de encargados actualizada');\n      onClose();\n    } catch (error) {\n      console.error('Error guardando encargados:', error);\n      alert('Error al guardar la configuraci√≥n: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Configurar Encargados</h2>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              Seleccione los usuarios que recibir√°n notificaciones de nuevas tareas\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <i className=\"ri-close-line text-xl\"></i>\n          </button>\n        </div>\n\n        {/* Contenido */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"flex items-center gap-2 text-gray-500\">\n                <i className=\"ri-loader-4-line animate-spin\"></i>\n                Cargando usuarios...\n              </div>\n            </div>\n          ) : usuarios.length === 0 ? (\n            <div className=\"text-center text-gray-500 py-8\">\n              <i className=\"ri-user-line text-4xl text-gray-300 mb-2\"></i>\n              <p>No hay usuarios en esta tienda</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              <div className=\"text-sm font-medium text-gray-700 mb-4\">\n                Usuarios de la tienda ({usuarios.length}):\n              </div>\n              \n              {usuarios.map((usuario) => (\n                <label\n                  key={usuario.id}\n                  className=\"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedUsuarios.includes(usuario.id)}\n                    onChange={(e) => handleUsuarioChange(usuario.id, e.target.checked)}\n                    className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                  />\n                  <div className=\"ml-3 flex-1\">\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {usuario.email}\n                    </div>\n                    {usuario.nombre && (\n                      <div className=\"text-xs text-gray-500\">\n                        {usuario.nombre}\n                      </div>\n                    )}\n                  </div>\n                  {encargados.some(e => e.usuario_id === usuario.id) && (\n                    <div className=\"text-xs text-green-600 bg-green-100 px-2 py-1 rounded\">\n                      Actual\n                    </div>\n                  )}\n                </label>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50\">\n          <div className=\"text-sm text-gray-600\">\n            {selectedUsuarios.length} encargado{selectedUsuarios.length !== 1 ? 's' : ''} seleccionado{selectedUsuarios.length !== 1 ? 's' : ''}\n          </div>\n          \n          <div className=\"flex gap-3\">\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer\"\n            >\n              Cancelar\n            </button>\n            <button\n              onClick={handleGuardar}\n              disabled={loading}\n              className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap\"\n            >\n              {loading ? (\n                <div className=\"flex items-center gap-2\">\n                  <i className=\"ri-loader-4-line animate-spin\"></i>\n                  Guardando...\n                </div>\n              ) : (\n                'Guardar Cambios'\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","import { useState, useEffect } from 'react';\nimport { tareaService } from '../../../services/tareaService';\nimport type { TareaColaborador } from '../../../types/tarea';\n\ninterface ColaboradoresModalProps {\n  onClose: () => void;\n}\n\nexport default function ColaboradoresModal({ onClose }: ColaboradoresModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [colaboradores, setColaboradores] = useState<TareaColaborador[]>([]);\n  const [showForm, setShowForm] = useState(false);\n  \n  // Form state\n  const [formData, setFormData] = useState({\n    nombre: '',\n    email: '',\n    telefono: ''\n  });\n\n  useEffect(() => {\n    cargarColaboradores();\n  }, []);\n\n  const cargarColaboradores = async () => {\n    try {\n      setLoading(true);\n      const data = await tareaService.getColaboradores();\n      setColaboradores(data);\n    } catch (error) {\n      console.error('Error cargando colaboradores:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.nombre.trim()) {\n      alert('El nombre es requerido');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      await tareaService.createColaborador(formData);\n      \n      // Limpiar formulario\n      setFormData({ nombre: '', email: '', telefono: '' });\n      setShowForm(false);\n      \n      // Recargar lista\n      await cargarColaboradores();\n      \n      console.log('‚úÖ Colaborador creado exitosamente');\n    } catch (error) {\n      console.error('Error creando colaborador:', error);\n      alert('Error al crear el colaborador: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900\">Gestionar Colaboradores</h2>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              Administre el personal que puede ser asignado a las tareas\n            </p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n          >\n            <i className=\"ri-close-line text-xl\"></i>\n          </button>\n        </div>\n\n        {/* Bot√≥n agregar */}\n        <div className=\"p-6 border-b border-gray-200\">\n          <button\n            onClick={() => setShowForm(!showForm)}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 cursor-pointer\"\n          >\n            <i className=\"ri-add-line\"></i>\n            Nuevo Colaborador\n          </button>\n        </div>\n\n        {/* Formulario para nuevo colaborador */}\n        {showForm && (\n          <div className=\"p-6 border-b border-gray-200 bg-gray-50\">\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Nombre *\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={formData.nombre}\n                    onChange={(e) => setFormData(prev => ({ ...prev, nombre: e.target.value }))}\n                    placeholder=\"Nombre completo\"\n                    required\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Email\n                  </label>\n                  <input\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                    placeholder=\"correo@ejemplo.com\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tel√©fono\n                  </label>\n                  <input\n                    type=\"tel\"\n                    value={formData.telefono}\n                    onChange={(e) => setFormData(prev => ({ ...prev, telefono: e.target.value }))}\n                    placeholder=\"8888-8888\"\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowForm(false)}\n                  className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer\"\n                >\n                  Cancelar\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={loading}\n                  className=\"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors cursor-pointer whitespace-nowrap\"\n                >\n                  {loading ? (\n                    <div className=\"flex items-center gap-2\">\n                      <i className=\"ri-loader-4-line animate-spin\"></i>\n                      Creando...\n                    </div>\n                  ) : (\n                    'Crear Colaborador'\n                  )}\n                </button>\n              </div>\n            </form>\n          </div>\n        )}\n\n        {/* Lista de colaboradores */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {loading && colaboradores.length === 0 ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"flex items-center gap-2 text-gray-500\">\n                <i className=\"ri-loader-4-line animate-spin\"></i>\n                Cargando colaboradores...\n              </div>\n            </div>\n          ) : colaboradores.length === 0 ? (\n            <div className=\"text-center text-gray-500 py-8\">\n              <i className=\"ri-team-line text-4xl text-gray-300 mb-2\"></i>\n              <p>No hay colaboradores registrados</p>\n              <p className=\"text-sm\">Agregue el primer colaborador usando el bot√≥n de arriba</p>\n            </div>\n          ) : (\n            <div className=\"divide-y divide-gray-200\">\n              {colaboradores.map((colaborador) => (\n                <div key={colaborador.id} className=\"p-4 hover:bg-gray-50\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h3 className=\"text-sm font-medium text-gray-900\">\n                          {colaborador.nombre}\n                        </h3>\n                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${\n                          colaborador.activo \n                            ? 'bg-green-100 text-green-800' \n                            : 'bg-red-100 text-red-800'\n                        }`}>\n                          {colaborador.activo ? 'Activo' : 'Inactivo'}\n                        </span>\n                      </div>\n                      \n                      <div className=\"mt-1 space-y-1\">\n                        {colaborador.email && (\n                          <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                            <i className=\"ri-mail-line\"></i>\n                            {colaborador.email}\n                          </div>\n                        )}\n                        {colaborador.telefono && (\n                          <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                            <i className=\"ri-phone-line\"></i>\n                            {colaborador.telefono}\n                          </div>\n                        )}\n                      </div>\n                      \n                      <div className=\"mt-1 text-xs text-gray-400\">\n                        Creado: {new Date(colaborador.created_at).toLocaleDateString()}\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2 ml-4\">\n                      {/* Aqu√≠ se podr√≠an agregar botones para editar/desactivar */}\n                      <button\n                        className=\"text-gray-400 hover:text-gray-600 transition-colors cursor-pointer\"\n                        title=\"Editar colaborador\"\n                      >\n                        <i className=\"ri-edit-line\"></i>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50\">\n          <div className=\"text-sm text-gray-600\">\n            {colaboradores.length} colaborador{colaboradores.length !== 1 ? 'es' : ''} registrado{colaboradores.length !== 1 ? 's' : ''}\n          </div>\n          \n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer\"\n          >\n            Cerrar\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Sidebar from '../../components/feature/Sidebar';\nimport TopBar from '../../components/feature/TopBar';\nimport TareasLayout from './components/TareasLayout';\nimport TareasDeadline from './components/TareasDeadline';\nimport TareaFormModal from './components/TareaFormModal';\nimport TareaProcesarModal from './components/TareaProcesarModal';\nimport ConfigEncargadosModal from './components/ConfigEncargadosModal';\nimport ColaboradoresModal from './components/ColaboradoresModal';\nimport { tareaService } from '../../services/tareaService';\nimport type { Tarea, TareaFilters, TareaStats } from '../../types/tarea';\nimport { useAuth } from '../../hooks/useAuth';\n\nexport default function TareasPage() {\n  const navigate = useNavigate();\n  const { hasPermission } = useAuth();\n  \n  // Estados principales\n  const [tareas, setTareas] = useState<Tarea[]>([]);\n  const [stats, setStats] = useState<TareaStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  \n  // Estados de modales\n  const [showFormModal, setShowFormModal] = useState(false);\n  const [showProcesarModal, setShowProcesarModal] = useState(false);\n  const [showEncargadosModal, setShowEncargadosModal] = useState(false);\n  const [showColaboradoresModal, setShowColaboradoresModal] = useState(false);\n  const [selectedTarea, setSelectedTarea] = useState<Tarea | null>(null);\n  \n  // Filtros\n  const [filtros, setFiltros] = useState<TareaFilters>({\n    estado: '',\n    fecha_desde: '',\n    fecha_hasta: '',\n    busqueda: ''\n  });\n\n  // Cargar datos al montar\n  useEffect(() => {\n    cargarDatos();\n  }, [filtros]);\n\n  const cargarDatos = async () => {\n    try {\n      setLoading(true);\n      \n      // Aplicar filtro por defecto: excluir Finalizado\n      const filtrosAplicados = { ...filtros };\n      if (!filtrosAplicados.estado) {\n        // Si no hay filtro de estado, excluir Finalizado\n      }\n      \n      const [tareasData, statsData] = await Promise.all([\n        tareaService.getTareas(filtrosAplicados),\n        tareaService.getStats()\n      ]);\n      \n      // Filtrar Finalizado por defecto si no hay filtro espec√≠fico\n      let tareasFiltradas = tareasData;\n      if (!filtros.estado) {\n        tareasFiltradas = tareasData.filter(t => t.estado !== 'Finalizado');\n      }\n      \n      setTareas(tareasFiltradas);\n      setStats(statsData);\n    } catch (error) {\n      console.error('Error cargando tareas:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Handlers\n  const handleNuevaTarea = () => {\n    setSelectedTarea(null);\n    setShowFormModal(true);\n  };\n\n  const handleProcesarTarea = (tarea: Tarea) => {\n    setSelectedTarea(tarea);\n    setShowProcesarModal(true);\n  };\n\n  const handleSaveTarea = async () => {\n    setShowFormModal(false);\n    setShowProcesarModal(false);\n    await cargarDatos();\n  };\n\n  const handleFiltroChange = (nuevosFiltros: TareaFilters) => {\n    setFiltros(nuevosFiltros);\n  };\n\n  const handleExportar = async () => {\n    try {\n      // Obtener todas las tareas sin filtro de estado\n      const todasTareas = await tareaService.getTareas({});\n      \n      // Crear CSV\n      const headers = [\n        'Consecutivo',\n        'Estado',\n        'Fecha Creaci√≥n',\n        'Fecha Estimada',\n        'Solicitante',\n        'Descripci√≥n',\n        'Cantidad Unidades',\n        'Cantidad Personas',\n        'Fecha Inicio',\n        'Fecha Cierre',\n        'Entregado A',\n        'Total Costo'\n      ];\n      \n      const rows = todasTareas.map(t => [\n        t.consecutivo,\n        t.estado,\n        new Date(t.created_at).toLocaleDateString(),\n        t.fecha_estimada_entrega || '',\n        t.email_solicitante,\n        t.descripcion_breve || '',\n        t.cantidad_unidades || '',\n        t.cantidad_personas || '',\n        t.fecha_inicio ? new Date(t.fecha_inicio).toLocaleDateString() : '',\n        t.fecha_cierre ? new Date(t.fecha_cierre).toLocaleDateString() : '',\n        t.entregado_a || '',\n        t.total_costo || 0\n      ]);\n      \n      const csvContent = [\n        headers.join(','),\n        ...rows.map(row => row.map(cell => `\"${cell}\"`).join(','))\n      ].join('\\n');\n      \n      // Descargar archivo\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      link.href = URL.createObjectURL(blob);\n      link.download = `tareas_${new Date().toISOString().split('T')[0]}.csv`;\n      link.click();\n      \n      console.log('‚úÖ Exportaci√≥n completada');\n    } catch (error) {\n      console.error('Error exportando:', error);\n      alert('Error al exportar datos');\n    }\n  };\n\n  const handleEliminarTarea = async (tarea: Tarea) => {\n    if (!window.confirm(`¬øEst√° seguro que desea eliminar la tarea \"${tarea.nombre_tarea}\"?\\n\\nEsta acci√≥n no se puede deshacer.`)) {\n      return;\n    }\n\n    try {\n      await tareaService.deleteTarea(tarea.id);\n      alert('Tarea eliminada exitosamente');\n      cargarTareas();\n    } catch (error) {\n      console.error('Error eliminando tarea:', error);\n      alert('Error al eliminar la tarea: ' + (error as Error).message);\n    }\n  };\n\n  return (\n    <div className=\"flex h-screen bg-gray-50\">\n      {/* Sidebar */}\n      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n      \n      {/* Contenido principal */}\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* TopBar */}\n        <TopBar onMenuClick={() => setSidebarOpen(true)} />\n        \n        {/* Layout de Tareas */}\n        <TareasLayout\n          stats={stats}\n          onNuevaTarea={handleNuevaTarea}\n          onConfigEncargados={() => setShowEncargadosModal(true)}\n          onConfigColaboradores={() => setShowColaboradoresModal(true)}\n          onExportar={handleExportar}\n          canCreate={hasPermission('tareas:create')}\n          canManage={hasPermission('tareas:manage')}\n        >\n          {/* Vista Deadline */}\n          <TareasDeadline\n            tareas={tareas}\n            loading={loading}\n            filtros={filtros}\n            onFiltroChange={handleFiltroChange}\n            onProcesar={handleProcesarTarea}\n            onRefresh={cargarDatos}\n          />\n        </TareasLayout>\n      </div>\n      \n      {/* Modal: Nueva Tarea */}\n      {showFormModal && (\n        <TareaFormModal\n          onClose={() => setShowFormModal(false)}\n          onSave={handleSaveTarea}\n        />\n      )}\n      \n      {/* Modal: Procesar Tarea */}\n      {showProcesarModal && selectedTarea && (\n        <TareaProcesarModal\n          tarea={selectedTarea}\n          onClose={() => setShowProcesarModal(false)}\n          onSave={handleSaveTarea}\n        />\n      )}\n      \n      {/* Modal: Configurar Encargados */}\n      {showEncargadosModal && (\n        <ConfigEncargadosModal\n          onClose={() => setShowEncargadosModal(false)}\n        />\n      )}\n      \n      {/* Modal: Gestionar Colaboradores */}\n      {showColaboradoresModal && (\n        <ColaboradoresModal\n          onClose={() => setShowColaboradoresModal(false)}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["TareasLayout","children","stats","onNuevaTarea","onConfigEncargados","onConfigColaboradores","onExportar","canCreate","canManage","jsxs","jsx","ESTADOS","getEstadoColor","estado","TareasDeadline","tareas","loading","filtros","onFiltroChange","onProcesar","onRefresh","busqueda","setBusqueda","useState","handleBusquedaChange","value","handleEstadoChange","e","tarea","TareaService","filters","user","supabase","tiendaActual","query","data","error","id","tiendaData","tareaError","tareaAnterior","estadoAnterior","totalCosto","sum","item","items","itemsError","asignaciones","colaboradorId","asignacionError","t","usuarioId","encargadoId","tareaId","estadoNuevo","session","response","cotizacionId","tareaService","TareaFormModal","onClose","onSave","setLoading","usuarioActual","setUsuarioActual","hasPermission","usePermissions","cotizacionBusqueda","setCotizacionBusqueda","cotizacionSeleccionada","setCotizacionSeleccionada","cotizacionesOpciones","setCotizacionesOpciones","mostrarOpciones","setMostrarOpciones","buscandoCotizaciones","setBuscandoCotizaciones","departamento","setDepartamento","cliente","setCliente","solicitudEPA","setSolicitudEPA","solicitudCOFERSA","setSolicitudCOFERSA","tipoTrabajo","setTipoTrabajo","itemsTablaSimple","setItemsTablaSimple","itemsTablaCompleta","setItemsTablaCompleta","personalAsignado","setPersonalAsignado","mostrarModalPersonal","setMostrarModalPersonal","colaboradoresDisponibles","setColaboradoresDisponibles","busquedaColaborador","setBusquedaColaborador","archivoExcel","setArchivoExcel","fechaEstimada","setFechaEstimada","descripcionBreve","setDescripcionBreve","fechaMinima","useEffect","cargarUsuarioActual","cargarColaboradores","timer","buscarCotizaciones","termino","queryPorCodigo","queryPorCliente","resultadoCodigo","resultadoCliente","resultadosCombinados","idsUnicos","resultadosUnicos","cot","opciones","seleccionarCotizacion","cotizacion","cotizacionItems","todosLosComponentes","bomItems","bomError","bomItem","cantidadTotal","costoUnitario","existente","comp","itemsSimples","itemsCompletos","limpiarCotizacion","abrirCotizacion","agregarFilaSimple","eliminarFilaSimple","index","_","i","actualizarFilaSimple","campo","valor","nuevosItems","agregarFilaCompleta","eliminarFilaCompleta","actualizarFilaCompleta","handleArchivoExcel","file","workbook","XLSX.read","worksheet","jsonData","XLSX.utils","primeraFila","row","descargarPlantillaExcel","esTablaSimple","mostrarTablaSimple","esTablaCompleta","mostrarTablaCompleta","nombreArchivo","datosPlantilla","XLSX.writeFile","handleSubmit","datosFormulario","cantidadTotalEntero","descripcionBreveFinal","tareaData","c","agregarPersonal","eliminarPersonal","colaboradoresFiltrados","colaboradoresSeleccionados","Fragment","colaborador","estaAsignado","TareaProcesarModal","useAuth","notification","showNotification","hideNotification","confirmation","useNotification","activeTab","setActiveTab","cantidadUnidades","setCantidadUnidades","fechaInicio","setFechaInicio","fechaCierre","setFechaCierre","entregadoA","setEntregadoA","setEstado","setItems","colaboradores","setColaboradores","personalSeleccionado","setPersonalSeleccionado","p","detalleProductosExpandido","setDetalleProductosExpandido","mostrarModalBOM","setMostrarModalBOM","componentesBOM","setComponentesBOM","cargandoBOM","setCargandoBOM","productoSeleccionadoBOM","setProductoSeleccionadoBOM","nuevoItem","setNuevoItem","itemBusqueda","setItemBusqueda","itemsOpciones","setItemsOpciones","mostrarItemsOpciones","setMostrarItemsOpciones","buscandoItems","setBuscandoItems","mostrarCotizacionesOpciones","setMostrarCotizacionesOpciones","MIN_CHARS","DEBOUNCE_MS","itemsCotizacion","errorItems","componentesMap","errorBom","articuloId","existing","formatCurrency","tieneCliente","opcion","colaboradoresData","verComponentesBOM","componentes","seleccionarItem","prev","updated","limpiarBusqueda","handleAgregarItem","handleEliminarItem","handleImportarCotizacion","handlePersonalChange","selected","calcularTotalCosto","total","updateData","cantidadPersonasCalculada","detalleProductosLargo","est","tipo","componente","NotificationPopup","ConfirmationDialog","ConfigEncargadosModal","usuarios","setUsuarios","encargados","setEncargados","selectedUsuarios","setSelectedUsuarios","cargarDatos","usuariosData","usuariosError","usuariosList","ut","encargadosData","handleUsuarioChange","handleGuardar","encargadosActuales","usuariosAgregar","usuariosRemover","encargado","usuario","ColaboradoresModal","showForm","setShowForm","formData","setFormData","TareasPage","useNavigate","setTareas","setStats","sidebarOpen","setSidebarOpen","showFormModal","setShowFormModal","showProcesarModal","setShowProcesarModal","showEncargadosModal","setShowEncargadosModal","showColaboradoresModal","setShowColaboradoresModal","selectedTarea","setSelectedTarea","setFiltros","filtrosAplicados","tareasData","statsData","tareasFiltradas","handleNuevaTarea","handleProcesarTarea","handleSaveTarea","handleFiltroChange","nuevosFiltros","handleExportar","todasTareas","headers","rows","csvContent","cell","blob","link","Sidebar","TopBar"],"mappings":"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"}