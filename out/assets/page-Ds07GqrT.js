import{u as H,r as c,j as e,s as M,b as J,C as I,a as W}from"./index-Bb3NupjY.js";import{p as O}from"./pedidoService-D09prSNX.js";import{S as q,T as L}from"./TopBar-BP5RF_Jd.js";import{f as T}from"./currency-BmxXlzML.js";import{C as K}from"./cotizacionService-lDCdb4M8.js";import{B as Q}from"./BuscarClienteModal-D46sr1Ai.js";import"./clienteService-DoS4zFTf.js";const G={borrador:{label:"Borrador",color:"bg-gray-100 text-gray-800"},confirmado:{label:"Confirmado",color:"bg-blue-100 text-blue-800"},facturado:{label:"Facturado",color:"bg-green-100 text-green-800"},cancelado:{label:"Cancelado",color:"bg-red-100 text-red-800"},vencido:{label:"Vencido",color:"bg-orange-100 text-orange-800"}};function Y({pedidos:o,loading:E,onEdit:s,onConfirmar:n,onCancelar:p,onFacturar:f}){const j=H(),[m,h]=c.useState(!1),[a,x]=c.useState(""),[b,S]=c.useState(!1),D=async i=>{if(i.estado==="facturado"&&i.factura_id)try{S(!0);const{data:N,error:P}=await M.from("facturas_electronicas").select("id, consecutivo, clave, estado_local, estado_hacienda").eq("id",i.factura_id).single();if(P){console.error("Error obteniendo factura:",P),x("Error al verificar el estado de la factura. Por favor intente nuevamente."),h(!0),S(!1);return}if(!N){x("No se encontrÃ³ la factura asociada a este pedido."),h(!0),S(!1);return}["aceptado","aceptada","aprobado","aprobada"].includes(N.estado_hacienda?.toLowerCase()||"")?j(`/facturacion/${i.factura_id}/print`):(x(`Por favor revisar el estatus de la factura. Se puede imprimir una vez sea aprobada por Hacienda.

Estado actual: ${N.estado_hacienda||N.estado_local||"Pendiente"}
Consecutivo: ${N.consecutivo||"N/A"}`),h(!0)),S(!1)}catch(N){console.error("Error verificando factura:",N),x("Error al verificar el estado de la factura. Por favor intente nuevamente."),h(!0),S(!1)}else j(`/pedidos/${i.id}/print`)},l=i=>{window.confirm("Â¿EstÃ¡s seguro de que deseas eliminar este pedido?")&&console.log("Eliminar pedido:",i)};return E?e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((i,N)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},N))})}):o.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("i",{className:"ri-file-list-3-line text-4xl mb-4"}),e.jsx("p",{children:"No hay pedidos registrados"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pedido"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:i.codigo}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.cliente?.nombre_razon_social||i.cliente?.nombre||"Sin cliente"}),e.jsx("div",{className:"text-sm text-gray-500",children:i.cliente?.identificacion||"Sin identificaciÃ³n"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${G[i.estado].color}`,children:G[i.estado].label})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:T(i.total,i.moneda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(i.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[(i.estado==="borrador"||i.estado==="confirmado")&&e.jsx("button",{onClick:()=>s(i),className:"text-blue-600 hover:text-blue-900 p-2 rounded hover:bg-blue-50 transition-colors cursor-pointer",title:"Editar pedido",children:e.jsx("i",{className:"ri-edit-line text-lg"})}),e.jsx("button",{onClick:()=>D(i),disabled:b,className:`p-2 rounded transition-colors cursor-pointer ${b?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,title:i.estado==="facturado"?"Imprimir factura":"Imprimir pedido",children:b?e.jsx("i",{className:"ri-loader-4-line text-lg animate-spin"}):e.jsx("i",{className:"ri-printer-line text-lg"})}),i.estado==="borrador"&&e.jsx("button",{onClick:()=>n(i.id),className:"text-green-600 hover:text-green-900 p-2 rounded hover:bg-green-50 transition-colors cursor-pointer",title:"Confirmar pedido",children:e.jsx("i",{className:"ri-check-line text-lg"})}),i.estado==="confirmado"&&e.jsx("button",{onClick:()=>f(i),className:"text-emerald-600 hover:text-emerald-900 p-2 rounded hover:bg-emerald-50 transition-colors cursor-pointer",title:"Facturar pedido",children:e.jsx("i",{className:"ri-bill-line text-lg"})}),(i.estado==="borrador"||i.estado==="confirmado")&&e.jsx("button",{onClick:()=>p(i.id),className:"text-orange-600 hover:text-orange-900 p-2 rounded hover:bg-orange-50 transition-colors cursor-pointer",title:"Cancelar pedido",children:e.jsx("i",{className:"ri-close-line text-lg"})}),(i.estado==="borrador"||i.estado==="cancelado")&&e.jsx("button",{onClick:()=>l(i.id),className:"text-red-600 hover:text-red-900 p-2 rounded hover:bg-red-50 transition-colors cursor-pointer",title:"Eliminar pedido",children:e.jsx("i",{className:"ri-delete-bin-line text-lg"})})]})})]},i.id))})]})})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"flex items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("i",{className:"ri-error-warning-line text-2xl text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Factura Pendiente de AprobaciÃ³n"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:a})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors cursor-pointer whitespace-nowrap",children:"Entendido"})})]})})]})}function X({filters:o,onFiltersChange:E}){const[s,n]=c.useState([]),[p,f]=c.useState(!1);c.useEffect(()=>{j()},[]);const j=async()=>{f(!0);try{const{data:a,error:x}=await M.from("clientes").select("id, nombre_razon_social").order("nombre_razon_social");if(x)throw x;n(a||[])}catch(a){console.error("Error al cargar clientes:",a)}finally{f(!1)}},m=(a,x)=>{const b={...o,[a]:x||void 0};E(b)},h=()=>{E({})};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o.search||"",onChange:a=>m("search",a.target.value),placeholder:"CÃ³digo, notas...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),e.jsxs("select",{value:o.cliente_id||"",onChange:a=>m("cliente_id",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p,children:[e.jsx("option",{value:"",children:"Todos los clientes"}),s.map(a=>e.jsx("option",{value:a.id,children:a.nombre_razon_social},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:o.estado||"",onChange:a=>m("estado",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"confirmado",children:"Confirmado"}),e.jsx("option",{value:"facturado",children:"Facturado"}),e.jsx("option",{value:"cancelado",children:"Cancelado"}),e.jsx("option",{value:"vencido",children:"Vencido"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha desde"}),e.jsx("input",{type:"date",value:o.fecha_desde||"",onChange:a=>m("fecha_desde",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha hasta"}),e.jsx("input",{type:"date",value:o.fecha_hasta||"",onChange:a=>m("fecha_hasta",a.target.value),min:o.fecha_desde||void 0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:h,className:"text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("i",{className:"ri-close-line"}),"Limpiar filtros"]})})]})}function Z({onSelect:o,onClose:E}){const[s,n]=c.useState([]),[p,f]=c.useState(!0),[j,m]=c.useState(""),[h,a]=c.useState(""),[x,b]=c.useState([]);c.useEffect(()=>{S(),D()},[]),c.useEffect(()=>{D()},[j,h]);const S=async()=>{try{const{data:l,error:i}=await M.from("categorias").select("id, nombre").order("nombre");if(i)throw i;b(l||[])}catch(l){console.error("Error cargando categorÃ­as:",l)}},D=async()=>{try{f(!0);let l=M.from("productos").select("id_producto, codigo_producto, descripcion_producto, categoria_id, costo_total_bom").eq("activo",!0);j.trim()&&(l=l.or(`codigo_producto.ilike.%${j}%,descripcion_producto.ilike.%${j}%`)),h&&(l=l.eq("categoria_id",h));const{data:i,error:N}=await l.limit(50);if(N)throw N;n(i||[])}catch(l){console.error("Error cargando productos:",l)}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Buscar Producto"}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-xl"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar por cÃ³digo o nombre"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:j,onChange:l=>m(l.target.value),placeholder:"Escriba para buscar...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),e.jsx("i",{className:"ri-search-line absolute left-3 top-2.5 text-gray-400 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CategorÃ­a"}),e.jsxs("select",{value:h,onChange:l=>a(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm pr-8",children:[e.jsx("option",{value:"",children:"Todas las categorÃ­as"}),x.map(l=>e.jsx("option",{value:l.id,children:l.nombre},l.id))]})]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden max-h-96 overflow-y-auto",children:p?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando productos..."})]}):s.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("i",{className:"ri-inbox-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay productos"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron productos con los criterios de bÃºsqueda."})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"CÃ³digo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"DescripciÃ³n"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"AcciÃ³n"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:l.codigo_producto}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:l.descripcion_producto}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:["$",(l.costo_total_bom||0).toLocaleString("es-CR",{minimumFractionDigits:2})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>o(l),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 cursor-pointer whitespace-nowrap",children:"Seleccionar"})})]},l.id_producto))})]})})]})]})})}function ee({pedido:o,onSave:E,onCancel:s}){const[n,p]=c.useState({cliente_id:0,moneda:"CRC",tipo_cambio:520,notas:"",items:[]}),[f,j]=c.useState(null),[m,h]=c.useState(!1),[a,x]=c.useState(!1),[b,S]=c.useState(!1),[D,l]=c.useState(!1),[i,N]=c.useState("Tipo de cambio segÃºn Banco Central de Costa Rica (BCCR). Haga clic en actualizar para obtener el valor mÃ¡s reciente."),[P,z]=c.useState({subtotal:0,descuento_total:0,impuesto_total:0,total:0});c.useEffect(()=>{if($(),o){const t=(o.items||[]).map(r=>({item_type:r.item_type||"producto",item_id:r.item_id||0,codigo_articulo:r.codigo_articulo||"",descripcion:r.descripcion||"Sin descripciÃ³n",unidad:r.unidad||"UND",cantidad:r.cantidad||1,precio_unitario:r.precio_unit||r.precio_unitario||0,descuento_porcentaje:r.descuento_pct||r.descuento_porcentaje||0,descuento_monto:0,impuesto_porcentaje:r.impuesto_pct||r.impuesto_porcentaje||13,impuesto_monto:0,subtotal_linea:r.total||r.total_linea||0,total_linea:r.total||r.total_linea||0,meta_json:r.meta_json}));p({cliente_id:o.cliente_id,moneda:o.moneda,tipo_cambio:o.tipo_cambio,notas:o.notas||"",items:t}),j(o.cliente)}},[o]),c.useEffect(()=>{A()},[n.items]);const $=async()=>{try{l(!0);const t=await K.obtenerTipoCambioBCCR();p(r=>({...r,tipo_cambio:t})),N(`ðŸ’° Tipo de cambio actualizado segÃºn BCCR: â‚¡${t.toFixed(2)} por USD`)}catch(t){console.error("Error obteniendo tipo de cambio:",t),N("âŒ Error al obtener tipo de cambio del BCCR. Usando valor por defecto.")}finally{l(!1)}},A=()=>{let t=0,r=0,d=0;n.items.forEach(_=>{const C=_.cantidad*_.precio_unitario,u=C*(_.descuento_porcentaje/100),V=(C-u)*(_.impuesto_porcentaje/100);t+=C,r+=u,d+=V});const w=t-r+d;z({subtotal:t,descuento_total:r,impuesto_total:d,total:w})},R=t=>{j(t),p(r=>({...r,cliente_id:t.id})),h(!1)},U=async t=>{try{console.log("Producto seleccionado:",t);let r=[];if(t.tipo==="producto"||t.id_producto){const{data:w,error:_}=await M.from("bom_items").select(`
            *,
            articulo:inventario(codigo, descripcion, unidad, precio_venta)
          `).eq("producto_id",t.id_producto||t.id);!_&&w&&(r=w.map(C=>({id:C.articulo_id,codigo:C.articulo.codigo,descripcion:C.articulo.descripcion,cantidad_por_unidad:C.cantidad,cantidad_total:C.cantidad*1,unidad:C.articulo.unidad,precio_unitario:C.articulo.precio_venta||0,total:(C.articulo.precio_venta||0)*C.cantidad})))}const d={item_type:t.tipo==="producto"||t.id_producto?"producto":"inventario",item_id:t.id_producto||t.id,codigo_articulo:t.codigo_producto||t.codigo||"",descripcion:t.descripcion_producto||t.descripcion||t.nombre||"Sin descripciÃ³n",unidad:t.unidad||"UND",cantidad:1,precio_unitario:t.costo_total_bom||t.precio_venta||0,descuento_porcentaje:0,descuento_monto:0,impuesto_porcentaje:13,impuesto_monto:0,subtotal_linea:t.costo_total_bom||t.precio_venta||0,total_linea:(t.costo_total_bom||t.precio_venta||0)*1.13,meta_json:r.length>0?{bom_items:r}:void 0};console.log("Nuevo item creado:",d),p(w=>({...w,items:[...w.items,d]}))}catch(r){console.error("Error al agregar producto:",r),alert("Error al agregar producto: "+r.message)}x(!1)},F=(t,r,d)=>{const w=[...n.items];w[t]={...w[t],[r]:d};const _=w[t],C=_.cantidad*_.precio_unitario,u=C*(_.descuento_porcentaje/100),g=C-u,V=g*(_.impuesto_porcentaje/100);if(w[t].subtotal_linea=C,w[t].descuento_monto=u,w[t].impuesto_monto=V,w[t].total_linea=g+V,r==="cantidad"&&_.meta_json?.bom_items){const B=_.meta_json.bom_items.map(k=>({...k,cantidad_total:k.cantidad_por_unidad*_.cantidad,total:k.precio_unitario*k.cantidad_por_unidad*_.cantidad}));w[t].meta_json={bom_items:B}}p(B=>({...B,items:w}))},v=t=>{p(r=>({...r,items:r.items.filter((d,w)=>w!==t)}))},y=async t=>{if(t.preventDefault(),!n.cliente_id){alert("Debe seleccionar un cliente");return}if(n.items.length===0){alert("Debe agregar al menos un artÃ­culo");return}S(!0);try{const r={cliente_id:n.cliente_id,moneda:n.moneda,tipo_cambio:n.tipo_cambio,notas:n.notas,subtotal:P.subtotal,descuento_total:P.descuento_total,impuesto_total:P.impuesto_total,total:P.total,items:n.items.map(d=>({item_type:d.item_type,item_id:d.item_id,descripcion:d.descripcion||"Sin descripciÃ³n",unidad:d.unidad||"UND",cantidad:d.cantidad||1,precio_unit:d.precio_unitario||0,descuento_pct:d.descuento_porcentaje||0,impuesto_pct:d.impuesto_porcentaje||0,total:d.total_linea||0,meta_json:d.meta_json}))};o?await O.updatePedido(o.id,r):await O.createPedido(r),E()}catch(r){console.error("Error al guardar pedido:",r),alert("Error al guardar pedido: "+r.message)}finally{S(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:o?`Editar Pedido ${o.codigo}`:"Nuevo Pedido"}),o&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Estado: ",e.jsx("span",{className:"font-medium",children:o.estado})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{type:"submit",form:"pedido-form",disabled:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 whitespace-nowrap",children:b?"Guardando...":"Guardar"})]})]}),e.jsxs("form",{id:"pedido-form",onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliente *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50",children:f?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:f.nombre_razon_social}),e.jsx("div",{className:"text-sm text-gray-500",children:f.identificacion})]}):e.jsx("span",{className:"text-gray-500",children:"Seleccionar cliente"})}),e.jsx("button",{type:"button",onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:e.jsx("i",{className:"ri-search-line"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Moneda"}),e.jsxs("select",{value:n.moneda,onChange:t=>p(r=>({...r,moneda:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CRC",children:"Colones (CRC)"}),e.jsx("option",{value:"USD",children:"DÃ³lares (USD)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Cambio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:n.tipo_cambio,onChange:t=>p(r=>({...r,tipo_cambio:parseFloat(t.target.value)||1})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"520.00"}),e.jsx("button",{type:"button",onClick:$,disabled:D,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:D?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsx("i",{className:"ri-refresh-line"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas"}),e.jsx("textarea",{value:n.notas,onChange:t=>p(r=>({...r,notas:t.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Notas adicionales del pedido..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Items del Pedido"}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line"}),"Agregar Item"]})]}),n.items.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("i",{className:"ri-shopping-cart-line text-4xl mb-2"}),e.jsx("p",{children:"No hay items agregados"})]}):e.jsx("div",{className:"space-y-4",children:n.items.map((t,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-4 items-start",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"DescripciÃ³n"}),e.jsx("div",{className:"text-sm font-medium",children:t.descripcion||"Sin descripciÃ³n"}),e.jsx("div",{className:"text-xs text-gray-500",children:t.codigo_articulo||"Sin cÃ³digo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.001",value:t.cantidad,onChange:d=>F(r,"cantidad",parseFloat(d.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Precio Unit."}),e.jsx("input",{type:"number",step:"0.01",value:t.precio_unitario,onChange:d=>F(r,"precio_unitario",parseFloat(d.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Desc. %"}),e.jsx("input",{type:"number",step:"0.01",value:t.descuento_porcentaje,onChange:d=>F(r,"descuento_porcentaje",parseFloat(d.target.value)||0),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Total"}),e.jsx("div",{className:"text-sm font-medium",children:T(t.total_linea,n.moneda)})]}),e.jsx("button",{type:"button",onClick:()=>v(r),className:"text-red-600 hover:text-red-800 p-1",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]}),t.meta_json?.bom_items&&t.meta_json.bom_items.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Ãtems utilizados:"}),e.jsxs("div",{className:"bg-blue-50 rounded p-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-2 text-xs font-medium text-gray-600 mb-2",children:[e.jsx("div",{children:"CÃ³digo"}),e.jsx("div",{children:"DescripciÃ³n"}),e.jsx("div",{children:"Cant. x Unidad"}),e.jsx("div",{children:"Cant. Total"}),e.jsx("div",{children:"Total"})]}),t.meta_json.bom_items.map((d,w)=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-2 text-xs text-gray-700 py-1",children:[e.jsx("div",{children:d.codigo}),e.jsx("div",{children:d.descripcion}),e.jsxs("div",{children:[d.cantidad_por_unidad," ",d.unidad]}),e.jsxs("div",{children:[d.cantidad_total," ",d.unidad]}),e.jsx("div",{children:T(d.total,n.moneda)})]},w))]})]})]},r))})]}),n.items.length>0&&e.jsx("div",{className:"border-t pt-6",children:e.jsxs("div",{className:"max-w-md ml-auto space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:T(P.subtotal,n.moneda)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Descuento:"}),e.jsxs("span",{children:["-",T(P.descuento_total,n.moneda)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Impuesto:"}),e.jsx("span",{children:T(P.impuesto_total,n.moneda)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold border-t pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:T(P.total,n.moneda)})]})]})})]})]})}),m&&e.jsx(Q,{onSelect:R,onClose:()=>h(!1)}),a&&e.jsx(Z,{onSelect:U,onClose:()=>x(!1)})]})}function se({isOpen:o,onClose:E,pedido:s,onSuccess:n}){const[p,f]=c.useState(!1),[j,m]=c.useState(!1),[h,a]=c.useState(!1),[x,b]=c.useState(!1),[S,D]=c.useState([]),[l,i]=c.useState(""),[N,P]=c.useState("");J();const z=()=>{const v=[];return s||v.push("No se ha seleccionado un pedido"),s?.cliente_id||v.push("El pedido debe tener un cliente asignado"),(s?.items||s?.pedido_items||[]).length===0&&v.push("El pedido debe tener al menos un item"),(!s?.total||s.total<=0)&&v.push("El pedido debe tener un total vÃ¡lido"),s?.estado!=="confirmado"&&v.push("Solo se pueden facturar pedidos confirmados"),v},$=async()=>{const v=z();if(v.length>0){D(v),m(!0);return}f(!0);try{console.log("ðŸ“¤ Emitiendo factura para pedido:",s.id);const y=s.items||s.pedido_items||[],t=crypto.randomUUID();console.log("ðŸ” Correlation ID:",t);const r="https://xmdjzqpmmmcqnsinrdou.supabase.co",d="sb_publishable_lys-jD8YwH-yK3BgM_j_GQ_GFw_Qt2Y",{data:{session:w}}=await M.auth.getSession(),_=await fetch(`${r}/functions/v1/facturar-pedido`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w?.access_token||d}`,apikey:d,"x-correlation-id":t},body:JSON.stringify({pedido_id:s.id,tipo_documento:"01",condicion_venta:"01",medio_pago:"01",moneda:"CRC",tipo_cambio:1,observaciones:null,items:y.map(g=>({item_type:g.item_type||"producto",item_id:g.item_id,descripcion:g.descripcion,unidad:g.unidad||"UND",cantidad:g.cantidad,precio_unitario:g.precio_unit||g.precio_unitario,descuento_porcentaje:g.descuento_pct||g.descuento_porcentaje||0,impuesto_porcentaje:g.impuesto_pct||g.impuesto_porcentaje||13,total:g.total}))})});console.log("ðŸ“¡ Response status:",_.status),console.log("ðŸ“¡ Response ok:",_.ok);const C=await _.text();console.log("ðŸ“„ Response body:",C);let u;try{u=JSON.parse(C)}catch(g){console.error("âŒ Error parseando respuesta:",g),P(`âŒ Error al procesar respuesta del servidor:

${C}

ID de seguimiento: ${t}`),b(!0);return}if(console.log("ðŸ“¥ Respuesta parseada:",u),!_.ok){console.error("âŒ Error HTTP:",_.status,u);let g="";u.code&&(g=`CÃ³digo: ${u.code}
`),u.message?g+=u.message:g+="Error desconocido",u.pgError&&(g+=`

Error de base de datos:
`,g+=`â€¢ CÃ³digo: ${u.pgError.code||"N/A"}
`,g+=`â€¢ Mensaje: ${u.pgError.message||"N/A"}
`,u.pgError.details&&(g+=`â€¢ Detalles: ${u.pgError.details}
`),u.pgError.hint&&(g+=`â€¢ Sugerencia: ${u.pgError.hint}
`)),u.stage&&(g+=`

Etapa: ${u.stage}`),g+=`

ID de seguimiento: ${u.correlationId||t}`,P(`âŒ Error al emitir factura:

${g}`),b(!0);return}if(u&&u.success)i(`âœ… Factura ${u.consecutivo} creada exitosamente

Estado: ${u.estado}
Clave: ${u.clave}

ID: ${u.factura_id}`),a(!0);else if(u&&u.ok===!1){const g=u.message||"Error desconocido",V=u.code||"UNKNOWN",B=u.correlationId||t;let k=`CÃ³digo: ${V}
${g}`;u.pgError&&(k+=`

Error de base de datos:
${JSON.stringify(u.pgError,null,2)}`),k+=`

ID de seguimiento: ${B}`,P(`âŒ Error al emitir factura:

${k}`),b(!0)}else P(`âŒ Respuesta inesperada del servidor:

${JSON.stringify(u,null,2)}

ID de seguimiento: ${t}`),b(!0)}catch(y){console.error("ðŸ’¥ Error inesperado emitiendo factura:",y);let t="Error inesperado al emitir factura";y instanceof Error?(t+=`:

${y.message}`,y.stack&&console.error("Stack trace:",y.stack)):t+=`:

${String(y)}`,P(t),b(!0)}finally{f(!1)}},A=()=>{a(!1),n(),E()},R=()=>{b(!1)};if(!o)return null;const U=s?.cliente?.nombre_razon_social||s?.cliente?.nombre||"Sin nombre",F=s?.items||s?.pedido_items||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Emitir Factura ElectrÃ³nica"}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600",disabled:p,children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-600 mb-2",children:["Â¿Deseas emitir una factura electrÃ³nica para el pedido #",s?.codigo,"?"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Cliente:"})," ",U]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," â‚¡",s?.total?.toLocaleString()||"0"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Items:"})," ",F.length]})]})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:E,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap",disabled:p,children:"Cancelar"}),e.jsx("button",{onClick:$,disabled:p,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 cursor-pointer whitespace-nowrap",children:p?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-bill-line mr-2"}),"Emitir Factura"]})})]})]})})}),e.jsx(I,{isOpen:j,onClose:()=>m(!1),onConfirm:()=>m(!1),title:"Errores de ValidaciÃ³n",message:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-600 mb-3",children:"Se encontraron los siguientes errores:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-red-600",children:S.map((v,y)=>e.jsx("li",{children:v},y))})]}),type:"error",confirmText:"Entendido",showCancel:!1}),e.jsx(I,{isOpen:h,onClose:A,onConfirm:A,title:"Factura Emitida Exitosamente",message:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mx-auto mb-4",children:e.jsx("i",{className:"ri-check-line text-2xl text-green-600"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:l})})]}),type:"success",confirmText:"Continuar",showCancel:!1}),e.jsx(I,{isOpen:x,onClose:R,onConfirm:R,title:"Error al Emitir Factura",message:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mx-auto mb-4",children:e.jsx("i",{className:"ri-close-line text-2xl text-red-600"})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600 whitespace-pre-line text-left",children:N})})]}),type:"error",confirmText:"Cerrar",showCancel:!1})]})}const ae=()=>{const{user:o,hasPermission:E}=W(),s=(a,x={})=>{const{resourceOwnerId:b,strict:S=!1}=x;if(!o)return!1;if(E(a))return!0;if(a.includes(":own")&&b)return o.id===b;if(a.includes(":own")){const i=a.replace(":own","");if(E(i))return!0}if(S)return!1;const[D,l]=a.split(":");return!!(E(`${D}:admin`)||o.rol==="Admin")},n=(a,x)=>s(`${a}:view`,{resourceOwnerId:x})||s(`${a}:view:own`,{resourceOwnerId:x}),p=a=>s(`${a}:create`),f=(a,x)=>s(`${a}:edit`,{resourceOwnerId:x})||s(`${a}:edit:own`,{resourceOwnerId:x}),j=(a,x)=>s(`${a}:delete`,{resourceOwnerId:x})||s(`${a}:delete:own`,{resourceOwnerId:x});return{checkPermission:s,canView:n,canCreate:p,canEdit:f,canDelete:j,canPerformAction:(a,x,b)=>s(`${a}:${x}`,{resourceOwnerId:b}),permissions:{clientes:{canView:a=>n("clientes",a),canCreate:()=>p("clientes"),canEdit:a=>f("clientes",a),canDelete:a=>j("clientes",a),canImport:()=>s("clientes:import"),canExport:()=>s("clientes:export"),canAssign:()=>s("clientes:assign")},cotizaciones:{canView:a=>n("cotizaciones",a),canCreate:()=>p("cotizaciones"),canEdit:a=>f("cotizaciones",a),canDelete:a=>j("cotizaciones",a),canApprove:()=>s("cotizaciones:approve"),canReject:()=>s("cotizaciones:reject"),canConvert:()=>s("cotizaciones:convert"),canDuplicate:()=>s("cotizaciones:duplicate"),canExport:()=>s("cotizaciones:export"),canPrint:()=>s("cotizaciones:print")},pedidos:{canView:a=>n("pedidos",a),canCreate:()=>p("pedidos"),canEdit:a=>f("pedidos",a),canDelete:a=>j("pedidos",a),canConfirm:()=>s("pedidos:confirm"),canCancel:()=>s("pedidos:cancel"),canInvoice:()=>s("pedidos:invoice"),canPrint:()=>s("pedidos:print")},inventario:{canView:()=>s("inventario:view"),canCreate:()=>p("inventario"),canEdit:()=>f("inventario"),canDelete:()=>j("inventario"),canAdjust:()=>s("inventario:adjust"),canTransfer:()=>s("inventario:transfer"),canImport:()=>s("inventario:import"),canExport:()=>s("inventario:export"),canManageCategories:()=>s("inventario:categories"),canManageThresholds:()=>s("inventario:thresholds")},productos:{canView:()=>s("productos:view"),canCreate:()=>p("productos"),canEdit:()=>f("productos"),canDelete:()=>j("productos"),canManageBOM:()=>s("productos:bom"),canManagePricing:()=>s("productos:pricing"),canExport:()=>s("productos:export")},facturas:{canView:a=>n("facturas",a),canCreate:()=>p("facturas"),canEdit:a=>f("facturas",a),canDelete:a=>j("facturas",a),canSend:()=>s("facturas:send"),canCancel:()=>s("facturas:cancel"),canPrint:()=>s("facturas:print"),canExport:()=>s("facturas:export"),canConfig:()=>s("facturas:config")},mantenimiento:{canView:()=>s("mantenimiento:view"),canViewAlerts:()=>s("mantenimiento:alerts"),canManageThresholds:()=>s("mantenimiento:thresholds"),canManageReplenishment:()=>s("mantenimiento:replenishment"),canViewPredictions:()=>s("mantenimiento:predictions"),canConfig:()=>s("mantenimiento:config")},seguridad:{canView:()=>s("seguridad:view"),canViewUsers:()=>s("seguridad:users:view"),canCreateUsers:()=>s("seguridad:users:create"),canEditUsers:()=>s("seguridad:users:edit"),canDeleteUsers:()=>s("seguridad:users:delete"),canActivateUsers:()=>s("seguridad:users:activate"),canViewRoles:()=>s("seguridad:roles:view"),canCreateRoles:()=>s("seguridad:roles:create"),canEditRoles:()=>s("seguridad:roles:edit"),canDeleteRoles:()=>s("seguridad:roles:delete"),canViewPermissions:()=>s("seguridad:permissions:view"),canCreatePermissions:()=>s("seguridad:permissions:create"),canEditPermissions:()=>s("seguridad:permissions:edit"),canDeletePermissions:()=>s("seguridad:permissions:delete"),canAssignPermissions:()=>s("seguridad:permissions:assign")},dashboard:{canView:()=>s("dashboard:view"),canViewStats:()=>s("dashboard:stats"),canViewCharts:()=>s("dashboard:charts"),canExport:()=>s("dashboard:export")},perfil:{canView:()=>s("perfil:view"),canEdit:()=>s("perfil:edit"),canChangePassword:()=>s("perfil:password")}}}},te=()=>{const{permissions:o,profile:E}=W();console.log("[DEBUG PERMISOS] ðŸ” useRobustPermissions - permisos finales:",o),console.log("[DEBUG PERMISOS] ðŸ” useRobustPermissions - total permisos:",o.length);const s=m=>{if(!m||o.includes(m))return!0;const h=`${m}:own`;return!!o.includes(h)},n=m=>{const h=`${m}:view`,a=`${m}:view:own`;return o.includes(h)||o.includes(a)},p=m=>{const h=`${m}:create`,a=`${m}:create:own`,x=`${m}:edit`,b=`${m}:edit:own`;return o.includes(h)||o.includes(a)||o.includes(x)||o.includes(b)},f=m=>{const h=`${m}:delete`,a=`${m}:delete:own`;return o.includes(h)||o.includes(a)},j=E?.rol==="Admin";return{permissions:o,hasPermission:s,canRead:n,canWrite:p,canDelete:f,isAdmin:j}};function ue(){const[o,E]=c.useState([]),[s,n]=c.useState(!0),[p,f]=c.useState(!1),[j,m]=c.useState(null),[h,a]=c.useState(!1),[x,b]=c.useState(null),[S,D]=c.useState(!1),[l,i]=c.useState({estado:"",cliente_id:null,fecha_desde:"",fecha_hasta:""});ae(),te(),c.useEffect(()=>{N()},[l]);const N=async()=>{n(!0);try{const v=await O.getPedidos(l);E(v)}catch(v){console.error("Error cargando pedidos:",v)}finally{n(!1)}},P=()=>{m(null),f(!0)},z=v=>{m(v),f(!0)},$=async()=>{f(!1),m(null),await N()},A=async v=>{if(confirm("Â¿EstÃ¡ seguro de confirmar este pedido? Esto crearÃ¡ reservas de inventario."))try{const{data:{user:y}}=await M.auth.getUser();if(!y){alert("Error: Usuario no autenticado");return}await O.confirmarPedido(v,y.id),alert("Pedido confirmado exitosamente"),await N()}catch(y){console.error("Error confirmando pedido:",y),alert("Error al confirmar pedido: "+(y instanceof Error?y.message:"Error desconocido"))}},R=async v=>{if(confirm("Â¿EstÃ¡ seguro de cancelar este pedido? Esto liberarÃ¡ las reservas de inventario."))try{await O.cancelarPedido(v),alert("Pedido cancelado exitosamente"),await N()}catch(y){console.error("Error cancelando pedido:",y),alert("Error al cancelar pedido: "+(y instanceof Error?y.message:"Error desconocido"))}},U=v=>{if(v.estado!=="confirmado"){alert("Solo se pueden facturar pedidos confirmados");return}b(v),a(!0)},F=async()=>{a(!1),b(null),await N()};return p?e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(q,{isOpen:S,onClose:()=>D(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{onMenuClick:()=>D(!S)}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(ee,{pedido:j,onSave:$,onCancel:()=>{f(!1),m(null)}})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[e.jsx(q,{isOpen:S,onClose:()=>D(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(L,{onMenuClick:()=>D(!S)}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"GestiÃ³n de Pedidos"}),e.jsxs("button",{onClick:P,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nuevo Pedido"]})]}),e.jsx(X,{filters:l,onFiltersChange:i}),e.jsx(Y,{pedidos:o,loading:s,onEdit:z,onConfirmar:A,onCancelar:R,onFacturar:U})]})})})]})]}),h&&x&&e.jsx(se,{pedido:x,isOpen:h,onClose:()=>{a(!1),b(null)},onSuccess:F})]})}export{ue as default};
//# sourceMappingURL=page-Ds07GqrT.js.map
