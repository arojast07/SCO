import{r as n,j as e,s as R,u as ie,C as le}from"./index-Bb3NupjY.js";import{S as ce,T as de}from"./TopBar-BP5RF_Jd.js";import{M as ue}from"./MobileNav-Dp72TdL_.js";import{a as K,f as me}from"./currency-BmxXlzML.js";import{C as te}from"./cotizacionService-lDCdb4M8.js";import{C as xe}from"./clienteService-DoS4zFTf.js";function pe({children:d}){const[T,D]=n.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(ce,{isOpen:T,onClose:()=>D(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(de,{onMenuClick:()=>D(!0)}),e.jsx("main",{className:"flex-1 p-4 lg:p-6 pb-20 lg:pb-6 overflow-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:d})})]}),e.jsx(ue,{})]})}function ge({cotizacion:d,onSubmit:T,onCancel:D,isOpen:O}){const[i,v]=n.useState({cliente_id:"",estado:"borrador",fecha_emision:new Date().toISOString().split("T")[0],fecha_vencimiento:"",moneda:"CRC",tipo_cambio:520,descuento_global:0,descuento_valor:0,impuestos:0,flete:0,otros:0,subtotal:0,total:0,items:[]}),[X,L]=n.useState([]),[y,h]=n.useState([]),[p,_]=n.useState(""),[j,I]=n.useState(!1),[B,M]=n.useState(null),[$,N]=n.useState([]),[G,w]=n.useState([]),[Y,q]=n.useState(""),[ee,F]=n.useState(!1),[a,E]=n.useState(!1),[Z,Q]=n.useState(!1),[r,c]=n.useState("Tipo de cambio seg√∫n Banco Central de Costa Rica (BCCR). Haga clic en actualizar para obtener el valor m√°s reciente.");n.useEffect(()=>{if(O){u(),b(),s();const t=new Date;t.setDate(t.getDate()+15),d?(console.log("Cargando cotizaci√≥n para editar:",d),S(d)):v(o=>({...o,fecha_vencimiento:t.toISOString().split("T")[0]}))}},[d,O]);const S=async t=>{try{console.log("Datos de cotizaci√≥n recibidos:",t),v({cliente_id:t.cliente_id?.toString()||"",estado:t.estado||"borrador",fecha_emision:t.fecha_emision||new Date().toISOString().split("T")[0],fecha_vencimiento:t.fecha_vencimiento||"",moneda:t.moneda||"CRC",tipo_cambio:t.tipo_cambio||520,descuento_global:t.descuento_global||0,descuento_valor:t.descuento_valor||0,impuestos:t.impuestos||0,flete:t.flete||0,otros:t.otros||0,subtotal:t.subtotal||0,total:t.total||0,items:[]}),t.clientes&&(M(t.clientes),_(t.clientes.nombre_razon_social)),t.id&&await C(t.id)}catch(o){console.error("Error cargando datos de cotizaci√≥n:",o)}},C=async t=>{try{console.log("Cargando items de cotizaci√≥n:",t);const{data:o,error:m}=await R.from("cotizacion_items").select("*").eq("cotizacion_id",t);if(m){console.error("Error cargando items:",m);return}if(console.log("Items cargados:",o),o&&o.length>0){const l=[...new Set(o.map(g=>g.producto_id))].filter(g=>g);let z=[];if(l.length>0){const{data:g,error:W}=await R.from("productos").select("id_producto, codigo_producto, descripcion_producto, costo_total_bom").in("id_producto",l);!W&&g&&(z=g)}const H=o.map(g=>{const W=z.find(se=>se.id_producto===g.producto_id);return{producto_id:g.producto_id,cantidad:g.cantidad||1,precio_unitario:g.precio_unitario||0,descuento:g.descuento||0,subtotal:g.subtotal||g.total_linea||0,producto_info:W||{codigo_producto:"N/A",descripcion_producto:g.descripcion||`Producto ID: ${g.producto_id}`,costo_total_bom:g.precio_unitario||0}}});console.log("Items formateados:",H),v(g=>({...g,items:H})),k(H)}}catch(o){console.error("Error cargando items de cotizaci√≥n:",o)}},u=async()=>{try{const{data:t,error:o}=await R.from("clientes").select("id, nombre_razon_social, identificacion, correo_principal").order("nombre_razon_social");if(o)throw o;L(t||[])}catch(t){console.error("Error cargando clientes:",t)}},b=async()=>{try{const{data:t,error:o}=await R.from("productos").select("id_producto, codigo_producto, descripcion_producto, costo_total_bom").order("descripcion_producto");if(o)throw o;N(t||[])}catch(t){console.error("Error cargando productos:",t)}},s=async()=>{try{Q(!0);const t=await te.obtenerTipoCambioBCCR();v(o=>({...o,tipo_cambio:t})),c(`üí∞ Tipo de cambio actualizado seg√∫n BCCR: ‚Ç°${K(t)} por USD`)}catch(t){console.error("Error obteniendo tipo de cambio:",t),c("‚ùå Error al obtener tipo de cambio del BCCR. Usando valor por defecto.")}finally{Q(!1)}},x=t=>{if(_(t),t.length===0){h([]),I(!1),M(null),v(m=>({...m,cliente_id:""}));return}const o=X.filter(m=>m.nombre_razon_social.toLowerCase().includes(t.toLowerCase())||m.identificacion.includes(t));h(o),I(o.length>0)},f=t=>{M(t),_(t.nombre_razon_social),I(!1),v(o=>({...o,cliente_id:t.id.toString()}))},U=t=>{if(q(t),t.length===0){w([]),F(!1);return}const o=$.filter(m=>m.descripcion_producto.toLowerCase().includes(t.toLowerCase())||m.codigo_producto.toLowerCase().includes(t.toLowerCase()));w(o),F(o.length>0)},J=t=>{const o={producto_id:t.id_producto,cantidad:1,precio_unitario:t.costo_total_bom||0,descuento:0,subtotal:t.costo_total_bom||0},m=[...i.items,o];v(l=>({...l,items:m})),q(""),F(!1),k(m)},V=(t,o,m)=>{const l=[...i.items];if(l[t]={...l[t],[o]:m},o==="cantidad"||o==="precio_unitario"||o==="descuento"){const z=l[t],H=z.cantidad*z.precio_unitario,g=H*(z.descuento/100);z.subtotal=H-g}v(z=>({...z,items:l})),k(l)},A=t=>{const o=i.items.filter((m,l)=>l!==t);v(m=>({...m,items:o})),k(o)},k=t=>{const o=t.reduce((g,W)=>g+(W.subtotal||0),0),m=o*(i.descuento_global/100),l=o-m,z=l*.13,H=l+z+i.flete+i.otros;v(g=>({...g,subtotal:o,descuento_valor:m,impuestos:z,total:H}))},P=(t,o)=>{v(m=>{const l={...m,[t]:o};if(["descuento_global","flete","otros"].includes(t)){const z=l.items.reduce((ae,ne)=>ae+(ne.subtotal||0),0),H=z*(l.descuento_global/100),g=z-H,W=g*.13,se=g+W+l.flete+l.otros;return{...l,subtotal:z,descuento_valor:H,impuestos:W,total:se}}return l})},re=async t=>{if(t.preventDefault(),!i.cliente_id){alert("Por favor seleccione un cliente");return}if(i.items.length===0){alert("Por favor agregue al menos un producto");return}E(!0);try{await T(i)}catch(o){console.error("Error guardando cotizaci√≥n:",o)}finally{E(!1)}},oe=t=>{const o=$.find(l=>l.id_producto===t);if(o)return o;const m=i.items.find(l=>l.producto_id===t);if(m&&m.producto_info){const l=m.producto_info;return{id_producto:t,codigo_producto:l.codigo_producto,descripcion_producto:l.descripcion_producto,costo_total_bom:l.costo_total_bom}}return null};return O?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:[d?"Editar Cotizaci√≥n":"Nueva Cotizaci√≥n",d&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",d.codigo,")"]})]}),e.jsx("button",{onClick:D,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliente *"}),e.jsx("input",{type:"text",value:p,onChange:t=>x(t.target.value),placeholder:"Buscar cliente por nombre o identificaci√≥n...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),j&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:y.map(t=>e.jsxs("div",{onClick:()=>f(t),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.nombre_razon_social}),e.jsx("div",{className:"text-sm text-gray-500",children:t.identificacion})]},t.id))}),B&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-sm",children:[e.jsx("i",{className:"ri-check-line text-green-600 mr-1"}),"Cliente seleccionado: ",e.jsx("strong",{children:B.nombre_razon_social})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado"}),e.jsxs("select",{value:i.estado,onChange:t=>P("estado",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"enviada",children:"Enviada"}),e.jsx("option",{value:"aceptada",children:"Aceptada"}),e.jsx("option",{value:"rechazada",children:"Rechazada"}),e.jsx("option",{value:"vencida",children:"Vencida"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Emisi√≥n"}),e.jsx("input",{type:"date",value:i.fecha_emision,onChange:t=>P("fecha_emision",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Vencimiento"}),e.jsx("input",{type:"date",value:i.fecha_vencimiento,onChange:t=>P("fecha_vencimiento",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Sugerencia: ",new Date(Date.now()+360*60*60*1e3).toLocaleDateString("es-ES")," (15 d√≠as desde hoy)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Moneda"}),e.jsxs("select",{value:i.moneda,onChange:t=>P("moneda",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"CRC",children:"Colones (CRC)"}),e.jsx("option",{value:"USD",children:"D√≥lares (USD)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Cambio"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:i.tipo_cambio,onChange:t=>v(o=>({...o,tipo_cambio:parseFloat(t.target.value)||0})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"520.00"}),e.jsx("button",{type:"button",onClick:s,disabled:Z,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:Z?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsx("i",{className:"ri-refresh-line"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Y,onChange:t=>U(t.target.value),placeholder:"Buscar producto por c√≥digo o nombre...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),ee&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:G.map(t=>e.jsxs("div",{onClick:()=>J(t),className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.descripcion_producto}),e.jsxs("div",{className:"text-sm text-gray-500",children:["C√≥digo: ",t.codigo_producto," | Precio: ‚Ç°",K(t.costo_total_bom)]})]},t.id_producto))})]})]}),i.items.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Productos Agregados (",i.items.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio Unit."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descuento %"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.items.map((t,o)=>{const m=oe(t.producto_id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:m?.descripcion_producto||"Producto no encontrado"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["C√≥digo: ",m?.codigo_producto||"N/A"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.cantidad,onChange:l=>V(o,"cantidad",parseInt(l.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.precio_unitario,onChange:l=>V(o,"precio_unitario",parseFloat(l.target.value)||0),className:"w-28 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"number",value:t.descuento,onChange:l=>V(o,"descuento",parseFloat(l.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100",step:"0.01"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["‚Ç°",K(t.subtotal||0)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{type:"button",onClick:()=>A(o),className:"text-red-600 hover:text-red-900 cursor-pointer p-1 hover:bg-red-50 rounded",title:"Eliminar producto",children:e.jsx("i",{className:"ri-delete-bin-line"})})})]},o)})})]})})]}),i.items.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 bg-gray-50 rounded-lg",children:[e.jsx("i",{className:"ri-shopping-cart-line text-4xl mb-2"}),e.jsx("p",{className:"font-medium",children:"No hay productos agregados"}),e.jsx("p",{className:"text-sm",children:"Use la barra de b√∫squeda para agregar productos"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descuento Global (%)"}),e.jsx("input",{type:"number",value:i.descuento_global,onChange:t=>P("descuento_global",parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0",max:"100",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Flete"}),e.jsx("input",{type:"number",value:i.flete,onChange:t=>P("flete",parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Otros"}),e.jsx("input",{type:"number",value:i.otros,onChange:t=>P("otros",parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Resumen"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["‚Ç°",K(i.subtotal)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Descuento (",i.descuento_global,"%):"]}),e.jsxs("span",{children:["-‚Ç°",K(i.descuento_valor)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Impuestos (13%):"}),e.jsxs("span",{children:["‚Ç°",K(i.impuestos)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Flete:"}),e.jsxs("span",{children:["‚Ç°",K(i.flete)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Otros:"}),e.jsxs("span",{children:["‚Ç°",K(i.otros)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["‚Ç°",K(i.total)]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap cursor-pointer",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 whitespace-nowrap cursor-pointer",children:a?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:d?"ri-save-line mr-2":"ri-add-line mr-2"}),d?"Actualizar":"Crear"," Cotizaci√≥n"]})})]})]})})]})}):null}function be({filters:d,onFiltersChange:T}){if(!d)return null;const[D,O]=n.useState(!1),[i,v]=n.useState([]),[X,L]=n.useState(""),[y,h]=n.useState(null),[p,_]=n.useState(!1),[j,I]=n.useState([]),[B,M]=n.useState(null),$=n.useRef(null);n.useEffect(()=>{(async()=>{try{const E=await xe.obtenerClientes({});v(E)}catch(E){console.error("Error cargando clientes:",E)}})()},[]),n.useEffect(()=>{if(d?.cliente_id&&i.length>0){const a=i.find(E=>E.id===parseInt(d.cliente_id));a&&(h(a),L(`${a.nombre_razon_social} - ${a.identificacion}`))}else h(null),L("")},[d?.cliente_id,i]),n.useEffect(()=>{const a=E=>{$.current&&!$.current.contains(E.target)&&_(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const N=(a,E)=>{T({...d,[a]:E||void 0})},G=a=>{N("search",a)},w=a=>{if(L(a),B&&clearTimeout(B),!a.trim()){h(null),N("cliente_id",""),_(!1),I([]);return}const E=setTimeout(()=>{const Z=i.filter(Q=>Q.nombre_razon_social.toLowerCase().includes(a.toLowerCase())||Q.identificacion.toLowerCase().includes(a.toLowerCase())).slice(0,10);I(Z),_(Z.length>0)},300);M(E)},Y=a=>{h(a),L(`${a.nombre_razon_social} - ${a.identificacion}`),_(!1),N("cliente_id",a.id?.toString())},q=()=>{h(null),L(""),_(!1),N("cliente_id","")},ee=()=>{T({}),O(!1),h(null),L(""),_(!1)},F=d?.search||d?.cliente_id||d?.estado||d?.moneda||d?.fecha_desde||d?.fecha_hasta;return e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por n√∫mero, cliente, descripci√≥n...",value:d?.search||"",onChange:a=>G(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>O(!D),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center whitespace-nowrap",children:[e.jsx("i",{className:"ri-filter-line mr-2"}),"Filtros",e.jsx("i",{className:`ri-arrow-${D?"up":"down"}-s-line ml-1`})]}),F&&e.jsxs("button",{onClick:ee,className:"px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors flex items-center whitespace-nowrap",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Limpiar"]})]})]}),D&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"relative",ref:$,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar cliente...",value:X,onChange:a=>w(a.target.value),onFocus:()=>{j.length>0&&_(!0)},className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"}),y&&e.jsx("button",{onClick:q,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line"})})]}),p&&j.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:j.map(a=>e.jsxs("button",{onClick:()=>Y(a),className:"w-full px-3 py-2 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.nombre_razon_social}),e.jsx("div",{className:"text-xs text-gray-600",children:a.identificacion})]},a.id))}),p&&X&&j.length===0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-3",children:e.jsx("div",{className:"text-sm text-gray-500 text-center",children:"No se encontraron clientes"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),e.jsxs("select",{value:d?.estado||"",onChange:a=>N("estado",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"borrador",children:"Borrador"}),e.jsx("option",{value:"enviada",children:"Enviada"}),e.jsx("option",{value:"aceptada",children:"Aceptada"}),e.jsx("option",{value:"rechazada",children:"Rechazada"}),e.jsx("option",{value:"vencida",children:"Vencida"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Moneda"}),e.jsxs("select",{value:d?.moneda||"",onChange:a=>N("moneda",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"CRC",children:"Colones (‚Ç°)"}),e.jsx("option",{value:"USD",children:"D√≥lares ($)"}),e.jsx("option",{value:"EUR",children:"Euros (‚Ç¨)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Desde"}),e.jsx("input",{type:"date",value:d?.fecha_desde||"",onChange:a=>N("fecha_desde",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Hasta"}),e.jsx("input",{type:"date",value:d?.fecha_hasta||"",onChange:a=>N("fecha_hasta",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-sm"})]})]})]})}function he({cotizaciones:d,loading:T,onEditar:D,onEliminar:O,onDuplicar:i,onCambiarEstado:v,onDescargarPDF:X}){const L=ie(),[y,h]=n.useState(null),[p,_]=n.useState({abierto:!1,cotizacion:null}),[j,I]=n.useState({destinatario:"",asunto:"",mensaje:""}),[B,M]=n.useState(!1),$=r=>{switch(r){case"borrador":return"bg-gray-100 text-gray-800";case"enviada":return"bg-blue-100 text-blue-800";case"aceptada":return"bg-green-100 text-green-800";case"rechazada":return"bg-red-100 text-red-800";case"vencida":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},N=r=>{switch(r){case"borrador":return"Borrador";case"enviada":return"Enviada";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"vencida":return"Vencida";default:return r}},G=r=>new Date(r).toLocaleDateString("es-CR"),w=r=>{h(y===r?null:r)},Y=async r=>{try{console.log("Generando PDF para cotizaci√≥n:",r.id);const{data:c,error:S}=await R.from("cotizaciones").select(`
          *,
          clientes (
            id,
            nombre_razon_social,
            identificacion,
            correo_principal,
            telefono_numero,
            otras_senas,
            barrio
          )
        `).eq("id",r.id).single();if(S){console.error("Error obteniendo cotizaci√≥n:",S),alert("Error al obtener los datos de la cotizaci√≥n");return}console.log("Cotizaci√≥n obtenida para PDF:",c);const{data:C,error:u}=await R.from("cotizacion_items").select("*").eq("cotizacion_id",r.id);if(u){console.error("Error obteniendo items:",u),alert("Error al obtener los items de la cotizaci√≥n");return}const b=C?.map(k=>k.producto_id).filter(Boolean)||[];let s=[];if(b.length>0){const{data:k,error:P}=await R.from("productos").select("id_producto, codigo_producto, descripcion_producto, costo_total_bom").in("id_producto",b);P||(s=k||[])}const x=C?.map(k=>{const P=s.find(re=>re.id_producto===k.producto_id);return{...k,productos:P||null}})||[],f={...c,cotizacion_items:x},U=q(f),J=new Blob([U],{type:"text/html;charset=utf-8"}),V=URL.createObjectURL(J),A=document.createElement("a");A.href=V,A.download=`cotizacion-${f.codigo}.html`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(V)}catch(c){console.error("Error generando PDF:",c),alert("Error al generar el PDF")}},q=r=>{const c=r.clientes||{},S=r.cotizacion_items||[],C=[c.otras_senas,c.barrio].filter(Boolean).join(", ")||"No especificada",u=b=>(parseFloat(b)||0).toLocaleString("es-CR",{minimumFractionDigits:2,maximumFractionDigits:2});return`
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizaci√≥n ${r.codigo}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #5AAB8E; padding-bottom: 20px; }
        .company-logo { width: 120px; height: auto; margin-bottom: 10px; }
        .company-name { font-size: 24px; font-weight: bold; color: #5AAB8E; margin-bottom: 5px; }
        .document-title { font-size: 18px; color: #666; }
        .info-section { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .info-box { width: 48%; }
        .info-title { font-weight: bold; color: #5AAB8E; margin-bottom: 10px; font-size: 14px; }
        .info-content { background: #f8fafc; padding: 15px; border-radius: 5px; }
        .table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .table th, .table td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
        .table th { background: #5AAB8E; color: white; font-weight: bold; }
        .table tr:nth-child(even) { background: #f8fafc; }
        .totals { margin-top: 20px; }
        .totals-table { width: 300px; margin-left: auto; }
        .total-row { font-weight: bold; background: #5AAB8E !important; color: white; }
        .footer { margin-top: 40px; text-align: center; color: #666; font-size: 10px; }
        
        @media print {
            body { font-size: 11px; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRYi7j4OFVRmD2T0m6NyFHqYa96zun92AUTIA&s" alt="SCO Logo" class="company-logo">
            <div class="company-name">SCO</div>
            <div class="document-title">COTIZACI√ìN</div>
        </div>

        <div class="info-section">
            <div class="info-box">
                <div class="info-title">INFORMACI√ìN DEL CLIENTE</div>
                <div class="info-content">
                    <strong>Cliente:</strong> ${c.nombre_razon_social||"No especificado"}<br>
                    <strong>Identificaci√≥n:</strong> ${c.identificacion||"No especificada"}<br>
                    <strong>Correo:</strong> ${c.correo_principal||"No especificado"}<br>
                    <strong>Tel√©fono:</strong> ${c.telefono_numero||"No especificado"}<br>
                    <strong>Direcci√≥n:</strong> ${C}
                </div>
            </div>
            <div class="info-box">
                <div class="info-title">INFORMACI√ìN DE LA COTIZACI√ìN</div>
                <div class="info-content">
                    <strong>C√≥digo:</strong> ${r.codigo}<br>
                    <strong>Fecha Emisi√≥n:</strong> ${new Date(r.fecha_emision).toLocaleDateString("es-ES")}<br>
                    <strong>Fecha Vencimiento:</strong> ${new Date(r.fecha_vencimiento).toLocaleDateString("es-ES")}<br>
                    <strong>Estado:</strong> ${r.estado.toUpperCase()}<br>
                    <strong>Moneda:</strong> ${r.moneda}
                </div>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>C√≥digo</th>
                    <th>Descripci√≥n</th>
                    <th>Cantidad</th>
                    <th>Precio Unit.</th>
                    <th>Descuento</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                ${S.map(b=>`
                    <tr>
                        <td>${b.productos?.codigo_producto||b.codigo_producto||"N/A"}</td>
                        <td>${b.productos?.descripcion_producto||b.descripcion_producto||"Producto sin descripci√≥n"}</td>
                        <td>${b.cantidad||0}</td>
                        <td>‚Ç°${u(b.precio_unitario||0)}</td>
                        <td>${b.descuento_porcentaje||b.descuento||0}%</td>
                        <td>‚Ç°${u(b.total_linea||b.subtotal||0)}</td>
                    </tr>
                `).join("")}
            </tbody>
        </table>

        <div class="totals">
            <table class="table totals-table">
                <tr>
                    <td><strong>Subtotal:</strong></td>
                    <td>‚Ç°${u(r.subtotal||0)}</td>
                </tr>
                <tr>
                    <td><strong>Descuento:</strong></td>
                    <td>‚Ç°${u(r.descuento_valor||0)}</td>
                </tr>
                <tr>
                    <td><strong>Flete:</strong></td>
                    <td>‚Ç°${u(r.flete||0)}</td>
                </tr>
                <tr>
                    <td><strong>Impuestos:</strong></td>
                    <td>‚Ç°${u(r.impuestos||0)}</td>
                </tr>
                <tr>
                    <td><strong>Otros:</strong></td>
                    <td>‚Ç°${u(r.otros||0)}</td>
                </tr>
                <tr class="total-row">
                    <td><strong>TOTAL:</strong></td>
                    <td><strong>‚Ç°${u(r.total||0)}</strong></td>
                </tr>
            </table>
        </div>

        <div class="footer">
            <p>Cotizaci√≥n generada el ${new Date().toLocaleDateString("es-ES")} a las ${new Date().toLocaleTimeString("es-ES")}</p>
            <p>Este documento es una cotizaci√≥n y no constituye una factura</p>
        </div>
    </div>
</body>
</html>`},ee=r=>{const c=r.clientes?.correo_principal||"",S=`Cotizaci√≥n ${r.codigo} - ${r.clientes?.nombre_razon_social||"Cliente"}`,C=`Estimado/a cliente,

Adjunto encontrar√° la cotizaci√≥n ${r.codigo} con los detalles de los productos y servicios solicitados.

Esta cotizaci√≥n tiene una validez hasta el ${r.fecha_vencimiento?new Date(r.fecha_vencimiento).toLocaleDateString("es-ES"):"fecha indicada"}.

Si tiene alguna consulta o requiere modificaciones, no dude en contactarnos.

Quedamos atentos a su respuesta.

Saludos cordiales,
Equipo de Ventas`;I({destinatario:c,asunto:S,mensaje:C}),_({abierto:!0,cotizacion:r}),h(null)},F=()=>{_({abierto:!1,cotizacion:null}),I({destinatario:"",asunto:"",mensaje:""})},a=async()=>{if(!j.destinatario.trim()){alert("Por favor ingrese un correo electr√≥nico de destino");return}if(!j.asunto.trim()){alert("Por favor ingrese un asunto para el correo");return}try{M(!0);const r=await E(p.cotizacion),c=`mailto:${j.destinatario}?subject=${encodeURIComponent(j.asunto)}&body=${encodeURIComponent(j.mensaje+`

Nota: La cotizaci√≥n detallada se encuentra adjunta en formato PDF.`)}`;window.open(c);const S=new Blob([r],{type:"text/html;charset=utf-8"}),C=URL.createObjectURL(S),u=document.createElement("a");u.href=C,u.download=`cotizacion-${p.cotizacion.codigo}.html`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(C),alert("Se ha abierto su cliente de correo y descargado la cotizaci√≥n. Por favor adjunte el archivo descargado al correo."),F()}catch(r){console.error("Error enviando cotizaci√≥n:",r),alert("Error al preparar el env√≠o de la cotizaci√≥n")}finally{M(!1)}},E=async r=>{try{const{data:c,error:S}=await R.from("cotizaciones").select(`
          *,
          clientes (
            id,
            nombre_razon_social,
            identificacion,
            correo_principal,
            telefono_numero,
            otras_senas,
            barrio
          )
        `).eq("id",r.id).single();if(S)throw new Error("Error obteniendo datos de la cotizaci√≥n");const{data:C,error:u}=await R.from("cotizacion_items").select("*").eq("cotizacion_id",r.id);if(u)throw new Error("Error obteniendo items de la cotizaci√≥n");const b=C?.map(U=>U.producto_id).filter(Boolean)||[];let s=[];if(b.length>0){const{data:U,error:J}=await R.from("productos").select("id_producto, codigo_producto, descripcion_producto, costo_total_bom").in("id_producto",b);J||(s=U||[])}const x=C?.map(U=>{const J=s.find(V=>V.id_producto===U.producto_id);return{...U,productos:J||null}})||[],f={...c,cotizacion_items:x};return q(f)}catch(c){throw console.error("Error generando HTML para env√≠o:",c),c}},Z=r=>{L(`/cotizaciones/${r}/detallada`),h(null)},Q=async r=>{try{const{data:c,error:S}=await R.from("cotizaciones").select(`
          *,
          clientes (
            id,
            nombre_razon_social,
            identificacion,
            correo_principal,
            telefono_numero,
            otras_senas,
            barrio
          )
        `).eq("id",r.id).single();if(S){console.error("Error obteniendo cotizaci√≥n:",S),alert("Error al obtener los datos de la cotizaci√≥n");return}const{data:C,error:u}=await R.from("cotizacion_items").select("*").eq("cotizacion_id",r.id);if(u){console.error("Error obteniendo items:",u),alert("Error al obtener los items de la cotizaci√≥n");return}const b=C?.map(k=>k.producto_id).filter(Boolean)||[];let s=[];if(b.length>0){const{data:k,error:P}=await R.from("productos").select("id_producto, codigo_producto, descripcion_producto, costo_total_bom").in("id_producto",b);P||(s=k||[])}const x=C?.map(k=>{const P=s.find(re=>re.id_producto===k.producto_id);return{...k,productos:P||null}})||[],f={...c,cotizacion_items:x},U=q(f),J=new Blob([U],{type:"text/html;charset=utf-8"}),V=URL.createObjectURL(J),A=document.createElement("a");A.href=V,A.download=`COT-${f.codigo}-detallada.pdf`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(V),h(null)}catch(c){console.error("Error generando PDF:",c),alert("Error al generar el PDF")}};return T?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando cotizaciones..."})]})}):d.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("i",{className:"ri-file-list-3-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay cotizaciones"}),e.jsx("p",{className:"text-gray-600",children:"No se encontraron cotizaciones con los filtros aplicados."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Emisi√≥n"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vencimiento"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Moneda"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.codigo})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.clientes?.nombre_razon_social||"Sin cliente"}),e.jsx("div",{className:"text-sm text-gray-500",children:r.clientes?.identificacion||""})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$(r.estado)}`,children:N(r.estado)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:G(r.fecha_emision)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:r.fecha_vencimiento?G(r.fecha_vencimiento):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:me(r.total,r.moneda)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:r.moneda}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>w(r.id),className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-more-2-fill"})}),y===r.id&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border",children:e.jsxs("div",{className:"py-1",children:[r.metadata?.tipo==="optimizador"&&e.jsxs("button",{onClick:()=>{console.log("[COTIZACIONES] Navegando a cotizaci√≥n optimizador:",r.id),L(`/cotizaciones/optimizador/${r.id}`),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-teal-700 hover:bg-teal-50 cursor-pointer font-medium",children:[e.jsx("i",{className:"ri-scissors-cut-line mr-2"}),"Ver Optimizador"]}),e.jsxs("button",{onClick:()=>{D(r),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),"Editar"]}),e.jsxs("button",{onClick:()=>{Y(r),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-printer-line mr-2"}),"Imprimir"]}),e.jsxs("button",{onClick:()=>ee(r),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-mail-send-line mr-2"}),"Enviar"]}),e.jsxs("button",{onClick:()=>Z(r.id),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-file-text-line mr-2"}),"Ver Detallada"]}),e.jsxs("button",{onClick:()=>Q(r),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Descargar PDF"]}),e.jsxs("button",{onClick:()=>{i(r.id),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-file-copy-line mr-2"}),"Duplicar"]}),r.estado==="borrador"&&e.jsxs("button",{onClick:()=>{v(r.id,"enviada"),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-send-plane-line mr-2"}),"Marcar como Enviada"]}),r.estado==="enviada"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{v(r.id,"aceptada"),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-check-line mr-2"}),"Marcar Aceptada"]}),e.jsxs("button",{onClick:()=>{v(r.id,"rechazada"),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Marcar Rechazada"]})]}),e.jsx("div",{className:"border-t border-gray-100"}),e.jsxs("button",{onClick:()=>{O(r.id),h(null)},className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50 cursor-pointer",children:[e.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Eliminar"]})]})})]})})]},r.id))})]})})}),p.abierto&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Enviar Cotizaci√≥n por Correo"}),e.jsx("button",{onClick:F,className:"text-gray-400 hover:text-gray-600 cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-information-line text-blue-600 mr-2"}),e.jsxs("span",{className:"text-sm text-blue-800",children:["Cotizaci√≥n: ",e.jsx("strong",{children:p.cotizacion?.codigo})," - Cliente: ",e.jsx("strong",{children:p.cotizacion?.clientes?.nombre_razon_social})]})]})}),e.jsxs("form",{onSubmit:r=>{r.preventDefault(),a()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo de destino *"}),e.jsx("input",{type:"email",value:j.destinatario,onChange:r=>I(c=>({...c,destinatario:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"cliente@ejemplo.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Asunto *"}),e.jsx("input",{type:"text",value:j.asunto,onChange:r=>I(c=>({...c,asunto:r.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mensaje"}),e.jsx("textarea",{value:j.mensaje,onChange:r=>I(c=>({...c,mensaje:r.target.value})),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Escriba su mensaje aqu√≠..."})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-top border-gray-200",children:[e.jsx("button",{type:"button",onClick:F,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 whitespace-nowrap cursor-pointer",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:B,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 whitespace-nowrap cursor-pointer",children:B?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-4-line animate-spin mr-2"}),"Preparando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-mail-send-line mr-2"}),"Enviar Cotizaci√≥n"]})})]})]})]})]})})]})}const Ce=()=>{const[d,T]=n.useState(!1),[D,O]=n.useState(null),[i,v]=n.useState([]),[X,L]=n.useState(!0),[y,h]=n.useState({}),[p,_]=n.useState(1),[j,I]=n.useState(10),[B,M]=n.useState({isOpen:!1,cotizacionId:null});n.useEffect(()=>{$()},[y,p,j]);const $=async()=>{try{L(!0);const s=await te.obtenerCotizaciones(y);v(s)}catch(s){console.error("Error cargando cotizaciones:",s)}finally{L(!1)}},N=i.filter(s=>{let x=!0;if(y.search){const f=y.search.toLowerCase();x=x&&(s.numero?.toString().includes(f)||s.codigo?.toLowerCase().includes(f)||s.clientes?.nombre_razon_social?.toLowerCase().includes(f)||s.clientes?.identificacion?.toLowerCase().includes(f)||s.descripcion?.toLowerCase().includes(f)||s.observaciones?.toLowerCase().includes(f))}return y.cliente_id&&(x=x&&s.cliente_id?.toString()===y.cliente_id),y.estado&&(x=x&&s.estado===y.estado),y.moneda&&(x=x&&s.moneda===y.moneda),y.fecha_desde&&(x=x&&new Date(s.fecha_emision)>=new Date(y.fecha_desde)),y.fecha_hasta&&(x=x&&new Date(s.fecha_emision)<=new Date(y.fecha_hasta)),x}),G=N.length,w=Math.ceil(G/j),Y=(p-1)*j,q=Y+j,ee=N.slice(Y,q),F={total:N.length,borradores:N.filter(s=>s.estado==="borrador").length,enviadas:N.filter(s=>s.estado==="enviada").length,aceptadas:N.filter(s=>s.estado==="aceptada").length,rechazadas:N.filter(s=>s.estado==="rechazada").length},a=async s=>{try{D?await te.actualizarCotizacion(D.id,s):await te.crearCotizacion(s),await $()}catch(x){console.error("Error guardando cotizaci√≥n:",x)}finally{T(!1),O(null)}},E=s=>{O(s),T(!0)},Z=async s=>{M({isOpen:!0,cotizacionId:s})},Q=async()=>{if(B.cotizacionId)try{await te.eliminarCotizacion(B.cotizacionId),await $()}catch(s){console.error("Error eliminando cotizaci√≥n:",s)}finally{M({isOpen:!1,cotizacionId:null})}},r=()=>{M({isOpen:!1,cotizacionId:null})},c=async s=>{try{await te.duplicarCotizacion(s),await $()}catch(x){console.error("Error duplicando cotizaci√≥n:",x)}},S=async(s,x)=>{try{await te.cambiarEstado(s,x),await $()}catch(f){console.error("Error cambiando estado:",f)}},C=s=>{h(s),_(1)},u=s=>{_(s)},b=s=>{I(s),_(1)};return e.jsxs(pe,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cotizaciones"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona las cotizaciones de tu empresa"})]}),e.jsxs("button",{onClick:()=>T(!0),className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors flex items-center justify-center whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nueva Cotizaci√≥n"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"ri-file-list-3-line text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:F.total})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("i",{className:"ri-draft-line text-gray-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Borradores"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:F.borradores})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"ri-send-plane-line text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Enviadas"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:F.enviadas})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"ri-check-line text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aceptadas"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:F.aceptadas})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"ri-close-line text-red-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rechazadas"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:F.rechazadas})]})]})})]}),e.jsx(be,{filters:y,onFiltersChange:C}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-sm text-gray-700",children:["Mostrando ",Y+1," - ",Math.min(q,G)," de ",G," cotizaciones"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"Mostrar:"}),e.jsxs("select",{value:j,onChange:s=>b(Number(s.target.value)),className:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-teal-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),w>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u(1),disabled:p===1,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-skip-back-line"})}),e.jsx("button",{onClick:()=>u(p-1),disabled:p===1,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-arrow-left-s-line"})}),Array.from({length:Math.min(5,w)},(s,x)=>{const f=Math.max(1,Math.min(w-4,p-2))+x;return f<=w?e.jsx("button",{onClick:()=>u(f),className:`px-3 py-1 text-sm border rounded ${p===f?"bg-teal-600 text-white border-teal-600":"border-gray-300 hover:bg-gray-50"}`,children:f},f):null}),e.jsx("button",{onClick:()=>u(p+1),disabled:p===w,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-arrow-right-s-line"})}),e.jsx("button",{onClick:()=>u(w),disabled:p===w,className:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("i",{className:"ri-skip-forward-line"})})]})]})]}),e.jsx(he,{cotizaciones:ee,loading:X,onEditar:E,onEliminar:Z,onDuplicar:c,onCambiarEstado:S,onDescargarPDF:()=>{}}),w>1&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u(1),disabled:p===1,className:"px-3 py-2 text-sm border border-gray-300 rounded-l hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Primera"}),e.jsx("button",{onClick:()=>u(p-1),disabled:p===1,className:"px-3 py-2 text-sm border-t border-b border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsxs("span",{className:"px-4 py-2 text-sm border-t border-b border-gray-300 bg-gray-50",children:["P√°gina ",p," de ",w]}),e.jsx("button",{onClick:()=>u(p+1),disabled:p===w,className:"px-3 py-2 text-sm border-t border-b border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"}),e.jsx("button",{onClick:()=>u(w),disabled:p===w,className:"px-3 py-2 text-sm border border-gray-300 rounded-r hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"√öltima"})]})})]}),d&&e.jsx(ge,{cotizacion:D,onSubmit:a,onCancel:()=>{T(!1),O(null)},isOpen:d}),e.jsx(le,{isOpen:B.isOpen,type:"danger",title:"Eliminar Cotizaci√≥n",message:"¬øEst√° seguro de que desea eliminar esta cotizaci√≥n? Esta acci√≥n no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",onConfirm:Q,onCancel:r})]})};export{Ce as default};
//# sourceMappingURL=page-CcFBSsl8.js.map
