{"version":3,"file":"CallbackPage-DW21UQaz.js","sources":["../../src/pages/auth/CallbackPage.tsx"],"sourcesContent":["\nimport { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { supabase } from '../../lib/supabase';\n\nexport default function CallbackPage() {\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const handleAuthCallback = async () => {\n      try {\n        console.log('Procesando callback de autenticación...');\n        \n        // Obtener los parámetros de la URL\n        const { data, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('Error en callback:', error);\n          setError('Error al confirmar el correo electrónico');\n          return;\n        }\n\n        if (data.session?.user) {\n          console.log('Usuario confirmado exitosamente:', data.session.user.id);\n          \n          // Crear perfil en BD ahora que el email está confirmado\n          try {\n            const user = data.session.user;\n            \n            // Verificar si el usuario ya existe en la tabla\n            const { data: existingUser } = await supabase\n              .from('usuarios')\n              .select('id')\n              .eq('email', user.email)\n              .single();\n\n            const perfilData = {\n              id: user.id,\n              email: user.email,\n              nombre_completo: user.user_metadata?.nombre_completo || user.email || 'Usuario',\n              rol: 'Usuario',\n              activo: true,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            };\n\n            if (existingUser) {\n              console.log('Usuario ya existe en BD, actualizando información...');\n              await supabase\n                .from('usuarios')\n                .update({\n                  nombre_completo: perfilData.nombre_completo,\n                  updated_at: new Date().toISOString(),\n                })\n                .eq('email', user.email);\n            } else {\n              console.log('Creando perfil en BD...');\n              await supabase\n                .from('usuarios')\n                .insert([perfilData]);\n            }\n            \n            console.log('Perfil creado/actualizado exitosamente');\n          } catch (profileError) {\n            console.error('Error creando perfil en BD:', profileError);\n            // No es crítico, el usuario puede usar la aplicación\n          }\n          \n          // Redirigir al dashboard\n          setTimeout(() => {\n            navigate('/dashboard', { replace: true });\n          }, 2000);\n        } else {\n          console.log('No hay sesión activa');\n          setError('No se pudo confirmar el correo electrónico');\n        }\n      } catch (error) {\n        console.error('Error procesando callback:', error);\n        setError('Error inesperado al confirmar el correo');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    handleAuthCallback();\n  }, [navigate]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n            Confirmando tu correo electrónico...\n          </h2>\n          <p className=\"text-gray-600\">\n            Por favor espera mientras procesamos tu confirmación\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4\">\n            <i className=\"ri-error-warning-line text-red-600 text-xl\"></i>\n          </div>\n          <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n            Error de Confirmación\n          </h2>\n          <p className=\"text-gray-600 mb-4\">{error}</p>\n          <button\n            onClick={() => navigate('/login')}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors\"\n          >\n            Ir al Login\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n      <div className=\"text-center\">\n        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4\">\n          <i className=\"ri-check-line text-green-600 text-xl\"></i>\n        </div>\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n          ¡Correo Confirmado Exitosamente!\n        </h2>\n        <p className=\"text-gray-600 mb-4\">\n          Tu cuenta ha sido verificada. Redirigiendo al dashboard...\n        </p>\n        <div className=\"animate-pulse text-blue-600\">\n          Redirigiendo en unos segundos...\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["CallbackPage","loading","setLoading","useState","error","setError","navigate","useNavigate","useEffect","data","supabase","user","existingUser","perfilData","profileError","jsxs","jsx"],"mappings":"wDAKA,SAAwBA,GAAe,CACrC,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAI,EACrC,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAwB,IAAI,EAChDG,EAAWC,EAAA,EAiFjB,OA/EAC,EAAAA,UAAU,IAAM,EACa,SAAY,CACrC,GAAI,CACF,QAAQ,IAAI,yCAAyC,EAGrD,KAAM,CAAE,KAAAC,EAAM,MAAAL,CAAAA,EAAU,MAAMM,EAAS,KAAK,WAAA,EAE5C,GAAIN,EAAO,CACT,QAAQ,MAAM,qBAAsBA,CAAK,EACzCC,EAAS,0CAA0C,EACnD,MACF,CAEA,GAAII,EAAK,SAAS,KAAM,CACtB,QAAQ,IAAI,mCAAoCA,EAAK,QAAQ,KAAK,EAAE,EAGpE,GAAI,CACF,MAAME,EAAOF,EAAK,QAAQ,KAGpB,CAAE,KAAMG,CAAA,EAAiB,MAAMF,EAClC,KAAK,UAAU,EACf,OAAO,IAAI,EACX,GAAG,QAASC,EAAK,KAAK,EACtB,OAAA,EAEGE,EAAa,CACjB,GAAIF,EAAK,GACT,MAAOA,EAAK,MACZ,gBAAiBA,EAAK,eAAe,iBAAmBA,EAAK,OAAS,UACtE,IAAK,UACL,OAAQ,GACR,WAAY,IAAI,KAAA,EAAO,YAAA,EACvB,WAAY,IAAI,KAAA,EAAO,YAAA,CAAY,EAGjCC,GACF,QAAQ,IAAI,sDAAsD,EAClE,MAAMF,EACH,KAAK,UAAU,EACf,OAAO,CACN,gBAAiBG,EAAW,gBAC5B,WAAY,IAAI,KAAA,EAAO,YAAA,CAAY,CACpC,EACA,GAAG,QAASF,EAAK,KAAK,IAEzB,QAAQ,IAAI,yBAAyB,EACrC,MAAMD,EACH,KAAK,UAAU,EACf,OAAO,CAACG,CAAU,CAAC,GAGxB,QAAQ,IAAI,wCAAwC,CACtD,OAASC,EAAc,CACrB,QAAQ,MAAM,8BAA+BA,CAAY,CAE3D,CAGA,WAAW,IAAM,CACfR,EAAS,aAAc,CAAE,QAAS,EAAA,CAAM,CAC1C,EAAG,GAAI,CACT,MACE,QAAQ,IAAI,sBAAsB,EAClCD,EAAS,4CAA4C,CAEzD,OAASD,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,EACjDC,EAAS,yCAAyC,CACpD,QAAA,CACEH,EAAW,EAAK,CAClB,CACF,GAEA,CACF,EAAG,CAACI,CAAQ,CAAC,EAETL,QAEC,MAAA,CAAI,UAAU,2DACb,SAAAc,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,6EAAA,CAA8E,EAC7FA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,uCAEzD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,sDAAA,CAE7B,CAAA,CAAA,CACF,CAAA,CACF,EAIAZ,QAEC,MAAA,CAAI,UAAU,2DACb,SAAAW,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,kFACb,eAAC,IAAA,CAAE,UAAU,6CAA6C,CAAA,CAC5D,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,wBAEzD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,qBAAsB,SAAAZ,EAAM,EACzCY,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMV,EAAS,QAAQ,EAChC,UAAU,8FACX,SAAA,aAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,QAKD,MAAA,CAAI,UAAU,2DACb,SAAAS,EAAAA,KAAC,MAAA,CAAI,UAAU,cACb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,oFACb,eAAC,IAAA,CAAE,UAAU,uCAAuC,CAAA,CACtD,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,2CAA2C,SAAA,mCAEzD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,qBAAqB,SAAA,6DAElC,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,kCAAA,CAE7C,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}