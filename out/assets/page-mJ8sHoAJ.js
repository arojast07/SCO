import{r as m,j as e,b as v,s as p,a as j}from"./index-Xz42BvxI.js";import{S as P,T as C}from"./TopBar-BLe2nnBZ.js";import{M as k}from"./MobileNav-CVw3BIlq.js";function E({children:l}){const[r,a]=m.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(P,{isOpen:r,onClose:()=>a(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(C,{onMenuClick:()=>a(!0)}),e.jsx(k,{isOpen:r,onClose:()=>a(!1)}),e.jsx("main",{className:"flex-1 p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:l})})]})]})}function S({user:l,profile:r}){const[a,i]=m.useState(!1),[t,d]=m.useState(!1),[s,c]=m.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,n]=m.useState(""),[b,x]=m.useState(!1);v();const N=o=>new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=()=>new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=async o=>{if(o.preventDefault(),!s.newPassword||!s.confirmPassword||!s.currentPassword){n("Por favor completa todos los campos");return}if(s.newPassword.length<6){n("La nueva contrase침a debe tener al menos 6 caracteres");return}if(s.newPassword!==s.confirmPassword){n("Las contrase침as no coinciden");return}if(s.newPassword===s.currentPassword){n("La nueva contrase침a debe ser diferente a la contrase침a actual");return}x(!0),n("");try{const{error:u}=await p.auth.signInWithPassword({email:l?.email||"",password:s.currentPassword});if(u){n("La contrase침a actual es incorrecta"),x(!1);return}const{error:h}=await p.auth.updateUser({password:s.newPassword});if(h){h.message.includes("New password should be different")?n("La nueva contrase침a debe ser diferente a la contrase침a actual. Por favor elige una contrase침a diferente."):n(h.message),x(!1);return}c({currentPassword:"",newPassword:"",confirmPassword:""}),d(!1);const g=document.createElement("div");g.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in",g.innerHTML=`
        <div class="flex items-center gap-2">
          <i class="ri-check-line text-xl"></i>
          <span>Contrase침a actualizada correctamente</span>
        </div>
      `,document.body.appendChild(g),setTimeout(()=>{g.remove()},3e3)}catch(u){console.error("Error al cambiar contrase침a:",u),u.message.includes("New password should be different")?n("La nueva contrase침a debe ser diferente a la contrase침a actual. Por favor elige una contrase침a diferente."):n("Error al cambiar la contrase침a. Por favor intenta nuevamente.")}finally{x(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Informaci칩n Personal"}),e.jsxs("button",{onClick:()=>i(!a),className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx("i",{className:"ri-edit-line mr-2"}),a?"Cancelar":"Editar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre Completo"}),a?e.jsx("input",{type:"text",defaultValue:r.nombre_completo,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):e.jsx("p",{className:"text-gray-900 bg-white px-3 py-2 rounded-lg border border-gray-200",children:r.nombre_completo})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo Electr칩nico"}),a?e.jsx("input",{type:"email",defaultValue:r.email,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}):e.jsx("p",{className:"text-gray-900 bg-white px-3 py-2 rounded-lg border border-gray-200",children:r.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ID de Usuario"}),e.jsx("p",{className:"text-gray-600 bg-gray-100 px-3 py-2 rounded-lg border border-gray-200 font-mono text-sm",children:l.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rol Asignado"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.rol==="Admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx("i",{className:"ri-shield-user-line mr-1"}),r.rol]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estado de la Cuenta"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.activo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx("i",{className:`${r.activo?"ri-check-line":"ri-close-line"} mr-1`}),r.activo?"Activo":"Inactivo"]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Registro"}),e.jsxs("p",{className:"text-gray-600 bg-gray-100 px-3 py-2 rounded-lg border border-gray-200",children:[e.jsx("i",{className:"ri-calendar-line mr-2"}),N(l.created_at)]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Informaci칩n de Sesi칩n"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-time-line text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"칔ltimo Acceso"}),e.jsx("p",{className:"text-sm text-gray-600",children:y()})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-shield-check-line text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Verificaci칩n"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.email_confirmed_at?"Email verificado":"Email pendiente"})]})]})})]})]}),a&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Guardar Cambios"]}),e.jsxs("button",{onClick:()=>i(!1),className:"px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Cancelar"]})]})}),!a&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Seguridad"}),e.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 text-sm font-medium text-orange-600 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors",children:[e.jsx("i",{className:"ri-lock-line mr-2"}),"Cambiar Contrase침a"]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3",children:e.jsx("i",{className:"ri-lock-line text-orange-600 text-xl"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cambiar Contrase침a"})]}),e.jsx("button",{onClick:()=>{d(!1),c({currentPassword:"",newPassword:"",confirmPassword:""}),n("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Por seguridad, ingresa tu contrase침a actual y luego tu nueva contrase침a."}),f&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-start",children:[e.jsx("i",{className:"ri-error-warning-line text-xl mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm",children:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contrase침a Actual"}),e.jsx("input",{type:"password",value:s.currentPassword,onChange:o=>c({...s,currentPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Tu contrase침a actual",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nueva Contrase침a"}),e.jsx("input",{type:"password",value:s.newPassword,onChange:o=>c({...s,newPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"M칤nimo 6 caracteres",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmar Nueva Contrase침a"}),e.jsx("input",{type:"password",value:s.confirmPassword,onChange:o=>c({...s,confirmPassword:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",placeholder:"Repite la nueva contrase침a",required:!0})]}),s.newPassword&&e.jsxs("div",{className:"space-y-2 bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("i",{className:`${s.newPassword.length>=6?"ri-check-line text-green-500":"ri-close-line text-red-500"} mr-2`}),e.jsx("span",{className:s.newPassword.length>=6?"text-green-600":"text-red-600",children:"Al menos 6 caracteres"})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("i",{className:`${s.newPassword===s.confirmPassword&&s.confirmPassword?"ri-check-line text-green-500":"ri-close-line text-gray-400"} mr-2`}),e.jsx("span",{className:s.newPassword===s.confirmPassword&&s.confirmPassword?"text-green-600":"text-gray-500",children:"Las contrase침as coinciden"})]}),s.currentPassword&&s.newPassword&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("i",{className:`${s.newPassword!==s.currentPassword?"ri-check-line text-green-500":"ri-close-line text-red-500"} mr-2`}),e.jsx("span",{className:s.newPassword!==s.currentPassword?"text-green-600":"text-red-600",children:"Diferente a la contrase침a actual"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-information-line text-blue-600 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Recomendaciones de seguridad:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Usa al menos 8 caracteres"}),e.jsx("li",{children:"Combina letras may칰sculas y min칰sculas"}),e.jsx("li",{children:"Incluye n칰meros y s칤mbolos"}),e.jsx("li",{children:"No uses informaci칩n personal"})]})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),c({currentPassword:"",newPassword:"",confirmPassword:""}),n("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:b,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b||!s.currentPassword||!s.newPassword||!s.confirmPassword||s.newPassword!==s.confirmPassword||s.newPassword.length<6,className:"px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Cambiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-save-line mr-2"}),"Cambiar Contrase침a"]})})]})]})]})})]})}const L=()=>{const{profile:l,permissions:r}=j();console.log("游늶 [PerfilPermisos] ========================================"),console.log("游늶 [PerfilPermisos] permissions (del contexto):",r.length),console.log("游늶 [PerfilPermisos] Lista completa:",r),console.log("游늶 [PerfilPermisos] profile.rol:",l?.rol),console.log("游늶 [PerfilPermisos] ========================================");const a=r.reduce((t,d)=>{const[s,...c]=d.split(":");return t[s]||(t[s]=[]),t[s].push(c.join(":")),t},{});console.log("游닍 [PerfilPermisos] Permisos agrupados por m칩dulo:",a),console.log("游늵 [PerfilPermisos] Estad칤sticas:",{permisosCount:r.length,modulosCount:Object.keys(a).length});const i=Object.keys(a).sort();return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Permisos y Roles"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Rol Asignado"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsx("span",{className:"text-blue-800 font-medium",children:l?.rol||"Sin rol"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:["Permisos (",r.length," permisos en ",i.length," m칩dulos)"]}),r.length===0?e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:[e.jsx("i",{className:"ri-alert-line text-yellow-600 text-2xl mb-2"}),e.jsx("p",{className:"text-yellow-800",children:"No tienes permisos asignados"}),e.jsx("p",{className:"text-yellow-600 text-sm mt-1",children:"Contacta al administrador"})]}):e.jsx("div",{className:"space-y-4",children:i.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:t}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a[t].map((d,s)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("i",{className:"ri-check-line mr-1"}),d]},s))})]},t))})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Los permisos determinan qu칠 acciones puedes realizar en cada m칩dulo del sistema."]})})]})};function D(){const{user:l,profile:r,loading:a}=j(),[i,t]=m.useState("info");return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando perfil..."})]})}):!l||!r?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-user-line text-6xl text-gray-300 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Acceso no autorizado"}),e.jsx("p",{className:"text-gray-500",children:"Debes iniciar sesi칩n para ver tu perfil"})]})}):e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-user-line text-2xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mi Perfil"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona tu informaci칩n personal y configuraci칩n"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{onClick:()=>t("info"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${i==="info"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("i",{className:"ri-user-line mr-2"}),"Informaci칩n Personal"]}),e.jsxs("button",{onClick:()=>t("permisos"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${i==="permisos"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("i",{className:"ri-shield-user-line mr-2"}),"Permisos y Roles"]})]})}),e.jsxs("div",{className:"p-6",children:[i==="info"&&e.jsx(S,{user:l,profile:r}),i==="permisos"&&e.jsx(L,{profile:r})]})]})]})})}export{D as default};
//# sourceMappingURL=page-mJ8sHoAJ.js.map
