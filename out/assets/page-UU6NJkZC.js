import{r as x,j as e,s as f,b as Z,C as re}from"./index-Bb3NupjY.js";import{S as te,T as se}from"./TopBar-BP5RF_Jd.js";import{M as oe}from"./MobileNav-Dp72TdL_.js";import{N as ee}from"./NotificationPopup-Br5iZ8zM.js";import{u as X,w as ie,r as ce}from"./xlsx-BojT3SgY.js";function ne({children:o,vistaActual:S,onCambiarVista:y}){const[a,w]=x.useState(!1),g=[{id:"inventario",label:"Inventario",icon:"ri-archive-line"},{id:"categorias",label:"Categor√≠as",icon:"ri-folder-settings-line"},{id:"importar",label:"Importar",icon:"ri-file-excel-line"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(te,{isOpen:a,onClose:()=>w(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(se,{onMenuClick:()=>w(!0)}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-4 lg:px-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("nav",{className:"flex space-x-8","aria-label":"Tabs",children:g.map(h=>e.jsxs("button",{onClick:()=>y(h.id),className:`${S===h.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center cursor-pointer transition-colors`,children:[e.jsx("i",{className:`${h.icon} mr-2`}),h.label]},h.id))})})}),e.jsx("main",{className:"flex-1 p-4 lg:p-6 pb-20 lg:pb-6 overflow-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:o})})]}),e.jsx(oe,{})]})}function le({searchTerm:o,onSearchChange:S,selectedCategoria:y,onCategoriaChange:a,categorias:w,sortBy:g,onSortByChange:h,sortOrder:k,onSortOrderChange:I}){const[D,T]=x.useState([]);x.useEffect(()=>{w?T(w):M()},[w]);const M=async()=>{try{const{data:u,error:q}=await f.from("categorias_inventario").select("id_categoria, nombre_categoria, activo").eq("activo",!0).order("nombre_categoria");if(q)throw q;T(u||[])}catch(u){console.error("Error cargando categor√≠as:",u)}},z=[{value:"codigo_articulo",label:"C√≥digo"},{value:"descripcion_articulo",label:"Descripci√≥n"},{value:"cantidad_articulo",label:"Cantidad"},{value:"costo_articulo",label:"Costo"},{value:"precio_articulo",label:"Precio"},{value:"created_at",label:"Fecha de creaci√≥n"}];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o,onChange:u=>S(u.target.value),placeholder:"C√≥digo o descripci√≥n...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"ri-search-line text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor√≠a de Inventario"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:y,onChange:u=>a(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8 appearance-none bg-white",children:[e.jsx("option",{value:"todas",children:"Todas las categor√≠as"}),D.map(u=>e.jsx("option",{value:u.id_categoria.toString(),children:u.nombre_categoria},u.id_categoria))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("i",{className:"ri-arrow-down-s-line text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ordenar por"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:g,onChange:u=>h(u.target.value),className:"w-full pl-3 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:z.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("i",{className:"ri-arrow-down-s-line text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Orden"}),e.jsxs("div",{className:"flex rounded-lg border border-gray-300 overflow-hidden",children:[e.jsxs("button",{onClick:()=>I("asc"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors cursor-pointer ${k==="asc"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"ri-arrow-up-line mr-1"}),"Asc"]}),e.jsxs("button",{onClick:()=>I("desc"),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors border-l border-gray-300 cursor-pointer ${k==="desc"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx("i",{className:"ri-arrow-down-line mr-1"}),"Desc"]})]})]})]}),(o||y!=="todas")&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Filtros activos:"}),o&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:['B√∫squeda: "',o,'"',e.jsx("button",{onClick:()=>S(""),className:"ml-1 text-blue-600 hover:text-blue-800 cursor-pointer",children:e.jsx("i",{className:"ri-close-line"})})]}),y!=="todas"&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:["Categor√≠a: ",D.find(u=>u.id_categoria.toString()===y)?.nombre_categoria,e.jsx("button",{onClick:()=>a("todas"),className:"ml-1 text-purple-600 hover:text-purple-800 cursor-pointer",children:e.jsx("i",{className:"ri-close-line"})})]})]})})]})}function de({searchTerm:o,selectedCategoria:S,sortBy:y,sortOrder:a,onEditar:w,refreshTrigger:g}){const[h,k]=x.useState([]),[I,D]=x.useState(!0),{notification:T,showSuccess:M,showError:z,showWarning:u,hideNotification:q,confirmation:G,showConfirmation:Y}=Z();x.useEffect(()=>{B()},[o,S,y,a,g]);const B=async()=>{try{D(!0);const[i,b]=await Promise.all([f.from("inventario").select(`
            *,
            unidades_medida(id, nombre, simbolo)
          `),f.from("categorias_inventario").select("id_categoria, nombre_categoria")]);if(i.error)throw i.error;if(b.error)throw b.error;let U=i.data||[];const $=b.data||[];let p=U.map(c=>({...c,categorias_inventario:$.find(v=>v.id_categoria===c.categoria_id)||null}));o&&(p=p.filter(c=>c.codigo_articulo?.toLowerCase().includes(o.toLowerCase())||c.descripcion_articulo?.toLowerCase().includes(o.toLowerCase()))),S&&S!=="todas"&&(p=p.filter(c=>c.categoria_id===parseInt(S))),p.sort((c,v)=>{let s=c[y],_=v[y];return s==null&&(s=""),_==null&&(_=""),s=s.toString(),_=_.toString(),a==="asc"?s.localeCompare(_):_.localeCompare(s)}),k(p)}catch(i){console.error("Error cargando art√≠culos:",i);try{let b=f.from("inventario").select("*");o&&(b=b.or(`codigo_articulo.ilike.%${o}%,descripcion_articulo.ilike.%${o}%`)),S&&S!=="todas"&&(b=b.eq("categoria_id",parseInt(S))),b=b.order(y,{ascending:a==="asc"});const{data:U,error:$}=await b;if($)throw $;const{data:r}=await f.from("categorias_inventario").select("id_categoria, nombre_categoria"),p=(U||[]).map(c=>({...c,categorias_inventario:r?.find(v=>v.id_categoria===c.categoria_id)||null}));k(p)}catch(b){console.error("Error en fallback:",b),k([])}}finally{D(!1)}},m=async(i,b)=>{try{const{error:U}=await f.from("inventario").update({activo:!b}).eq("id_articulo",i);if(U)throw U;k($=>$.map(r=>r.id_articulo===i?{...r,activo:!b}:r))}catch(U){console.error("Error actualizando estado:",U),z("Error al actualizar el estado del art√≠culo","No se pudo actualizar el estado del art√≠culo")}},j=async i=>{Y("danger","¬øEliminar art√≠culo?","¬øEst√° seguro que desea eliminar este art√≠culo? Esta acci√≥n no se puede deshacer.",async()=>{try{const{data:b}=await f.from("bom_items").select("id_bom_item").eq("id_componente",i).limit(1);if(b&&b.length>0){u("Art√≠culo en uso","Este art√≠culo est√° siendo utilizado como componente en la lista de materiales de otros productos. Para eliminarlo, primero debe ir al m√≥dulo de Productos y eliminarlo de las listas de materiales.");return}const{data:U}=await f.from("cotizacion_items").select("id_cotizacion_item").eq("id_articulo",i).limit(1);if(U&&U.length>0){u("Art√≠culo en uso","Este art√≠culo est√° siendo utilizado en cotizaciones. Para eliminarlo, primero debe eliminar las cotizaciones que lo contienen.");return}const{data:$}=await f.from("pedido_items").select("id_pedido_item").eq("id_articulo",i).limit(1);if($&&$.length>0){u("Art√≠culo en uso","Este art√≠culo est√° siendo utilizado en pedidos. Para eliminarlo, primero debe eliminar los pedidos que lo contienen.");return}const{error:r}=await f.from("inventario").delete().eq("id_articulo",i);if(r){if(r.code==="23503"){u("Art√≠culo en uso","Este art√≠culo est√° siendo utilizado en otros registros del sistema. Para eliminarlo, primero debe eliminar las referencias en otros m√≥dulos.");return}throw r}k(p=>p.filter(c=>c.id_articulo!==i)),M("Art√≠culo eliminado","El art√≠culo ha sido eliminado exitosamente")}catch(b){console.error("Error eliminando art√≠culo:",b),b.code==="23503"?u("Art√≠culo en uso","Este art√≠culo est√° siendo utilizado en otros registros del sistema. Para eliminarlo, primero debe eliminar las referencias en otros m√≥dulos."):z("Error al eliminar","No se pudo eliminar el art√≠culo. Por favor, int√©ntelo nuevamente.")}})};return I?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando inventario..."})]})}):h.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("i",{className:"ri-archive-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay art√≠culos"}),e.jsx("p",{className:"text-gray-600",children:o||S!=="todas"?"No se encontraron art√≠culos con los filtros aplicados.":"Comience agregando art√≠culos a su inventario."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"C√≥digo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripci√≥n"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categor√≠a"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Costo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:i.codigo_articulo}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsx("div",{className:"max-w-xs truncate",title:i.descripcion_articulo,children:i.descripcion_articulo})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:i.categorias_inventario?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:i.categorias_inventario.nombre_categoria}):e.jsx("span",{className:"text-gray-400",children:"Sin categor√≠a"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("span",{className:`font-medium ${i.cantidad_articulo<=10?"text-red-600":i.cantidad_articulo<=50?"text-yellow-600":"text-green-600"}`,children:i.cantidad_articulo})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:i.unidades_medida?e.jsx("span",{className:"text-gray-600",children:i.unidades_medida.simbolo}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["‚Ç°",i.costo_articulo?.toLocaleString()||"0"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["‚Ç°",i.precio_articulo?.toLocaleString()||"0"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>m(i.id_articulo,i.activo),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium cursor-pointer ${i.activo?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:i.activo?"Activo":"Inactivo"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>w(i),className:"text-blue-600 hover:text-blue-900 cursor-pointer",title:"Editar art√≠culo",children:e.jsx("i",{className:"ri-edit-line"})}),e.jsx("button",{onClick:()=>j(i.id_articulo),className:"text-red-600 hover:text-red-900 cursor-pointer",title:"Eliminar art√≠culo",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})})]},i.id_articulo))})]})})}),e.jsx(ee,{isOpen:T.isOpen,onClose:q,title:T.title,message:T.message,type:T.type})]}),e.jsx(re,{isOpen:G.isOpen,type:G.type,title:G.title,message:G.message,onConfirm:G.onConfirm,onCancel:G.onCancel})]})}function me({articulo:o,onSave:S,onCancel:y}){const[a,w]=x.useState({codigo_articulo:"",descripcion_articulo:"",cantidad_articulo:"0.000",costo_articulo:"0.00",ganancia_articulo:"0.00",categoria_id:0,unidad_base_id:10,activo:!0,espesor_mm:"",largo_lamina_mm:"",ancho_lamina_mm:"",ancho_tapacanto_mm:"",grosor_tapacanto_mm:"",cod_barras:"",tipo_cod_barras:0}),[g,h]=x.useState({}),[k,I]=x.useState(0),[D,T]=x.useState([]),[M,z]=x.useState([]),[u,q]=x.useState([]),[G,Y]=x.useState(!0),[B,m]=x.useState(!1),[j,i]=x.useState(null),[b,U]=x.useState(!1),[$,r]=x.useState(null),{notification:p,showSuccess:c,showError:v,showWarning:s,hideNotification:_}=Z();x.useEffect(()=>{(async()=>{try{Y(!0);const[l,n,N]=await Promise.all([f.from("categorias_inventario").select("id_categoria, nombre_categoria, descripcion_categoria, activo").eq("activo",!0).order("nombre_categoria"),f.from("unidades_medida").select("*").order("grupo, nombre"),f.from("tipos_cod_barras").select("*").eq("activo",!0).order("descripcion_tipo_cod_barras")]);if(l.error)throw console.error("Error cargando categor√≠as de inventario:",l.error),new Error(`Error cargando categor√≠as de inventario: ${l.error.message}`);if(n.error)throw console.error("Error cargando unidades:",n.error),new Error(`Error cargando unidades: ${n.error.message}`);N.error&&console.error("Error cargando tipos de c√≥digos de barras:",N.error),console.log("Categor√≠as cargadas:",l.data),console.log("Tipos de c√≥digos de barras cargados:",N.data),T(l.data||[]),z(n.data||[]),q(N.data||[])}catch(l){console.error("Error cargando datos:",l),s("Error cargando datos",l instanceof Error?l.message:"Error cargando datos del formulario")}finally{Y(!1)}})()},[]),x.useEffect(()=>{o?(w({codigo_articulo:o.codigo_articulo,descripcion_articulo:o.descripcion_articulo,cantidad_articulo:o.cantidad_articulo.toFixed(3),costo_articulo:o.costo_articulo.toFixed(2),ganancia_articulo:o.ganancia_articulo.toFixed(2),categoria_id:o.categoria_id,unidad_base_id:o.unidad_base_id||10,activo:o.activo??!0,espesor_mm:o.espesor_mm?.toString()||"",largo_lamina_mm:o.largo_lamina_mm?.toString()||"",ancho_lamina_mm:o.ancho_lamina_mm?.toString()||"",ancho_tapacanto_mm:o.ancho_tapacanto_mm?.toString()||"",grosor_tapacanto_mm:o.grosor_tapacanto_mm?.toString()||"",cod_barras:o.cod_barras||"",tipo_cod_barras:o.tipo_cod_barras||0}),o.cod_barras&&o.tipo_cod_barras&&C(o.cod_barras,o.tipo_cod_barras)):(w({codigo_articulo:"",descripcion_articulo:"",cantidad_articulo:"0.000",costo_articulo:"0.00",ganancia_articulo:"0.00",categoria_id:0,unidad_base_id:10,activo:!0,espesor_mm:"",largo_lamina_mm:"",ancho_lamina_mm:"",ancho_tapacanto_mm:"",grosor_tapacanto_mm:"",cod_barras:"",tipo_cod_barras:0}),r(null))},[o]),x.useEffect(()=>{if(a.categoria_id&&D.length>0){const t=D.find(l=>l.id_categoria===a.categoria_id);i(t||null)}else i(null)},[a.categoria_id,D]),x.useEffect(()=>{const t=parseFloat(a.costo_articulo)||0,l=parseFloat(a.ganancia_articulo)||0;if(l>=100){I(0);return}const n=t/(1-l/100);I(n)},[a.costo_articulo,a.ganancia_articulo]),x.useEffect(()=>{if(a.cod_barras&&a.tipo_cod_barras){const t=setTimeout(()=>{C(a.cod_barras,a.tipo_cod_barras)},500);return()=>clearTimeout(t)}else r(null)},[a.cod_barras,a.tipo_cod_barras]);const C=async(t,l)=>{if(!t||!l){r(null);return}U(!0);try{const n=u.find(d=>d.id_tipo_cod_barras===l);if(!n){r(null);return}if(!n.formato_valido){r(!0);return}const E=new RegExp(n.formato_valido).test(t);r(E),h(E?d=>{const W={...d};return delete W.cod_barras,W}:d=>({...d,cod_barras:`El c√≥digo no cumple con el formato ${n.descripcion_tipo_cod_barras}`}))}catch(n){console.error("Error validando c√≥digo de barras:",n),r(null)}finally{U(!1)}},Q=async t=>{if(t){console.log("üîç [C√ìDIGO DE BARRAS] Detectando tipo autom√°tico para:",t);for(const l of u)if(l.formato_valido)try{if(new RegExp(l.formato_valido).test(t)){console.log("‚úÖ [C√ìDIGO DE BARRAS] Tipo detectado:",l.descripcion_tipo_cod_barras),w(N=>({...N,tipo_cod_barras:l.id_tipo_cod_barras})),c("Tipo detectado autom√°ticamente",`${l.descripcion_tipo_cod_barras}`),await C(t,l.id_tipo_cod_barras);return}}catch(n){console.error("‚ùå [C√ìDIGO DE BARRAS] Error en regex:",n)}console.log("‚ö†Ô∏è [C√ìDIGO DE BARRAS] No se pudo detectar el tipo autom√°ticamente"),s("Tipo no detectado","Por favor, seleccione manualmente el tipo de c√≥digo de barras")}},O=t=>{const{name:l,value:n,type:N}=t.target;let E=n;if(N==="checkbox"?E=t.target.checked:["categoria_id","unidad_base_id","tipo_cod_barras"].includes(l)&&(E=parseInt(n)||0),l==="ganancia_articulo"){const d=parseFloat(n);d<0||d>=100?h(W=>({...W,ganancia_articulo:"El margen debe estar entre 0% y 99.99%"})):h(W=>({...W,ganancia_articulo:""}))}if(l==="tipo_cod_barras"&&a.cod_barras){const d=parseInt(n)||0;d>0&&C(a.cod_barras,d)}w(d=>({...d,[l]:E})),g[l]&&h(d=>({...d,[l]:""}))},P=t=>{const l=t.target.value.trim();if(w(n=>({...n,cod_barras:l})),r(null),h(n=>{const N={...n};return delete N.cod_barras,N}),!l){w(n=>({...n,tipo_cod_barras:0}));return}a.tipo_cod_barras||Q(l)},R=(t,l,n)=>{(new RegExp(`^\\d*\\.?\\d{0,${n}}$`).test(l)||l==="")&&w(E=>({...E,[t]:l}))},V=async()=>{const t={};if(!a.codigo_articulo.trim())t.codigo_articulo="El c√≥digo es obligatorio";else if(!o||o.codigo_articulo!==a.codigo_articulo)try{const{data:E,error:d}=await f.from("inventario").select("id_articulo").eq("codigo_articulo",a.codigo_articulo.trim()).maybeSingle();d&&d.code!=="PGRST116"?(console.error("Error verificando c√≥digo:",d),t.codigo_articulo="Error verificando c√≥digo √∫nico"):E&&(t.codigo_articulo="Este c√≥digo ya existe")}catch(E){console.error("Error verificando c√≥digo:",E),t.codigo_articulo="Error de conexi√≥n al verificar c√≥digo"}a.descripcion_articulo.trim()||(t.descripcion_articulo="La descripci√≥n es obligatoria");const l=parseFloat(a.cantidad_articulo);(isNaN(l)||l<0)&&(t.cantidad_articulo="La cantidad debe ser un n√∫mero v√°lido mayor o igual a 0");const n=parseFloat(a.costo_articulo);(isNaN(n)||n<0)&&(t.costo_articulo="El costo debe ser un n√∫mero v√°lido mayor o igual a 0");const N=parseFloat(a.ganancia_articulo);if((isNaN(N)||N<0||N>=100)&&(t.ganancia_articulo="El margen debe estar entre 0% y 99.99%"),a.categoria_id===0&&(t.categoria_id="Debe seleccionar una categor√≠a"),a.unidad_base_id===0&&(t.unidad_base_id="Debe seleccionar una unidad de medida"),a.cod_barras&&a.cod_barras.trim()){if(!a.tipo_cod_barras)t.tipo_cod_barras="Debe seleccionar el tipo de c√≥digo de barras";else if($===!1){const E=u.find(d=>d.id_tipo_cod_barras===a.tipo_cod_barras);t.cod_barras=`El c√≥digo no cumple con el formato ${E?.descripcion_tipo_cod_barras||"seleccionado"}`}if(!t.cod_barras)try{const{data:E,error:d}=await f.from("inventario").select("id_articulo, codigo_articulo, descripcion_articulo").eq("cod_barras",a.cod_barras.trim()).maybeSingle();d&&d.code!=="PGRST116"?console.error("Error verificando c√≥digo de barras:",d):E&&(!o||E.id_articulo!==o.id_articulo)&&(t.cod_barras=`Este c√≥digo de barras ya est√° asignado al art√≠culo: ${E.codigo_articulo} - ${E.descripcion_articulo}`)}catch(E){console.error("Error verificando c√≥digo de barras:",E)}}return h(t),Object.keys(t).length===0},L=async t=>{if(t.preventDefault(),B)return;if(h({}),!await V()){v("Formulario incompleto","Por favor, corrija los errores antes de continuar");return}try{m(!0);const{data:{user:n}}=await f.auth.getUser();if(!n)throw new Error("No hay usuario autenticado");const{data:N,error:E}=await f.from("usuario_tienda_actual").select("tienda_id").eq("usuario_id",n.id).single();if(E||!N?.tienda_id)throw console.error("‚ùå [GUARDAR] Error obteniendo tienda actual:",E),new Error("No tienes una tienda asignada. Contacta al administrador.");console.log("‚úÖ [GUARDAR] Tienda actual del usuario:",N.tienda_id);const d={codigo_articulo:a.codigo_articulo.trim(),descripcion_articulo:a.descripcion_articulo.trim(),cantidad_articulo:parseFloat(a.cantidad_articulo),costo_articulo:parseFloat(a.costo_articulo),ganancia_articulo:parseFloat(a.ganancia_articulo),categoria_id:a.categoria_id,unidad_base_id:a.unidad_base_id,activo:a.activo,cod_barras:a.cod_barras&&a.cod_barras.trim()?a.cod_barras.trim():null,tipo_cod_barras:a.cod_barras&&a.cod_barras.trim()&&a.tipo_cod_barras?a.tipo_cod_barras:null,tienda_id:N.tienda_id};console.log("üíæ [GUARDAR] Datos del c√≥digo de barras:",{cod_barras:d.cod_barras,tipo_cod_barras:d.tipo_cod_barras,tipo_nombre:u.find(ae=>ae.id_tipo_cod_barras===d.tipo_cod_barras)?.descripcion_tipo_cod_barras}),console.log("üíæ [GUARDAR] Tienda asignada al art√≠culo:",d.tienda_id),j?.nombre_categoria==="LAMINAS"?(d.espesor_mm=a.espesor_mm?parseFloat(a.espesor_mm):null,d.largo_lamina_mm=a.largo_lamina_mm?parseFloat(a.largo_lamina_mm):null,d.ancho_lamina_mm=a.ancho_lamina_mm?parseFloat(a.ancho_lamina_mm):null,d.ancho_tapacanto_mm=null,d.grosor_tapacanto_mm=null):j?.nombre_categoria==="TAPACANTOS"?(d.ancho_tapacanto_mm=a.ancho_tapacanto_mm?parseFloat(a.ancho_tapacanto_mm):null,d.grosor_tapacanto_mm=a.grosor_tapacanto_mm?parseFloat(a.grosor_tapacanto_mm):null,d.espesor_mm=null,d.largo_lamina_mm=null,d.ancho_lamina_mm=null):(d.espesor_mm=null,d.largo_lamina_mm=null,d.ancho_lamina_mm=null,d.ancho_tapacanto_mm=null,d.grosor_tapacanto_mm=null);let W;if(o?W=await f.from("inventario").update(d).eq("id_articulo",o.id_articulo).select():W=await f.from("inventario").insert([d]).select(),W.error)throw console.error("‚ùå [GUARDAR] Error en operaci√≥n:",W.error),new Error(W.error.message);console.log("‚úÖ [GUARDAR] Art√≠culo guardado exitosamente:",W.data),c(o?"Art√≠culo actualizado":"Art√≠culo creado",`El art√≠culo ${d.cod_barras?"con c√≥digo de barras "+d.cod_barras:""} ha sido ${o?"actualizado":"creado"} exitosamente`),S(d)}catch(n){console.error("‚ùå [GUARDAR] Error guardando art√≠culo:",n);let N="Error al guardar el art√≠culo. Intente nuevamente.";n.message&&(n.message.includes("duplicate key")?n.message.includes("cod_barras")?N="El c√≥digo de barras ya existe en otro art√≠culo.":N="El c√≥digo del art√≠culo ya existe.":n.message.includes("connection")?N="Error de conexi√≥n. Verifique su conexi√≥n a internet.":n.message.includes("timeout")?N="La operaci√≥n tard√≥ demasiado. Intente nuevamente.":n.message.includes("categoria_inventario_id")?N="Error con la categor√≠a seleccionada. Intente nuevamente.":n.message.includes("tienda asignada")?N=n.message:n.message.includes("row-level security")&&(N="No tienes permisos para realizar esta operaci√≥n. Verifica que tengas una tienda asignada.")),v("Error al guardar",N)}finally{m(!1)}},F=t=>new Intl.NumberFormat("es-CR",{style:"currency",currency:"CRC",minimumFractionDigits:2,maximumFractionDigits:2}).format(t);if(G)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cargando datos"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Conectando con la base de datos..."})]})]})})});const J=(()=>{const t={};return M.forEach(l=>{t[l.grupo]||(t[l.grupo]=[]),t[l.grupo].push(l)}),t})(),H=j?.nombre_categoria==="LAMINAS",K=j?.nombre_categoria==="TAPACANTOS";return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[95vh] overflow-y-auto",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:o?"Editar Art√≠culo":"Nuevo Art√≠culo"}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),g.general&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:[e.jsx("i",{className:"ri-error-warning-line mr-2"}),g.general]}),e.jsxs("form",{onSubmit:L,className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informaci√≥n B√°sica"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C√≥digo del Art√≠culo *"}),e.jsx("input",{type:"text",name:"codigo_articulo",value:a.codigo_articulo,onChange:O,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all ${g.codigo_articulo?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"Ej: MAT-001"}),g.codigo_articulo&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.codigo_articulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor√≠a *"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"categoria_id",value:a.categoria_id,onChange:O,className:`w-full px-4 py-3 pr-10 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all appearance-none cursor-pointer ${g.categoria_id?"border-red-500 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:0,children:"Seleccionar categor√≠a"}),D.map(t=>e.jsx("option",{value:t.id_categoria,children:t.nombre_categoria},t.id_categoria))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("i",{className:"ri-arrow-down-s-line text-gray-400 text-lg"})})]}),g.categoria_id&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.categoria_id]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci√≥n *"}),e.jsx("textarea",{name:"descripcion_articulo",value:a.descripcion_articulo,onChange:O,rows:3,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all resize-none ${g.descripcion_articulo?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"Descripci√≥n detallada del art√≠culo"}),g.descripcion_articulo&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.descripcion_articulo]})]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-6 border-2 border-indigo-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"ri-barcode-line text-indigo-600 mr-2 text-xl"}),"C√≥digo de Barras (Opcional)"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tipo de C√≥digo",a.cod_barras&&a.cod_barras.trim()&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"tipo_cod_barras",value:a.tipo_cod_barras,onChange:O,className:`w-full px-4 py-3 pr-10 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all appearance-none cursor-pointer ${g.tipo_cod_barras?"border-red-500 bg-red-50":a.tipo_cod_barras>0?"border-indigo-500 bg-indigo-50":"border-gray-300"}`,disabled:!a.cod_barras||!a.cod_barras.trim(),children:[e.jsx("option",{value:0,children:a.cod_barras&&a.cod_barras.trim()?"Seleccionar tipo":"Ingrese primero el c√≥digo"}),u.map(t=>e.jsx("option",{value:t.id_tipo_cod_barras,children:t.descripcion_tipo_cod_barras},t.id_tipo_cod_barras))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:a.tipo_cod_barras>0?e.jsx("i",{className:"ri-check-line text-indigo-600 text-lg"}):e.jsx("i",{className:"ri-arrow-down-s-line text-gray-400 text-lg"})})]}),g.tipo_cod_barras&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.tipo_cod_barras]}),a.tipo_cod_barras>0&&e.jsxs("p",{className:"mt-2 text-xs text-indigo-700 flex items-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),u.find(t=>t.id_tipo_cod_barras===a.tipo_cod_barras)?.descripcion_tipo_cod_barras]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C√≥digo de Barras"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"cod_barras",value:a.cod_barras,onChange:P,className:`w-full px-4 py-3 pr-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all ${g.cod_barras?"border-red-500 bg-red-50":$===!0?"border-green-500 bg-green-50":$===!1?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"Ingrese el c√≥digo de barras"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:b?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600"}):$===!0?e.jsx("i",{className:"ri-check-line text-green-600 text-xl"}):$===!1?e.jsx("i",{className:"ri-close-line text-red-600 text-xl"}):a.cod_barras&&a.cod_barras.trim()?e.jsx("i",{className:"ri-barcode-line text-indigo-600 text-xl"}):null})]}),g.cod_barras&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.cod_barras]}),$===!0&&e.jsxs("p",{className:"mt-2 text-sm text-green-600 flex items-center font-medium",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"C√≥digo v√°lido para ",u.find(t=>t.id_tipo_cod_barras===a.tipo_cod_barras)?.descripcion_tipo_cod_barras]}),$===!1&&!g.cod_barras&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-close-line mr-1"}),"El c√≥digo no cumple con el formato esperado"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-indigo-100 rounded-lg border border-indigo-300",children:e.jsxs("p",{className:"text-xs text-indigo-800 flex items-start",children:[e.jsx("i",{className:"ri-lightbulb-line mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Detecci√≥n autom√°tica:"})," Ingrese el c√≥digo de barras y el sistema intentar√° detectar autom√°ticamente el tipo. Tambi√©n puede seleccionar el tipo manualmente si lo prefiere."]})]})})]}),H&&e.jsxs("div",{className:"bg-amber-50 rounded-lg p-6 border-2 border-amber-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"ri-ruler-line text-amber-600 mr-2"}),"Medidas de L√°mina"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Espesor (mm)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"espesor_mm",value:a.espesor_mm,onChange:t=>R("espesor_mm",t.target.value,2),className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all text-right",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:"mm"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Largo (mm)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"largo_lamina_mm",value:a.largo_lamina_mm,onChange:t=>R("largo_lamina_mm",t.target.value,2),className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all text-right",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:"mm"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ancho (mm)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"ancho_lamina_mm",value:a.ancho_lamina_mm,onChange:t=>R("ancho_lamina_mm",t.target.value,2),className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all text-right",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:"mm"})})]})]})]}),e.jsxs("p",{className:"text-xs text-amber-700 mt-3 flex items-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Estos campos son espec√≠ficos para l√°minas y se utilizan en el optimizador de cortes"]})]}),K&&e.jsxs("div",{className:"bg-purple-50 rounded-lg p-6 border-2 border-purple-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx("i",{className:"ri-ruler-2-line text-purple-600 mr-2"}),"Medidas de Tapacanto"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ancho (mm)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"ancho_tapacanto_mm",value:a.ancho_tapacanto_mm,onChange:t=>R("ancho_tapacanto_mm",t.target.value,2),className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all text-right",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:"mm"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grosor (mm)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"grosor_tapacanto_mm",value:a.grosor_tapacanto_mm,onChange:t=>R("grosor_tapacanto_mm",t.target.value,2),className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all text-right",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:"mm"})})]})]})]}),e.jsxs("p",{className:"text-xs text-purple-700 mt-3 flex items-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Estos campos son espec√≠ficos para tapacantos y se utilizar√°n en el optimizador de cortes"]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Unidad de Medida"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unidad Base *"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"unidad_base_id",value:a.unidad_base_id,onChange:O,className:`w-full px-4 py-3 pr-10 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all appearance-none cursor-pointer ${g.unidad_base_id?"border-red-500 bg-red-50":"border-gray-300"}`,children:[e.jsx("option",{value:0,children:"Seleccionar unidad"}),Object.entries(J).map(([t,l])=>e.jsx("optgroup",{label:t.charAt(0).toUpperCase()+t.slice(1),children:l.map(n=>e.jsxs("option",{value:n.id,children:[n.nombre," (",n.simbolo,")"]},n.id))},t))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("i",{className:"ri-arrow-down-s-line text-gray-400 text-lg"})})]}),g.unidad_base_id&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.unidad_base_id]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informaci√≥n Financiera"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cantidad en Stock"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"cantidad_articulo",value:a.cantidad_articulo,onChange:t=>R("cantidad_articulo",t.target.value,3),className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-right ${g.cantidad_articulo?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"0.000"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("i",{className:"ri-archive-line text-gray-400"})})]}),g.cantidad_articulo&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.cantidad_articulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Costo Unitario"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"costo_articulo",value:a.costo_articulo,onChange:t=>R("costo_articulo",t.target.value,2),className:`w-full px-4 py-3 pl-8 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-right ${g.costo_articulo?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 font-medium",children:"‚Ç°"})})]}),g.costo_articulo&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.costo_articulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Margen sobre Precio (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"ganancia_articulo",value:a.ganancia_articulo,onChange:t=>R("ganancia_articulo",t.target.value,2),className:`w-full px-4 py-3 pr-8 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-right ${g.ganancia_articulo?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-gray-500 font-medium",children:"%"})})]}),g.ganancia_articulo&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),g.ganancia_articulo]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Porcentaje de utilidad respecto al precio de venta"]})]})]})]}),e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",name:"activo",id:"activo",checked:a.activo,onChange:O,className:"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer"}),e.jsxs("label",{htmlFor:"activo",className:"ml-3 block text-sm font-medium text-gray-900 cursor-pointer",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"Art√≠culo activo"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-calculator-line text-blue-600 text-xl mr-2"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Precio de Venta Calculado:"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-900",children:k>0?F(k):"‚Ç°0.00"})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-xs text-blue-700 flex items-center",children:[e.jsx("i",{className:"ri-information-line mr-1"}),"Precio = Costo / (1 - Margen/100)"]}),parseFloat(a.ganancia_articulo)>=100&&e.jsxs("p",{className:"text-xs text-red-600 flex items-center font-medium",children:[e.jsx("i",{className:"ri-error-warning-line mr-1"}),"El margen debe ser menor a 100% para calcular el precio"]}),k>0&&parseFloat(a.ganancia_articulo)>0&&e.jsxs("p",{className:"text-xs text-green-700 flex items-center",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"Utilidad: ",F(k-parseFloat(a.costo_articulo||"0"))," (",a.ganancia_articulo,"% del precio)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:y,disabled:B,className:"px-6 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap disabled:opacity-50 flex items-center cursor-pointer",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",disabled:B,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap disabled:opacity-50 flex items-center cursor-pointer",children:[B&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx("i",{className:`${B?"hidden":"ri-save-line"} mr-2`}),o?"Actualizar":"Crear"," Art√≠culo"]})]})]})]})}),e.jsx(ee,{isOpen:p.isOpen,onClose:_,title:p.title,message:p.message,type:p.type})]})}function ue(){const[o,S]=x.useState(null),[y,a]=x.useState([]),[w,g]=x.useState(!1),[h,k]=x.useState(!1),[I,D]=x.useState(null),[T,M]=x.useState([]),[z,u]=x.useState([]),q=x.useRef(null);x.useEffect(()=>{G()},[]);const G=async()=>{try{const{data:r,error:p}=await f.from("categorias_inventario").select("id_categoria, nombre_categoria").eq("activo",!0).order("nombre_categoria");p?(console.error("Error cargando categor√≠as de inventario:",p),M([{id_categoria:1,nombre_categoria:"ETIQUETAS"},{id_categoria:2,nombre_categoria:"EMBALAJE"},{id_categoria:3,nombre_categoria:"MAQUINA"},{id_categoria:4,nombre_categoria:"HH"},{id_categoria:5,nombre_categoria:"DEDICADOS"},{id_categoria:6,nombre_categoria:"HABLADORES"},{id_categoria:7,nombre_categoria:"GENERAL"}])):M(r||[]);const{data:c,error:v}=await f.from("unidades_medida").select("id, nombre").order("nombre");v?(console.error("Error cargando unidades:",v),u([{id:1,nombre:"Unidad"},{id:2,nombre:"Metros"},{id:3,nombre:"Litros"},{id:4,nombre:"Kilogramos"},{id:5,nombre:"Cent√≠metros"},{id:6,nombre:"Mil√≠metros"},{id:7,nombre:"Gramos"},{id:8,nombre:"Libras"},{id:9,nombre:"Mililitros"},{id:10,nombre:"Galones"},{id:11,nombre:"Segundos"},{id:12,nombre:"Minutos"},{id:13,nombre:"Horas"},{id:14,nombre:"Piezas"},{id:15,nombre:"Cajas"},{id:16,nombre:"Paquetes"},{id:17,nombre:"Rollos"},{id:18,nombre:"Hojas"},{id:19,nombre:"Pares"},{id:20,nombre:"Juegos"}])):u(c||[])}catch(r){console.error("Error general cargando datos:",r)}},Y=()=>{const r=[{codigo_articulo:"ART001",descripcion_articulo:"Tornillo Phillips 6x25mm",cantidad_articulo:500,costo_articulo:.15,ganancia_articulo:35,categoria:"Ferreter√≠a",unidad_base:"Unidad",activo:"SI"},{codigo_articulo:"ART002",descripcion_articulo:"Cable el√©ctrico 12 AWG",cantidad_articulo:100.5,costo_articulo:2.75,ganancia_articulo:28.5,categoria:"El√©ctricos",unidad_base:"Metros",activo:"SI"},{codigo_articulo:"ART003",descripcion_articulo:"Pintura acr√≠lica blanca",cantidad_articulo:25,costo_articulo:15.25,ganancia_articulo:42,categoria:"Pinturas",unidad_base:"Litros",activo:"NO"}],p=[["INSTRUCCIONES PARA IMPORTAR INVENTARIO"],[""],["1. CAMPOS OBLIGATORIOS:"],["   - codigo_articulo: C√≥digo √∫nico del art√≠culo (sin espacios)"],["   - descripcion_articulo: Nombre descriptivo del producto"],["   - cantidad_articulo: Cantidad en stock (n√∫mero decimal)"],["   - costo_articulo: Precio de costo (n√∫mero decimal)"],[""],["2. CAMPOS OPCIONALES:"],["   - ganancia_articulo: Porcentaje de ganancia (0-100)"],["   - categoria: Nombre de la categor√≠a (se crea si no existe)"],["   - unidad_base: Unidad de medida (ver lista abajo)"],["   - activo: Estado del art√≠culo (SI/NO, TRUE/FALSE, 1/0)"],[""],["3. UNIDADES DE MEDIDA DISPONIBLES:"],["   - Unidad, Mil√≠metros, Cent√≠metros, Metros"],["   - Gramos, Kilogramos, Libras"],["   - Mililitros, Litros, Galones"],["   - Segundos, Minutos, Horas"],[""],["4. FORMATO DE N√öMEROS:"],["   - Use punto (.) como separador decimal"],["   - Cantidad: hasta 3 decimales (ej: 100.500)"],["   - Costo: hasta 4 decimales (ej: 15.2500)"],["   - Ganancia: hasta 2 decimales sin % (ej: 35.00)"],[""],["5. NOTAS IMPORTANTES:"],["   - El precio de venta se calcula autom√°ticamente"],["   - Los c√≥digos deben ser √∫nicos"],["   - M√°ximo 1000 registros por importaci√≥n"],["   - Formatos soportados: .xlsx, .csv"],[""],['IMPORTANTE: Use la hoja "Datos" para ingresar su informaci√≥n']],c=X.book_new(),v=X.aoa_to_sheet(p);X.book_append_sheet(c,v,"Instrucciones");const s=X.json_to_sheet(r);X.book_append_sheet(c,s,"Datos");const _=[{wch:15},{wch:40},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:10}];s["!cols"]=_,v["!cols"]=[{wch:80}],ie(c,"plantilla_inventario.xlsx")},B=()=>{const r=["codigo_articulo,descripcion_articulo,cantidad_articulo,costo_articulo,ganancia_articulo,categoria,unidad_base,activo","ART001,Tornillo Phillips 6x25mm,500.000,0.1500,35.00,Ferreter√≠a,Unidad,SI","ART002,Cable el√©ctrico 12 AWG,100.500,2.7500,28.50,El√©ctricos,Metros,SI","ART003,Pintura acr√≠lica blanca,25.000,15.2500,42.00,Pinturas,Litros,NO"].join(`
`),c=["INSTRUCCIONES PARA IMPORTAR INVENTARIO","","1. CAMPOS OBLIGATORIOS:","   - codigo_articulo: C√≥digo √∫nico del art√≠culo (sin espacios)","   - descripcion_articulo: Nombre descriptivo del producto","   - cantidad_articulo: Cantidad en stock (n√∫mero decimal)","   - costo_articulo: Precio de costo (n√∫mero decimal)","","2. CAMPOS OPCIONALES:","   - ganancia_articulo: Porcentaje de ganancia (0-100)","   - categoria: Nombre de la categor√≠a (se crea si no existe)","   - unidad_base: Unidad de medida (ver lista abajo)","   - activo: Estado del art√≠culo (SI/NO, TRUE/FALSE, 1/0)","","3. UNIDADES DE MEDIDA DISPONIBLES:","   - Unidad, Mil√≠metros, Cent√≠metros, Metros","   - Gramos, Kilogramos, Libras","   - Mililitros, Litros, Galones","   - Segundos, Minutos, Horas","","4. FORMATO DE N√öMEROS:","   - Use punto (.) como separador decimal","   - Cantidad: hasta 3 decimales (ej: 100.500)","   - Costo: hasta 4 decimales (ej: 15.2500)","   - Ganancia: hasta 2 decimales sin % (ej: 35.00)","","5. NOTAS IMPORTANTES:","   - El precio de venta se calcula autom√°ticamente","   - Los c√≥digos deben ser √∫nicos","   - M√°ximo 1000 registros por importaci√≥n","   - Formato soportado: .csv","","--- PLANTILLA DE DATOS ---"].join(`
`)+`

`+r,v=new Blob([c],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),_=URL.createObjectURL(v);s.setAttribute("href",_),s.setAttribute("download","plantilla_inventario.csv"),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},m=async r=>(z.length===0&&await G(),new Promise((p,c)=>{const v=new FileReader;v.onload=s=>{try{const _=s.target?.result;let C=[];if(r.name.match(/\.xlsx$/i)){const O=ce(_,{type:"array"});let P="Datos";O.Sheets[P]||(P=O.SheetNames[0]);const R=O.Sheets[P];C=X.sheet_to_json(R,{header:1});let V=-1;for(let A=0;A<C.length;A++){const J=C[A];if(J&&J.some(H=>typeof H=="string"&&H.toLowerCase().includes("codigo_articulo"))){V=A;break}}if(V===-1){c(new Error('No se encontr√≥ el encabezado con "codigo_articulo" en el archivo Excel'));return}const L=C[V].map(A=>typeof A=="string"?A.trim().toLowerCase():"");C=C.slice(V+1).map(A=>{const J={};return L.forEach((H,K)=>{H&&(J[H]=A[K]||"")}),J}).filter(A=>A.codigo_articulo&&A.codigo_articulo.toString().trim()!=="")}else{const P=_.split(`
`).filter(F=>F.trim());let R=0;for(let F=0;F<P.length;F++)if(P[F].includes("codigo_articulo")){R=F;break}if(R===0&&!P[0].includes("codigo_articulo")){c(new Error("No se encontr√≥ el encabezado con los nombres de columnas"));return}const V=P[R].split(",").map(F=>F.trim().toLowerCase());C=P.slice(R+1).map(F=>{const A=F.split(",").map(H=>H.trim()),J={};return V.forEach((H,K)=>{J[H]=A[K]||""}),J}).filter(F=>F.codigo_articulo&&F.codigo_articulo.toString().trim()!=="")}const Q=C.map((O,P)=>j(O,P+2));p(Q.slice(0,50))}catch(_){c(_)}},r.name.match(/\.xlsx$/i)?v.readAsArrayBuffer(r):v.readAsText(r,"UTF-8")})),j=(r,p)=>{const c=[],v=[],s=(r.codigo_articulo||"").toString().trim(),_=(r.descripcion_articulo||"").toString().trim(),C=(r.cantidad_articulo||"").toString().trim(),Q=(r.costo_articulo||"").toString().trim(),O=(r.ganancia_articulo||"").toString().trim(),P=(r.categoria||"").toString().trim(),R=(r.unidad_base||"Unidad").toString().trim(),V=(r.activo||"SI").toString().trim().toUpperCase();s||c.push("C√≥digo de art√≠culo requerido"),_||c.push("Descripci√≥n requerida"),C||c.push("Cantidad requerida"),Q||c.push("Costo requerido");const L=parseFloat(C.replace(",",".")),F=parseFloat(Q.replace(",","."));let A=0;if(C&&(isNaN(L)||L<0)&&c.push("Cantidad debe ser un n√∫mero ‚â• 0"),Q&&(isNaN(F)||F<0)&&c.push("Costo debe ser un n√∫mero ‚â• 0"),O){const K=O.replace("%","").replace(",",".");A=parseFloat(K),(isNaN(A)||A<0||A>100)&&c.push("Ganancia debe ser entre 0 y 100%")}if(P&&!T.find(K=>K.nombre_categoria?.toLowerCase()===P.toLowerCase())&&v.push(`Categor√≠a "${P}" no existe, se crear√° autom√°ticamente`),!z.find(K=>K.nombre.toLowerCase()===R.toLowerCase())){const K=z.map(t=>t.nombre).join(", ");c.push(`Unidad "${R}" no v√°lida. Unidades disponibles: ${K}`)}["SI","NO","TRUE","FALSE","1","0"].includes(V)||c.push("Campo activo debe ser: SI/NO, TRUE/FALSE o 1/0");const H=c.length>0?"error":v.length>0?"advertencia":"valido";return{fila:p,codigo_articulo:s,descripcion_articulo:_,cantidad_articulo:C,costo_articulo:Q,ganancia_articulo:O,categoria:P,unidad_base:R,activo:V,errores:c,advertencias:v,estado:H}},i=async r=>{const p=r.target.files?.[0];if(p){if(!p.name.match(/\.(csv|xlsx)$/i)){alert("Formato de archivo no v√°lido. Use archivos .csv o .xlsx");return}S(p),k(!0);try{const c=await m(p);a(c),g(!0)}catch(c){console.error("Error procesando archivo:",c),alert(`Error al procesar el archivo: ${c}`)}finally{k(!1)}}},b=async()=>{if(!o)return;k(!0);const r={creados:0,actualizados:0,errores:0,detalles:[]};try{const c=(await m(o)).filter(s=>s.estado!=="error"),{data:{user:v}}=await f.auth.getUser();if(!v)throw new Error("Usuario no autenticado");for(const s of c)try{let _=null;if(s.categoria&&s.categoria.trim()!==""){const{data:L}=await f.from("categorias_inventario").select("id_categoria").ilike("nombre_categoria",s.categoria.trim()).single();if(L)_=L.id_categoria,console.log(`‚úÖ Categor√≠a encontrada: "${s.categoria}" -> ID: ${_}`);else{const{data:F,error:A}=await f.from("categorias_inventario").insert({nombre_categoria:s.categoria.trim(),descripcion_categoria:`Categor√≠a "${s.categoria}" creada autom√°ticamente durante importaci√≥n`,activo:!0}).select("id_categoria").single();A?(console.error("Error creando categor√≠a:",A),_=1):(_=F.id_categoria,console.log(`‚úÖ Nueva categor√≠a creada: "${s.categoria}" -> ID: ${_}`))}}else _=1,console.log(`‚ö†Ô∏è Sin categor√≠a especificada para ${s.codigo_articulo}, usando categor√≠a por defecto`);let C=1;if(s.unidad_base&&s.unidad_base.trim()!==""){const{data:L}=await f.from("unidades_medida").select("id").ilike("nombre",s.unidad_base.trim()).single();L?(C=L.id,console.log(`‚úÖ Unidad encontrada: "${s.unidad_base}" -> ID: ${C}`)):console.log(`‚ö†Ô∏è Unidad "${s.unidad_base}" no encontrada, usando "Unidad" por defecto`)}const Q=parseFloat(s.cantidad_articulo.replace(",",".")),O=parseFloat(s.costo_articulo.replace(",",".")),P=s.ganancia_articulo?parseFloat(s.ganancia_articulo.replace(",",".")):0,R=["SI","TRUE","1"].includes(s.activo.toUpperCase());console.log(`üìä Procesando: ${s.codigo_articulo} - Categor√≠a: "${s.categoria}" (ID: ${_}) - Unidad: "${s.unidad_base}" (ID: ${C})`);const{data:V}=await f.from("inventario").select("id_articulo").eq("codigo_articulo",s.codigo_articulo).single();if(V){const{error:L}=await f.from("inventario").update({descripcion_articulo:s.descripcion_articulo,cantidad_articulo:Q,costo_articulo:O,ganancia_articulo:P,categoria_id:_,unidad_base_id:C,activo:R,updated_at:new Date().toISOString()}).eq("id_articulo",V.id_articulo);if(L)throw new Error(`Error actualizando inventario: ${L.message}`);r.actualizados++,r.detalles.push(`‚úÖ Actualizado: ${s.codigo_articulo} - ${s.descripcion_articulo} (Categor√≠a: ${s.categoria})`)}else{const{error:L}=await f.from("inventario").insert({codigo_articulo:s.codigo_articulo,descripcion_articulo:s.descripcion_articulo,cantidad_articulo:Q,costo_articulo:O,ganancia_articulo:P,categoria_id:_,unidad_base_id:C,activo:R});if(L)throw new Error(`Error creando inventario: ${L.message}`);r.creados++,r.detalles.push(`‚úÖ Creado: ${s.codigo_articulo} - ${s.descripcion_articulo} (Categor√≠a: ${s.categoria})`)}}catch(_){r.errores++,r.detalles.push(`‚ùå Error en ${s.codigo_articulo}: ${_.message||_}`),console.error("Error procesando fila:",s,_)}D(r),(r.creados>0||r.actualizados>0)&&(alert(`‚úÖ Importaci√≥n completada:
${r.creados} creados
${r.actualizados} actualizados
${r.errores} errores`),setTimeout(()=>{window.location.reload()},2e3))}catch(p){console.error("Error en importaci√≥n:",p),alert(`Error durante la importaci√≥n: ${p.message||p}`)}finally{k(!1)}},U=()=>{S(null),a([]),g(!1),D(null),q.current&&(q.current.value="")},$=r=>{switch(r){case"error":return"bg-red-50 border-red-200";case"advertencia":return"bg-yellow-50 border-yellow-200";default:return"bg-green-50 border-green-200"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Importar Inventario"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Y,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-file-excel-line mr-2"}),"Descargar Plantilla Excel"]}),e.jsxs("button",{onClick:B,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-file-text-line mr-2"}),"Descargar Plantilla CSV"]})]})]}),!w&&!I&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-file-excel-line text-4xl text-green-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Selecciona un archivo Excel o CSV"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Formatos soportados: .xlsx, .csv (m√°ximo 1000 registros)"}),e.jsx("input",{ref:q,type:"file",accept:".csv,.xlsx",onChange:i,className:"hidden"}),e.jsx("button",{onClick:()=>q.current?.click(),disabled:h,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 whitespace-nowrap cursor-pointer",children:h?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-loader-line animate-spin mr-2"}),"Procesando archivo..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-upload-line mr-2"}),"Seleccionar Archivo"]})})]}),e.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Formato esperado (nombres exactos de columnas):"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"codigo_articulo:"})," √önico, sin espacios (ej: ART001)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"descripcion_articulo:"})," Nombre del producto"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"cantidad_articulo:"})," N√∫mero decimal (ej: 100.000)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"costo_articulo:"})," Precio de costo (ej: 50.0000)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"ganancia_articulo:"})," Porcentaje 0-100 (ej: 25.00)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"categoria:"})," Nombre de la categor√≠a (se crea si no existe)"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"unidad_base:"})," Unidad, Mil√≠metros, Cent√≠metros, Metros, Gramos, Kilogramos, Libras, Segundos, Minutos, Horas"]}),e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"activo:"})," SI/NO, TRUE/FALSE o 1/0"]})]}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"Importante:"}),' Para archivos Excel, use la hoja "Datos" o aseg√∫rese de que los datos est√©n en la primera hoja. Los nombres de las columnas deben ser exactamente como se muestran arriba. El precio se calcula autom√°ticamente: precio = costo √ó (1 + ganancia/100)']})})]})]}),w&&!I&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Vista Previa - ",o?.name]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors whitespace-nowrap cursor-pointer",children:"Cancelar"}),e.jsx("button",{onClick:b,disabled:h||y.every(r=>r.estado==="error"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 whitespace-nowrap cursor-pointer",children:h?"Importando...":"Confirmar Importaci√≥n"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.filter(r=>r.estado==="valido").length}),e.jsx("div",{className:"text-sm text-green-700",children:"V√°lidos"})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:y.filter(r=>r.estado==="advertencia").length}),e.jsx("div",{className:"text-sm text-yellow-700",children:"Advertencias"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.filter(r=>r.estado==="error").length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errores"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Fila"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"C√≥digo"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Descripci√≥n"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Categor√≠a"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Cantidad"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Costo"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Ganancia"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Activo"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map((r,p)=>e.jsxs("tr",{className:$(r.estado),children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:r.fila}),e.jsx("td",{className:"px-3 py-2 text-sm font-medium",children:r.codigo_articulo}),e.jsx("td",{className:"px-3 py-2 text-sm",children:r.descripcion_articulo}),e.jsx("td",{className:"px-3 py-2 text-sm",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:r.categoria||"Sin categor√≠a"})}),e.jsx("td",{className:"px-3 py-2 text-sm",children:r.cantidad_articulo}),e.jsx("td",{className:"px-3 py-2 text-sm",children:r.costo_articulo}),e.jsxs("td",{className:"px-3 py-2 text-sm",children:[r.ganancia_articulo,"%"]}),e.jsx("td",{className:"px-3 py-2 text-sm",children:r.activo}),e.jsx("td",{className:"px-3 py-2 text-sm",children:e.jsxs("div",{className:"space-y-1",children:[r.errores.map((c,v)=>e.jsx("div",{className:"text-red-600 text-xs",children:c},v)),r.advertencias.map((c,v)=>e.jsx("div",{className:"text-yellow-600 text-xs",children:c},v)),r.estado==="valido"&&e.jsx("div",{className:"text-green-600 text-xs",children:"‚úì V√°lido"})]})})]},p))})]})})})]}),I&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Resultado de la Importaci√≥n"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:I.creados}),e.jsx("div",{className:"text-sm text-green-700",children:"Creados"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:I.actualizados}),e.jsx("div",{className:"text-sm text-blue-700",children:"Actualizados"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:I.errores}),e.jsx("div",{className:"text-sm text-red-700",children:"Errores"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detalles:"}),I.detalles.map((r,p)=>e.jsx("div",{className:"text-sm text-gray-600",children:r},p))]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:U,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap cursor-pointer",children:"Nueva Importaci√≥n"})})]})]})}function xe({onClose:o}){const[S,y]=x.useState([]),[a,w]=x.useState(!0),[g,h]=x.useState(!1),[k,I]=x.useState(null),[D,T]=x.useState({nombre_categoria:"",descripcion_categoria:""}),[M,z]=x.useState(!1);x.useEffect(()=>{u()},[]);const u=async()=>{try{w(!0);const{data:m,error:j}=await f.from("categorias_inventario").select("*").order("nombre_categoria");if(j)throw j;y(m||[])}catch(m){console.error("Error cargando categor√≠as de inventario:",m),alert("Error al cargar las categor√≠as de inventario")}finally{w(!1)}},q=async()=>{if(!D.nombre_categoria.trim()){alert("El nombre de la categor√≠a es obligatorio");return}try{h(!0);const{error:m}=await f.from("categorias_inventario").insert([{nombre_categoria:D.nombre_categoria.trim(),descripcion_categoria:D.descripcion_categoria.trim()||null,activo:!0}]);if(m)throw m;T({nombre_categoria:"",descripcion_categoria:""}),z(!1),u(),alert("Categor√≠a creada exitosamente")}catch(m){console.error("Error creando categor√≠a:",m),m.code==="23505"?alert("Ya existe una categor√≠a con ese nombre"):alert("Error al crear la categor√≠a")}finally{h(!1)}},G=async(m,j)=>{try{h(!0);const{error:i}=await f.from("categorias_inventario").update(j).eq("id_categoria",m);if(i)throw i;I(null),u(),alert("Categor√≠a actualizada exitosamente")}catch(i){console.error("Error actualizando categor√≠a:",i),i.code==="23505"?alert("Ya existe una categor√≠a con ese nombre"):alert("Error al actualizar la categor√≠a")}finally{h(!1)}},Y=async(m,j)=>{try{const{data:i,error:b}=await f.from("inventario").select("id_articulo").eq("categoria_inventario_id",m).limit(1);if(b)throw b;if(i&&i.length>0&&j){alert("No se puede desactivar esta categor√≠a porque est√° siendo utilizada por art√≠culos del inventario");return}await G(m,{activo:!j})}catch(i){console.error("Error cambiando estado de categor√≠a:",i),alert("Error al cambiar el estado de la categor√≠a")}},B=async m=>{try{const{data:j,error:i}=await f.from("inventario").select("id_articulo").eq("categoria_inventario_id",m).limit(1);if(i)throw i;if(j&&j.length>0){alert("No se puede eliminar esta categor√≠a porque est√° siendo utilizada por art√≠culos del inventario");return}if(!confirm("¬øEst√°s seguro de que deseas eliminar esta categor√≠a? Esta acci√≥n no se puede deshacer."))return;h(!0);const{error:b}=await f.from("categorias_inventario").delete().eq("id_categoria",m);if(b)throw b;u(),alert("Categor√≠a eliminada exitosamente")}catch(j){console.error("Error eliminando categor√≠a:",j),alert("Error al eliminar la categor√≠a")}finally{h(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl p-8 max-w-md w-full",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cargando categor√≠as"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Obteniendo categor√≠as de inventario..."})]})]})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gesti√≥n de Categor√≠as de Inventario"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-lg",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>z(!M),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nueva Categor√≠a de Inventario"]})}),M&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-4",children:"Nueva Categor√≠a"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre *"}),e.jsx("input",{type:"text",value:D.nombre_categoria,onChange:m=>T(j=>({...j,nombre_categoria:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nombre de la categor√≠a"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci√≥n"}),e.jsx("input",{type:"text",value:D.descripcion_categoria,onChange:m=>T(j=>({...j,descripcion_categoria:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Descripci√≥n opcional"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{z(!1),T({nombre_categoria:"",descripcion_categoria:""})},className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap cursor-pointer",children:"Cancelar"}),e.jsx("button",{onClick:q,disabled:g||!D.nombre_categoria.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 whitespace-nowrap cursor-pointer",children:g?"Creando...":"Crear Categor√≠a"})]})]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripci√≥n"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Creaci√≥n"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("i",{className:"ri-folder-line text-4xl mb-4 block"}),"No se encontraron categor√≠as de inventario"]})}):S.map(m=>e.jsxs("tr",{className:`hover:bg-gray-50 ${m.activo?"":"opacity-60"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:k===m.id_categoria?e.jsx("input",{type:"text",defaultValue:m.nombre_categoria,onBlur:j=>{j.target.value.trim()!==m.nombre_categoria?G(m.id_categoria,{nombre_categoria:j.target.value.trim()}):I(null)},onKeyPress:j=>{j.key==="Enter"&&j.currentTarget.blur()},className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}):e.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.nombre_categoria})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:m.descripcion_categoria||"Sin descripci√≥n"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>Y(m.id_categoria,m.activo),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium cursor-pointer transition-colors ${m.activo?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:m.activo?"Activa":"Inactiva"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500",children:new Date(m.created_at).toLocaleDateString("es-ES")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>I(m.id_categoria),className:"text-blue-600 hover:text-blue-900 transition-colors p-1",title:"Editar nombre",children:e.jsx("i",{className:"ri-edit-line"})}),e.jsx("button",{onClick:()=>B(m.id_categoria),className:"text-red-600 hover:text-red-900 transition-colors p-1",title:"Eliminar",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})})]},m.id_categoria))})]})}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"ri-information-line text-yellow-600 mt-0.5 mr-2"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Informaci√≥n importante:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Las categor√≠as de inventario son independientes de las categor√≠as de productos"}),e.jsx("li",{children:"No se pueden eliminar categor√≠as que est√©n siendo utilizadas por art√≠culos"}),e.jsx("li",{children:"Al desactivar una categor√≠a, los art√≠culos existentes mantienen su categor√≠a"}),e.jsx("li",{children:"Las categor√≠as inactivas no aparecen en los formularios de nuevos art√≠culos"})]})]})]})})]})})})}function fe(){const[o,S]=x.useState("inventario"),[y,a]=x.useState(""),[w,g]=x.useState(null),[h,k]=x.useState("codigo_articulo"),[I,D]=x.useState("asc"),[T,M]=x.useState(!1),[z,u]=x.useState(null),[q,G]=x.useState(0),Y=()=>{u(null),M(!0)},B=b=>{u(b),M(!0)},m=()=>{M(!1),u(null),G(b=>b+1)},j=()=>{M(!1),u(null)},i=()=>{switch(o){case"inventario":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventario"}),e.jsx("p",{className:"text-gray-600",children:"Gesti√≥n de art√≠culos y stock"})]}),e.jsxs("button",{onClick:Y,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Nuevo Art√≠culo"]})]}),e.jsx(le,{searchTerm:y,onSearchChange:a,selectedCategoria:w,onCategoriaChange:g,sortBy:h,onSortByChange:k,sortOrder:I,onSortOrderChange:D}),e.jsx(de,{searchTerm:y,selectedCategoria:w,sortBy:h,sortOrder:I,onEditar:B,refreshTrigger:q})]});case"categorias":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Categor√≠as de Inventario"}),e.jsx("p",{className:"text-gray-600",children:"Gesti√≥n de categor√≠as para art√≠culos"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:e.jsx(xe,{onClose:()=>{}})})]});case"importar":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Importar Inventario"}),e.jsx("p",{className:"text-gray-600",children:"Importaci√≥n masiva desde Excel"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:e.jsx(ue,{})})]});default:return null}};return e.jsxs(ne,{vistaActual:o,onCambiarVista:S,children:[i(),T&&e.jsx(me,{articulo:z,onSave:m,onCancel:j})]})}export{fe as default};
//# sourceMappingURL=page-UU6NJkZC.js.map
