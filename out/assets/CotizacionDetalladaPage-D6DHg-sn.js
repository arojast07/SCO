import{c as w,u as Y,r as n,s as m,j as e,R as B}from"./index-Bb3NupjY.js";import{N as H}from"./NotificationPopup-Br5iZ8zM.js";const M=()=>{const{id:c}=w(),C=Y(),[s,_]=n.useState(null),[z,u]=n.useState(!0),[g,j]=n.useState(null),[x,D]=n.useState({}),[Z,K]=n.useState(!1),[b,O]=n.useState({isOpen:!1,type:"info",message:""}),S=()=>{O(r=>({...r,isOpen:!1}))};n.useEffect(()=>{c&&I(parseInt(c))},[c]);const E=r=>{D(t=>({...t,[r]:!t[r]}))},I=async r=>{try{u(!0),j(null);const{data:t,error:l}=await m.from("cotizaciones").select("*").eq("id",r).single();if(l)throw l;let o=null;if(t.cliente_id){const{data:i,error:d}=await m.from("clientes").select("*").eq("id",t.cliente_id).single();!d&&i?o=i:(console.warn("No se pudo cargar el cliente:",d),o={id:t.cliente_id,nombre_completo:"Cliente no especificado",identificacion:"3-101-2562-32",correo:"cliente@ejemplo.com",telefono:"2205-2525",direccion:"San José, Costa Rica"})}const{data:p,error:y}=await m.from("cotizacion_items").select("*").eq("cotizacion_id",r);if(y)throw y;const $=await Promise.all((p||[]).map(async i=>{let d=null,v=[];if(i.producto_id){const{data:G}=await m.from("productos").select("*").eq("id_producto",i.producto_id).single();d=G;const{data:J}=await m.from("bom_items").select("*").eq("product_id",i.producto_id);v=J||[]}return{...i,producto:d,bom_items:v}}));_({...t,cliente:o,cotizacion_items:$})}catch(t){console.error("Error cargando cotización detallada:",t),j(t.message||"Error al cargar la cotización")}finally{u(!1)}},h=r=>{if(!r)return"Fecha no disponible";try{const t=new Date(r);return isNaN(t.getTime())?"Fecha inválida":t.toLocaleDateString("es-CR",{year:"numeric",month:"long",day:"numeric"})}catch{return"Fecha inválida"}},a=r=>{const t=Number(r);return isNaN(t)||r===null||r===void 0?"₡0,00":new Intl.NumberFormat("es-CR",{style:"currency",currency:"CRC",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},R=()=>{try{const r=`${window.location.origin}${window.location.pathname.replace("/detallada","/print")}`;console.log("Abriendo URL de impresión:",r),window.open(r,"_blank","noopener,noreferrer")}catch(r){console.error("Error al abrir ventana de impresión:",r);const t=`/cotizaciones/${c}/print`;window.open(t,"_blank","noopener,noreferrer")}};if(z)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(g)return e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("i",{className:"ri-error-warning-line text-red-400 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:g})})]})]})});if(!s)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No se encontró la cotización"})});const F=s.codigo||s.numero_cotizacion||s.id.toString(),P=s.fecha_emision||s.fecha_cotizacion||"",N=Number(s.subtotal)||0,f=Number(s.descuento_global||s.descuento_general)||0,L=(N-f)*.13,T=Number(s.impuestos||s.impuesto)||L,U=s.cliente?.razon_social||s.cliente?.nombre_completo||s.cliente?.nombre||"Cliente Ejemplo S.A.",A=s.cliente?.identificacion||s.cliente?.cedula||"3-101-2562-32",V=s.cliente?.correo||s.cliente?.email||"cliente@ejemplo.com",k=s.cliente?.telefono||s.cliente?.celular||"2205-2525",q=s.cliente?.direccion||"San José, Costa Rica";return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 bg-white",children:[e.jsx(H,{isOpen:b.isOpen,type:b.type,message:b.message,onClose:S}),e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRYi7j4OFVRmD2T0m6NyFHqYa96zun92AUTIA&s",alt:"OLO Logo",className:"w-16 h-16 rounded-lg mr-4 object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Overseas Logistics Operations"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("p",{children:"Centro logístico IRO (CLIRO), Bodega 100A"}),e.jsx("p",{children:"200 mts al oeste de la Iglesia Católica El Coyol, Alajuela"}),e.jsx("p",{children:"Tel: 2205 2525 | Email: Olo@Olo.com"}),e.jsx("p",{children:"Cédula: 3-101-101010"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"COTIZACIÓN"}),e.jsxs("p",{className:"text-lg text-gray-600",children:["#",F]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información del Cliente"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",U]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Identificación:"})," ",A]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",V]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Teléfono:"})," ",k]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Dirección:"})," ",q]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Datos de la Cotización"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",h(P)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Vencimiento:"})," ",h(s.fecha_vencimiento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${s.estado==="Aprobada"||s.estado==="aprobada"?"bg-green-100 text-green-800":s.estado==="Pendiente"||s.estado==="pendiente"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.estado})]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Productos Cotizados"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold",children:"Código"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold",children:"Descripción"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-semibold",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-semibold",children:"Unidad"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-right font-semibold",children:"Precio Unit."}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-semibold",children:"Desc. %"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-semibold",children:"Imp. %"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-right font-semibold",children:"Total"})]})}),e.jsx("tbody",{children:s.cotizacion_items.map(r=>e.jsxs(B.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:r.producto?.codigo_producto||"SERV"}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.descripcion}),r.bom_items&&r.bom_items.length>0&&e.jsxs("button",{type:"button",className:"ml-2 text-sm text-blue-600 hover:text-blue-800 print:hidden transition-colors duration-200 flex items-center gap-1","aria-expanded":!!x[r.id],title:"Ver componentes",onClick:()=>E(r.id),children:[e.jsx("i",{className:`ri-eye-line transition-transform duration-300 ${x[r.id]?"rotate-180":""}`}),e.jsx("span",{className:"text-xs",children:x[r.id]?"Ocultar":"Ver"})]})]})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:Number(r.cantidad).toLocaleString("es-CR",{maximumFractionDigits:2})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:"UN"}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-right",children:a(Number(r.precio_unitario))}),e.jsxs("td",{className:"border border-gray-300 px-4 py-3 text-center",children:[Number(r.descuento||0).toFixed(1),"%"]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:"13%"}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-right font-semibold",children:a(Number(r.subtotal))})]}),(x[r.id]||typeof window>"u")&&r.bom_items&&r.bom_items.length>0&&e.jsx("tr",{className:"print:table-row",children:e.jsx("td",{colSpan:8,className:"p-0 border border-gray-300",children:e.jsxs("div",{className:"bom-block border-l-4 border-blue-200 bg-blue-50 px-6 py-4 ml-4 mr-2 my-2",children:[e.jsx("div",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Ítems utilizados:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-gray-600 bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3 border-b border-gray-200",children:"Código comp."}),e.jsx("th",{className:"text-left py-2 px-3 border-b border-gray-200",children:"Descripción"}),e.jsx("th",{className:"text-right py-2 px-3 border-b border-gray-200",children:"Cantidad"}),e.jsx("th",{className:"text-left py-2 px-3 border-b border-gray-200",children:"Unidad"}),e.jsx("th",{className:"text-right py-2 px-3 border-b border-gray-200",children:"Precio Unit."}),e.jsx("th",{className:"text-right py-2 px-3 border-b border-gray-200",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white",children:r.bom_items.map(t=>{const l=Number(r.cantidad)*Number(t.cantidad_x_unidad||0),o=Number(t.precio_ajustado||t.precio_unitario||t.precio_unitario_base||0),p=l*o;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 border-b border-gray-100",children:t.id_componente||"—"}),e.jsx("td",{className:"py-2 px-3 border-b border-gray-100",children:t.nombre_componente||"Sin descripción"}),e.jsx("td",{className:"text-right py-2 px-3 border-b border-gray-100",children:l.toLocaleString("es-CR",{maximumFractionDigits:2})}),e.jsx("td",{className:"py-2 px-3 border-b border-gray-100",children:t.unidad||"—"}),e.jsx("td",{className:"text-right py-2 px-3 border-b border-gray-100",children:a(o)}),e.jsx("td",{className:"text-right py-2 px-3 border-b border-gray-100 font-medium",children:a(p)})]},t.id)})})]})})]})})})]},r.id))})]})})]}),e.jsx("div",{className:"flex justify-end mb-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Subtotal:"}),e.jsx("span",{children:a(N)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Descuento:"}),e.jsxs("span",{children:["-",a(f)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Impuesto:"}),e.jsx("span",{children:a(T)})]}),s.flete&&Number(s.flete)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Flete:"}),e.jsx("span",{children:a(Number(s.flete))})]}),s.otros_cargos&&Number(s.otros_cargos)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Otros:"}),e.jsx("span",{children:a(Number(s.otros_cargos))})]}),e.jsx("div",{className:"border-t border-gray-300 pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:a(Number(s.total))})]})})]})})})}),(s.notas||s.observaciones)&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Observaciones"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-700",children:s.notas||s.observaciones})})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-6 text-center text-sm text-gray-600",children:[e.jsxs("p",{children:["Cotización generada el ",h(new Date().toISOString())]}),e.jsx("p",{className:"mt-2",children:"Overseas Logistics Operations - Sistema de Gestión de Cotizaciones"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-8 print:hidden",children:[e.jsxs("button",{onClick:()=>C("/cotizaciones"),className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors duration-200 flex items-center gap-2",children:[e.jsx("i",{className:"ri-arrow-left-line"}),"Volver a Cotizaciones"]}),e.jsx("button",{onClick:R,className:"w-12 h-12 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-full hover:from-orange-600 hover:to-orange-700 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-105",title:"Imprimir cotización",children:e.jsx("i",{className:"ri-printer-line text-xl"})})]})]})};function ee(){const{id:c}=w();return e.jsx(M,{})}export{ee as default};
//# sourceMappingURL=CotizacionDetalladaPage-D6DHg-sn.js.map
