{"version":3,"file":"page-B6HO1GGK.js","sources":["../../src/pages/optimizador/components/OptimizadorLayout.tsx","../../src/pages/optimizador/components/SelectorModo.tsx","../../src/services/productosService.ts","../../src/pages/optimizador/components/SelectorProductoBOM.tsx","../../src/services/optimizadorService.ts","../../src/pages/optimizador/components/BuscadorArticuloBlur.tsx","../../src/pages/optimizador/components/TablaPiezas.tsx","../../src/pages/optimizador/components/ImportarExcelModal.tsx","../../src/pages/optimizador/components/EditorPiezas.tsx","../../src/pages/optimizador/components/VisualizadorCortes.tsx","../../src/pages/optimizador/components/PanelResultados.tsx","../../src/pages/optimizador/components/ExportarExcelModal.tsx","../../src/services/optimizadorProyectoService.ts","../../src/pages/optimizador/components/CrearCotizacionModal.tsx","../../src/pages/optimizador/page.tsx"],"sourcesContent":["import { ReactNode } from 'react';\nimport Sidebar from '../../../components/feature/Sidebar';\nimport TopBar from '../../../components/feature/TopBar';\nimport MobileNav from '../../../components/feature/MobileNav';\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport default function OptimizadorLayout({ children }: Props) {\n  return (\n    <div className=\"flex h-screen bg-gray-50\">\n      <Sidebar />\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        <TopBar />\n        <main className=\"flex-1 overflow-y-auto\">\n          <div className=\"max-w-[1920px] mx-auto p-6\">\n            {children}\n          </div>\n        </main>\n      </div>\n      <MobileNav />\n    </div>\n  );\n}\n","import { ModoOptimizador } from '../../../types/optimizador';\n\ninterface Props {\n  modo: ModoOptimizador;\n  onCambiarModo: (modo: ModoOptimizador) => void;\n  productoBOM?: { id: number; nombre: string } | null;\n}\n\nexport default function SelectorModo({ modo, onCambiarModo, productoBOM }: Props) {\n  return (\n    <div className=\"space-y-3\">\n      <label className=\"block text-sm font-medium text-gray-700\">\n        Modo de Trabajo\n      </label>\n      \n      <div className=\"grid grid-cols-2 gap-4\">\n        {/* Modo BOM */}\n        <button\n          onClick={() => onCambiarModo('bom')}\n          className={`relative p-4 rounded-lg border-2 transition-all ${\n            modo === 'bom'\n              ? 'border-blue-500 bg-blue-50'\n              : 'border-gray-200 bg-white hover:border-gray-300'\n          }`}\n        >\n          <div className=\"flex items-start gap-3\">\n            <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${\n              modo === 'bom' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'\n            }`}>\n              <i className=\"ri-file-list-3-line text-xl\"></i>\n            </div>\n            <div className=\"flex-1 text-left\">\n              <h3 className=\"font-semibold text-gray-900 mb-1\">Modo BOM</h3>\n              <p className=\"text-sm text-gray-600\">\n                Cargar piezas desde un producto existente\n              </p>\n              {modo === 'bom' && productoBOM && (\n                <div className=\"mt-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded\">\n                  {productoBOM.nombre}\n                </div>\n              )}\n            </div>\n          </div>\n          {modo === 'bom' && (\n            <div className=\"absolute top-2 right-2\">\n              <i className=\"ri-checkbox-circle-fill text-blue-500 text-xl\"></i>\n            </div>\n          )}\n        </button>\n\n        {/* Modo Manual */}\n        <button\n          onClick={() => onCambiarModo('manual')}\n          className={`relative p-4 rounded-lg border-2 transition-all ${\n            modo === 'manual'\n              ? 'border-blue-500 bg-blue-50'\n              : 'border-gray-200 bg-white hover:border-gray-300'\n          }`}\n        >\n          <div className=\"flex items-start gap-3\">\n            <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${\n              modo === 'manual' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'\n            }`}>\n              <i className=\"ri-edit-box-line text-xl\"></i>\n            </div>\n            <div className=\"flex-1 text-left\">\n              <h3 className=\"font-semibold text-gray-900 mb-1\">Modo Manual</h3>\n              <p className=\"text-sm text-gray-600\">\n                Agregar piezas personalizadas una por una\n              </p>\n            </div>\n          </div>\n          {modo === 'manual' && (\n            <div className=\"absolute top-2 right-2\">\n              <i className=\"ri-checkbox-circle-fill text-blue-500 text-xl\"></i>\n            </div>\n          )}\n        </button>\n      </div>\n    </div>\n  );\n}\n","\nimport { supabase } from '../lib/supabase';\n\nexport interface ProductoFilters {\n  search?: string;\n  categoria?: string;\n  activo?: boolean;\n}\n\nexport const getProductos = async (filters: ProductoFilters = {}, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: [], error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    let query = supabase\n      .from('productos')\n      .select(`\n        *,\n        categoria:categorias(nombre)\n      `)\n      .eq('tienda_id', currentStore.id); // FILTRO OBLIGATORIO POR TIENDA\n\n    if (filters.search) {\n      query = query.or(`nombre.ilike.%${filters.search}%,codigo.ilike.%${filters.search}%,descripcion.ilike.%${filters.search}%`);\n    }\n\n    if (filters.categoria) {\n      query = query.eq('categoria_id', filters.categoria);\n    }\n\n    if (filters.activo !== undefined) {\n      query = query.eq('activo', filters.activo);\n    }\n\n    query = query.order('created_at', { ascending: false });\n\n    const { data, error } = await query;\n\n    return { data: data || [], error };\n  } catch (error) {\n    console.error('Error fetching productos:', error);\n    return { data: [], error };\n  }\n};\n\nexport const getProductoById = async (id: string, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: null, error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('productos')\n      .select(`\n        *,\n        categoria:categorias(nombre)\n      `)\n      .eq('id', id)\n      .eq('tienda_id', currentStore.id) // FILTRO OBLIGATORIO POR TIENDA\n      .single();\n\n    return { data, error };\n  } catch (error) {\n    console.error('Error fetching producto:', error);\n    return { data: null, error };\n  }\n};\n\nexport const createProducto = async (producto: any, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: null, error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('productos')\n      .insert([{\n        ...producto,\n        tienda_id: currentStore.id // INCLUIR TIENDA_ID OBLIGATORIO\n      }])\n      .select()\n      .single();\n\n    return { data, error };\n  } catch (error) {\n    console.error('Error creating producto:', error);\n    return { data: null, error };\n  }\n};\n\nexport const updateProducto = async (id: string, producto: any, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: null, error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('productos')\n      .update(producto)\n      .eq('id', id)\n      .eq('tienda_id', currentStore.id) // FILTRO OBLIGATORIO POR TIENDA\n      .select()\n      .single();\n\n    return { data, error };\n  } catch (error) {\n    console.error('Error updating producto:', error);\n    return { data: null, error };\n  }\n};\n\nexport const deleteProducto = async (id: string, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { error } = await supabase\n      .from('productos')\n      .delete()\n      .eq('id', id)\n      .eq('tienda_id', currentStore.id); // FILTRO OBLIGATORIO POR TIENDA\n\n    return { error };\n  } catch (error) {\n    console.error('Error deleting producto:', error);\n    return { error };\n  }\n};\n\nexport const buscarProductos = async (search: string, currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: [], error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('productos')\n      .select('id, nombre, codigo, precio_venta')\n      .eq('tienda_id', currentStore.id) // FILTRO OBLIGATORIO POR TIENDA\n      .or(`nombre.ilike.%${search}%,codigo.ilike.%${search}%`)\n      .eq('activo', true)\n      .limit(10);\n\n    return { data: data || [], error };\n  } catch (error) {\n    console.error('Error searching productos:', error);\n    return { data: [], error };\n  }\n};\n","import { useState, useEffect } from 'react';\nimport { useAuth } from '../../../hooks/useAuth';\nimport { getProductos } from '../../../services/productosService';\n\ninterface Props {\n  onSeleccionar: (productoId: number, productoNombre: string) => void;\n}\n\nexport default function SelectorProductoBOM({ onSeleccionar }: Props) {\n  const { tiendaActual } = useAuth();\n  const [productos, setProductos] = useState<any[]>([]);\n  const [busqueda, setBusqueda] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    cargarProductos();\n  }, [tiendaActual]);\n\n  const cargarProductos = async () => {\n    setLoading(true);\n    try {\n      const { data } = await getProductos({ activo: true }, tiendaActual);\n      setProductos(data || []);\n    } catch (error) {\n      console.error('Error cargando productos:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const productosFiltrados = productos.filter(p =>\n    p.nombre.toLowerCase().includes(busqueda.toLowerCase()) ||\n    p.codigo.toLowerCase().includes(busqueda.toLowerCase())\n  );\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"relative\">\n        <input\n          type=\"text\"\n          value={busqueda}\n          onChange={(e) => setBusqueda(e.target.value)}\n          placeholder=\"Buscar producto por nombre o c√≥digo...\"\n          className=\"w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        />\n        <i className=\"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"></i>\n      </div>\n\n      {loading ? (\n        <div className=\"text-center py-8\">\n          <i className=\"ri-loader-4-line animate-spin text-3xl text-gray-400\"></i>\n          <p className=\"text-gray-600 mt-2\">Cargando productos...</p>\n        </div>\n      ) : productosFiltrados.length > 0 ? (\n        <div className=\"grid grid-cols-1 gap-3 max-h-96 overflow-y-auto\">\n          {productosFiltrados.map((producto) => (\n            <button\n              key={producto.id}\n              onClick={() => onSeleccionar(producto.id, producto.nombre)}\n              className=\"p-4 bg-white border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                  <i className=\"ri-product-hunt-line text-blue-600 text-xl\"></i>\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <span className=\"bg-gray-100 text-gray-700 text-xs px-2 py-0.5 rounded\">\n                      {producto.codigo}\n                    </span>\n                    <span className=\"font-semibold text-gray-900\">{producto.nombre}</span>\n                  </div>\n                  {producto.descripcion && (\n                    <p className=\"text-sm text-gray-600 line-clamp-1\">{producto.descripcion}</p>\n                  )}\n                </div>\n                <i className=\"ri-arrow-right-line text-gray-400\"></i>\n              </div>\n            </button>\n          ))}\n        </div>\n      ) : (\n        <div className=\"text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n          <i className=\"ri-inbox-line text-3xl text-gray-400 mb-2\"></i>\n          <p className=\"text-gray-600\">\n            {busqueda ? 'No se encontraron productos' : 'No hay productos disponibles'}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { supabase } from '../lib/supabase';\nimport type { \n  ArticuloInventario, \n  PiezaCorte, \n  ConfiguracionCorte,\n  ResultadoOptimizacion,\n  LaminaCorte,\n  ResultadoPorMaterial,\n  ProyectoOptimizador,\n  TipoVeta\n} from '../types/optimizador';\n\n// Buscar art√≠culos en inventario (l√°minas o tapacantos)\nexport async function buscarArticulosInventario(\n  search: string = '',\n  tipo: 'articulo' | 'lamina' | 'tapacanto' | 'hh' | 'consumible' | 'perforacion' | 'mecanizado' | null = 'articulo',\n  currentStore?: { id: string; nombre: string } | null\n): Promise<{ data: ArticuloInventario[]; error: any }> {\n  try {\n    console.log('üîç [OPTIMIZADOR] buscarArticulosInventario - INICIO', {\n      search,\n      tipo,\n      tienda: currentStore?.nombre\n    });\n\n    // ‚úÖ Validar que existe tienda\n    if (!currentStore?.id) {\n      console.error('‚ùå [OPTIMIZADOR] No hay tienda seleccionada');\n      return { data: [], error: { message: 'No hay tienda seleccionada' } };\n    }\n\n    // üîß B√öSQUEDA GENERAL: Si tipo es null, buscar en TODO el inventario\n    if (tipo === null) {\n      console.log('üîç [OPTIMIZADOR] ‚≠ê B√öSQUEDA GENERAL - Sin restricci√≥n de categor√≠a');\n      console.log('üîç [OPTIMIZADOR] Par√°metros de b√∫squeda:', {\n        termino: search || '(sin t√©rmino - mostrar primeros 50)',\n        filtro_tienda: currentStore.nombre,\n        filtro_categoria: 'NINGUNA (busca en todas)'\n      });\n\n      // üîß Query base: solo filtrar por tienda y activo\n      let query = supabase\n        .from('inventario')\n        .select('*')\n        .eq('activo', true)\n        .or(`tienda_id.eq.${currentStore.id},tienda_id.is.null`);\n\n      // ‚úÖ B√∫squeda por c√≥digo O descripci√≥n (sin restricci√≥n de categor√≠a)\n      if (search && search.trim().length > 0) {\n        const searchTerm = `%${search.trim()}%`;\n        console.log('üîç [OPTIMIZADOR] Buscando t√©rmino:', searchTerm);\n        \n        query = query.or(`codigo_articulo.ilike.${searchTerm},descripcion_articulo.ilike.${searchTerm}`);\n      }\n\n      query = query.limit(50);\n\n      const { data, error } = await query;\n\n      if (error) {\n        console.error('‚ùå [OPTIMIZADOR] Error en query general:', error);\n        return { data: [], error };\n      }\n\n      console.log('‚úÖ [OPTIMIZADOR] Resultados encontrados:', {\n        total: data?.length || 0,\n        primeros_5: data?.slice(0, 5).map(item => ({\n          codigo: item.codigo_articulo,\n          descripcion: item.descripcion_articulo,\n          categoria_id: item.categoria_id,\n          precio: item.precio_articulo\n        }))\n      });\n\n      // üîß Obtener nombres de categor√≠as en una segunda query\n      const categoriaIds = [...new Set(data?.map(item => item.categoria_id).filter(Boolean))];\n      let categoriasMap = new Map<number, string>();\n\n      if (categoriaIds.length > 0) {\n        const { data: categoriasData } = await supabase\n          .from('categorias_inventario')\n          .select('id_categoria, nombre_categoria')\n          .in('id_categoria', categoriaIds);\n\n        if (categoriasData) {\n          categoriasData.forEach(cat => {\n            categoriasMap.set(cat.id_categoria, cat.nombre_categoria);\n          });\n        }\n      }\n\n      console.log(`‚úÖ [OPTIMIZADOR] B√∫squeda GENERAL completada:`, {\n        total_resultados: data?.length || 0,\n        categorias_encontradas: categoriasMap.size,\n        primeros_3: data?.slice(0, 3).map(item => ({\n          codigo: item.codigo_articulo,\n          descripcion: item.descripcion_articulo,\n          categoria: categoriasMap.get(item.categoria_id) || 'Sin categor√≠a',\n          precio: item.precio_articulo\n        }))\n      });\n\n      // Mapear a ArticuloInventario\n      const articulosMapeados: ArticuloInventario[] = (data || []).map(item => ({\n        id: item.id_articulo,\n        id_articulo: item.id_articulo,\n        codigo_articulo: item.codigo_articulo,\n        descripcion_articulo: item.descripcion_articulo,\n        categoria_nombre: categoriasMap.get(item.categoria_id) || 'Sin categor√≠a',\n        espesor_mm: item.espesor_mm || 0,\n        largo_lamina: item.largo_lamina_mm || 0,\n        ancho_lamina: item.ancho_lamina_mm || 0,\n        largo_lamina_mm: item.largo_lamina_mm || 0,\n        ancho_lamina_mm: item.ancho_lamina_mm || 0,\n        ancho_tapacanto_mm: item.ancho_tapacanto_mm || 0,\n        grosor_tapacanto_mm: item.grosor_tapacanto_mm || 0,\n        precio_unitario: item.precio_articulo || 0\n      }));\n\n      return { data: articulosMapeados, error: null };\n    }\n\n    // ‚úÖ B√öSQUEDA POR CATEGOR√çA ESPEC√çFICA (c√≥digo original para l√°minas y tapacantos)\n    let nombreCategoria = 'LAMINAS'; // Por defecto\n    \n    if (tipo === 'tapacanto') {\n      nombreCategoria = 'TAPACANTOS';\n      console.log('üîç [OPTIMIZADOR] Buscando TAPACANTOS en inventario...');\n    } else if (tipo === 'lamina') {\n      nombreCategoria = 'LAMINAS';\n      console.log('üìÇ [OPTIMIZADOR] Buscando LAMINAS en inventario...');\n    } else if (tipo === 'mecanizado') {\n      nombreCategoria = 'MECANIZADO';\n      console.log('üîß [OPTIMIZADOR] Buscando MECANIZADO en inventario...');\n    }\n\n    console.log(`üìÇ [OPTIMIZADOR] Buscando categor√≠a \"${nombreCategoria}\" en categorias_inventario...`);\n    const { data: categoriaData, error: categoriaError } = await supabase\n      .from('categorias_inventario')\n      .select('id_categoria')\n      .eq('nombre_categoria', nombreCategoria)\n      .single();\n\n    if (categoriaError || !categoriaData) {\n      console.error(`‚ùå [OPTIMIZADOR] No se encontr√≥ la categor√≠a ${nombreCategoria}:`, categoriaError);\n      return { data: [], error: categoriaError };\n    }\n\n    console.log(`‚úÖ [OPTIMIZADOR] Categor√≠a ${nombreCategoria} encontrada:`, categoriaData);\n\n    // ‚úÖ PASO 2: Buscar art√≠culos con esa categor√≠a - üÜï INCLUIR CAMPOS DE TAPACANTO\n    let query = supabase\n      .from('inventario')\n      .select(`\n        id_articulo,\n        codigo_articulo,\n        descripcion_articulo,\n        categoria_id,\n        espesor_mm,\n        largo_lamina_mm,\n        ancho_lamina_mm,\n        ancho_tapacanto_mm,\n        grosor_tapacanto_mm,\n        precio_articulo,\n        activo\n      `)\n      .eq('categoria_id', categoriaData.id_categoria)\n      .eq('activo', true);\n\n    // ‚úÖ Filtrar por tienda si existe\n    if (currentStore?.id) {\n      // üÜï CORRECCI√ìN: Incluir art√≠culos de la tienda O art√≠culos globales (tienda_id = null)\n      query = query.or(`tienda_id.eq.${currentStore.id},tienda_id.is.null`);\n      console.log('üè™ [OPTIMIZADOR] Filtrando por tienda:', currentStore.nombre, '(incluye art√≠culos globales)');\n    }\n\n    // ‚úÖ CORRECCI√ìN: Usar filtros separados en lugar de .or() para evitar problemas con caracteres especiales\n    if (search && search.trim().length > 0) {\n      const searchTerm = `%${search.trim()}%`;\n      // Usar dos queries separadas y combinar resultados\n      const [resultCodigo, resultDescripcion] = await Promise.all([\n        supabase\n          .from('inventario')\n          .select(`\n            id_articulo,\n            codigo_articulo,\n            descripcion_articulo,\n            categoria_id,\n            espesor_mm,\n            largo_lamina_mm,\n            ancho_lamina_mm,\n            ancho_tapacanto_mm,\n            grosor_tapacanto_mm,\n            precio_articulo,\n            activo\n          `)\n          .eq('categoria_id', categoriaData.id_categoria)\n          .eq('activo', true)\n          .or(`tienda_id.eq.${currentStore?.id || ''},tienda_id.is.null`)\n          .ilike('codigo_articulo', searchTerm)\n          .limit(25),\n        supabase\n          .from('inventario')\n          .select(`\n            id_articulo,\n            codigo_articulo,\n            descripcion_articulo,\n            categoria_id,\n            espesor_mm,\n            largo_lamina_mm,\n            ancho_lamina_mm,\n            ancho_tapacanto_mm,\n            grosor_tapacanto_mm,\n            precio_articulo,\n            activo\n          `)\n          .eq('categoria_id', categoriaData.id_categoria)\n          .eq('activo', true)\n          .or(`tienda_id.eq.${currentStore?.id || ''},tienda_id.is.null`)\n          .ilike('descripcion_articulo', searchTerm)\n          .limit(25)\n      ]);\n\n      // Combinar resultados y eliminar duplicados\n      const combinedData = [\n        ...(resultCodigo.data || []),\n        ...(resultDescripcion.data || [])\n      ];\n      \n      // Eliminar duplicados por id_articulo\n      const uniqueData = Array.from(\n        new Map(combinedData.map(item => [item.id_articulo, item])).values()\n      );\n\n      console.log(`‚úÖ [OPTIMIZADOR] Query exitosa - Resultados RAW (${nombreCategoria}):`, {\n        total_resultados: uniqueData.length,\n        primeros_3: uniqueData.slice(0, 3).map(item => ({\n          codigo: item.codigo_articulo,\n          descripcion: item.descripcion_articulo,\n          categoria_id: item.categoria_id,\n          espesor: item.espesor_mm,\n          largo: item.largo_lamina_mm,\n          ancho: item.ancho_lamina_mm,\n          grosor_tc: item.grosor_tapacanto_mm,\n          precio: item.precio_articulo\n        }))\n      });\n\n      // ‚úÖ PASO 3: Para LAMINAS, filtrar solo las que tienen dimensiones completas\n      // Para TAPACANTOS y MECANIZADO, no es necesario validar dimensiones de l√°mina\n      let articulosValidos = uniqueData;\n      \n      if (tipo === 'lamina') {\n        articulosValidos = uniqueData.filter(item => {\n          const tieneEspesor = item.espesor_mm != null && item.espesor_mm > 0;\n          const tieneLargo = item.largo_lamina_mm != null && item.largo_lamina_mm > 0;\n          const tieneAncho = item.ancho_lamina_mm != null && item.ancho_lamina_mm > 0;\n\n          if (!tieneEspesor || !tieneLargo || !tieneAncho) {\n            console.warn('‚ö†Ô∏è [OPTIMIZADOR] L√°mina descartada (faltan dimensiones):', {\n              codigo: item.codigo_articulo,\n              descripcion: item.descripcion_articulo,\n              espesor: item.espesor_mm,\n              largo: item.largo_lamina_mm,\n              ancho: item.ancho_lamina_mm\n            });\n            return false;\n          }\n\n          return true;\n        });\n\n        console.log('üéâ [OPTIMIZADOR] L√°minas v√°lidas encontradas:', {\n          total: articulosValidos.length,\n          laminas: articulosValidos.map(l => ({\n            codigo: l.codigo_articulo,\n            descripcion: l.descripcion_articulo,\n            dimensiones: `${l.largo_lamina_mm}x${l.ancho_lamina_mm}x${l.espesor_mm}mm`,\n            precio: l.precio_articulo\n          }))\n        });\n      } else if (tipo === 'tapacanto') {\n        console.log('üéâ [OPTIMIZADOR] Tapacantos encontrados:', {\n          total: articulosValidos.length,\n          tapacantos: articulosValidos.map(tc => ({\n            codigo: tc.codigo_articulo,\n            descripcion: tc.descripcion_articulo,\n            grosor: tc.grosor_tapacanto_mm,\n            precio: tc.precio_articulo\n          }))\n        });\n      } else if (tipo === 'mecanizado') {\n        console.log('üéâ [OPTIMIZADOR] Art√≠culos de MECANIZADO encontrados:', {\n          total: articulosValidos.length,\n          articulos: articulosValidos.map(art => ({\n            codigo: art.codigo_articulo,\n            descripcion: art.descripcion_articulo,\n            precio: art.precio_articulo\n          }))\n        });\n      }\n\n      // ‚úÖ PASO 4: Mapear a ArticuloInventario\n      const articulosMapeados: ArticuloInventario[] = articulosValidos.map(item => ({\n        id: item.id_articulo,\n        id_articulo: item.id_articulo,\n        codigo_articulo: item.codigo_articulo,\n        descripcion_articulo: item.descripcion_articulo,\n        categoria_nombre: nombreCategoria,\n        espesor_mm: item.espesor_mm || 0,\n        largo_lamina: item.largo_lamina_mm || 0,\n        ancho_lamina: item.ancho_lamina_mm || 0,\n        largo_lamina_mm: item.largo_lamina_mm || 0,\n        ancho_lamina_mm: item.ancho_lamina_mm || 0,\n        ancho_tapacanto_mm: item.ancho_tapacanto_mm || 0,\n        grosor_tapacanto_mm: item.grosor_tapacanto_mm || 0,\n        precio_unitario: item.precio_articulo || 0\n      }));\n\n      return { data: articulosMapeados, error: null };\n    }\n\n    query = query.limit(50);\n\n    console.log('‚è≥ [OPTIMIZADOR] Ejecutando query en Supabase...');\n    const { data, error } = await query;\n\n    if (error) {\n      console.error('‚ùå [OPTIMIZADOR] Error en query:', error);\n      return { data: [], error };\n    }\n\n    console.log(`‚úÖ [OPTIMIZADOR] Query exitosa - Resultados RAW (${nombreCategoria}):`, {\n      total_resultados: data?.length || 0,\n      primeros_3: data?.slice(0, 3).map(item => ({\n        codigo: item.codigo_articulo,\n        descripcion: item.descripcion_articulo,\n        categoria_id: item.categoria_id,\n        espesor: item.espesor_mm,\n        largo: item.largo_lamina_mm,\n        ancho: item.ancho_lamina_mm,\n        grosor_tc: item.grosor_tapacanto_mm,\n        precio: item.precio_articulo\n      }))\n    });\n\n    // ‚úÖ PASO 3: Para LAMINAS, filtrar solo las que tienen dimensiones completas\n    // Para TAPACANTOS y MECANIZADO, no es necesario validar dimensiones de l√°mina\n    let articulosValidos = data;\n    \n    if (tipo === 'lamina') {\n      articulosValidos = data.filter(item => {\n        const tieneEspesor = item.espesor_mm != null && item.espesor_mm > 0;\n        const tieneLargo = item.largo_lamina_mm != null && item.largo_lamina_mm > 0;\n        const tieneAncho = item.ancho_lamina_mm != null && item.ancho_lamina_mm > 0;\n\n        if (!tieneEspesor || !tieneLargo || !tieneAncho) {\n          console.warn('‚ö†Ô∏è [OPTIMIZADOR] L√°mina descartada (faltan dimensiones):', {\n            codigo: item.codigo_articulo,\n            descripcion: item.descripcion_articulo,\n            espesor: item.espesor_mm,\n            largo: item.largo_lamina_mm,\n            ancho: item.ancho_lamina_mm\n          });\n          return false;\n        }\n\n        return true;\n      });\n\n      console.log('üéâ [OPTIMIZADOR] L√°minas v√°lidas encontradas:', {\n        total: articulosValidos.length,\n        laminas: articulosValidos.map(l => ({\n          codigo: l.codigo_articulo,\n          descripcion: l.descripcion_articulo,\n          dimensiones: `${l.largo_lamina_mm}x${l.ancho_lamina_mm}x${l.espesor_mm}mm`,\n          precio: l.precio_articulo\n        }))\n      });\n    } else if (tipo === 'tapacanto') {\n      console.log('üéâ [OPTIMIZADOR] Tapacantos encontrados:', {\n        total: articulosValidos.length,\n        tapacantos: articulosValidos.map(tc => ({\n          codigo: tc.codigo_articulo,\n          descripcion: tc.descripcion_articulo,\n          grosor: tc.grosor_tapacanto_mm,\n          precio: tc.precio_articulo\n        }))\n      });\n    } else if (tipo === 'mecanizado') {\n      console.log('üéâ [OPTIMIZADOR] Art√≠culos de MECANIZADO encontrados:', {\n        total: articulosValidos.length,\n        articulos: articulosValidos.map(art => ({\n          codigo: art.codigo_articulo,\n          descripcion: art.descripcion_articulo,\n          precio: art.precio_articulo\n        }))\n      });\n    }\n\n    // ‚úÖ PASO 4: Mapear a ArticuloInventario\n    const articulosMapeados: ArticuloInventario[] = articulosValidos.map(item => ({\n      id: item.id_articulo,\n      id_articulo: item.id_articulo,\n      codigo_articulo: item.codigo_articulo,\n      descripcion_articulo: item.descripcion_articulo,\n      categoria_nombre: nombreCategoria,\n      espesor_mm: item.espesor_mm || 0,\n      largo_lamina: item.largo_lamina_mm || 0,\n      ancho_lamina: item.ancho_lamina_mm || 0,\n      largo_lamina_mm: item.largo_lamina_mm || 0,\n      ancho_lamina_mm: item.ancho_lamina_mm || 0,\n      ancho_tapacanto_mm: item.ancho_tapacanto_mm || 0,\n      grosor_tapacanto_mm: item.grosor_tapacanto_mm || 0,\n      precio_unitario: item.precio_articulo || 0\n    }));\n\n    return { data: articulosMapeados, error: null };\n  } catch (error) {\n    console.error('‚ùå [OPTIMIZADOR] Error inesperado:', error);\n    return { data: [], error };\n  }\n};\n\n// ============================================\n// CARGAR PIEZAS DESDE BOM\n// ============================================\n\nexport const cargarPiezasDesdeBOM = async (\n  productoId: number,\n  currentStore: { id: string } | null = null\n): Promise<{ data: PiezaCorte[] | null; error: any }> => {\n  if (!currentStore) {\n    return { data: null, error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    // Obtener componentes del BOM\n    const { data: bomItems, error: bomError } = await supabase\n      .from('bom_items')\n      .select(`\n        id,\n        id_componente,\n        cantidad_x_unidad,\n        unidad_id,\n        precio_ajustado,\n        inventario!inner(\n          id_articulo,\n          codigo_articulo,\n          descripcion_articulo,\n          categoria_id,\n          espesor_mm,\n          largo_lamina_mm,\n          ancho_lamina_mm,\n          precio_articulo\n        ),\n        unidades_medida!inner(simbolo)\n      `)\n      .eq('id_producto', productoId);\n\n    if (bomError) throw bomError;\n\n    const piezas: PiezaCorte[] = (bomItems || [])\n      .filter((item: any) => {\n        // Solo incluir piezas que sean l√°minas/tableros\n        const inv = item.inventario;\n        return inv.largo_lamina_mm && inv.ancho_lamina_mm;\n      })\n      .map((item: any) => {\n        const inv = item.inventario;\n        const largo = inv.largo_lamina_mm || 0;\n        const ancho = inv.ancho_lamina_mm || 0;\n        \n        return {\n          id: `bom-${item.id}`,\n          descripcion: inv.descripcion_articulo,\n          material_id: inv.id_articulo,\n          material_codigo: inv.codigo_articulo,\n          material_descripcion: inv.descripcion_articulo,\n          material_precio: item.precio_ajustado || inv.precio_articulo,\n          material_espesor_mm: inv.espesor_mm,\n          material_largo_lamina_mm: inv.largo_lamina_mm,\n          material_ancho_lamina_mm: inv.ancho_lamina_mm,\n          largo,\n          ancho,\n          cantidad: item.cantidad_x_unidad,\n          veta: determinarVetaAutomatica(largo, ancho),\n          tapacantos: [],\n          cnc1: '',\n          cnc2: '',\n          color: generarColorAleatorio()\n        } as PiezaCorte;\n      });\n\n    return { data: piezas, error: null };\n  } catch (error) {\n    console.error('Error cargando piezas desde BOM:', error);\n    return { data: null, error };\n  }\n};\n\n// ============================================\n// üÜï CALCULAR DIMENSIONES DE CORTE CON COMPENSACI√ìN DE TAPACANTO\n// ============================================\n\n/**\n * Calcula las dimensiones de corte ajustadas por grosor de tapacanto\n * \n * REGLA: Si un lado lleva tapacanto, la dimensi√≥n del corte debe reducirse\n * por el grosor para que al pegar el tapacanto la medida final sea la original.\n * \n * INTERPRETACI√ìN POR LADO:\n * - TC Superior e Inferior afectan el ANCHO (porque van a lo largo)\n * - TC Izquierdo y Derecho afectan el LARGO (porque van a lo ancho)\n * \n * @param pieza - Pieza con dimensiones finales y tapacantos asignados\n * @param inventarioTapacantos - Map con informaci√≥n de tapacantos del inventario\n * @returns Objeto con largo_corte_mm y ancho_corte_mm, o null si hay error\n */\nasync function calcularDimensionesCorte(\n  pieza: PiezaCorte,\n  inventarioTapacantos: Map<string, { grosor_mm: number }>\n): Promise<{ largo_corte_mm: number; ancho_corte_mm: number; error?: string } | null> {\n  const largoOriginal = pieza.largo;\n  const anchoOriginal = pieza.ancho;\n\n  console.log(`  üìê [COMPENSACI√ìN TC] Calculando dimensiones de corte para \"${pieza.descripcion}\"`);\n  console.log(`    üìè Dimensiones originales (finales): ${largoOriginal} √ó ${anchoOriginal} mm`);\n\n  // Inicializar ajustes\n  let ajusteLargo = 0;\n  let ajusteAncho = 0;\n\n  // Procesar cada tapacanto\n  if (pieza.tapacantos && pieza.tapacantos.length > 0) {\n    for (const tc of pieza.tapacantos) {\n      if (!tc.codigo || tc.codigo === 'Sin TC') continue;\n\n      // Buscar grosor en inventario\n      const infoTC = inventarioTapacantos.get(tc.codigo);\n      const grosor = infoTC?.grosor_mm || tc.grosor_mm || 0;\n\n      if (grosor <= 0) {\n        console.warn(`    ‚ö†Ô∏è [COMPENSACI√ìN TC] Tapacanto \"${tc.codigo}\" sin grosor definido en inventario`);\n        continue;\n      }\n\n      console.log(`    üîß [COMPENSACI√ìN TC] ${tc.lado}: \"${tc.codigo}\" - Grosor: ${grosor} mm`);\n\n      // Aplicar ajuste seg√∫n el lado\n      switch (tc.lado) {\n        case 'superior':\n        case 'inferior':\n          // TC Superior e Inferior afectan el ANCHO\n          ajusteAncho += grosor;\n          console.log(`      ‚Üí Reducir ANCHO en ${grosor} mm`);\n          break;\n        case 'izquierdo':\n        case 'derecho':\n          // TC Izquierdo y Derecho afectan el LARGO\n          ajusteLargo += grosor;\n          console.log(`      ‚Üí Reducir LARGO en ${grosor} mm`);\n          break;\n      }\n    }\n  }\n\n  // Calcular dimensiones de corte\n  const largoCorte = largoOriginal - ajusteLargo;\n  const anchoCorte = anchoOriginal - ajusteAncho;\n\n  console.log(`    üìä [COMPENSACI√ìN TC] Ajustes totales: Largo -${ajusteLargo} mm, Ancho -${ajusteAncho} mm`);\n  console.log(`    ‚úÇÔ∏è [COMPENSACI√ìN TC] Dimensiones de corte: ${largoCorte} √ó ${anchoCorte} mm`);\n\n  // üö® VALIDACI√ìN CR√çTICA: Dimensiones de corte deben ser > 0\n  if (largoCorte <= 0) {\n    const error = `‚ùå Dimensi√≥n de corte LARGO inv√°lida (${largoCorte} mm). El grosor de los tapacantos izquierdo/derecho (${ajusteLargo} mm) excede la dimensi√≥n original (${largoOriginal} mm).`;\n    console.error(`    ${error}`);\n    return { largo_corte_mm: largoCorte, ancho_corte_mm: anchoCorte, error };\n  }\n\n  if (anchoCorte <= 0) {\n    const error = `‚ùå Dimensi√≥n de corte ANCHO inv√°lida (${anchoCorte} mm). El grosor de los tapacantos superior/inferior (${ajusteAncho} mm) excede la dimensi√≥n original (${anchoOriginal} mm).`;\n    console.error(`    ${error}`);\n    return { largo_corte_mm: largoCorte, ancho_corte_mm: anchoCorte, error };\n  }\n\n  console.log(`    ‚úÖ [COMPENSACI√ìN TC] Dimensiones de corte v√°lidas`);\n\n  return {\n    largo_corte_mm: largoCorte,\n    ancho_corte_mm: anchoCorte\n  };\n}\n\n// ============================================\n// üÜï OBTENER INFORMACI√ìN DE TAPACANTOS DEL INVENTARIO\n// ============================================\n\nasync function obtenerInfoTapacantos(\n  codigosTapacantos: string[],\n  currentStore: { id: string } | null\n): Promise<Map<string, { grosor_mm: number; precio: number }>> {\n  const infoMap = new Map<string, { grosor_mm: number; precio: number }>();\n\n  if (codigosTapacantos.length === 0) return infoMap;\n\n  try {\n    console.log('üîç [INVENTARIO TC] Buscando informaci√≥n de tapacantos:', codigosTapacantos);\n\n    const { data, error } = await supabase\n      .from('inventario')\n      .select('codigo_articulo, grosor_tapacanto_mm, precio_articulo')\n      .in('codigo_articulo', codigosTapacantos);\n\n    if (error) {\n      console.error('‚ùå [INVENTARIO TC] Error buscando tapacantos:', error);\n      return infoMap;\n    }\n\n    if (data) {\n      data.forEach(item => {\n        infoMap.set(item.codigo_articulo, {\n          grosor_mm: item.grosor_tapacanto_mm || 0,\n          precio: item.precio_articulo || 0\n        });\n      });\n\n      console.log('‚úÖ [INVENTARIO TC] Informaci√≥n obtenida:', {\n        total: infoMap.size,\n        detalle: Array.from(infoMap.entries()).map(([codigo, info]) => ({\n          codigo,\n          grosor: info.grosor_mm,\n          precio: info.precio\n        }))\n      });\n    }\n  } catch (error) {\n    console.error('‚ùå [INVENTARIO TC] Error inesperado:', error);\n  }\n\n  return infoMap;\n}\n\n// ============================================\n// ALGORITMO DE OPTIMIZACI√ìN DE CORTES 2D\n// üÜï MEJORADO: Agrupa por material y optimiza cada grupo\n// üÜï INCLUYE: Compensaci√≥n de tapacanto por grosor\n// ============================================\n\nexport const optimizarCortes = async (\n  piezas: PiezaCorte[],\n  config: ConfiguracionCorte,\n  currentStore: { id: string } | null = null\n): Promise<ResultadoOptimizacion> => {\n  console.log('üöÄ [OPTIMIZADOR] Iniciando optimizaci√≥n de cortes', {\n    total_piezas: piezas.length,\n    configuracion: config\n  });\n\n  // üÜï VALIDACI√ìN CR√çTICA: Verificar que hay piezas\n  if (!piezas || piezas.length === 0) {\n    console.error('‚ùå [OPTIMIZADOR] No hay piezas para optimizar');\n    throw new Error('No hay piezas para optimizar');\n  }\n\n  // üÜï PASO 0: Obtener informaci√≥n de tapacantos del inventario\n  const codigosTapacantos = new Set<string>();\n  piezas.forEach(pieza => {\n    if (pieza.tapacantos) {\n      pieza.tapacantos.forEach(tc => {\n        if (tc.codigo && tc.codigo !== 'Sin TC') {\n          codigosTapacantos.add(tc.codigo);\n        }\n      });\n    }\n  });\n\n  const inventarioTapacantos = await obtenerInfoTapacantos(\n    Array.from(codigosTapacantos),\n    currentStore\n  );\n\n  // üÜï PASO 0.5: Calcular dimensiones de corte para cada pieza\n  const piezasConDimensionesCorte: PiezaCorte[] = [];\n  const erroresValidacion: string[] = [];\n\n  for (const pieza of piezas) {\n    const resultado = await calcularDimensionesCorte(pieza, inventarioTapacantos);\n    \n    if (resultado?.error) {\n      erroresValidacion.push(`Pieza \"${pieza.descripcion}\": ${resultado.error}`);\n      continue;\n    }\n\n    if (resultado) {\n      // Actualizar pieza con dimensiones de corte\n      const piezaActualizada = {\n        ...pieza,\n        largo_corte_mm: resultado.largo_corte_mm,\n        ancho_corte_mm: resultado.ancho_corte_mm\n      };\n      piezasConDimensionesCorte.push(piezaActualizada);\n\n      // Actualizar grosor en tapacantos\n      if (piezaActualizada.tapacantos) {\n        piezaActualizada.tapacantos.forEach(tc => {\n          if (tc.codigo && tc.codigo !== 'Sin TC') {\n            const info = inventarioTapacantos.get(tc.codigo);\n            if (info) {\n              tc.grosor_mm = info.grosor_mm;\n            }\n          }\n        });\n      }\n    }\n  }\n\n  // üö® Si hay errores de validaci√≥n, lanzar excepci√≥n\n  if (erroresValidacion.length > 0) {\n    const mensajeError = `Errores de validaci√≥n de dimensiones:\\n${erroresValidacion.join('\\n')}`;\n    console.error('‚ùå [OPTIMIZADOR] ' + mensajeError);\n    throw new Error(mensajeError);\n  }\n\n  console.log(`‚úÖ [OPTIMIZADOR] Dimensiones de corte calculadas para ${piezasConDimensionesCorte.length} piezas`);\n\n  // üÜï PASO 1: Agrupar piezas por material_codigo\n  const piezasPorMaterial = new Map<string, PiezaCorte[]>();\n  \n  piezasConDimensionesCorte.forEach(pieza => {\n    if (!pieza.material_codigo) {\n      console.warn('‚ö†Ô∏è [OPTIMIZADOR] Pieza sin material asignado:', pieza);\n      return;\n    }\n    \n    const codigo = pieza.material_codigo;\n    if (!piezasPorMaterial.has(codigo)) {\n      piezasPorMaterial.set(codigo, []);\n    }\n    piezasPorMaterial.get(codigo)!.push(pieza);\n  });\n\n  console.log('üì¶ [OPTIMIZADOR] Piezas agrupadas por material:', {\n    materiales_distintos: piezasPorMaterial.size,\n    detalle: Array.from(piezasPorMaterial.entries()).map(([codigo, piezas]) => ({\n      codigo,\n      cantidad_piezas: piezas.length,\n      dimensiones_lamina: `${piezas[0].material_largo_lamina_mm} √ó ${piezas[0].material_ancho_lamina_mm} mm`,\n      espesor: `${piezas[0].material_espesor_mm} mm`\n    }))\n  });\n\n  // üÜï PASO 2: Obtener dimensiones de l√°mina desde inventario para cada material\n  const resultadosPorMaterial: ResultadoPorMaterial[] = [];\n  const todasLasLaminas: LaminaCorte[] = [];\n  const todasPiezasSinAsignar: PiezaCorte[] = [];\n  let contadorLaminasGlobal = 1;\n\n  piezasPorMaterial.forEach((piezasDelMaterial, codigoMaterial) => {\n    console.log(`\\nüîß [OPTIMIZADOR] Optimizando material: ${codigoMaterial}`);\n    \n    const primeraPieza = piezasDelMaterial[0];\n    \n    // üÜï VALIDACI√ìN CR√çTICA: El material debe tener dimensiones de l√°mina\n    if (!primeraPieza.material_largo_lamina_mm || !primeraPieza.material_ancho_lamina_mm) {\n      console.error(`‚ùå [OPTIMIZADOR] Material ${codigoMaterial} sin dimensiones de l√°mina en inventario`);\n      console.error(`   Las piezas de este material no se pueden optimizar`);\n      todasPiezasSinAsignar.push(...piezasDelMaterial);\n      return;\n    }\n\n    // üÜï Usar dimensiones de inventario (NO de las piezas)\n    const laminaBaseMaterial = {\n      id: primeraPieza.material_id || 0,\n      codigo_articulo: primeraPieza.material_codigo || '',\n      descripcion_articulo: primeraPieza.material_descripcion || '',\n      precio_unitario: primeraPieza.material_precio || 0,\n      largo_lamina_mm: primeraPieza.material_largo_lamina_mm,\n      ancho_lamina_mm: primeraPieza.material_ancho_lamina_mm,\n      espesor_mm: primeraPieza.material_espesor_mm || 18\n    };\n\n    console.log(`  üìè [OPTIMIZADOR] Dimensiones de l√°mina desde inventario:`, {\n      codigo: laminaBaseMaterial.codigo_articulo,\n      largo: laminaBaseMaterial.largo_lamina_mm,\n      ancho: laminaBaseMaterial.ancho_lamina_mm,\n      espesor: laminaBaseMaterial.espesor_mm\n    });\n\n    // Optimizar este grupo de piezas\n    const { laminas, piezasSinAsignar } = optimizarGrupoDePiezas(\n      piezasDelMaterial,\n      laminaBaseMaterial,\n      config,\n      contadorLaminasGlobal\n    );\n\n    // üÜï VALIDACI√ìN: Si hay piezas v√°lidas, DEBE haber al menos 1 l√°mina\n    if (piezasDelMaterial.length > piezasSinAsignar.length && laminas.length === 0) {\n      console.error(`‚ùå [OPTIMIZADOR] ERROR CR√çTICO: Hay piezas v√°lidas pero no se generaron l√°minas`);\n      throw new Error(`Error en optimizaci√≥n: No se generaron l√°minas para material ${codigoMaterial}`);\n    }\n\n    contadorLaminasGlobal += laminas.length;\n\n    // Calcular m√©tricas para este material\n    const totalLaminas = laminas.length;\n    const areaTotalUtilizada = laminas.reduce((sum, l) => sum + l.area_utilizada, 0);\n    const areaTotalSobrante = laminas.reduce((sum, l) => sum + l.area_sobrante, 0);\n    const porcentajePromedio = totalLaminas > 0\n      ? laminas.reduce((sum, l) => sum + l.porcentaje_aprovechamiento, 0) / totalLaminas\n      : 0;\n    const costoTotalLaminas = totalLaminas * laminaBaseMaterial.precio_unitario;\n\n    console.log(`‚úÖ [OPTIMIZADOR] Material ${codigoMaterial} optimizado:`, {\n      laminas_usadas: totalLaminas,\n      piezas_asignadas: piezasDelMaterial.length - piezasSinAsignar.length,\n      aprovechamiento_promedio: `${porcentajePromedio.toFixed(1)}%`,\n      costo_total: costoTotalLaminas\n    });\n\n    // üÜï Solo agregar resultado si se generaron l√°minas\n    if (totalLaminas > 0) {\n      resultadosPorMaterial.push({\n        material_id: laminaBaseMaterial.id,\n        material_codigo: laminaBaseMaterial.codigo_articulo,\n        material_descripcion: laminaBaseMaterial.descripcion_articulo,\n        espesor_mm: laminaBaseMaterial.espesor_mm,\n        largo_lamina_mm: laminaBaseMaterial.largo_lamina_mm,\n        ancho_lamina_mm: laminaBaseMaterial.ancho_lamina_mm,\n        precio_unitario_lamina: laminaBaseMaterial.precio_unitario,\n        laminas,\n        total_laminas: totalLaminas,\n        area_total_utilizada: areaTotalUtilizada,\n        area_total_sobrante: areaTotalSobrante,\n        porcentaje_aprovechamiento_promedio: porcentajePromedio,\n        costo_total_laminas: costoTotalLaminas,\n        piezas_asignadas: piezasDelMaterial.length - piezasSinAsignar.length\n      });\n\n      todasLasLaminas.push(...laminas);\n    }\n\n    todasPiezasSinAsignar.push(...piezasSinAsignar);\n  });\n\n  // üÜï VALIDACI√ìN FINAL: Si hab√≠a piezas v√°lidas, debe haber al menos 1 l√°mina\n  const piezasValidasTotal = piezasConDimensionesCorte.length - todasPiezasSinAsignar.length;\n  if (piezasValidasTotal > 0 && todasLasLaminas.length === 0) {\n    console.error('‚ùå [OPTIMIZADOR] ERROR CR√çTICO: Hay piezas v√°lidas pero no se generaron l√°minas');\n    throw new Error('Error en optimizaci√≥n: No se pudieron generar l√°minas para las piezas v√°lidas');\n  }\n\n  // üÜï PASO 3: Calcular totales globales\n  const resultado = calcularResultadoGlobal(\n    resultadosPorMaterial,\n    todasLasLaminas,\n    todasPiezasSinAsignar\n  );\n\n  // üÜï VALIDACI√ìN FINAL DEL RESULTADO\n  console.log('üîç [OPTIMIZADOR] Validando estructura del resultado:', {\n    tiene_resultado: true,\n    total_laminas: resultado.total_laminas,\n    laminas_array_length: resultado.laminas.length,\n    resultados_por_material_length: resultado.resultados_por_material.length,\n    piezas_sin_asignar: resultado.piezas_sin_asignar.length\n  });\n\n  if (resultado.total_laminas === 0 && piezasValidasTotal > 0) {\n    console.error('‚ùå [OPTIMIZADOR] ERROR: total_laminas = 0 pero hay piezas v√°lidas');\n    throw new Error('Error en optimizaci√≥n: No se generaron l√°minas');\n  }\n\n  console.log('üéâ [OPTIMIZADOR] Optimizaci√≥n completada exitosamente:', {\n    materiales_procesados: resultadosPorMaterial.length,\n    total_laminas: resultado.total_laminas,\n    aprovechamiento_global: `${resultado.porcentaje_aprovechamiento_global.toFixed(1)}%`,\n    costo_total: resultado.costo_total\n  });\n\n  return resultado;\n};\n\n// ============================================\n// FUNCIONES AUXILIARES\n// ============================================\n\n// üÜï Crear nueva l√°mina\nfunction crearNuevaLamina(\n  id: number,\n  laminaBase: {\n    id: number;\n    codigo_articulo: string;\n    descripcion_articulo: string;\n    precio_unitario: number;\n    largo_lamina_mm: number;\n    ancho_lamina_mm: number;\n    espesor_mm: number;\n  }\n): LaminaCorte {\n  console.log(`  üí∞ [COSTO] Creando l√°mina ${id} con precio: ${laminaBase.precio_unitario}`);\n  \n  return {\n    id,\n    numero_lamina: id,\n    material_id: laminaBase.id,\n    material_codigo: laminaBase.codigo_articulo,\n    material_descripcion: laminaBase.descripcion_articulo,\n    largo: laminaBase.largo_lamina_mm,\n    ancho: laminaBase.ancho_lamina_mm,\n    espesor: laminaBase.espesor_mm,\n    piezas: [],\n    area_total: laminaBase.largo_lamina_mm * laminaBase.ancho_lamina_mm,\n    area_utilizada: 0,\n    area_sobrante: laminaBase.largo_lamina_mm * laminaBase.ancho_lamina_mm,\n    porcentaje_aprovechamiento: 0,\n    costo_lamina: laminaBase.precio_unitario,\n    costo_piezas: 0\n  };\n}\n\n// üÜï Calcular m√©tricas de una l√°mina\nfunction calcularMetricasLamina(lamina: LaminaCorte): void {\n  const areaTotal = lamina.largo * lamina.ancho;\n  let areaUtilizada = 0;\n  let costoPiezas = 0;\n\n  lamina.piezas.forEach(pieza => {\n    const piezaLargo = pieza.rotada ? pieza.ancho : pieza.largo;\n    const piezaAncho = pieza.rotada ? pieza.largo : pieza.ancho;\n    const areaPieza = piezaLargo * piezaAncho;\n    areaUtilizada += areaPieza;\n    costoPiezas += pieza.costo_pieza || 0;\n  });\n\n  lamina.area_utilizada = areaUtilizada;\n  lamina.area_sobrante = areaTotal - areaUtilizada;\n  lamina.porcentaje_aprovechamiento = areaTotal > 0 ? (areaUtilizada / areaTotal) * 100 : 0;\n  lamina.costo_piezas = costoPiezas;\n}\n\n// üÜï Calcular costos de una pieza\nfunction calcularCostosPieza(pieza: PiezaCorte, lamina: LaminaCorte): void {\n  const piezaLargo = pieza.rotada ? pieza.ancho : pieza.largo;\n  const piezaAncho = pieza.rotada ? pieza.largo : pieza.ancho;\n  const areaPieza = (piezaLargo * piezaAncho) / 1000000; // m¬≤\n  const areaLamina = (lamina.largo * lamina.ancho) / 1000000; // m¬≤\n  \n  // üÜï Costo proporcional del material (l√°mina)\n  pieza.costo_material = areaLamina > 0 ? (areaPieza / areaLamina) * lamina.costo_lamina : 0;\n  \n  console.log(`    üí∞ [COSTO] Pieza \"${pieza.descripcion}\":`, {\n    area_pieza_m2: areaPieza.toFixed(4),\n    area_lamina_m2: areaLamina.toFixed(4),\n    precio_lamina: lamina.costo_lamina,\n    costo_material: pieza.costo_material.toFixed(2)\n  });\n  \n  // üÜï Costo de tapacantos\n  pieza.costo_tapacantos = 0;\n  pieza.metros_tapacanto_total = 0;\n  \n  if (pieza.tapacantos && pieza.tapacantos.length > 0) {\n    pieza.tapacantos.forEach(tc => {\n      if (tc.precio_unitario && tc.metros_lineales) {\n        const costoTapacanto = (tc.metros_lineales / 1000) * tc.precio_unitario; // convertir mm a metros\n        pieza.costo_tapacantos! += costoTapacanto;\n        pieza.metros_tapacanto_total! += tc.metros_lineales / 1000;\n      }\n    });\n    \n    if (pieza.costo_tapacantos > 0) {\n      console.log(`    üí∞ [COSTO] Tapacantos: ${pieza.costo_tapacantos.toFixed(2)} (${pieza.metros_tapacanto_total.toFixed(2)}m)`);\n    }\n  }\n  \n  // üÜï Costo de horas m√°quina (HH)\n  // Estimaci√≥n: 1 segundo por cada 10mm de corte + 5 segundos de setup por pieza\n  const perimetroCorte = (piezaLargo + piezaAncho) * 2; // mm\n  const segundosCorte = (perimetroCorte / 10) + 5; // segundos estimados\n  pieza.hh_segundos = segundosCorte;\n  \n  // Asumir costo de HH desde configuraci√≥n o usar valor por defecto\n  // Por ahora usamos 0 hasta que se configure en el sistema\n  const costoHHPorSegundo = 0; // Se puede configurar despu√©s\n  pieza.costo_hh = segundosCorte * costoHHPorSegundo;\n  \n  // üÜï Costo total de la pieza\n  pieza.costo_total = pieza.costo_material + pieza.costo_tapacantos + pieza.costo_hh;\n  \n  // üÜï Costo de la pieza para la l√°mina (solo material proporcional)\n  pieza.costo_pieza = pieza.costo_material;\n  \n  console.log(`    üí∞ [COSTO] Total pieza: ${pieza.costo_total.toFixed(2)}`);\n}\n\n// üÜï Calcular resultado global\nfunction calcularResultadoGlobal(\n  resultadosPorMaterial: ResultadoPorMaterial[],\n  todasLasLaminas: LaminaCorte[],\n  todasPiezasSinAsignar: PiezaCorte[]\n): ResultadoOptimizacion {\n  const totalLaminas = todasLasLaminas.length;\n  const areaTotalUtilizada = todasLasLaminas.reduce((sum, l) => sum + l.area_utilizada, 0);\n  const areaTotalSobrante = todasLasLaminas.reduce((sum, l) => sum + l.area_sobrante, 0);\n  const areaTotal = areaTotalUtilizada + areaTotalSobrante;\n  const porcentajeGlobal = areaTotal > 0 ? (areaTotalUtilizada / areaTotal) * 100 : 0;\n  \n  // üÜï CALCULAR COSTOS TOTALES DESDE LAS PIEZAS\n  let costoTotalMateriales = 0;\n  let costoTotalTapacantos = 0;\n  let costoTotalHH = 0;\n  \n  todasLasLaminas.forEach(lamina => {\n    // Costo del material (l√°mina completa)\n    costoTotalMateriales += lamina.costo_lamina;\n    \n    // Costos de las piezas (tapacantos y HH)\n    lamina.piezas.forEach(pieza => {\n      costoTotalTapacantos += pieza.costo_tapacantos || 0;\n      costoTotalHH += pieza.costo_hh || 0;\n    });\n  });\n  \n  const costoTotal = costoTotalMateriales + costoTotalTapacantos + costoTotalHH;\n\n  console.log('üí∞ [COSTOS] Resumen de costos calculados:', {\n    materiales: costoTotalMateriales.toFixed(2),\n    tapacantos: costoTotalTapacantos.toFixed(2),\n    hh: costoTotalHH.toFixed(2),\n    total: costoTotal.toFixed(2)\n  });\n\n  return {\n    laminas: todasLasLaminas,\n    total_laminas: totalLaminas,\n    area_total_utilizada: areaTotalUtilizada,\n    area_total_sobrante: areaTotalSobrante,\n    porcentaje_aprovechamiento_global: porcentajeGlobal,\n    costo_total_materiales: costoTotalMateriales,\n    costo_total_tapacantos: costoTotalTapacantos,\n    costo_total_hh: costoTotalHH,\n    costo_total: costoTotal,\n    piezas_sin_asignar: todasPiezasSinAsignar,\n    resultados_por_material: resultadosPorMaterial\n  };\n}\n\n// Determinar veta autom√°tica seg√∫n dimensiones\nfunction determinarVetaAutomatica(largo: number, ancho: number): TipoVeta {\n  if (largo > ancho * 1.5) return 'S';\n  if (ancho > largo * 1.5) return 'X';\n  return 'N';\n}\n\n// Generar color aleatorio para visualizaci√≥n\nfunction generarColorAleatorio(): string {\n  const colores = [\n    '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6',\n    '#EC4899', '#14B8A6', '#F97316', '#6366F1', '#84CC16'\n  ];\n  return colores[Math.floor(Math.random() * colores.length)];\n}\n\n// ============================================\n// OPTIMIZAR UN GRUPO DE PIEZAS DEL MISMO MATERIAL\n// üÜï ALGORITMO MEJORADO: Respeta veta y valida dimensiones\n// üÜï USA: Dimensiones de corte (ajustadas por tapacanto)\n// ============================================\n\nfunction optimizarGrupoDePiezas(\n  piezas: PiezaCorte[],\n  laminaBase: {\n    id: number;\n    codigo_articulo: string;\n    descripcion_articulo: string;\n    precio_unitario: number;\n    largo_lamina_mm: number;\n    ancho_lamina_mm: number;\n    espesor_mm: number;\n  },\n  config: ConfiguracionCorte,\n  contadorInicial: number\n): { laminas: LaminaCorte[]; piezasSinAsignar: PiezaCorte[] } {\n  console.log(`  üîß [OPTIMIZADOR] optimizarGrupoDePiezas - INICIO`, {\n    total_piezas: piezas.length,\n    lamina_base: `${laminaBase.largo_lamina_mm} √ó ${laminaBase.ancho_lamina_mm} mm`,\n    piezas_detalle: piezas.map(p => ({\n      desc: p.descripcion,\n      dim_final: `${p.largo} √ó ${p.ancho}`,\n      dim_corte: `${p.largo_corte_mm || p.largo} √ó ${p.ancho_corte_mm || p.ancho}`,\n      cant: p.cantidad,\n      veta: p.veta\n    }))\n  });\n\n  const laminas: LaminaCorte[] = [];\n  let laminaCounter = contadorInicial;\n\n  // üÜï Definir lado largo y corto de la l√°mina (para validaci√≥n de veta)\n  const ladoLargoLamina = Math.max(laminaBase.largo_lamina_mm, laminaBase.ancho_lamina_mm);\n  const ladoCortoLamina = Math.min(laminaBase.largo_lamina_mm, laminaBase.ancho_lamina_mm);\n\n  console.log(`  üìê [VETA] L√°mina base:`, {\n    dimensiones: `${laminaBase.largo_lamina_mm} √ó ${laminaBase.ancho_lamina_mm}`,\n    lado_largo: ladoLargoLamina,\n    lado_corto: ladoCortoLamina,\n    nota: 'La veta de la l√°mina va en la direcci√≥n del lado m√°s largo'\n  });\n\n  // Expandir piezas seg√∫n cantidad\n  const piezasExpandidas: PiezaCorte[] = [];\n  piezas.forEach(pieza => {\n    console.log(`    üì¶ [OPTIMIZADOR] Expandiendo pieza \"${pieza.descripcion}\" √ó ${pieza.cantidad}`);\n    for (let i = 0; i < pieza.cantidad; i++) {\n      piezasExpandidas.push({\n        ...pieza,\n        id: `${pieza.id}-${i}`,\n        cantidad: 1\n      });\n    }\n  });\n\n  console.log(`  ‚úÖ [OPTIMIZADOR] Piezas expandidas: ${piezasExpandidas.length}`);\n\n  // üÜï VALIDACI√ìN DE VETA: Separar piezas v√°lidas e inv√°lidas\n  // üÜï USAR DIMENSIONES DE CORTE en lugar de dimensiones originales\n  const piezasValidas: PiezaCorte[] = [];\n  const piezasInvalidas: PiezaCorte[] = [];\n  const espacioCorte = config.espesor_sierra + config.margen_seguridad;\n\n  piezasExpandidas.forEach(pieza => {\n    // üÜï Usar dimensiones de corte si existen, sino usar originales\n    const largoParaValidar = pieza.largo_corte_mm || pieza.largo;\n    const anchoParaValidar = pieza.ancho_corte_mm || pieza.ancho;\n    \n    const ladoLargoPieza = Math.max(largoParaValidar, anchoParaValidar);\n    const ladoCortoPieza = Math.min(largoParaValidar, anchoParaValidar);\n\n    let esValida = false;\n    let razonInvalida = '';\n\n    if (pieza.veta === 'S') {\n      // Veta S: El lado largo de la pieza debe ir paralelo a la veta de la l√°mina\n      // Por lo tanto, el lado largo de la pieza debe ser <= lado largo de la l√°mina\n      if (ladoLargoPieza + espacioCorte <= ladoLargoLamina && \n          ladoCortoPieza + espacioCorte <= ladoCortoLamina) {\n        esValida = true;\n      } else {\n        razonInvalida = `Veta S requiere lado largo (${ladoLargoPieza}mm) ‚â§ lado largo l√°mina (${ladoLargoLamina}mm)`;\n      }\n    } else if (pieza.veta === 'X') {\n      // Veta X: El lado largo de la pieza debe ir perpendicular a la veta de la l√°mina\n      // Por lo tanto, el lado largo de la pieza debe ser <= lado corto de la l√°mina\n      if (ladoLargoPieza + espacioCorte <= ladoCortoLamina && \n          ladoCortoPieza + espacioCorte <= ladoLargoLamina) {\n        esValida = true;\n      } else {\n        razonInvalida = `Veta X requiere lado largo (${ladoLargoPieza}mm) ‚â§ lado corto l√°mina (${ladoCortoLamina}mm)`;\n      }\n    } else {\n      // Veta N: Sin restricci√≥n, solo verificar que quepa en cualquier orientaci√≥n\n      // üÜï Usar dimensiones de corte\n      if ((largoParaValidar + espacioCorte <= laminaBase.largo_lamina_mm && \n           anchoParaValidar + espacioCorte <= laminaBase.ancho_lamina_mm) ||\n          (anchoParaValidar + espacioCorte <= laminaBase.largo_lamina_mm && \n           largoParaValidar + espacioCorte <= laminaBase.ancho_lamina_mm)) {\n        esValida = true;\n      } else {\n        razonInvalida = `Dimensiones de corte (${largoParaValidar}√ó${anchoParaValidar}) exceden l√°mina (${laminaBase.largo_lamina_mm}√ó${laminaBase.ancho_lamina_mm})`;\n      }\n    }\n\n    if (esValida) {\n      piezasValidas.push(pieza);\n    } else {\n      console.warn(`  ‚ö†Ô∏è [VALIDACI√ìN VETA] Pieza \"${pieza.descripcion}\" INV√ÅLIDA: ${razonInvalida}`);\n      piezasInvalidas.push(pieza);\n    }\n  });\n\n  console.log(`  üìä [VALIDACI√ìN VETA] Piezas v√°lidas: ${piezasValidas.length}, Piezas inv√°lidas: ${piezasInvalidas.length}`);\n\n  if (piezasValidas.length === 0) {\n    console.warn(`  ‚ö†Ô∏è [OPTIMIZADOR] No hay piezas v√°lidas para optimizar`);\n    return {\n      laminas: [],\n      piezasSinAsignar: piezasInvalidas\n    };\n  }\n\n  // Ordenar piezas por √°rea descendente (usar dimensiones de corte)\n  const piezasOrdenadas = [...piezasValidas].sort((a, b) => {\n    const areaA = (a.largo_corte_mm || a.largo) * (a.ancho_corte_mm || a.ancho);\n    const areaB = (b.largo_corte_mm || b.largo) * (b.ancho_corte_mm || b.ancho);\n    return areaB - areaA;\n  });\n\n  // Algoritmo de colocaci√≥n\n  let iteracion = 0;\n  const MAX_ITERACIONES = 50;\n  let laminasSinPiezas = 0;\n  const MAX_LAMINAS_VACIAS = 3;\n\n  while (piezasOrdenadas.length > 0 && iteracion < MAX_ITERACIONES) {\n    iteracion++;\n    console.log(`\\n  üîÑ [OPTIMIZADOR] Iteraci√≥n ${iteracion} - Piezas restantes: ${piezasOrdenadas.length}`);\n    \n    const lamina = crearNuevaLamina(laminaCounter++, laminaBase);\n    console.log(`    üìã [OPTIMIZADOR] L√°mina ${lamina.id} creada: ${lamina.largo} √ó ${lamina.ancho} mm`);\n    \n    const resultado = colocarPiezasEnLamina(piezasOrdenadas, lamina, config, laminaBase);\n    \n    console.log(`  ‚úÇÔ∏è [OPTIMIZADOR] L√°mina ${lamina.id}: ${resultado.piezasColocadas} piezas colocadas`);\n    \n    if (lamina.piezas.length > 0) {\n      calcularMetricasLamina(lamina);\n      laminas.push(lamina);\n      laminasSinPiezas = 0;\n    } else {\n      laminasSinPiezas++;\n      console.warn(`  ‚ö†Ô∏è [OPTIMIZADOR] L√°mina ${lamina.id} vac√≠a (${laminasSinPiezas}/${MAX_LAMINAS_VACIAS})`);\n    }\n\n    if (laminasSinPiezas >= MAX_LAMINAS_VACIAS) {\n      console.error(`  ‚ùå [OPTIMIZADOR] ${MAX_LAMINAS_VACIAS} l√°minas vac√≠as consecutivas - DETENIENDO`);\n      break;\n    }\n  }\n\n  if (iteracion >= MAX_ITERACIONES) {\n    console.error(`  ‚ùå [OPTIMIZADOR] L√≠mite de iteraciones alcanzado (${MAX_ITERACIONES})`);\n  }\n\n  const todasPiezasSinAsignar = [...piezasOrdenadas, ...piezasInvalidas];\n\n  console.log(`  üèÅ [OPTIMIZADOR] optimizarGrupoDePiezas - FIN`, {\n    laminas_creadas: laminas.length,\n    piezas_sin_asignar: todasPiezasSinAsignar.length\n  });\n\n  // üÜï GARANT√çA: Si hay piezas v√°lidas y no se crearon l√°minas, crear al menos 1\n  if (piezasValidas.length > 0 && laminas.length === 0) {\n    console.warn(`  ‚ö†Ô∏è [OPTIMIZADOR] CORRECCI√ìN: Creando l√°mina m√≠nima para piezas v√°lidas`);\n    const laminaMinima = crearNuevaLamina(laminaCounter++, laminaBase);\n    calcularMetricasLamina(laminaMinima);\n    laminas.push(laminaMinima);\n  }\n\n  return {\n    laminas,\n    piezasSinAsignar: todasPiezasSinAsignar\n  };\n}\n\n// ============================================\n// üÜï Funci√≥n mejorada para colocar piezas respetando veta\n// üÜï USA: Dimensiones de corte en lugar de dimensiones originales\nfunction colocarPiezasEnLamina(\n  piezas: PiezaCorte[],\n  lamina: LaminaCorte,\n  config: ConfiguracionCorte,\n  laminaBase: {\n    largo_lamina_mm: number;\n    ancho_lamina_mm: number;\n  }\n): { piezasColocadas: number } {\n  let piezasColocadas = 0;\n  const espacioCorte = config.espesor_sierra + config.margen_seguridad;\n\n  const ladoLargoLamina = Math.max(laminaBase.largo_lamina_mm, laminaBase.ancho_lamina_mm);\n  const ladoCortoLamina = Math.min(laminaBase.largo_lamina_mm, laminaBase.ancho_lamina_mm);\n\n  // Espacios libres iniciales\n  const espaciosLibres: Array<{\n    x: number;\n    y: number;\n    ancho: number;\n    alto: number;\n  }> = [\n    {\n      x: 0,\n      y: 0,\n      ancho: lamina.largo,\n      alto: lamina.ancho\n    }\n  ];\n\n  let intentosSinExito = 0;\n  const MAX_INTENTOS = piezas.length;\n\n  while (piezas.length > 0 && intentosSinExito < MAX_INTENTOS) {\n    let piezaColocada = false;\n\n    for (let i = 0; i < piezas.length; i++) {\n      const pieza = piezas[i];\n      let mejorEspacio = -1;\n      let mejorDesperdicio = Infinity;\n      let mejorRotacion = false;\n\n      // üÜï Usar dimensiones de corte si existen\n      const largoCorte = pieza.largo_corte_mm || pieza.largo;\n      const anchoCorte = pieza.ancho_corte_mm || pieza.ancho;\n\n      // Buscar mejor espacio para esta pieza\n      for (let j = 0; j < espaciosLibres.length; j++) {\n        const espacio = espaciosLibres[j];\n\n        // üÜï Probar orientaciones seg√∫n veta\n        const orientacionesPermitidas = obtenerOrientacionesPermitidas(pieza, config);\n\n        for (const orientacion of orientacionesPermitidas) {\n          const piezaLargo = orientacion.rotada ? anchoCorte : largoCorte;\n          const piezaAncho = orientacion.rotada ? largoCorte : anchoCorte;\n          const piezaLargoConEspacio = piezaLargo + espacioCorte;\n          const piezaAnchoConEspacio = piezaAncho + espacioCorte;\n\n          if (piezaLargoConEspacio <= espacio.ancho && piezaAnchoConEspacio <= espacio.alto) {\n            const desperdicio = (espacio.ancho * espacio.alto) - (piezaLargoConEspacio * piezaAnchoConEspacio);\n            if (desperdicio < mejorDesperdicio) {\n              mejorDesperdicio = desperdicio;\n              mejorEspacio = j;\n              mejorRotacion = orientacion.rotada;\n            }\n          }\n        }\n      }\n\n      // Si encontramos espacio, colocar pieza\n      if (mejorEspacio !== -1) {\n        const espacio = espaciosLibres[mejorEspacio];\n        const rotada = mejorRotacion;\n        \n        const piezaLargo = rotada ? anchoCorte : largoCorte;\n        const piezaAncho = rotada ? largoCorte : anchoCorte;\n        const piezaLargoConEspacio = piezaLargo + espacioCorte;\n        const piezaAnchoConEspacio = piezaAncho + espacioCorte;\n\n        pieza.posicion_x = espacio.x;\n        pieza.posicion_y = espacio.y;\n        pieza.rotada = rotada;\n        pieza.lamina_asignada = lamina.id;\n        \n        // üÜï CORRECCI√ìN CR√çTICA: Guardar dimensiones de corte en largo/ancho\n        // para que el visualizador renderice las dimensiones ajustadas\n        pieza.largo = largoCorte;\n        pieza.ancho = anchoCorte;\n        \n        calcularCostosPieza(pieza, lamina);\n        lamina.piezas.push(pieza);\n\n        // Actualizar espacios\n        espaciosLibres.splice(mejorEspacio, 1);\n\n        const espacioDerechaAncho = espacio.ancho - piezaLargoConEspacio;\n        const espacioArribaAlto = espacio.alto - piezaAnchoConEspacio;\n\n        if (espacioDerechaAncho > 10) {\n          espaciosLibres.push({\n            x: espacio.x + piezaLargoConEspacio,\n            y: espacio.y,\n            ancho: espacioDerechaAncho,\n            alto: piezaAnchoConEspacio\n          });\n        }\n\n        if (espacioArribaAlto > 10) {\n          espaciosLibres.push({\n            x: espacio.x,\n            y: espacio.y + piezaAnchoConEspacio,\n            ancho: espacio.ancho,\n            alto: espacioArribaAlto\n          });\n        }\n\n        espaciosLibres.sort((a, b) => (b.ancho * b.alto) - (a.ancho * a.alto));\n\n        piezas.splice(i, 1);\n        piezasColocadas++;\n        piezaColocada = true;\n        intentosSinExito = 0;\n        break;\n      }\n    }\n\n    if (!piezaColocada) {\n      intentosSinExito++;\n    }\n  }\n\n  return { piezasColocadas };\n}\n\n// üÜï Obtener orientaciones permitidas seg√∫n veta\nfunction obtenerOrientacionesPermitidas(\n  pieza: PiezaCorte,\n  config: ConfiguracionCorte\n): Array<{ rotada: boolean }> {\n  const orientaciones: Array<{ rotada: boolean }> = [];\n\n  if (pieza.veta === 'N') {\n    // Sin veta: permitir ambas orientaciones si rotaci√≥n est√° habilitada\n    orientaciones.push({ rotada: false });\n    if (config.permitir_rotacion) {\n      orientaciones.push({ rotada: true });\n    }\n  } else if (pieza.veta === 'S') {\n    // Veta S: lado largo paralelo a veta (normal)\n    orientaciones.push({ rotada: false });\n  } else if (pieza.veta === 'X') {\n    // Veta X: lado largo perpendicular a veta (rotada)\n    if (config.permitir_rotacion) {\n      orientaciones.push({ rotada: true });\n    } else {\n      // Si no se permite rotaci√≥n, intentar normal\n      orientaciones.push({ rotada: false });\n    }\n  }\n\n  return orientaciones;\n}\n\n// ============================================\n// GUARDAR Y CARGAR PROYECTOS\n// ============================================\n\nexport const guardarProyecto = async (\n  proyecto: ProyectoOptimizador,\n  currentStore: { id: string } | null,\n  userId: string\n) => {\n  if (!currentStore) {\n    return { data: null, error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const proyectoData = {\n      nombre: proyecto.nombre,\n      descripcion: proyecto.descripcion,\n      modo: proyecto.modo,\n      producto_bom_id: proyecto.producto_bom_id,\n      piezas: JSON.stringify(proyecto.piezas),\n      configuracion: JSON.stringify(proyecto.configuracion),\n      resultado: proyecto.resultado ? JSON.stringify(proyecto.resultado) : null,\n      tienda_id: currentStore.id,\n      usuario_id: userId\n    };\n\n    if (proyecto.id) {\n      // Actualizar\n      const { data, error } = await supabase\n        .from('proyectos_optimizador')\n        .update(proyectoData)\n        .eq('id', proyecto.id)\n        .eq('tienda_id', currentStore.id)\n        .select()\n        .single();\n\n      return { data, error };\n    } else {\n      // Crear\n      const { data, error } = await supabase\n        .from('proyectos_optimizador')\n        .insert([proyectoData])\n        .select()\n        .single();\n\n      return { data, error };\n    }\n  } catch (error) {\n    console.error('Error guardando proyecto:', error);\n    return { data: null, error };\n  }\n};\n\nexport const cargarProyectos = async (currentStore: { id: string } | null) => {\n  if (!currentStore) {\n    return { data: [], error: { message: 'No hay tienda seleccionada' } };\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from('proyectos_optimizador')\n      .select('*')\n      .eq('tienda_id', currentStore.id)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    const proyectos: ProyectoOptimizador[] = (data || []).map((p: any) => ({\n      ...p,\n      piezas: JSON.parse(p.piezas || '[]'),\n      configuracion: JSON.parse(p.configuracion || '{}'),\n      resultado: p.resultado ? JSON.parse(p.resultado) : undefined\n    }));\n\n    return { data: proyectos, error: null };\n  } catch (error) {\n    console.error('Error cargando proyectos:', error);\n    return { data: [], error };\n  }\n};\n","import { useState, useEffect, useRef } from 'react';\nimport { ArticuloInventario } from '../../../types/optimizador';\nimport { buscarArticulosInventario } from '../../../services/optimizadorService';\n\ninterface Props {\n  tipoArticulo?: 'lamina' | 'tapacanto' | 'hh' | 'consumible' | 'perforacion' | 'mecanizado' | null; // üîß Agregado 'mecanizado'\n  onSeleccionar: (articulo: ArticuloInventario) => void;\n  onCancelar?: () => void;\n  placeholder?: string;\n  permitirLimpiar?: boolean;\n  onLimpiar?: () => void;\n  tiendaActual?: { id: string; nombre: string } | null;\n}\n\nexport default function BuscadorArticuloBlur({\n  tipoArticulo = null, // üîß Por defecto busca en TODAS las categor√≠as\n  onSeleccionar,\n  onCancelar,\n  placeholder = 'Buscar art√≠culo...',\n  permitirLimpiar = false,\n  onLimpiar,\n  tiendaActual\n}: Props) {\n  const [busqueda, setBusqueda] = useState('');\n  const [articulos, setArticulos] = useState<ArticuloInventario[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [mostrarResultados, setMostrarResultados] = useState(false);\n  const [busquedaRealizada, setBusquedaRealizada] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    console.log('üéØ [BUSCADOR BLUR] Componente montado', {\n      tipoArticulo,\n      placeholder,\n      tiendaActual: tiendaActual?.id\n    });\n    inputRef.current?.focus();\n  }, []);\n\n  useEffect(() => {\n    console.log('üîÑ [BUSCADOR BLUR] useEffect b√∫squeda', {\n      busqueda,\n      longitud: busqueda.length,\n      tipoArticulo,\n      tiendaActual: tiendaActual?.id\n    });\n\n    const timer = setTimeout(() => {\n      if (busqueda.length >= 2) {\n        console.log('‚è∞ [BUSCADOR BLUR] Timer completado, iniciando b√∫squeda');\n        buscarArticulos();\n      } else {\n        console.log('‚ö†Ô∏è [BUSCADOR BLUR] B√∫squeda muy corta, limpiando resultados');\n        setArticulos([]);\n        setBusquedaRealizada(false);\n        setMostrarResultados(false);\n      }\n    }, 300);\n\n    return () => {\n      console.log('üßπ [BUSCADOR BLUR] Limpiando timer');\n      clearTimeout(timer);\n    };\n  }, [busqueda, tiendaActual]);\n\n  useEffect(() => {\n    // üîß Solo agregar listener si onCancelar est√° definido\n    if (!onCancelar) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        console.log('üëÜ [BUSCADOR BLUR] Click fuera del componente, cancelando');\n        onCancelar();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [onCancelar]);\n\n  const buscarArticulos = async () => {\n    if (!tiendaActual) {\n      console.error('‚ùå [BUSCADOR BLUR] No hay tienda seleccionada');\n      setArticulos([]);\n      setBusquedaRealizada(false);\n      return;\n    }\n\n    console.log('üöÄ [BUSCADOR BLUR] Iniciando b√∫squeda', {\n      busqueda,\n      tipoArticulo: tipoArticulo || 'TODAS LAS CATEGOR√çAS',\n      tiendaActual: tiendaActual?.id\n    });\n\n    setLoading(true);\n    setBusquedaRealizada(false);\n    try {\n      // üîß Pasar tipoArticulo (puede ser null para b√∫squeda general)\n      const { data } = await buscarArticulosInventario(busqueda, tipoArticulo, tiendaActual);\n      \n      console.log('‚úÖ [BUSCADOR BLUR] B√∫squeda completada', {\n        resultados: data?.length || 0,\n        articulos: data?.map(a => ({\n          codigo: a.codigo_articulo,\n          descripcion: a.descripcion_articulo,\n          categoria: a.categoria_nombre,\n          tipo: a.tipo_articulo\n        }))\n      });\n\n      setArticulos(data || []);\n      setMostrarResultados(true);\n      setBusquedaRealizada(true);\n    } catch (error) {\n      console.error('‚ùå [BUSCADOR BLUR] Error buscando art√≠culos:', error);\n      setArticulos([]);\n      setBusquedaRealizada(true);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSeleccionar = (articulo: ArticuloInventario) => {\n    console.log('‚ú® [BUSCADOR BLUR] Art√≠culo seleccionado', {\n      id: articulo.id,\n      codigo: articulo.codigo_articulo,\n      descripcion: articulo.descripcion_articulo,\n      tipo: articulo.tipo_articulo\n    });\n\n    onSeleccionar(articulo);\n    setMostrarResultados(false);\n    setBusquedaRealizada(false);\n    // üîß Limpiar b√∫squeda despu√©s de seleccionar\n    setBusqueda('');\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Escape' && onCancelar) {\n      console.log('‚å®Ô∏è [BUSCADOR BLUR] ESC presionado, cancelando');\n      onCancelar();\n    }\n  };\n\n  return (\n    <div ref={containerRef} className=\"relative z-50\">\n      <div className=\"flex gap-1\">\n        <div className=\"relative flex-1\">\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={busqueda}\n            onChange={(e) => {\n              console.log('‚å®Ô∏è [BUSCADOR BLUR] Input onChange', {\n                valor: e.target.value,\n                longitud: e.target.value.length\n              });\n              setBusqueda(e.target.value);\n            }}\n            onKeyDown={handleKeyDown}\n            onFocus={() => {\n              console.log('üëÅÔ∏è [BUSCADOR BLUR] Input enfocado');\n            }}\n            placeholder={placeholder}\n            className=\"w-full px-3 py-1.5 pl-9 text-sm border-2 border-blue-500 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-600 shadow-lg\"\n            autoComplete=\"off\"\n          />\n          <i className=\"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-blue-500\"></i>\n          {loading && (\n            <i className=\"ri-loader-4-line animate-spin absolute right-3 top-1/2 -translate-y-1/2 text-blue-500\"></i>\n          )}\n        </div>\n        \n        {permitirLimpiar && onLimpiar && (\n          <button\n            onClick={() => {\n              console.log('üßπ [BUSCADOR BLUR] Bot√≥n limpiar presionado');\n              onLimpiar();\n            }}\n            className=\"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm whitespace-nowrap\"\n            title=\"Limpiar selecci√≥n\"\n          >\n            <i className=\"ri-close-line\"></i>\n          </button>\n        )}\n        \n        {/* üîß Solo mostrar bot√≥n cancelar si la funci√≥n existe */}\n        {onCancelar && (\n          <button\n            onClick={() => {\n              console.log('‚ùå [BUSCADOR BLUR] Bot√≥n cancelar presionado');\n              onCancelar();\n            }}\n            className=\"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm\"\n            title=\"Cancelar\"\n          >\n            <i className=\"ri-close-line\"></i>\n          </button>\n        )}\n      </div>\n\n      {/* Resultados con backdrop blur */}\n      {mostrarResultados && articulos.length > 0 && (\n        <div className=\"absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md border-2 border-blue-500 rounded-lg shadow-2xl max-h-80 overflow-y-auto z-50 min-w-[600px]\">\n          <div className=\"p-2\">\n            <div className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider px-3 py-2 bg-gray-50 rounded-t-lg\">\n              {articulos.length} resultado{articulos.length !== 1 ? 's' : ''} encontrado{articulos.length !== 1 ? 's' : ''}\n            </div>\n            {articulos.map((articulo) => (\n              <button\n                key={articulo.id}\n                onClick={() => handleSeleccionar(articulo)}\n                className=\"w-full p-3 hover:bg-blue-50 transition-colors text-left border-b border-gray-100 last:border-0 rounded-lg\"\n              >\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-sm\">\n                      {articulo.codigo_articulo.substring(0, 2).toUpperCase()}\n                    </div>\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                      <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded font-semibold whitespace-nowrap\">\n                        {articulo.codigo_articulo}\n                      </span>\n                      {articulo.categoria_nombre && (\n                        <span className=\"bg-gray-100 text-gray-700 text-xs px-2 py-0.5 rounded whitespace-nowrap\">\n                          {articulo.categoria_nombre}\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"text-sm font-medium text-gray-900 mb-1\">\n                      {articulo.descripcion_articulo}\n                    </div>\n                    <div className=\"flex items-center gap-3 text-xs text-gray-600 flex-wrap\">\n                      {articulo.largo_lamina && articulo.ancho_lamina && (\n                        <span className=\"flex items-center gap-1 whitespace-nowrap\">\n                          <i className=\"ri-ruler-line\"></i>\n                          {articulo.largo_lamina} √ó {articulo.ancho_lamina} mm\n                        </span>\n                      )}\n                      {articulo.espesor && (\n                        <span className=\"flex items-center gap-1 whitespace-nowrap\">\n                          <i className=\"ri-stack-line\"></i>\n                          {articulo.espesor} mm\n                        </span>\n                      )}\n                      {articulo.precio_unitario != null && (\n                        <span className=\"flex items-center gap-1 text-green-600 font-semibold whitespace-nowrap\">\n                          <i className=\"ri-price-tag-3-line\"></i>\n                          ‚Ç°{articulo.precio_unitario.toLocaleString('es-CR')}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Sin resultados */}\n      {mostrarResultados && busquedaRealizada && busqueda.length >= 2 && !loading && articulos.length === 0 && (\n        <div className=\"absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl p-6 text-center z-50 min-w-[400px]\">\n          <i className=\"ri-search-line text-4xl text-gray-400 mb-2\"></i>\n          <p className=\"text-sm text-gray-600\">\n            No se encontraron art√≠culos para \"{busqueda}\"\n          </p>\n          {tipoArticulo && (\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Tipo: {tipoArticulo}\n            </p>\n          )}\n        </div>\n      )}\n\n      {/* Ayuda inicial */}\n      {!busquedaRealizada && busqueda.length > 0 && busqueda.length < 2 && (\n        <div className=\"absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md border-2 border-gray-300 rounded-lg shadow-xl p-4 text-center z-50 min-w-[400px]\">\n          <i className=\"ri-information-line text-2xl text-blue-500 mb-2\"></i>\n          <p className=\"text-xs text-gray-600\">\n            Escribe al menos 2 caracteres para buscar\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { PiezaCorte, ArticuloInventario } from '../../../types/optimizador';\nimport BuscadorArticuloBlur from './BuscadorArticuloBlur';\n\ninterface Props {\n  piezas: PiezaCorte[];\n  onEditar: (index: number, pieza: PiezaCorte) => void;\n  onEliminar: (index: number) => void;\n  onDuplicar?: (index: number) => void;\n  tiendaActual: { id: string; nombre: string } | null;\n}\n\nexport default function TablaPiezas({ piezas, onEditar, onEliminar, onDuplicar, tiendaActual }: Props) {\n  const [editandoIndex, setEditandoIndex] = useState<number | null>(null);\n  const [editandoCampo, setEditandoCampo] = useState<string | null>(null);\n\n  if (piezas.length === 0) {\n    return (\n      <div className=\"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300\">\n        <i className=\"ri-inbox-line text-4xl text-gray-400 mb-3\"></i>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-1\">Sin piezas</h3>\n        <p className=\"text-gray-600\">\n          Agrega piezas manualmente, importa desde Excel o carga desde un producto BOM\n        </p>\n      </div>\n    );\n  }\n\n  const handleCambiarValor = (index: number, campo: string, valor: any) => {\n    const piezaActual = piezas[index];\n    const piezaEditada = { ...piezaActual, [campo]: valor };\n    \n    // Recalcular veta autom√°ticamente si cambian dimensiones\n    if (campo === 'largo' || campo === 'ancho') {\n      const largo = campo === 'largo' ? parseFloat(valor) : piezaActual.largo;\n      const ancho = campo === 'ancho' ? parseFloat(valor) : piezaActual.ancho;\n      \n      if (largo > ancho) {\n        piezaEditada.veta = 'S';\n      } else if (ancho > largo) {\n        piezaEditada.veta = 'X';\n      } else {\n        piezaEditada.veta = 'N';\n      }\n    }\n    \n    onEditar(index, piezaEditada);\n  };\n\n  const handleSeleccionarMaterial = (index: number, articulo: ArticuloInventario) => {\n    const piezaActual = piezas[index];\n    const piezaEditada = {\n      ...piezaActual,\n      material_id: articulo.id,\n      material_codigo: articulo.codigo_articulo,\n      material_descripcion: articulo.descripcion_articulo,\n      material_precio: articulo.precio_unitario,\n      material_espesor_mm: articulo.espesor_mm,\n      material_largo_lamina_mm: articulo.largo_lamina_mm,\n      material_ancho_lamina_mm: articulo.ancho_lamina_mm\n    };\n    onEditar(index, piezaEditada);\n    setEditandoIndex(null);\n    setEditandoCampo(null);\n  };\n\n  const handleSeleccionarTapacanto = (index: number, lado: string, articulo: ArticuloInventario | null) => {\n    const piezaActual = piezas[index];\n    const tapacantos = Array.isArray(piezaActual.tapacantos) ? [...piezaActual.tapacantos] : [];\n    \n    const indiceTC = tapacantos.findIndex(tc => tc.lado === lado);\n    \n    if (articulo) {\n      if (indiceTC >= 0) {\n        tapacantos[indiceTC] = {\n          lado: lado as any,\n          articulo_id: articulo.id,\n          codigo: articulo.codigo_articulo,\n          descripcion: articulo.descripcion_articulo,\n          precio_unitario: articulo.precio_unitario,\n          grosor_mm: articulo.grosor_tapacanto_mm || 0\n        };\n      } else {\n        tapacantos.push({\n          lado: lado as any,\n          articulo_id: articulo.id,\n          codigo: articulo.codigo_articulo,\n          descripcion: articulo.descripcion_articulo,\n          precio_unitario: articulo.precio_unitario,\n          grosor_mm: articulo.grosor_tapacanto_mm || 0\n        });\n      }\n    } else {\n      if (indiceTC >= 0) {\n        tapacantos.splice(indiceTC, 1);\n      }\n    }\n    \n    onEditar(index, { ...piezaActual, tapacantos });\n    setEditandoIndex(null);\n    setEditandoCampo(null);\n  };\n\n  // üÜï Manejar selecci√≥n de CNC desde inventario\n  const handleSeleccionarCNC = (index: number, campo: 'cnc1' | 'cnc2', articulo: ArticuloInventario) => {\n    const piezaActual = piezas[index];\n    const piezaEditada = {\n      ...piezaActual,\n      [campo]: articulo.codigo_articulo // Guardar solo el c√≥digo\n    };\n    onEditar(index, piezaEditada);\n    setEditandoIndex(null);\n    setEditandoCampo(null);\n  };\n\n  const obtenerTapacanto = (pieza: PiezaCorte, lado: string) => {\n    if (!pieza.tapacantos || !Array.isArray(pieza.tapacantos)) {\n      return undefined;\n    }\n    return pieza.tapacantos.find(tc => tc.lado === lado);\n  };\n\n  const handleDuplicar = (index: number) => {\n    if (onDuplicar) {\n      onDuplicar(index);\n    }\n  };\n\n  // üÜï Calcular dimensiones de corte estimadas (para preview)\n  const calcularDimensionesCorteEstimadas = (pieza: PiezaCorte) => {\n    let ajusteLargo = 0;\n    let ajusteAncho = 0;\n\n    if (pieza.tapacantos && pieza.tapacantos.length > 0) {\n      pieza.tapacantos.forEach(tc => {\n        const grosor = tc.grosor_mm || 0;\n        if (grosor > 0) {\n          switch (tc.lado) {\n            case 'superior':\n            case 'inferior':\n              ajusteAncho += grosor;\n              break;\n            case 'izquierdo':\n            case 'derecho':\n              ajusteLargo += grosor;\n              break;\n          }\n        }\n      });\n    }\n\n    return {\n      largo_corte: pieza.largo - ajusteLargo,\n      ancho_corte: pieza.ancho - ajusteAncho,\n      ajuste_largo: ajusteLargo,\n      ajuste_ancho: ajusteAncho\n    };\n  };\n\n  const totalPiezas = piezas.reduce((sum, p) => sum + Number(p.cantidad || 0), 0);\n  const areaTotal = piezas.reduce((sum, p) => {\n    const area = (Number(p.largo || 0) * Number(p.ancho || 0) * Number(p.cantidad || 0)) / 1000000;\n    return sum + area;\n  }, 0);\n\n  const getVetaIcon = (direccion: string) => {\n    switch (direccion) {\n      case 'S':\n        return { icon: 'ri-arrow-right-line', label: 'S - Hacia largo', color: 'text-teal-600' };\n      case 'X':\n        return { icon: 'ri-arrow-down-line', label: 'X - Cruzada', color: 'text-orange-600' };\n      case 'N':\n        return { icon: 'ri-close-circle-line', label: 'N - Sin veta', color: 'text-gray-400' };\n      default:\n        return { icon: 'ri-question-line', label: 'Desconocida', color: 'text-gray-400' };\n    }\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border\">\n      {/* üîß Contenedor con altura m√°xima y scroll */}\n      <div className=\"overflow-x-auto max-h-[500px] overflow-y-auto\">\n        <table className=\"w-full\">\n          <thead className=\"bg-gray-50 sticky top-0 z-10\">\n            <tr className=\"border-b\">\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 w-12\">#</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[150px]\">Descripci√≥n</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[200px]\">Material</th>\n              <th className=\"px-2 py-2 text-center text-xs font-semibold text-gray-700 w-32\">\n                <div className=\"flex flex-col items-center\">\n                  <span>Medida Final</span>\n                  <span className=\"text-[10px] text-gray-500 font-normal\">(Largo √ó Ancho)</span>\n                </div>\n              </th>\n              <th className=\"px-2 py-2 text-center text-xs font-semibold text-gray-700 w-32\">\n                <div className=\"flex flex-col items-center\">\n                  <span>Corte Ajustado</span>\n                  <span className=\"text-[10px] text-gray-500 font-normal\">(con TC)</span>\n                </div>\n              </th>\n              <th className=\"px-2 py-2 text-center text-xs font-semibold text-gray-700 w-20\">Cant.</th>\n              <th className=\"px-2 py-2 text-center text-xs font-semibold text-gray-700 w-28\">Veta</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[120px]\">TC Superior</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[120px]\">TC Inferior</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[120px]\">TC Izquierdo</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[120px]\">TC Derecho</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[140px]\">CNC1</th>\n              <th className=\"px-2 py-2 text-left text-xs font-semibold text-gray-700 min-w-[140px]\">CNC2</th>\n              <th className=\"px-2 py-2 text-center text-xs font-semibold text-gray-700 w-24\">Acciones</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-gray-200\">\n            {piezas.map((pieza, index) => {\n              const vetaInfo = getVetaIcon(pieza.veta || 'N');\n              const area = ((Number(pieza.largo || 0) * Number(pieza.ancho || 0)) / 1000000).toFixed(2);\n              const dimensionesCorte = calcularDimensionesCorteEstimadas(pieza);\n              const tieneAjuste = dimensionesCorte.ajuste_largo > 0 || dimensionesCorte.ajuste_ancho > 0;\n\n              return (\n                <tr key={pieza.id} className=\"hover:bg-gray-50\">\n                  {/* # */}\n                  <td className=\"px-2 py-2\">\n                    <div\n                      className=\"w-6 h-6 rounded flex items-center justify-center text-white font-semibold text-xs\"\n                      style={{ backgroundColor: pieza.color }}\n                    >\n                      {index + 1}\n                    </div>\n                  </td>\n\n                  {/* Descripci√≥n */}\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"text\"\n                      value={pieza.descripcion}\n                      onChange={(e) => handleCambiarValor(index, 'descripcion', e.target.value)}\n                      className=\"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      placeholder=\"Descripci√≥n\"\n                    />\n                  </td>\n\n                  {/* Material */}\n                  <td className=\"px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'material' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"lamina\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarMaterial(index, art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar material...\"\n                      />\n                    ) : (\n                      <button\n                        onClick={() => {\n                          setEditandoIndex(index);\n                          setEditandoCampo('material');\n                        }}\n                        className=\"w-full text-left px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      >\n                        {pieza.material_codigo ? (\n                          <div>\n                            <div className=\"font-medium text-gray-900\">{pieza.material_codigo}</div>\n                            <div className=\"text-gray-500 truncate\">{pieza.material_descripcion}</div>\n                          </div>\n                        ) : (\n                          <span className=\"text-red-600\">Seleccionar material...</span>\n                        )}\n                      </button>\n                    )}\n                  </td>\n\n                  {/* üÜï Medida Final (Largo √ó Ancho) */}\n                  <td className=\"px-2 py-2\">\n                    <div className=\"flex flex-col gap-1\">\n                      <div className=\"flex items-center gap-1\">\n                        <input\n                          type=\"number\"\n                          value={pieza.largo}\n                          onChange={(e) => handleCambiarValor(index, 'largo', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 px-2 py-1 text-xs text-center border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                          min=\"0\"\n                          step=\"1\"\n                          title=\"Largo final (mm)\"\n                        />\n                        <span className=\"text-gray-400 text-xs\">√ó</span>\n                        <input\n                          type=\"number\"\n                          value={pieza.ancho}\n                          onChange={(e) => handleCambiarValor(index, 'ancho', parseFloat(e.target.value) || 0)}\n                          className=\"w-16 px-2 py-1 text-xs text-center border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                          min=\"0\"\n                          step=\"1\"\n                          title=\"Ancho final (mm)\"\n                        />\n                      </div>\n                      <div className=\"text-[10px] text-gray-500 text-center\">\n                        {pieza.largo} √ó {pieza.ancho} mm\n                      </div>\n                    </div>\n                  </td>\n\n                  {/* üÜï Corte Ajustado (con compensaci√≥n de TC) */}\n                  <td className=\"px-2 py-2\">\n                    <div className=\"flex flex-col items-center gap-1\">\n                      {tieneAjuste ? (\n                        <>\n                          <div \n                            className=\"text-xs font-semibold text-orange-700 bg-orange-50 px-2 py-1 rounded border border-orange-200 cursor-help\"\n                            title={`Ajuste por tapacanto:\\nLargo: -${dimensionesCorte.ajuste_largo}mm\\nAncho: -${dimensionesCorte.ajuste_ancho}mm`}\n                          >\n                            {dimensionesCorte.largo_corte} √ó {dimensionesCorte.ancho_corte}\n                          </div>\n                          <div className=\"text-[10px] text-orange-600 flex items-center gap-1\">\n                            <i className=\"ri-scissors-cut-line\"></i>\n                            <span>-{dimensionesCorte.ajuste_largo + dimensionesCorte.ajuste_ancho}mm</span>\n                          </div>\n                        </>\n                      ) : (\n                        <div className=\"text-xs text-gray-400\">\n                          Sin ajuste\n                        </div>\n                      )}\n                    </div>\n                  </td>\n\n                  {/* Cantidad */}\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"number\"\n                      value={pieza.cantidad}\n                      onChange={(e) => handleCambiarValor(index, 'cantidad', parseInt(e.target.value) || 1)}\n                      className=\"w-20 px-2 py-1 text-xs text-center border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      min=\"1\"\n                      step=\"1\"\n                    />\n                  </td>\n\n                  {/* Veta - LISTA DESPLEGABLE */}\n                  <td className=\"px-2 py-2\">\n                    <select\n                      value={pieza.veta || 'N'}\n                      onChange={(e) => handleCambiarValor(index, 'veta', e.target.value)}\n                      className=\"w-28 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    >\n                      <option value=\"S\">S - Hacia largo</option>\n                      <option value=\"X\">X - Cruzada</option>\n                      <option value=\"N\">N - Sin veta</option>\n                    </select>\n                    <div className=\"flex items-center gap-1 mt-1\">\n                      <i className={`${vetaInfo.icon} ${vetaInfo.color} text-xs`}></i>\n                      <span className={`${vetaInfo.color} text-[10px]`}>\n                        {vetaInfo.label}\n                      </span>\n                    </div>\n                  </td>\n\n                  {/* Tapacanto Superior */}\n                  <td className=\"px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'tc_superior' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"tapacanto\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarTapacanto(index, 'superior', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar tapacanto...\"\n                      />\n                    ) : (\n                      <button\n                        onClick={() => {\n                          setEditandoIndex(index);\n                          setEditandoCampo('tc_superior');\n                        }}\n                        className=\"w-full text-left px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      >\n                        {obtenerTapacanto(pieza, 'superior') ? (\n                          <div className=\"flex items-center justify-between\">\n                            <span>{obtenerTapacanto(pieza, 'superior')?.codigo}</span>\n                            {obtenerTapacanto(pieza, 'superior')?.grosor_mm && (\n                              <span className=\"text-[10px] text-orange-600 font-semibold\">\n                                {obtenerTapacanto(pieza, 'superior')?.grosor_mm}mm\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-gray-400\">Sin TC</span>\n                        )}\n                      </button>\n                    )}\n                  </td>\n\n                  {/* Tapacanto Inferior */}\n                  <td className=\"px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'tc_inferior' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"tapacanto\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarTapacanto(index, 'inferior', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar tapacanto...\"\n                      />\n                    ) : (\n                      <button\n                        onClick={() => {\n                          setEditandoIndex(index);\n                          setEditandoCampo('tc_inferior');\n                        }}\n                        className=\"w-full text-left px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      >\n                        {obtenerTapacanto(pieza, 'inferior') ? (\n                          <div className=\"flex items-center justify-between\">\n                            <span>{obtenerTapacanto(pieza, 'inferior')?.codigo}</span>\n                            {obtenerTapacanto(pieza, 'inferior')?.grosor_mm && (\n                              <span className=\"text-[10px] text-orange-600 font-semibold\">\n                                {obtenerTapacanto(pieza, 'inferior')?.grosor_mm}mm\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-gray-400\">Sin TC</span>\n                        )}\n                      </button>\n                    )}\n                  </td>\n\n                  {/* Tapacanto Izquierdo */}\n                  <td className=\"px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'tc_izquierdo' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"tapacanto\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarTapacanto(index, 'izquierdo', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar tapacanto...\"\n                      />\n                    ) : (\n                      <button\n                        onClick={() => {\n                          setEditandoIndex(index);\n                          setEditandoCampo('tc_izquierdo');\n                        }}\n                        className=\"w-full text-left px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      >\n                        {obtenerTapacanto(pieza, 'izquierdo') ? (\n                          <div className=\"flex items-center justify-between\">\n                            <span>{obtenerTapacanto(pieza, 'izquierdo')?.codigo}</span>\n                            {obtenerTapacanto(pieza, 'izquierdo')?.grosor_mm && (\n                              <span className=\"text-[10px] text-orange-600 font-semibold\">\n                                {obtenerTapacanto(pieza, 'izquierdo')?.grosor_mm}mm\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-gray-400\">Sin TC</span>\n                        )}\n                      </button>\n                    )}\n                  </td>\n\n                  {/* Tapacanto Derecho */}\n                  <td className=\"px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'tc_derecho' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"tapacanto\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarTapacanto(index, 'derecho', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar tapacanto...\"\n                      />\n                    ) : (\n                      <button\n                        onClick={() => {\n                          setEditandoIndex(index);\n                          setEditandoCampo('tc_derecho');\n                        }}\n                        className=\"w-full text-left px-2 py-1 text-xs border border-gray-300 rounded hover:bg-gray-50 transition-colors\"\n                      >\n                        {obtenerTapacanto(pieza, 'derecho') ? (\n                          <div className=\"flex items-center justify-between\">\n                            <span>{obtenerTapacanto(pieza, 'derecho')?.codigo}</span>\n                            {obtenerTapacanto(pieza, 'derecho')?.grosor_mm && (\n                              <span className=\"text-[10px] text-orange-600 font-semibold\">\n                                {obtenerTapacanto(pieza, 'derecho')?.grosor_mm}mm\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-gray-400\">Sin TC</span>\n                        )}\n                      </button>\n                    )}\n                  </td>\n\n                  {/* CNC1 */}\n                  <td className=\"text-xs border-b border-gray-200 px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'cnc1' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"mecanizado\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarCNC(index, 'cnc1', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar CNC1...\"\n                      />\n                    ) : (\n                      <div className=\"flex items-center gap-1\">\n                        {/* üîç CAMPO DE B√öSQUEDA CNC1 */}\n                        <button\n                          onClick={() => {\n                            setEditandoIndex(index);\n                            setEditandoCampo('cnc1');\n                          }}\n                          className={`flex-1 text-left px-2 py-1 text-xs rounded transition-colors ${\n                            pieza.cnc1 && pieza.cnc1.trim() !== ''\n                              ? 'bg-blue-50 text-blue-700 border border-blue-300 hover:bg-blue-100'\n                              : 'text-gray-400 border border-dashed border-gray-300 hover:border-gray-400 hover:bg-gray-50'\n                          }`}\n                          title=\"Buscar art√≠culo CNC1\"\n                        >\n                          {pieza.cnc1 && pieza.cnc1.trim() !== '' ? pieza.cnc1 : '+ Buscar CNC1'}\n                        </button>\n\n                        {/* üî¢ CAMPO DE CANTIDAD CNC1 */}\n                        <input\n                          type=\"number\"\n                          value={pieza.cnc1_cantidad || 0}\n                          onChange={(e) => handleCambiarValor(index, 'cnc1_cantidad', parseInt(e.target.value) || 0)}\n                          disabled={!pieza.cnc1 || pieza.cnc1.trim() === ''}\n                          className=\"w-14 px-1 py-1 text-xs text-center border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400\"\n                          min=\"0\"\n                          step=\"1\"\n                          placeholder=\"Cant\"\n                          title={pieza.cnc1 && pieza.cnc1.trim() !== '' ? \"Cantidad CNC1\" : \"Seleccione un CNC1 primero\"}\n                        />\n                      </div>\n                    )}\n                  </td>\n\n                  {/* CNC2 */}\n                  <td className=\"text-xs border-b border-gray-200 px-2 py-2\">\n                    {editandoIndex === index && editandoCampo === 'cnc2' ? (\n                      <BuscadorArticuloBlur\n                        tipoArticulo=\"mecanizado\"\n                        tiendaActual={tiendaActual}\n                        onSeleccionar={(art) => handleSeleccionarCNC(index, 'cnc2', art)}\n                        onCancelar={() => {\n                          setEditandoIndex(null);\n                          setEditandoCampo(null);\n                        }}\n                        placeholder=\"Buscar CNC2...\"\n                      />\n                    ) : (\n                      <div className=\"flex items-center gap-1\">\n                        {/* üîç CAMPO DE B√öSQUEDA CNC2 */}\n                        <button\n                          onClick={() => {\n                            setEditandoIndex(index);\n                            setEditandoCampo('cnc2');\n                          }}\n                          className={`flex-1 text-left px-2 py-1 text-xs rounded transition-colors ${\n                            pieza.cnc2 && pieza.cnc2.trim() !== ''\n                              ? 'bg-blue-50 text-blue-700 border border-blue-300 hover:bg-blue-100'\n                              : 'text-gray-400 border border-dashed border-gray-300 hover:border-gray-400 hover:bg-gray-50'\n                          }`}\n                          title=\"Buscar art√≠culo CNC2\"\n                        >\n                          {pieza.cnc2 && pieza.cnc2.trim() !== '' ? pieza.cnc2 : '+ Buscar CNC2'}\n                        </button>\n\n                        {/* üî¢ CAMPO DE CANTIDAD CNC2 */}\n                        <input\n                          type=\"number\"\n                          value={pieza.cnc2_cantidad || 0}\n                          onChange={(e) => handleCambiarValor(index, 'cnc2_cantidad', parseInt(e.target.value) || 0)}\n                          disabled={!pieza.cnc2 || pieza.cnc2.trim() === ''}\n                          className=\"w-14 px-1 py-1 text-xs text-center border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400\"\n                          min=\"0\"\n                          step=\"1\"\n                          placeholder=\"Cant\"\n                          title={pieza.cnc2 && pieza.cnc2.trim() !== '' ? \"Cantidad CNC2\" : \"Seleccione un CNC2 primero\"}\n                        />\n                      </div>\n                    )}\n                  </td>\n\n                  {/* Acciones */}\n                  <td className=\"px-2 py-2\">\n                    <div className=\"flex items-center justify-center gap-1\">\n                      {onDuplicar && (\n                        <button\n                          onClick={() => handleDuplicar(index)}\n                          className=\"p-1.5 text-green-600 hover:bg-green-50 rounded transition-colors\"\n                          title=\"Duplicar\"\n                        >\n                          <i className=\"ri-file-copy-line text-sm\"></i>\n                        </button>\n                      )}\n                      <button\n                        onClick={() => onEliminar(index)}\n                        className=\"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors\"\n                        title=\"Eliminar\"\n                      >\n                        <i className=\"ri-delete-bin-line text-sm\"></i>\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n\n      {/* Footer con totales */}\n      <div className=\"px-4 py-3 border-t bg-gray-50\">\n        <div className=\"flex items-center justify-between text-sm\">\n          <span className=\"font-semibold text-gray-700\">Totales:</span>\n          <div className=\"flex items-center gap-6\">\n            <span className=\"text-gray-600\">\n              Piezas: <strong className=\"text-gray-900\">{totalPiezas}</strong>\n            </span>\n            <span className=\"text-gray-600\">\n              √Årea: <strong className=\"text-gray-900\">{areaTotal.toFixed(2)} m¬≤</strong>\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { useAuth } from '../../../hooks/useAuth';\nimport { PiezaCorte } from '../../../types/optimizador';\nimport { useNotification } from '../../../hooks/useNotification';\nimport { buscarArticulosInventario } from '../../../services/optimizadorService';\nimport { supabase } from '../../../lib/supabase';\nimport * as XLSX from 'xlsx';\n\ninterface Props {\n  onImportar: (piezas: PiezaCorte[]) => void;\n}\n\n// üé® Paleta de 20 colores √∫nicos\nconst COLORES_PIEZAS = [\n  '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6',\n  '#EC4899', '#14B8A6', '#F97316', '#6366F1', '#84CC16',\n  '#06B6D4', '#F43F5E', '#92400E', '#6B7280', '#7C3AED',\n  '#22C55E', '#EAB308', '#DC2626', '#0EA5E9', '#D946EF'\n];\n\nexport default function ImportarExcelModal({ onImportar }: Props) {\n  const { showNotification } = useNotification();\n  const { currentStore } = useAuth();\n  const [mostrarModal, setMostrarModal] = useState(false);\n  const [archivo, setArchivo] = useState<File | null>(null);\n  const [previsualizacion, setPrevisualizacion] = useState<any[]>([]);\n  const [cargando, setCargando] = useState(false);\n\n  const handleSeleccionarArchivo = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setArchivo(file);\n    leerArchivo(file);\n  };\n\n  const leerArchivo = (file: File) => {\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      try {\n        const data = e.target?.result;\n        const workbook = XLSX.read(data, { type: 'binary' });\n        const sheetName = workbook.SheetNames[0];\n        const worksheet = workbook.Sheets[sheetName];\n        const jsonData = XLSX.utils.sheet_to_json(worksheet);\n        \n        setPrevisualizacion(jsonData.slice(0, 5)); // Mostrar solo 5 filas de preview\n      } catch (error) {\n        console.error('Error leyendo archivo:', error);\n        showNotification('error', 'Error al leer el archivo Excel');\n      }\n    };\n\n    reader.readAsBinaryString(file);\n  };\n\n  const handleImportar = async () => {\n    if (!archivo) return;\n\n    setCargando(true);\n    const reader = new FileReader();\n    \n    reader.onload = async (e) => {\n      try {\n        const data = e.target?.result;\n        const workbook = XLSX.read(data, { type: 'binary' });\n        const sheetName = workbook.SheetNames[0];\n        const worksheet = workbook.Sheets[sheetName];\n        const jsonData: any[] = XLSX.utils.sheet_to_json(worksheet);\n\n        console.log('üì• [IMPORTAR] Iniciando importaci√≥n de', jsonData.length, 'filas');\n\n        // üîß HELPER: Normalizar c√≥digo (quitar .0, trim, convertir a string)\n        const normalizarCodigo = (valor: any): string => {\n          if (!valor) return '';\n          let str = String(valor).trim();\n          // Quitar .0 al final (ej: 334433.0 ‚Üí 334433)\n          if (str.endsWith('.0')) {\n            str = str.slice(0, -2);\n          }\n          return str;\n        };\n\n        // üÜï PASO 1: Extraer todos los c√≥digos √∫nicos de materiales y tapacantos\n        const codigosMateriales = new Set<string>();\n        const codigosTapacantos = new Set<string>();\n        const codigosCNC = new Set<string>();\n\n        jsonData.forEach(row => {\n          const materialCodigo = normalizarCodigo(row['Material'] || row['material']);\n          if (materialCodigo) codigosMateriales.add(materialCodigo);\n\n          // üîß Normalizar c√≥digos de tapacantos\n          const tcSup = normalizarCodigo(row['TC Superior'] || row['tc_superior']);\n          const tcInf = normalizarCodigo(row['TC Inferior'] || row['tc_inferior']);\n          const tcIzq = normalizarCodigo(row['TC Izquierdo'] || row['tc_izquierdo']);\n          const tcDer = normalizarCodigo(row['TC Derecho'] || row['tc_derecho']);\n\n          // Ignorar valores como \"Sin TC\", \"0\", vac√≠os\n          if (tcSup && tcSup !== 'Sin TC' && tcSup !== '0') codigosTapacantos.add(tcSup);\n          if (tcInf && tcInf !== 'Sin TC' && tcInf !== '0') codigosTapacantos.add(tcInf);\n          if (tcIzq && tcIzq !== 'Sin TC' && tcIzq !== '0') codigosTapacantos.add(tcIzq);\n          if (tcDer && tcDer !== 'Sin TC' && tcDer !== '0') codigosTapacantos.add(tcDer);\n\n          // üÜï Extraer c√≥digos de CNC\n          const cnc1 = normalizarCodigo(row['CNC1'] || row['cnc1']);\n          const cnc2 = normalizarCodigo(row['CNC2'] || row['cnc2']);\n          if (cnc1 && cnc1 !== '0') codigosCNC.add(cnc1);\n          if (cnc2 && cnc2 !== '0') codigosCNC.add(cnc2);\n        });\n\n        console.log('üîç [IMPORTAR] C√≥digos a validar:', {\n          materiales: Array.from(codigosMateriales),\n          tapacantos: Array.from(codigosTapacantos),\n          cnc: Array.from(codigosCNC)\n        });\n\n        // üÜï PASO 2: Buscar materiales en la base de datos\n        const materialesMap = new Map<string, any>();\n        \n        for (const codigo of codigosMateriales) {\n          const { data: materiales } = await buscarArticulosInventario(codigo, 'lamina', currentStore);\n          \n          if (materiales && materiales.length > 0) {\n            // Buscar coincidencia exacta (case-insensitive)\n            const materialExacto = materiales.find(m => \n              m.codigo_articulo.toLowerCase().trim() === codigo.toLowerCase().trim()\n            );\n            \n            if (materialExacto) {\n              materialesMap.set(codigo, materialExacto);\n              console.log('‚úÖ [IMPORTAR] Material encontrado:', codigo, '‚Üí', materialExacto.descripcion_articulo);\n            }\n          }\n        }\n\n        console.log('üìä [IMPORTAR] Resumen de materiales encontrados:', {\n          total_buscados: codigosMateriales.size,\n          total_encontrados: materialesMap.size,\n          materiales_encontrados: Array.from(materialesMap.keys()),\n          materiales_no_encontrados: Array.from(codigosMateriales).filter(c => !materialesMap.has(c))\n        });\n\n        // üÜï PASO 3: Buscar tapacantos en la base de datos (MISMA L√ìGICA QUE MATERIALES)\n        const tapacantosMap = new Map<string, any>();\n        \n        if (codigosTapacantos.size > 0) {\n          for (const codigo of codigosTapacantos) {\n            const { data: tapacantos } = await buscarArticulosInventario(codigo, 'tapacanto', currentStore);\n            \n            console.log(`üîç [tapacanto_resolve] Buscando \"${codigo}\":`, {\n              columna: 'TC',\n              codigo_normalizado: codigo,\n              encontrado: tapacantos && tapacantos.length > 0,\n              resultados: tapacantos?.length || 0\n            });\n            \n            if (tapacantos && tapacantos.length > 0) {\n              // Buscar coincidencia exacta (case-insensitive)\n              const tapacantoExacto = tapacantos.find(tc => \n                tc.codigo_articulo.toLowerCase().trim() === codigo.toLowerCase().trim()\n              );\n              \n              if (tapacantoExacto) {\n                tapacantosMap.set(codigo, tapacantoExacto);\n                console.log('‚úÖ [tapacanto_resolve]', {\n                  columna: 'TC',\n                  codigo_normalizado: codigo,\n                  encontrado: true,\n                  id_articulo: tapacantoExacto.id,\n                  codigo_articulo: tapacantoExacto.codigo_articulo,\n                  descripcion: tapacantoExacto.descripcion_articulo\n                });\n              }\n            }\n          }\n        }\n\n        console.log('üìä [IMPORTAR] Resumen de tapacantos encontrados:', {\n          total_buscados: codigosTapacantos.size,\n          total_encontrados: tapacantosMap.size,\n          tapacantos_encontrados: Array.from(tapacantosMap.keys()),\n          tapacantos_no_encontrados: Array.from(codigosTapacantos).filter(c => !tapacantosMap.has(c))\n        });\n\n        // üÜï PASO 3.5: Buscar c√≥digos de CNC en la base de datos\n        const cncMap = new Map<string, any>();\n        \n        if (codigosCNC.size > 0) {\n          const { data: todosCNC, error: errorCNC } = await supabase\n            .from('inventario')\n            .select(`\n              id_articulo,\n              codigo_articulo,\n              descripcion_articulo,\n              precio_articulo\n            `)\n            .in('codigo_articulo', Array.from(codigosCNC))\n            .eq('id_tienda', currentStore?.id)\n            .eq('activo', true);\n\n          if (!errorCNC && todosCNC) {\n            todosCNC.forEach(cnc => {\n              cncMap.set(cnc.codigo_articulo, cnc);\n              console.log('‚úÖ [IMPORTAR] CNC encontrado:', cnc.codigo_articulo, '‚Üí', cnc.descripcion_articulo, '- Precio:', cnc.precio_articulo);\n            });\n          }\n        }\n\n        // üÜï PASO 4: Mapear piezas con validaci√≥n\n        const piezasImportadas: PiezaCorte[] = [];\n        const erroresValidacion: string[] = [];\n\n        jsonData.forEach((row, index) => {\n          const descripcion = row['Descripci√≥n'] || row['Descripcion'] || row['descripcion'] || `Pieza ${index + 1}`;\n          const materialCodigo = normalizarCodigo(row['Material'] || row['material']);\n          const largo = parseFloat(row['Largo'] || row['largo'] || '0');\n          const ancho = parseFloat(row['Ancho'] || row['ancho'] || '0');\n          const cantidad = parseInt(row['Cantidad'] || row['cantidad'] || '1');\n          const veta = (row['Veta'] || row['veta'] || 'S').toString().toUpperCase();\n          \n          // üîß Leer CNC con sus cantidades\n          const cnc1Codigo = normalizarCodigo(row['CNC1'] || row['cnc1']);\n          const cnc1Cantidad = parseInt(row['CNC1 Cantidad'] || row['cnc1_cantidad'] || '0');\n          const cnc2Codigo = normalizarCodigo(row['CNC2'] || row['cnc2']);\n          const cnc2Cantidad = parseInt(row['CNC2 Cantidad'] || row['cnc2_cantidad'] || '0');\n\n          // üÜï Validar material\n          if (!materialCodigo) {\n            erroresValidacion.push(`Fila ${index + 1}: Sin c√≥digo de material`);\n            return;\n          }\n\n          const material = materialesMap.get(materialCodigo);\n          if (!material) {\n            erroresValidacion.push(\n              `Fila ${index + 1}: Material \"${materialCodigo}\" no encontrado en inventario.\\n` +\n              `   ‚Ä¢ Verifica que el c√≥digo sea correcto\\n` +\n              `   ‚Ä¢ Aseg√∫rate de que est√© en la categor√≠a LAMINAS\\n` +\n              `   ‚Ä¢ Verifica que est√© activo y tenga dimensiones completas`\n            );\n            return;\n          }\n\n          // üîß CORREGIDO: Validar y mapear tapacantos con nombres correctos\n          const tapacantos = [];\n          const tapacantosData = [\n            { lado: 'superior' as const, codigo: normalizarCodigo(row['TC Superior'] || row['tc_superior']) },\n            { lado: 'inferior' as const, codigo: normalizarCodigo(row['TC Inferior'] || row['tc_inferior']) },\n            { lado: 'izquierdo' as const, codigo: normalizarCodigo(row['TC Izquierdo'] || row['tc_izquierdo']) },\n            { lado: 'derecho' as const, codigo: normalizarCodigo(row['TC Derecho'] || row['tc_derecho']) }\n          ];\n\n          tapacantosData.forEach(({ lado, codigo }) => {\n            // Ignorar valores vac√≠os, \"Sin TC\", \"0\"\n            if (codigo && codigo !== 'Sin TC' && codigo !== '0') {\n              const tapacanto = tapacantosMap.get(codigo);\n              \n              if (tapacanto) {\n                tapacantos.push({\n                  lado,\n                  articulo_id: tapacanto.id,\n                  codigo: tapacanto.codigo_articulo,\n                  descripcion: tapacanto.descripcion_articulo,\n                  precio_unitario: tapacanto.precio_articulo || 0,\n                  grosor_mm: tapacanto.grosor_tapacanto_mm || 0,\n                  metros_lineales: 0\n                });\n                console.log(`‚úÖ [IMPORTAR] Tapacanto asignado a \"${descripcion}\" - ${lado}: ${codigo}`);\n              } else {\n                console.warn(`‚ö†Ô∏è [IMPORTAR] Tapacanto \"${codigo}\" no encontrado para pieza \"${descripcion}\" - lado: ${lado}`);\n              }\n            }\n          });\n\n          // Log de pieza mapeada\n          console.log('üì¶ [pieza_mapeada]', {\n            desc: descripcion,\n            tcSup: tapacantos.find(tc => tc.lado === 'superior')?.codigo || null,\n            tcInf: tapacantos.find(tc => tc.lado === 'inferior')?.codigo || null,\n            tcIzq: tapacantos.find(tc => tc.lado === 'izquierdo')?.codigo || null,\n            tcDer: tapacantos.find(tc => tc.lado === 'derecho')?.codigo || null\n          });\n\n          // üÜï Validar y normalizar veta (S, X, N)\n          let vetaNormalizada: 'S' | 'X' | 'N' = 'S';\n          const vetaStr = String(veta).toUpperCase().trim();\n          \n          if (vetaStr === 'S' || vetaStr === 'X' || vetaStr === 'N') {\n            vetaNormalizada = vetaStr as 'S' | 'X' | 'N';\n          } else if (vetaStr === 'Y' || vetaStr === 'YES' || vetaStr === 'SI' || vetaStr === 'S√ç') {\n            vetaNormalizada = 'N';\n          } else {\n            vetaNormalizada = largo > ancho ? 'S' : (ancho > largo ? 'X' : 'N');\n          }\n\n          // üé® Asignar color secuencial (20 colores antes de repetir)\n          const color = COLORES_PIEZAS[index % COLORES_PIEZAS.length];\n\n          // üÜï Crear pieza con datos validados del material\n          piezasImportadas.push({\n            id: `excel-${Date.now()}-${index}`,\n            descripcion,\n            material_id: material.id,\n            material_codigo: material.codigo_articulo,\n            material_descripcion: material.descripcion_articulo,\n            material_precio: material.precio_unitario || 0,\n            material_espesor_mm: material.espesor_mm,\n            material_largo_lamina_mm: material.largo_lamina_mm,\n            material_ancho_lamina_mm: material.ancho_lamina_mm,\n            largo,\n            ancho,\n            cantidad,\n            veta: vetaNormalizada,\n            tapacantos,\n            cnc1: cnc1Codigo,\n            cnc1_codigo: cnc1Codigo,\n            cnc1_cantidad: cnc1Cantidad,\n            cnc2: cnc2Codigo,\n            cnc2_codigo: cnc2Codigo,\n            cnc2_cantidad: cnc2Cantidad,\n            color\n          } as PiezaCorte);\n\n          console.log(`‚úÖ [IMPORTAR] Pieza \"${descripcion}\" creada:`, {\n            material: materialCodigo,\n            tapacantos: tapacantos.length,\n            cnc1: cnc1Codigo ? `${cnc1Codigo} x ${cnc1Cantidad}` : '-',\n            cnc2: cnc2Codigo ? `${cnc2Codigo} x ${cnc2Cantidad}` : '-'\n          });\n        });\n\n        // üÜï PASO 5: Mostrar resultados\n        if (erroresValidacion.length > 0) {\n          console.error('‚ùå [IMPORTAR] Errores de validaci√≥n:', erroresValidacion);\n          \n          // Mostrar los primeros 5 errores en un modal m√°s informativo\n          const mensajeErrores = erroresValidacion.slice(0, 5).join('\\n\\n');\n          const mensajeCompleto = `‚ùå Se encontraron ${erroresValidacion.length} error(es) de validaci√≥n:\\n\\n${mensajeErrores}${erroresValidacion.length > 5 ? '\\n\\n... y m√°s errores' : ''}\\n\\nüí° Sugerencias:\\n\\n1. Verifica que los c√≥digos de material existan en tu inventario\\n2. Aseg√∫rate de que los materiales est√©n en la categor√≠a LAMINAS\\n3. Verifica que los materiales est√©n activos\\n4. Aseg√∫rate de que tengan dimensiones completas (largo, ancho, espesor)\\n5. Revisa la consola del navegador (F12) para m√°s detalles\\n\\nüìã Materiales buscados: ${Array.from(codigosMateriales).join(', ')}\\n‚úÖ Materiales encontrados: ${Array.from(materialesMap.keys()).join(', ') || 'Ninguno'}`;\n          \n          alert(mensajeCompleto);\n          showNotification('error', `${erroresValidacion.length} error(es) de validaci√≥n. Revisa el mensaje.`);\n        }\n\n        if (piezasImportadas.length > 0) {\n          onImportar(piezasImportadas);\n          showNotification('success', `‚úÖ Se importaron ${piezasImportadas.length} piezas correctamente`);\n          setMostrarModal(false);\n          setArchivo(null);\n          setPrevisualizacion([]);\n        } else {\n          showNotification('error', 'No se pudo importar ninguna pieza. Verifica los c√≥digos de material.');\n        }\n\n        setCargando(false);\n      } catch (error) {\n        console.error('Error importando:', error);\n        showNotification('error', 'Error al importar el archivo. Verifica el formato.');\n        setCargando(false);\n      }\n    };\n\n    reader.readAsBinaryString(archivo);\n  };\n\n  const descargarPlantilla = () => {\n    const plantilla = [\n      {\n        'Descripci√≥n': 'Tapa superior',\n        'Material': 'MEL001',\n        'Largo': 2000,\n        'Ancho': 600,\n        'Cantidad': 1,\n        'Veta': 'S',\n        'TC Superior': 'TC001',\n        'TC Inferior': 'TC001',\n        'TC Izquierdo': 'TC001',\n        'TC Derecho': 'TC001',\n        'CNC1': '77788',\n        'CNC1 Cantidad': 1,\n        'CNC2': '77788',\n        'CNC2 Cantidad': 2\n      },\n      {\n        'Descripci√≥n': 'Lateral izquierdo',\n        'Material': 'MEL001',\n        'Largo': 1800,\n        'Ancho': 400,\n        'Cantidad': 1,\n        'Veta': 'S',\n        'TC Superior': 'TC001',\n        'TC Inferior': '',\n        'TC Izquierdo': 'TC001',\n        'TC Derecho': 'TC001',\n        'CNC1': '77788',\n        'CNC1 Cantidad': 1,\n        'CNC2': '',\n        'CNC2 Cantidad': 0\n      },\n      {\n        'Descripci√≥n': 'Entrepa√±o',\n        'Material': 'MEL001',\n        'Largo': 400,\n        'Ancho': 1800,\n        'Cantidad': 2,\n        'Veta': 'X',\n        'TC Superior': 'TC001',\n        'TC Inferior': 'TC001',\n        'TC Izquierdo': '',\n        'TC Derecho': '',\n        'CNC1': '',\n        'CNC1 Cantidad': 0,\n        'CNC2': '',\n        'CNC2 Cantidad': 0\n      }\n    ];\n\n    const ws = XLSX.utils.json_to_sheet(plantilla);\n    \n    // Ajustar anchos de columna\n    ws['!cols'] = [\n      { wch: 30 }, // Descripci√≥n\n      { wch: 15 }, // Material\n      { wch: 10 }, // Largo\n      { wch: 10 }, // Ancho\n      { wch: 10 }, // Cantidad\n      { wch: 8 },  // Veta\n      { wch: 15 }, // TC Superior\n      { wch: 15 }, // TC Inferior\n      { wch: 15 }, // TC Izquierdo\n      { wch: 15 }, // TC Derecho\n      { wch: 15 }, // CNC1\n      { wch: 15 }, // CNC1 Cantidad\n      { wch: 15 }, // CNC2\n      { wch: 15 }  // CNC2 Cantidad\n    ];\n    \n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, 'Piezas');\n    XLSX.writeFile(wb, 'plantilla_optimizador.xlsx');\n    \n    showNotification('success', 'Plantilla descargada correctamente');\n  };\n\n  return (\n    <>\n      <button\n        onClick={() => setMostrarModal(true)}\n        className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 whitespace-nowrap\"\n      >\n        <i className=\"ri-folder-open-line\"></i>\n        Cargar Proyecto\n      </button>\n\n      {mostrarModal && (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n          <div className=\"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden\">\n            {/* Header */}\n            <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center\">\n                    <i className=\"ri-file-excel-2-line text-2xl\"></i>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold\">Cargar Proyecto desde Excel</h2>\n                    <p className=\"text-blue-100 text-sm\">\n                      Importa la lista de piezas desde un archivo Excel (.xlsx)\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => {\n                    setMostrarModal(false);\n                    setArchivo(null);\n                    setPrevisualizacion([]);\n                  }}\n                  className=\"text-white hover:bg-white/20 p-2 rounded-lg transition-colors\"\n                  disabled={cargando}\n                >\n                  <i className=\"ri-close-line text-2xl\"></i>\n                </button>\n              </div>\n            </div>\n\n            {/* Body */}\n            <div className=\"p-6 overflow-y-auto max-h-[calc(90vh-200px)]\">\n              {/* Formato esperado */}\n              <div className=\"bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6\">\n                <h3 className=\"font-semibold text-blue-900 mb-3 flex items-center gap-2\">\n                  <i className=\"ri-information-line\"></i>\n                  Formato del Archivo Excel\n                </h3>\n                <div className=\"text-sm text-blue-800 space-y-2\">\n                  <p>El archivo debe contener las siguientes columnas:</p>\n                  <div className=\"bg-white rounded-lg p-3 font-mono text-xs overflow-x-auto\">\n                    <div className=\"grid grid-cols-7 gap-2 min-w-max\">\n                      <div className=\"font-bold\">1. Descripci√≥n</div>\n                      <div className=\"font-bold\">2. Material</div>\n                      <div className=\"font-bold\">3. Largo</div>\n                      <div className=\"font-bold\">4. Ancho</div>\n                      <div className=\"font-bold\">5. Cantidad</div>\n                      <div className=\"font-bold\">6. Veta</div>\n                      <div className=\"font-bold\">7. TC Superior</div>\n                    </div>\n                    <div className=\"grid grid-cols-7 gap-2 min-w-max mt-2\">\n                      <div className=\"font-bold\">8. TC Inferior</div>\n                      <div className=\"font-bold\">9. TC Izquierdo</div>\n                      <div className=\"font-bold\">10. TC Derecho</div>\n                      <div className=\"font-bold\">11. CNC1</div>\n                      <div className=\"font-bold\">12. CNC1 Cantidad</div>\n                      <div className=\"font-bold\">13. CNC2</div>\n                      <div className=\"font-bold\">14. CNC2 Cantidad</div>\n                    </div>\n                  </div>\n                  <div className=\"bg-amber-50 border border-amber-200 rounded p-2 mt-2\">\n                    <p className=\"text-xs text-amber-900\">\n                      <strong>Importante:</strong> Los c√≥digos de Material, Tapacantos y CNC deben existir en tu inventario\n                    </p>\n                  </div>\n                  <div className=\"bg-green-50 border border-green-200 rounded p-2 mt-2\">\n                    <p className=\"text-xs text-green-900\">\n                      <strong>Veta:</strong> Usa <strong>S</strong> (hacia largo), <strong>X</strong> (cruzada), o <strong>N</strong> (sin veta)\n                    </p>\n                  </div>\n                  <div className=\"bg-purple-50 border border-purple-200 rounded p-2 mt-2\">\n                    <p className=\"text-xs text-purple-900\">\n                      <strong>CNC:</strong> Ingresa el c√≥digo del art√≠culo CNC y su cantidad. Ejemplo: CNC1 = \"77788\", CNC1 Cantidad = 1\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Descargar plantilla */}\n              <div className=\"mb-6\">\n                <button\n                  onClick={descargarPlantilla}\n                  className=\"w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2\"\n                  disabled={cargando}\n                >\n                  <i className=\"ri-download-2-line text-xl\"></i>\n                  Descargar Plantilla de Ejemplo\n                </button>\n              </div>\n\n              {/* Selector de archivo */}\n              <div className=\"mb-6\">\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Seleccionar archivo Excel\n                </label>\n                <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors\">\n                  <input\n                    type=\"file\"\n                    accept=\".xlsx,.xls\"\n                    onChange={handleSeleccionarArchivo}\n                    className=\"hidden\"\n                    id=\"file-upload\"\n                    disabled={cargando}\n                  />\n                  <label\n                    htmlFor=\"file-upload\"\n                    className={`${cargando ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'} flex flex-col items-center gap-3`}\n                  >\n                    <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\n                      <i className={`${cargando ? 'ri-loader-4-line animate-spin' : 'ri-upload-cloud-2-line'} text-3xl text-blue-600`}></i>\n                    </div>\n                    <div>\n                      <p className=\"text-lg font-semibold text-gray-900\">\n                        {cargando ? 'Validando c√≥digos...' : (archivo ? archivo.name : 'Haz clic para seleccionar un archivo')}\n                      </p>\n                      <p className=\"text-sm text-gray-600\">\n                        {cargando ? 'Por favor espera...' : 'o arrastra y suelta aqu√≠'}\n                      </p>\n                    </div>\n                    <p className=\"text-xs text-gray-500\">\n                      Formatos soportados: .xlsx, .xls\n                    </p>\n                  </label>\n                </div>\n              </div>\n\n              {/* Previsualizaci√≥n */}\n              {previsualizacion.length > 0 && !cargando && (\n                <div className=\"mb-6\">\n                  <h3 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n                    <i className=\"ri-eye-line text-blue-600\"></i>\n                    Previsualizaci√≥n (primeras 5 filas)\n                  </h3>\n                  <div className=\"overflow-x-auto border border-gray-200 rounded-lg\">\n                    <table className=\"min-w-full divide-y divide-gray-200 text-xs\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          {Object.keys(previsualizacion[0]).map((key) => (\n                            <th key={key} className=\"px-3 py-2 text-left font-semibold text-gray-700 whitespace-nowrap\">\n                              {key}\n                            </th>\n                          ))}\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {previsualizacion.map((row, index) => (\n                          <tr key={index} className=\"hover:bg-gray-50\">\n                            {Object.values(row).map((value: any, i) => (\n                              <td key={i} className=\"px-3 py-2 text-gray-900 whitespace-nowrap\">\n                                {value}\n                              </td>\n                            ))}\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                  <p className=\"text-xs text-gray-600 mt-2\">\n                    Se validar√°n todos los c√≥digos de material y tapacantos antes de importar\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Footer */}\n            <div className=\"bg-gray-50 px-6 py-4 border-t border-gray-200 flex gap-3\">\n              <button\n                onClick={() => {\n                  setMostrarModal(false);\n                  setArchivo(null);\n                  setPrevisualizacion([]);\n                }}\n                className=\"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-semibold\"\n                disabled={cargando}\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={handleImportar}\n                disabled={!archivo || cargando}\n                className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-semibold flex items-center justify-center gap-2\"\n              >\n                {cargando ? (\n                  <>\n                    <i className=\"ri-loader-4-line text-xl animate-spin\"></i>\n                    Validando...\n                  </>\n                ) : (\n                  <>\n                    <i className=\"ri-check-line text-xl\"></i>\n                    Cargar Piezas\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","import React, { useState } from 'react';\nimport { PiezaCorte, ModoOptimizador, ArticuloInventario } from '../../../types/optimizador';\nimport TablaPiezas from './TablaPiezas';\nimport SelectorProductoBOM from './SelectorProductoBOM';\nimport ImportarExcelModal from './ImportarExcelModal';\nimport { useAuth } from '../../../hooks/useAuth';\n\ninterface EditorPiezasProps {\n  modo: ModoOptimizador;\n  piezas: PiezaCorte[];\n  laminaBase: ArticuloInventario | null;\n  onCargarBOM: (productoId: number, productoNombre: string) => void;\n  onAgregarPieza: (pieza: PiezaCorte) => void;\n  onEditarPieza: (index: number, pieza: PiezaCorte) => void;\n  onEliminarPieza: (index: number) => void;\n  onSeleccionarLamina: (lamina: ArticuloInventario | null) => void;\n  onLimpiar: () => void;\n}\n\nconst EditorPiezas: React.FC<EditorPiezasProps> = ({\n  modo,\n  piezas,\n  laminaBase,\n  onCargarBOM,\n  onAgregarPieza,\n  onEditarPieza,\n  onEliminarPieza,\n  onSeleccionarLamina,\n  onLimpiar\n}) => {\n  const [showImportModal, setShowImportModal] = React.useState(false);\n  const { currentStore } = useAuth();\n\n  const handleDuplicarPieza = (index: number) => {\n    const piezaOriginal = piezas[index];\n    const piezaDuplicada: PiezaCorte = {\n      ...piezaOriginal,\n      id: `${piezaOriginal.id}-dup-${Date.now()}`,\n      descripcion: `${piezaOriginal.descripcion} (Copia)`,\n      tapacantos: [...piezaOriginal.tapacantos] // Copiar el array de tapacantos\n    };\n    onAgregarPieza(piezaDuplicada);\n  };\n\n  const handleAgregarNuevaPieza = () => {\n    const colores = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899'];\n    const colorAleatorio = colores[Math.floor(Math.random() * colores.length)];\n    \n    const nuevaPieza: PiezaCorte = {\n      id: `pieza-${Date.now()}`,\n      descripcion: '',\n      largo: 0,\n      ancho: 0,\n      cantidad: 1,\n      veta: 'S',\n      tapacantos: [], // ‚úÖ Inicializar como array vac√≠o\n      color: colorAleatorio\n    };\n    onAgregarPieza(nuevaPieza);\n  };\n\n  const handleImportarPiezas = (piezasImportadas: PiezaCorte[]) => {\n    // Asegurar que todas las piezas importadas tengan tapacantos inicializado\n    const piezasConTapacantos = piezasImportadas.map(pieza => ({\n      ...pieza,\n      tapacantos: Array.isArray(pieza.tapacantos) ? pieza.tapacantos : []\n    }));\n    \n    piezasConTapacantos.forEach(pieza => onAgregarPieza(pieza));\n    setShowImportModal(false);\n  };\n\n  const handleAgregarPiezaManual = () => {\n    if (!nuevaPieza.descripcion.trim()) {\n      showNotification('error', 'Debes ingresar una descripci√≥n');\n      return;\n    }\n\n    if (!nuevaPieza.largo || !nuevaPieza.ancho) {\n      showNotification('error', 'Debes ingresar las dimensiones');\n      return;\n    }\n\n    // üÜï Generar color √∫nico basado en el √≠ndice de la pieza\n    const colores = [\n      '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6',\n      '#EC4899', '#14B8A6', '#F97316', '#6366F1', '#84CC16',\n      '#06B6D4', '#F43F5E', '#8B5A3C', '#6B7280', '#A855F7',\n      '#22C55E', '#EAB308', '#DC2626', '#0EA5E9', '#D946EF'\n    ];\n    \n    const colorIndex = piezas.length % colores.length;\n    const color = colores[colorIndex];\n\n    const pieza: PiezaCorte = {\n      id: `pieza-${Date.now()}`,\n      descripcion: nuevaPieza.descripcion,\n      largo: nuevaPieza.largo,\n      ancho: nuevaPieza.ancho,\n      cantidad: nuevaPieza.cantidad,\n      veta: nuevaPieza.veta,\n      tapacantos: [],\n      cnc1: '',\n      cnc2: '',\n      color\n    };\n\n    onAgregarPieza(pieza);\n    setNuevaPieza({\n      descripcion: '',\n      largo: 0,\n      ancho: 0,\n      cantidad: 1,\n      veta: 'S'\n    });\n    setMostrarFormulario(false);\n    showNotification('success', 'Pieza agregada correctamente');\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Selector de Producto BOM (solo en modo BOM) */}\n      {modo === 'bom' && (\n        <div className=\"bg-white rounded-lg shadow-sm border p-4\">\n          <SelectorProductoBOM onSeleccionar={onCargarBOM} />\n        </div>\n      )}\n\n      {/* Header con botones */}\n      <div className=\"bg-white rounded-lg shadow-sm border p-4\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n            <i className=\"ri-table-line text-blue-600\"></i>\n            Lista de Piezas\n          </h3>\n          <div className=\"flex gap-2\">\n            <button\n              onClick={handleAgregarNuevaPieza}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 whitespace-nowrap\"\n            >\n              <i className=\"ri-add-line\"></i>\n              Nueva Pieza\n            </button>\n            <button\n              onClick={() => setShowImportModal(true)}\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 whitespace-nowrap\"\n            >\n              <i className=\"ri-file-excel-2-line\"></i>\n              Importar Excel\n            </button>\n            {piezas.length > 0 && (\n              <button\n                onClick={onLimpiar}\n                className=\"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 whitespace-nowrap\"\n              >\n                <i className=\"ri-delete-bin-line\"></i>\n                Limpiar Todo\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Tabla de piezas estilo Excel */}\n        <TablaPiezas\n          piezas={piezas}\n          onEditar={onEditarPieza}\n          onEliminar={onEliminarPieza}\n          onDuplicar={handleDuplicarPieza}\n          tiendaActual={currentStore}\n        />\n      </div>\n\n      {/* Modal de importaci√≥n */}\n      {showImportModal && (\n        <ImportarExcelModal\n          onImportar={handleImportarPiezas}\n          onCerrar={() => setShowImportModal(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default EditorPiezas;\n","import { useState, useRef, useEffect } from 'react';\nimport { ResultadoOptimizacion, ConfiguracionCorte, LaminaCorte } from '../../../types/optimizador';\n\ninterface Props {\n  resultado: ResultadoOptimizacion;\n  configuracion: ConfiguracionCorte;\n}\n\nexport default function VisualizadorCortes({ resultado }: Props) {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [laminaSeleccionada, setLaminaSeleccionada] = useState(0);\n\n  // üÜï Log detallado del resultado recibido\n  useEffect(() => {\n    console.log('üé® [VISUALIZADOR] Resultado completo recibido:', {\n      tiene_resultado: !!resultado,\n      estructura: resultado ? {\n        total_laminas: resultado.total_laminas,\n        laminas_array_length: resultado.laminas?.length,\n        resultados_por_material_length: resultado.resultados_por_material?.length,\n        primera_lamina: resultado.laminas?.[0] ? {\n          id: resultado.laminas[0].id,\n          piezas_length: resultado.laminas[0].piezas?.length,\n          piezas_sample: resultado.laminas[0].piezas?.slice(0, 2)\n        } : null,\n        primer_resultado_material: resultado.resultados_por_material?.[0] ? {\n          material_codigo: resultado.resultados_por_material[0].material_codigo,\n          laminas_length: resultado.resultados_por_material[0].laminas?.length,\n          primera_lamina_piezas: resultado.resultados_por_material[0].laminas?.[0]?.piezas?.length\n        } : null\n      } : null\n    });\n  }, [resultado]);\n\n  useEffect(() => {\n    if (!resultado || !canvasRef.current) {\n      console.log('‚ö†Ô∏è [VISUALIZADOR] No hay resultado o canvas');\n      return;\n    }\n\n    console.log('üé® [VISUALIZADOR] useEffect disparado', {\n      tiene_resultado: !!resultado,\n      total_laminas: resultado.total_laminas,\n      lamina_seleccionada: laminaSeleccionada\n    });\n\n    // üÜï Obtener la l√°mina correcta desde resultados_por_material\n    let laminaActual: LaminaCorte | null = null;\n    \n    // Primero intentar desde resultados_por_material (estructura correcta)\n    if (resultado.resultados_por_material && resultado.resultados_por_material.length > 0) {\n      let contadorLaminas = 0;\n      for (const resultadoMaterial of resultado.resultados_por_material) {\n        if (resultadoMaterial.laminas) {\n          for (const lamina of resultadoMaterial.laminas) {\n            if (contadorLaminas === laminaSeleccionada) {\n              laminaActual = lamina;\n              break;\n            }\n            contadorLaminas++;\n          }\n        }\n        if (laminaActual) break;\n      }\n    }\n    \n    // Si no se encontr√≥, intentar desde el array plano de l√°minas\n    if (!laminaActual && resultado.laminas && resultado.laminas[laminaSeleccionada]) {\n      laminaActual = resultado.laminas[laminaSeleccionada];\n    }\n\n    if (!laminaActual) {\n      console.error('‚ùå [VISUALIZADOR] No se encontr√≥ la l√°mina seleccionada');\n      return;\n    }\n\n    console.log('üé® [VISUALIZADOR] Dibujando l√°mina', laminaSeleccionada, {\n      lamina: {\n        id: laminaActual.id,\n        dimensiones: `${laminaActual.largo} √ó ${laminaActual.ancho} mm`,\n        total_piezas: laminaActual.piezas?.length || 0,\n        piezas: laminaActual.piezas?.map(p => ({\n          id: p.id,\n          desc: p.descripcion,\n          pos: `(${p.posicion_x}, ${p.posicion_y})`,\n          dim: `${p.largo}√ó${p.ancho}`,\n          rotada: p.rotada\n        }))\n      }\n    });\n\n    dibujarLamina(canvasRef.current, laminaActual);\n  }, [resultado, laminaSeleccionada]);\n\n  const dibujarLamina = (canvas: HTMLCanvasElement, lamina: LaminaCorte) => {\n    console.log('üñåÔ∏è [VISUALIZADOR] Iniciando dibujo de l√°mina', {\n      id: lamina.id,\n      dimensiones: `${lamina.largo} √ó ${lamina.ancho} mm`,\n      total_piezas: lamina.piezas?.length || 0,\n      piezas: lamina.piezas\n    });\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) {\n      console.error('‚ùå [VISUALIZADOR] No se pudo obtener contexto 2D');\n      return;\n    }\n\n    // Limpiar canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Dimensiones del canvas\n    const canvasWidth = canvas.width;\n    const canvasHeight = canvas.height;\n    const padding = 40;\n\n    console.log('üìê [VISUALIZADOR] Dimensiones canvas:', {\n      canvas: `${canvasWidth} √ó ${canvasHeight}`,\n      area_dibujo: `${canvasWidth - padding * 2} √ó ${canvasHeight - padding * 2}`,\n      padding\n    });\n\n    // Calcular escala para que la l√°mina quepa en el canvas\n    const escalaX = (canvasWidth - padding * 2) / lamina.largo;\n    const escalaY = (canvasHeight - padding * 2) / lamina.ancho;\n    const escala = Math.min(escalaX, escalaY);\n\n    const laminaWidth = lamina.largo * escala;\n    const laminaHeight = lamina.ancho * escala;\n    const offsetX = (canvasWidth - laminaWidth) / 2;\n    const offsetY = (canvasHeight - laminaHeight) / 2;\n\n    console.log('üìè [VISUALIZADOR] Escala y posici√≥n:', {\n      escala: escala.toFixed(4),\n      lamina_dibujada: `${laminaWidth.toFixed(1)} √ó ${laminaHeight.toFixed(1)}`,\n      offset: `(${offsetX.toFixed(1)}, ${offsetY.toFixed(1)})`\n    });\n\n    // Dibujar fondo de la l√°mina\n    ctx.fillStyle = '#F9FAFB';\n    ctx.fillRect(offsetX, offsetY, laminaWidth, laminaHeight);\n\n    // Dibujar borde de la l√°mina\n    ctx.strokeStyle = '#1F2937';\n    ctx.lineWidth = 2;\n    ctx.strokeRect(offsetX, offsetY, laminaWidth, laminaHeight);\n\n    console.log('‚úÖ [VISUALIZADOR] L√°mina base dibujada');\n\n    // üÜï Verificar que hay piezas\n    if (!lamina.piezas || lamina.piezas.length === 0) {\n      console.warn('‚ö†Ô∏è [VISUALIZADOR] La l√°mina no tiene piezas para dibujar');\n      \n      // Mostrar mensaje en el canvas\n      ctx.fillStyle = '#6B7280';\n      ctx.font = '16px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText('No hay piezas en esta l√°mina', canvasWidth / 2, canvasHeight / 2);\n      \n      return;\n    }\n\n    // üÜï Calcular √°reas ocupadas para identificar sobrantes\n    const areasOcupadas: Array<{x: number, y: number, w: number, h: number}> = [];\n\n    // Dibujar cada pieza\n    let piezasDibujadas = 0;\n    lamina.piezas.forEach((pieza, index) => {\n      console.log(`üî∑ [VISUALIZADOR] Dibujando pieza ${index + 1}:`, {\n        id: pieza.id,\n        descripcion: pieza.descripcion,\n        posicion_mm: `(${pieza.posicion_x}, ${pieza.posicion_y})`,\n        dimensiones_mm: `${pieza.largo} √ó ${pieza.ancho}`,\n        veta: pieza.veta,\n        rotada: pieza.rotada,\n        color: pieza.color\n      });\n\n      // üÜï Validar que la pieza tiene posici√≥n\n      if (pieza.posicion_x === undefined || pieza.posicion_y === undefined) {\n        console.error(`‚ùå [VISUALIZADOR] Pieza ${index + 1} sin posici√≥n asignada`);\n        return;\n      }\n\n      // ‚úÖ USAR DIMENSIONES DE CORTE AJUSTADAS (con compensaci√≥n de tapacanto)\n      const piezaLargo = pieza.rotada ? pieza.ancho : pieza.largo;\n      const piezaAncho = pieza.rotada ? pieza.largo : pieza.ancho;\n\n      const x = offsetX + (pieza.posicion_x * escala);\n      const y = offsetY + (pieza.posicion_y * escala);\n      const w = piezaLargo * escala;\n      const h = piezaAncho * escala;\n\n      // üÜï Guardar √°rea ocupada\n      areasOcupadas.push({\n        x: pieza.posicion_x,\n        y: pieza.posicion_y,\n        w: piezaLargo,\n        h: piezaAncho\n      });\n\n      console.log(`  üìç [VISUALIZADOR] Posici√≥n en canvas:`, {\n        posicion_canvas: `(${x.toFixed(1)}, ${y.toFixed(1)})`,\n        tama√±o_canvas: `${w.toFixed(1)} √ó ${h.toFixed(1)}`\n      });\n\n      // Dibujar rect√°ngulo de la pieza\n      ctx.fillStyle = pieza.color || '#3B82F6';\n      ctx.fillRect(x, y, w, h);\n\n      // Dibujar borde de la pieza\n      ctx.strokeStyle = '#1F2937';\n      ctx.lineWidth = 1;\n      ctx.strokeRect(x, y, w, h);\n\n      // üÜï Dibujar l√≠neas de veta MEJORADAS (m√°s visibles)\n      ctx.strokeStyle = 'rgba(0, 0, 0, 0.25)';\n      ctx.lineWidth = 1;\n\n      if (pieza.veta === 'S') {\n        // ‚úÖ Veta S = Hacia el lado m√°s largo (horizontal si largo > ancho)\n        const numLineas = Math.floor(h / 12);\n        for (let i = 1; i < numLineas; i++) {\n          const lineaY = y + (i * h / numLineas);\n          ctx.beginPath();\n          ctx.moveTo(x, lineaY);\n          ctx.lineTo(x + w, lineaY);\n          ctx.stroke();\n        }\n      } else if (pieza.veta === 'X') {\n        // ‚úÖ Veta X = Cruzada, hacia el lado m√°s corto (vertical si largo > ancho)\n        const numLineas = Math.floor(w / 12);\n        for (let i = 1; i < numLineas; i++) {\n          const lineaX = x + (i * w / numLineas);\n          ctx.beginPath();\n          ctx.moveTo(lineaX, y);\n          ctx.lineTo(lineaX, y + h);\n          ctx.stroke();\n        }\n      }\n\n      // üÜï Dibujar flecha de direcci√≥n de veta MEJORADA (m√°s grande y visible)\n      if (w > 40 && h > 40) {\n        // Fondo blanco para la flecha\n        const flechaSize = Math.min(w, h) * 0.15;\n        const flechaX = x + w - flechaSize - 8;\n        const flechaY = y + 8;\n        \n        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n        ctx.fillRect(flechaX - 4, flechaY - 4, flechaSize + 8, flechaSize + 8);\n        \n        // Dibujar flecha seg√∫n veta\n        ctx.strokeStyle = '#1F2937';\n        ctx.fillStyle = '#1F2937';\n        ctx.lineWidth = 2;\n        \n        if (pieza.veta === 'S') {\n          // Flecha horizontal ‚Üí (veta hacia el lado m√°s largo)\n          const arrowY = flechaY + flechaSize / 2;\n          \n          // L√≠nea\n          ctx.beginPath();\n          ctx.moveTo(flechaX, arrowY);\n          ctx.lineTo(flechaX + flechaSize, arrowY);\n          ctx.stroke();\n          \n          // Punta\n          ctx.beginPath();\n          ctx.moveTo(flechaX + flechaSize, arrowY);\n          ctx.lineTo(flechaX + flechaSize - 6, arrowY - 4);\n          ctx.lineTo(flechaX + flechaSize - 6, arrowY + 4);\n          ctx.closePath();\n          ctx.fill();\n          \n        } else if (pieza.veta === 'X') {\n          // Flecha vertical ‚Üì (veta cruzada, hacia el lado m√°s corto)\n          const arrowX = flechaX + flechaSize / 2;\n          \n          // L√≠nea\n          ctx.beginPath();\n          ctx.moveTo(arrowX, flechaY);\n          ctx.lineTo(arrowX, flechaY + flechaSize);\n          ctx.stroke();\n          \n          // Punta\n          ctx.beginPath();\n          ctx.moveTo(arrowX, flechaY + flechaSize);\n          ctx.lineTo(arrowX - 4, flechaY + flechaSize - 6);\n          ctx.lineTo(arrowX + 4, flechaY + flechaSize - 6);\n          ctx.closePath();\n          ctx.fill();\n          \n        } else if (pieza.veta === 'N') {\n          // Sin veta - mostrar \"N\"\n          ctx.font = 'bold 14px sans-serif';\n          ctx.textAlign = 'center';\n          ctx.textBaseline = 'middle';\n          ctx.fillText('N', flechaX + flechaSize / 2, flechaY + flechaSize / 2);\n        }\n      }\n\n      // Dibujar n√∫mero de pieza\n      ctx.fillStyle = 'white';\n      ctx.font = 'bold 14px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(`${index + 1}`, x + w / 2, y + h / 2);\n\n      // ‚úÖ Dibujar dimensiones DE CORTE AJUSTADAS\n      ctx.fillStyle = '#1F2937';\n      ctx.font = '10px sans-serif';\n      ctx.fillText(`${piezaLargo}√ó${piezaAncho}`, x + w / 2, y + h / 2 + 15);\n\n      piezasDibujadas++;\n    });\n\n    console.log(`‚úÖ [VISUALIZADOR] ${piezasDibujadas} piezas dibujadas`);\n\n    // üÜï Calcular y dibujar sobrantes inteligentes DESDE LOS BORDES DE LA L√ÅMINA\n    console.log('üì¶ [SOBRANTES] Calculando sobrantes desde bordes de l√°mina...');\n    \n    const sobrantes: Array<{x: number, y: number, w: number, h: number}> = [];\n    \n    if (areasOcupadas.length > 0) {\n      // üÜï SOBRANTE DERECHO: Desde la pieza m√°s a la derecha hasta el borde derecho\n      const piezaMasDerecha = areasOcupadas.reduce((max, area) => \n        (area.x + area.w) > (max.x + max.w) ? area : max\n      );\n      \n      const derechaX = piezaMasDerecha.x + piezaMasDerecha.w;\n      const derechaW = lamina.largo - derechaX;\n      \n      if (derechaW > 50) {\n        sobrantes.push({\n          x: derechaX,\n          y: 0,\n          w: derechaW,\n          h: lamina.ancho  // ‚úÖ TODO EL ALTO DE LA L√ÅMINA\n        });\n        \n        console.log('  ‚û°Ô∏è [SOBRANTE DERECHO]:', {\n          posicion: `(${derechaX}, 0)`,\n          dimensiones: `${Math.round(derechaW)} √ó ${lamina.ancho} mm`,\n          area_m2: ((derechaW * lamina.ancho) / 1000000).toFixed(2)\n        });\n      }\n      \n      // üÜï SOBRANTE SUPERIOR: Desde la pieza m√°s alta hasta el borde superior\n      const piezaMasAlta = areasOcupadas.reduce((max, area) => \n        (area.y + area.h) > (max.y + max.h) ? area : max\n      );\n      \n      const superiorY = piezaMasAlta.y + piezaMasAlta.h;\n      const superiorH = lamina.ancho - superiorY;\n      \n      if (superiorH > 50) {\n        sobrantes.push({\n          x: 0,\n          y: superiorY,\n          w: lamina.largo,  // ‚úÖ TODO EL ANCHO DE LA L√ÅMINA\n          h: superiorH\n        });\n        \n        console.log('  ‚¨ÜÔ∏è [SOBRANTE SUPERIOR]:', {\n          posicion: `(0, ${superiorY})`,\n          dimensiones: `${lamina.largo} √ó ${Math.round(superiorH)} mm`,\n          area_m2: ((lamina.largo * superiorH) / 1000000).toFixed(2)\n        });\n      }\n    }\n\n    console.log(`üì¶ [SOBRANTES FINALES] L√°mina completa:`, {\n      sobrantes: sobrantes.length,\n      detalles: sobrantes.map(s => ({\n        posicion: `(${Math.round(s.x)}, ${Math.round(s.y)})`,\n        dimensiones: `${Math.round(s.w)}√ó${Math.round(s.h)} mm`,\n        area: ((s.w * s.h) / 1000000).toFixed(2) + ' m¬≤'\n      }))\n    });\n\n    // Dibujar sobrantes con medidas\n    ctx.fillStyle = '#059669';\n    ctx.font = 'bold 12px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    sobrantes.forEach((sobrante, index) => {\n      const sx = offsetX + (sobrante.x * escala);\n      const sy = offsetY + (sobrante.y * escala);\n      const sw = sobrante.w * escala;\n      const sh = sobrante.h * escala;\n\n      console.log(`  üé® [DIBUJANDO SOBRANTE ${index + 1}]:`, {\n        canvas_pos: `(${sx.toFixed(1)}, ${sy.toFixed(1)})`,\n        canvas_size: `${sw.toFixed(1)} √ó ${sh.toFixed(1)} px`,\n        real_size: `${Math.round(sobrante.w)} √ó ${Math.round(sobrante.h)} mm`\n      });\n\n      // Solo dibujar si el √°rea es visible (> 20px en canvas)\n      if (sw > 20 && sh > 20) {\n        // Dibujar fondo semi-transparente para las medidas\n        ctx.fillStyle = 'rgba(5, 150, 105, 0.15)';\n        ctx.fillRect(sx, sy, sw, sh);\n\n        // Dibujar borde punteado del sobrante\n        ctx.strokeStyle = '#059669';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.strokeRect(sx, sy, sw, sh);\n        ctx.setLineDash([]);\n\n        // Dibujar medidas\n        ctx.fillStyle = '#047857';\n        ctx.font = 'bold 13px sans-serif';\n        \n        // Medida horizontal (si hay espacio)\n        if (sw > 80) {\n          ctx.fillText(\n            `${Math.round(sobrante.w)} mm`,\n            sx + sw / 2,\n            sy + sh / 2 - 10\n          );\n        }\n        \n        // Medida vertical (si hay espacio)\n        if (sh > 80) {\n          ctx.fillText(\n            `${Math.round(sobrante.h)} mm`,\n            sx + sw / 2,\n            sy + sh / 2 + 10\n          );\n        }\n\n        // Etiqueta \"SOBRANTE\" (si hay espacio)\n        if (sw > 100 && sh > 60) {\n          ctx.font = 'bold 11px sans-serif';\n          ctx.fillStyle = '#065f46';\n          ctx.fillText('SOBRANTE', sx + sw / 2, sy + 20);\n        }\n      }\n    });\n\n    console.log(`‚úÖ [VISUALIZADOR] ${sobrantes.length} sobrantes dibujados`);\n\n    // Dibujar l√≠neas de corte\n    ctx.strokeStyle = '#EF4444';\n    ctx.lineWidth = 1;\n    ctx.setLineDash([5, 5]);\n\n    lamina.piezas.forEach(pieza => {\n      if (pieza.posicion_x === undefined || pieza.posicion_y === undefined) return;\n\n      const piezaLargo = pieza.rotada ? pieza.ancho : pieza.largo;\n      const piezaAncho = pieza.rotada ? pieza.largo : pieza.ancho;\n\n      const x = offsetX + (pieza.posicion_x * escala);\n      const y = offsetY + (pieza.posicion_y * escala);\n      const w = piezaLargo * escala;\n      const h = piezaAncho * escala;\n\n      // L√≠nea vertical derecha\n      ctx.beginPath();\n      ctx.moveTo(x + w, offsetY);\n      ctx.lineTo(x + w, offsetY + laminaHeight);\n      ctx.stroke();\n\n      // L√≠nea horizontal inferior\n      ctx.beginPath();\n      ctx.moveTo(offsetX, y + h);\n      ctx.lineTo(offsetX + laminaWidth, y + h);\n      ctx.stroke();\n    });\n\n    ctx.setLineDash([]);\n    console.log('‚úÖ [VISUALIZADOR] L√≠neas de corte dibujadas');\n    console.log('üéâ [VISUALIZADOR] Dibujo completado exitosamente');\n  };\n\n  if (!resultado) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-sm border p-8 text-center\">\n        <i className=\"ri-scissors-cut-line text-6xl text-gray-300 mb-4\"></i>\n        <p className=\"text-gray-500\">\n          Agrega piezas y haz clic en \"Optimizar Cortes\" para ver el resultado\n        </p>\n      </div>\n    );\n  }\n\n  // üÜï Obtener el total real de l√°minas\n  const totalLaminasReal = resultado.resultados_por_material?.reduce(\n    (sum, r) => sum + (r.laminas?.length || 0), \n    0\n  ) || resultado.total_laminas || 0;\n\n  // üÜï Obtener la l√°mina actual para mostrar la lista de piezas\n  const obtenerLaminaActual = (): LaminaCorte | null => {\n    if (resultado.resultados_por_material && resultado.resultados_por_material.length > 0) {\n      let contadorLaminas = 0;\n      for (const resultadoMaterial of resultado.resultados_por_material) {\n        if (resultadoMaterial.laminas) {\n          for (const lamina of resultadoMaterial.laminas) {\n            if (contadorLaminas === laminaSeleccionada) {\n              return lamina;\n            }\n            contadorLaminas++;\n          }\n        }\n      }\n    }\n    \n    if (resultado.laminas && resultado.laminas[laminaSeleccionada]) {\n      return resultado.laminas[laminaSeleccionada];\n    }\n    \n    return null;\n  };\n\n  const laminaActualParaLista = obtenerLaminaActual();\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-bold text-gray-900 flex items-center gap-2\">\n          <i className=\"ri-layout-grid-line text-blue-600\"></i>\n          Plano de Corte 2D\n        </h3>\n\n        {/* Selector de l√°mina */}\n        {totalLaminasReal > 1 && (\n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-sm text-gray-600\">\n              L√°mina {laminaSeleccionada + 1} de {totalLaminasReal}\n            </span>\n            <button\n              onClick={() => setLaminaSeleccionada(Math.max(0, laminaSeleccionada - 1))}\n              disabled={laminaSeleccionada === 0}\n              className=\"p-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <i className=\"ri-arrow-left-line\"></i>\n            </button>\n            <button\n              onClick={() => setLaminaSeleccionada(Math.min(totalLaminasReal - 1, laminaSeleccionada + 1))}\n              disabled={laminaSeleccionada >= totalLaminasReal - 1}\n              className=\"p-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              <i className=\"ri-arrow-right-line\"></i>\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Canvas */}\n      <div className=\"bg-gray-50 rounded-lg border-2 border-gray-200 p-4\">\n        <canvas\n          ref={canvasRef}\n          width={1200}\n          height={800}\n          className=\"w-full h-auto\"\n        />\n      </div>\n\n      {/* Leyenda */}\n      <div className=\"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-4 h-4 border-2 border-gray-900 bg-white\"></div>\n          <span className=\"text-sm text-gray-700\">L√°mina base</span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-4 h-4 bg-blue-500\"></div>\n          <span className=\"text-sm text-gray-700\">Piezas cortadas</span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-0.5 border-t-2 border-dashed border-red-500\"></div>\n          <span className=\"text-sm text-gray-700\">L√≠neas de corte</span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <i className=\"ri-arrow-right-line text-gray-700\"></i>\n          <span className=\"text-sm text-gray-700\">Direcci√≥n veta</span>\n        </div>\n      </div>\n\n      {/* Lista de piezas en esta l√°mina */}\n      {laminaActualParaLista && laminaActualParaLista.piezas && laminaActualParaLista.piezas.length > 0 && (\n        <div className=\"mt-6\">\n          <h4 className=\"text-sm font-semibold text-gray-900 mb-3\">\n            Piezas en esta l√°mina:\n          </h4>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n            {laminaActualParaLista.piezas.map((pieza, index) => (\n              <div\n                key={pieza.id}\n                className=\"flex items-center gap-3 p-2 bg-gray-50 rounded-lg border border-gray-200\"\n              >\n                <div\n                  className=\"w-8 h-8 rounded flex items-center justify-center text-white font-semibold text-sm flex-shrink-0\"\n                  style={{ backgroundColor: pieza.color }}\n                >\n                  {index + 1}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"text-sm font-medium text-gray-900 truncate\">\n                    {pieza.descripcion}\n                  </div>\n                  <div className=\"text-xs text-gray-600\">\n                    {pieza.largo} √ó {pieza.ancho} mm\n                    {pieza.rotada && <span className=\"ml-2 text-orange-600\">(Rotada)</span>}\n                  </div>\n                </div>\n                <span className={`text-xs px-2 py-1 rounded-full font-semibold ${\n                  pieza.veta === 'S' ? 'bg-green-100 text-green-800' :\n                  pieza.veta === 'X' ? 'bg-orange-100 text-orange-800' :\n                  'bg-gray-100 text-gray-800'\n                }`}>\n                  {pieza.veta}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { ResultadoOptimizacion } from '../../../types/optimizador';\nimport { formatCurrency } from '../../../lib/currency';\n\ninterface Props {\n  resultado: ResultadoOptimizacion;\n  onExportar: () => void;\n}\n\nexport default function PanelResultados({ resultado, onExportar }: Props) {\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n          <i className=\"ri-bar-chart-box-line text-blue-600\"></i>\n          Resultados de Optimizaci√≥n\n        </h3>\n        <button\n          onClick={onExportar}\n          className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2\"\n        >\n          <i className=\"ri-file-excel-2-line\"></i>\n          Exportar Excel\n        </button>\n      </div>\n\n      {/* üÜï Resultados por Material */}\n      {resultado.resultados_por_material && resultado.resultados_por_material.length > 0 && (\n        <div className=\"mb-6\">\n          <h4 className=\"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n            <i className=\"ri-stack-line text-blue-600\"></i>\n            Resultados por Material\n          </h4>\n          <div className=\"space-y-4\">\n            {resultado.resultados_por_material.map((materialResult, index) => (\n              <div key={index} className=\"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200\">\n                <div className=\"flex items-start justify-between mb-3\">\n                  <div className=\"flex-1\">\n                    <h5 className=\"font-bold text-gray-900 text-base mb-1\">\n                      {materialResult.material_codigo}\n                    </h5>\n                    <p className=\"text-sm text-gray-700 mb-2\">\n                      {materialResult.material_descripcion}\n                    </p>\n                    <div className=\"flex flex-wrap gap-3 text-xs text-gray-600\">\n                      <span className=\"flex items-center gap-1\">\n                        <i className=\"ri-ruler-line text-blue-600\"></i>\n                        {materialResult.largo_lamina_mm} √ó {materialResult.ancho_lamina_mm} mm\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <i className=\"ri-stack-line text-blue-600\"></i>\n                        Espesor: {materialResult.espesor_mm} mm\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <i className=\"ri-price-tag-3-line text-green-600\"></i>\n                        {formatCurrency(materialResult.precio_unitario_lamina)} / l√°mina\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3\">\n                  <div className=\"bg-white rounded-lg p-3 border border-blue-200\">\n                    <div className=\"text-xs text-gray-600 mb-1\">L√°minas Usadas</div>\n                    <div className=\"text-xl font-bold text-blue-900\">\n                      {materialResult.total_laminas}\n                    </div>\n                  </div>\n                  <div className=\"bg-white rounded-lg p-3 border border-green-200\">\n                    <div className=\"text-xs text-gray-600 mb-1\">Aprovechamiento</div>\n                    <div className=\"text-xl font-bold text-green-900\">\n                      {materialResult.porcentaje_aprovechamiento_promedio.toFixed(1)}%\n                    </div>\n                  </div>\n                  <div className=\"bg-white rounded-lg p-3 border border-purple-200\">\n                    <div className=\"text-xs text-gray-600 mb-1\">Piezas</div>\n                    <div className=\"text-xl font-bold text-purple-900\">\n                      {materialResult.piezas_asignadas}\n                    </div>\n                  </div>\n                  <div className=\"bg-white rounded-lg p-3 border border-orange-200\">\n                    <div className=\"text-xs text-gray-600 mb-1\">Costo Total</div>\n                    <div className=\"text-lg font-bold text-orange-900\">\n                      {formatCurrency(materialResult.costo_total_laminas)}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Detalle de l√°minas de este material */}\n                <div className=\"bg-white rounded-lg p-3 border border-gray-200\">\n                  <div className=\"text-xs font-semibold text-gray-700 mb-2\">\n                    Detalle de L√°minas:\n                  </div>\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n                    {materialResult.laminas.map((lamina) => (\n                      <div\n                        key={lamina.id}\n                        className=\"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200 text-xs\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"w-6 h-6 bg-blue-100 rounded flex items-center justify-center\">\n                            <span className=\"text-blue-900 font-bold text-xs\">{lamina.id}</span>\n                          </div>\n                          <span className=\"text-gray-700\">{lamina.piezas.length} pzs</span>\n                        </div>\n                        <span className=\"font-semibold text-green-600\">\n                          {lamina.porcentaje_aprovechamiento.toFixed(1)}%\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* M√©tricas Globales */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n        <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <i className=\"ri-stack-line text-blue-600\"></i>\n            <span className=\"text-sm text-blue-900 font-medium\">Total L√°minas</span>\n          </div>\n          <div className=\"text-2xl font-bold text-blue-900\">\n            {resultado.total_laminas}\n          </div>\n        </div>\n\n        <div className=\"bg-green-50 rounded-lg p-4 border border-green-200\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <i className=\"ri-percent-line text-green-600\"></i>\n            <span className=\"text-sm text-green-900 font-medium\">Aprovechamiento</span>\n          </div>\n          <div className=\"text-2xl font-bold text-green-900\">\n            {resultado.porcentaje_aprovechamiento_global.toFixed(1)}%\n          </div>\n        </div>\n\n        <div className=\"bg-purple-50 rounded-lg p-4 border border-purple-200\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <i className=\"ri-checkbox-circle-line text-purple-600\"></i>\n            <span className=\"text-sm text-purple-900 font-medium\">√Årea Utilizada</span>\n          </div>\n          <div className=\"text-2xl font-bold text-purple-900\">\n            {resultado.area_total_utilizada.toFixed(2)} m¬≤\n          </div>\n        </div>\n\n        <div className=\"bg-orange-50 rounded-lg p-4 border border-orange-200\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <i className=\"ri-delete-bin-line text-orange-600\"></i>\n            <span className=\"text-sm text-orange-900 font-medium\">Sobrante</span>\n          </div>\n          <div className=\"text-2xl font-bold text-orange-900\">\n            {resultado.area_total_sobrante.toFixed(2)} m¬≤\n          </div>\n        </div>\n      </div>\n\n      {/* Costos */}\n      <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n        <h4 className=\"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n          <i className=\"ri-money-dollar-circle-line text-green-600\"></i>\n          Desglose de Costos\n        </h4>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between py-2 border-b border-gray-200\">\n            <span className=\"text-sm text-gray-700\">Materiales (L√°minas)</span>\n            <span className=\"text-sm font-semibold text-gray-900\">\n              {formatCurrency(resultado.costo_total_materiales)}\n            </span>\n          </div>\n          <div className=\"flex items-center justify-between py-2 border-b border-gray-200\">\n            <span className=\"text-sm text-gray-700\">Tapacantos</span>\n            <span className=\"text-sm font-semibold text-gray-900\">\n              {formatCurrency(resultado.costo_total_tapacantos)}\n            </span>\n          </div>\n          <div className=\"flex items-center justify-between py-2 border-b border-gray-200\">\n            <span className=\"text-sm text-gray-700\">Horas M√°quina (HH)</span>\n            <span className=\"text-sm font-semibold text-gray-900\">\n              {formatCurrency(resultado.costo_total_hh)}\n            </span>\n          </div>\n          <div className=\"flex items-center justify-between py-3 bg-blue-50 -mx-4 px-4 rounded-lg mt-2\">\n            <span className=\"text-base font-bold text-blue-900\">TOTAL</span>\n            <span className=\"text-xl font-bold text-blue-900\">\n              {formatCurrency(resultado.costo_total)}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Detalle por L√°mina (todas) */}\n      <div className=\"mt-6\">\n        <h4 className=\"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n          <i className=\"ri-list-check text-blue-600\"></i>\n          Todas las L√°minas ({resultado.laminas.length})\n        </h4>\n        <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n          {resultado.laminas.map((lamina) => (\n            <div\n              key={lamina.id}\n              className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                  <span className=\"text-blue-900 font-bold\">{lamina.id}</span>\n                </div>\n                <div>\n                  <div className=\"text-sm font-medium text-gray-900\">\n                    L√°mina {lamina.id} - {lamina.material_codigo}\n                  </div>\n                  <div className=\"text-xs text-gray-600\">\n                    {lamina.piezas.length} piezas ‚Ä¢ {lamina.largo} √ó {lamina.ancho} mm ‚Ä¢ {lamina.espesor} mm\n                  </div>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-sm font-semibold text-green-600\">\n                  {lamina.porcentaje_aprovechamiento.toFixed(1)}%\n                </div>\n                <div className=\"text-xs text-gray-600\">\n                  {lamina.area_utilizada.toFixed(2)} m¬≤ / {lamina.area_total.toFixed(2)} m¬≤\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Piezas sin asignar (si hay) */}\n      {resultado.piezas_sin_asignar.length > 0 && (\n        <div className=\"mt-6 bg-red-50 border border-red-200 rounded-lg p-4\">\n          <div className=\"flex items-start gap-3\">\n            <i className=\"ri-error-warning-line text-red-600 text-xl mt-0.5\"></i>\n            <div className=\"flex-1\">\n              <h4 className=\"text-sm font-semibold text-red-900 mb-2\">\n                Piezas sin asignar ({resultado.piezas_sin_asignar.length})\n              </h4>\n              <p className=\"text-sm text-red-800 mb-3\">\n                Las siguientes piezas no pudieron ser asignadas a ninguna l√°mina. \n                Considera ajustar las dimensiones o usar l√°minas m√°s grandes.\n              </p>\n              <div className=\"space-y-1\">\n                {resultado.piezas_sin_asignar.map((pieza) => (\n                  <div key={pieza.id} className=\"text-sm text-red-900\">\n                    ‚Ä¢ {pieza.descripcion} ({pieza.largo} √ó {pieza.ancho} mm) - Material: {pieza.material_codigo}\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Recomendaciones */}\n      <div className=\"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4\">\n        <h4 className=\"text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2\">\n          <i className=\"ri-lightbulb-line\"></i>\n          Recomendaciones\n        </h4>\n        <ul className=\"text-sm text-blue-800 space-y-1\">\n          {resultado.porcentaje_aprovechamiento_global < 70 && (\n            <li>‚Ä¢ El aprovechamiento es bajo. Considera agrupar m√°s piezas o ajustar dimensiones.</li>\n          )}\n          {resultado.porcentaje_aprovechamiento_global >= 85 && (\n            <li>‚Ä¢ ¬°Excelente aprovechamiento! La optimizaci√≥n es muy eficiente.</li>\n          )}\n          {resultado.area_total_sobrante > 1 && (\n            <li>‚Ä¢ Hay {resultado.area_total_sobrante.toFixed(2)} m¬≤ de sobrante que puede reutilizarse.</li>\n          )}\n          {resultado.total_laminas > 5 && (\n            <li>‚Ä¢ Considera negociar descuento por volumen con tu proveedor ({resultado.total_laminas} l√°minas).</li>\n          )}\n          {resultado.resultados_por_material && resultado.resultados_por_material.length > 1 && (\n            <li>‚Ä¢ Se est√°n usando {resultado.resultados_por_material.length} tipos diferentes de l√°minas en este proyecto.</li>\n          )}\n        </ul>\n      </div>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { ResultadoOptimizacion, PiezaCorte, ArticuloInventario, ExportDataExcel } from '../../../types/optimizador';\nimport * as XLSX from 'xlsx';\n\ninterface Props {\n  resultado: ResultadoOptimizacion;\n  piezas: PiezaCorte[];\n  laminaBase: ArticuloInventario | null;\n  onCerrar: () => void;\n}\n\nexport default function ExportarExcelModal({ resultado, piezas, laminaBase, onCerrar }: Props) {\n  const [nombreArchivo, setNombreArchivo] = useState(`Optimizacion_${new Date().toISOString().split('T')[0]}`);\n  const [exportando, setExportando] = useState(false);\n\n  const exportarExcel = () => {\n    setExportando(true);\n\n    try {\n      // Crear workbook\n      const wb = XLSX.utils.book_new();\n\n      // ============================================\n      // HOJA 1: RESUMEN GENERAL\n      // ============================================\n      const resumenData = [\n        ['OPTIMIZADOR DE CORTES 2D - RESUMEN GENERAL'],\n        [''],\n        ['Fecha:', new Date().toLocaleDateString('es-CR')],\n        ['L√°mina Base:', laminaBase?.descripcion_articulo || 'N/A'],\n        ['Dimensiones L√°mina:', `${laminaBase?.largo_lamina} √ó ${laminaBase?.ancho_lamina} mm`],\n        ['Precio L√°mina:', `‚Ç°${laminaBase?.precio_unitario.toLocaleString('es-CR')}`],\n        [''],\n        ['RESULTADOS DE OPTIMIZACI√ìN'],\n        ['Total de L√°minas:', resultado.total_laminas],\n        ['Aprovechamiento Global:', `${resultado.porcentaje_aprovechamiento_global.toFixed(2)}%`],\n        ['√Årea Total Utilizada:', `${resultado.area_total_utilizada.toFixed(4)} m¬≤`],\n        ['√Årea Total Sobrante:', `${resultado.area_total_sobrante.toFixed(4)} m¬≤`],\n        [''],\n        ['COSTOS'],\n        ['Materiales (L√°minas):', `‚Ç°${resultado.costo_total_materiales.toLocaleString('es-CR')}`],\n        ['Tapacantos:', `‚Ç°${resultado.costo_total_tapacantos.toLocaleString('es-CR')}`],\n        ['Horas M√°quina (HH):', `‚Ç°${resultado.costo_total_hh.toLocaleString('es-CR')}`],\n        ['TOTAL:', `‚Ç°${resultado.costo_total.toLocaleString('es-CR')}`],\n      ];\n\n      const wsResumen = XLSX.utils.aoa_to_sheet(resumenData);\n      \n      // Estilos para el resumen\n      wsResumen['!cols'] = [{ wch: 25 }, { wch: 30 }];\n      \n      XLSX.utils.book_append_sheet(wb, wsResumen, 'Resumen');\n\n      // ============================================\n      // HOJA 2: DETALLE DE PIEZAS\n      // ============================================\n      const detallePiezasData: any[][] = [\n        [\n          'Descripci√≥n',\n          'Material (C√≥digo)',\n          'Largo (mm)',\n          'Ancho (mm)',\n          'Cantidad',\n          'Veta',\n          'Largo Inf',\n          'Largo Sup',\n          'Ancho Inf',\n          'Ancho Sup',\n          'CNC1',\n          'CNC2',\n          'm¬≤ Usados',\n          'Tapacantos (m)',\n          'HH (segundos)',\n          'Total Pieza'\n        ]\n      ];\n\n      piezas.forEach((pieza) => {\n        const areaUnitaria = (pieza.largo * pieza.ancho) / 1000000;\n        const areaTotal = areaUnitaria * pieza.cantidad;\n        \n        const largoInf = pieza.tapacantos.find(tc => tc.lado === 'largo_inf');\n        const largoSup = pieza.tapacantos.find(tc => tc.lado === 'largo_sup');\n        const anchoInf = pieza.tapacantos.find(tc => tc.lado === 'ancho_inf');\n        const anchoSup = pieza.tapacantos.find(tc => tc.lado === 'ancho_sup');\n\n        detallePiezasData.push([\n          pieza.descripcion,\n          pieza.material_codigo || '',\n          pieza.largo,\n          pieza.ancho,\n          pieza.cantidad,\n          pieza.veta,\n          largoInf?.codigo || '',\n          largoSup?.codigo || '',\n          anchoInf?.codigo || '',\n          anchoSup?.codigo || '',\n          pieza.cnc1 || '',\n          pieza.cnc2 || '',\n          areaTotal.toFixed(4),\n          pieza.metros_tapacanto_total?.toFixed(2) || '0',\n          pieza.hh_segundos || 0,\n          pieza.costo_total?.toFixed(2) || '0'\n        ]);\n      });\n\n      // Totales\n      const totalM2 = piezas.reduce((sum, p) => sum + ((p.largo * p.ancho * p.cantidad) / 1000000), 0);\n      const totalTapacantos = piezas.reduce((sum, p) => sum + (p.metros_tapacanto_total || 0), 0);\n      const totalHH = piezas.reduce((sum, p) => sum + (p.hh_segundos || 0), 0);\n      const totalCosto = piezas.reduce((sum, p) => sum + (p.costo_total || 0), 0);\n\n      detallePiezasData.push([\n        'TOTALES',\n        '',\n        '',\n        '',\n        piezas.reduce((sum, p) => sum + p.cantidad, 0),\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        totalM2.toFixed(4),\n        totalTapacantos.toFixed(2),\n        totalHH,\n        totalCosto.toFixed(2)\n      ]);\n\n      const wsDetalle = XLSX.utils.aoa_to_sheet(detallePiezasData);\n      \n      // Anchos de columna\n      wsDetalle['!cols'] = [\n        { wch: 30 }, // Descripci√≥n\n        { wch: 15 }, // Material\n        { wch: 12 }, // Largo\n        { wch: 12 }, // Ancho\n        { wch: 10 }, // Cantidad\n        { wch: 8 },  // Veta\n        { wch: 12 }, // Largo Inf\n        { wch: 12 }, // Largo Sup\n        { wch: 12 }, // Ancho Inf\n        { wch: 12 }, // Ancho Sup\n        { wch: 20 }, // CNC1\n        { wch: 20 }, // CNC2\n        { wch: 12 }, // m¬≤ Usados\n        { wch: 15 }, // Tapacantos\n        { wch: 12 }, // HH\n        { wch: 15 }  // Total\n      ];\n\n      XLSX.utils.book_append_sheet(wb, wsDetalle, 'Detalle Piezas');\n\n      // ============================================\n      // HOJA 3: DETALLE POR L√ÅMINA\n      // ============================================\n      const detalleLaminasData: any[][] = [\n        ['DETALLE POR L√ÅMINA'],\n        ['']\n      ];\n\n      resultado.laminas.forEach((lamina) => {\n        detalleLaminasData.push([`L√ÅMINA ${lamina.id}`]);\n        detalleLaminasData.push([\n          'Material:', lamina.material_descripcion,\n          'Dimensiones:', `${lamina.largo} √ó ${lamina.ancho} mm`,\n          'Espesor:', `${lamina.espesor} mm`\n        ]);\n        detalleLaminasData.push([\n          '√Årea Total:', `${lamina.area_total.toFixed(4)} m¬≤`,\n          '√Årea Utilizada:', `${lamina.area_utilizada.toFixed(4)} m¬≤`,\n          '√Årea Sobrante:', `${lamina.area_sobrante.toFixed(4)} m¬≤`,\n          'Aprovechamiento:', `${lamina.porcentaje_aprovechamiento.toFixed(2)}%`\n        ]);\n        detalleLaminasData.push(['']);\n        detalleLaminasData.push(['#', 'Descripci√≥n', 'Largo', 'Ancho', 'Veta', 'Rotada', 'Posici√≥n X', 'Posici√≥n Y']);\n        \n        lamina.piezas.forEach((pieza, index) => {\n          detalleLaminasData.push([\n            index + 1,\n            pieza.descripcion,\n            pieza.largo,\n            pieza.ancho,\n            pieza.veta,\n            pieza.rotada ? 'S√≠' : 'No',\n            pieza.posicion_x || 0,\n            pieza.posicion_y || 0\n          ]);\n        });\n        \n        detalleLaminasData.push(['']);\n        detalleLaminasData.push(['']);\n      });\n\n      const wsLaminas = XLSX.utils.aoa_to_sheet(detalleLaminasData);\n      wsLaminas['!cols'] = [\n        { wch: 8 },\n        { wch: 30 },\n        { wch: 12 },\n        { wch: 12 },\n        { wch: 8 },\n        { wch: 10 },\n        { wch: 12 },\n        { wch: 12 }\n      ];\n\n      XLSX.utils.book_append_sheet(wb, wsLaminas, 'Detalle L√°minas');\n\n      // ============================================\n      // HOJA 4: PIEZAS SIN ASIGNAR (si hay)\n      // ============================================\n      if (resultado.piezas_sin_asignar.length > 0) {\n        const sinAsignarData: any[][] = [\n          ['PIEZAS SIN ASIGNAR'],\n          [''],\n          ['Las siguientes piezas no pudieron ser asignadas a ninguna l√°mina:'],\n          [''],\n          ['Descripci√≥n', 'Largo (mm)', 'Ancho (mm)', 'Cantidad', 'Veta']\n        ];\n\n        resultado.piezas_sin_asignar.forEach((pieza) => {\n          sinAsignarData.push([\n            pieza.descripcion,\n            pieza.largo,\n            pieza.ancho,\n            pieza.cantidad,\n            pieza.veta\n          ]);\n        });\n\n        const wsSinAsignar = XLSX.utils.aoa_to_sheet(sinAsignarData);\n        wsSinAsignar['!cols'] = [{ wch: 30 }, { wch: 12 }, { wch: 12 }, { wch: 10 }, { wch: 8 }];\n        XLSX.utils.book_append_sheet(wb, wsSinAsignar, 'Sin Asignar');\n      }\n\n      // Generar archivo\n      XLSX.writeFile(wb, `${nombreArchivo}.xlsx`);\n\n      setTimeout(() => {\n        setExportando(false);\n        onCerrar();\n      }, 500);\n\n    } catch (error) {\n      console.error('Error exportando Excel:', error);\n      alert('Error al exportar el archivo Excel');\n      setExportando(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl max-w-2xl w-full\">\n        <div className=\"bg-gradient-to-r from-green-600 to-green-700 px-6 py-4 flex items-center justify-between rounded-t-lg\">\n          <h2 className=\"text-xl font-bold text-white flex items-center gap-2\">\n            <i className=\"ri-file-excel-2-line\"></i>\n            Exportar a Excel\n          </h2>\n          <button\n            onClick={onCerrar}\n            className=\"text-white hover:text-gray-200 p-1\"\n          >\n            <i className=\"ri-close-line text-2xl\"></i>\n          </button>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {/* Informaci√≥n */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <h3 className=\"text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2\">\n              <i className=\"ri-information-line\"></i>\n              Contenido del archivo\n            </h3>\n            <ul className=\"text-sm text-blue-800 space-y-1\">\n              <li>‚Ä¢ <strong>Resumen General:</strong> M√©tricas y costos totales</li>\n              <li>‚Ä¢ <strong>Detalle de Piezas:</strong> Todas las piezas con dimensiones, tapacantos y costos</li>\n              <li>‚Ä¢ <strong>Detalle por L√°mina:</strong> Distribuci√≥n de piezas en cada l√°mina</li>\n              {resultado.piezas_sin_asignar.length > 0 && (\n                <li>‚Ä¢ <strong>Piezas Sin Asignar:</strong> Piezas que no cupieron en las l√°minas</li>\n              )}\n            </ul>\n          </div>\n\n          {/* Nombre del archivo */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              Nombre del archivo\n            </label>\n            <div className=\"flex gap-2\">\n              <input\n                type=\"text\"\n                value={nombreArchivo}\n                onChange={(e) => setNombreArchivo(e.target.value)}\n                className=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                placeholder=\"Nombre del archivo...\"\n              />\n              <span className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg border border-gray-300\">\n                .xlsx\n              </span>\n            </div>\n          </div>\n\n          {/* Estad√≠sticas */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n              <div className=\"text-sm text-gray-600 mb-1\">Total de Piezas</div>\n              <div className=\"text-2xl font-bold text-gray-900\">{piezas.length}</div>\n            </div>\n            <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n              <div className=\"text-sm text-gray-600 mb-1\">Total de L√°minas</div>\n              <div className=\"text-2xl font-bold text-gray-900\">{resultado.total_laminas}</div>\n            </div>\n          </div>\n\n          {/* Botones */}\n          <div className=\"flex gap-3 pt-4 border-t border-gray-200\">\n            <button\n              type=\"button\"\n              onClick={onCerrar}\n              disabled={exportando}\n              className=\"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50\"\n            >\n              Cancelar\n            </button>\n            <button\n              type=\"button\"\n              onClick={exportarExcel}\n              disabled={exportando}\n              className=\"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n            >\n              {exportando ? (\n                <>\n                  <i className=\"ri-loader-4-line animate-spin\"></i>\n                  Exportando...\n                </>\n              ) : (\n                <>\n                  <i className=\"ri-download-line\"></i>\n                  Descargar Excel\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * Servicio para gestionar proyectos temporales del optimizador 2D\n */\n\nimport { supabase } from '../lib/supabase';\n\nexport interface PiezaOptimizador {\n  descripcion: string;\n  largo: number;\n  ancho: number;\n  cantidad: number;\n  veta: string;\n  tapacanto_superior: string;\n  tapacanto_inferior: string;\n  tapacanto_izquierdo: string;\n  tapacanto_derecho: string;\n  cnc1: string;\n  cnc1_codigo: string; // üÜï C√≥digo del art√≠culo CNC1\n  cnc1_cantidad: number; // üÜï Cantidad de CNC1\n  cnc2: string;\n  cnc2_codigo: string; // üÜï C√≥digo del art√≠culo CNC2\n  cnc2_cantidad: number; // üÜï Cantidad de CNC2\n  codigo_material: string;\n  nombre_material: string;\n  precio_unitario?: number;\n  subtotal?: number;\n}\n\nexport interface Detallelamina {\n  numero_lamina: number;\n  piezas_count: number;\n  aprovechamiento: number;\n  area_utilizada: number;\n  area_total: number;\n  dimensiones: {\n    largo: number;\n    ancho: number;\n    espesor: number;\n  };\n}\n\nexport interface ResultadoMaterial {\n  codigo_material: string;\n  nombre_material: string;\n  dimensiones: {\n    largo: number;\n    ancho: number;\n    espesor: number;\n  };\n  precio_lamina: number;\n  laminas_usadas: number;\n  aprovechamiento_promedio: number;\n  total_piezas: number;\n  costo_total: number;\n  area_utilizada: number;\n  area_sobrante: number;\n  detalle_laminas: Detallelamina[];\n}\n\nexport interface ResumenProyecto {\n  total_laminas: number;\n  aprovechamiento_promedio: number;\n  total_piezas: number;\n  costo_total: number;\n  costo_materiales: number;\n  costo_tapacantos: number;\n  costo_horas_maquina: number;\n  area_utilizada: number;\n  area_sobrante: number;\n}\n\nexport interface ProyectoOptimizador {\n  id_proyecto?: string;\n  id_usuario?: string;\n  id_tienda?: string;\n  nombre_proyecto?: string;\n  fecha_creacion?: string;\n  piezas: PiezaOptimizador[];\n  resultados_optimizacion: Record<string, ResultadoMaterial>;\n  resumen: ResumenProyecto;\n  estado?: 'activo' | 'cotizado' | 'archivado';\n  id_cotizacion?: string;\n}\n\n/**\n * Guarda o actualiza un proyecto del optimizador\n */\nexport async function guardarProyectoOptimizador(\n  proyecto: ProyectoOptimizador\n): Promise<{ success: boolean; id_proyecto?: string; error?: string }> {\n  try {\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) {\n      return { success: false, error: 'Usuario no autenticado' };\n    }\n\n    const { data: tiendaData } = await supabase\n      .from('usuario_tienda_actual')\n      .select('id_tienda')\n      .eq('id_usuario', userData.user.id)\n      .single();\n\n    if (!tiendaData) {\n      return { success: false, error: 'No se encontr√≥ la tienda del usuario' };\n    }\n\n    // Si existe id_proyecto, actualizar; si no, crear nuevo\n    if (proyecto.id_proyecto) {\n      const { error } = await supabase\n        .from('optimizador_proyectos_temp')\n        .update({\n          piezas: proyecto.piezas,\n          resultados_optimizacion: proyecto.resultados_optimizacion,\n          resumen: proyecto.resumen,\n          nombre_proyecto: proyecto.nombre_proyecto,\n        })\n        .eq('id_proyecto', proyecto.id_proyecto);\n\n      if (error) {\n        console.error('Error al actualizar proyecto:', error);\n        return { success: false, error: error.message };\n      }\n\n      return { success: true, id_proyecto: proyecto.id_proyecto };\n    } else {\n      const { data, error } = await supabase\n        .from('optimizador_proyectos_temp')\n        .insert({\n          id_usuario: userData.user.id,\n          id_tienda: tiendaData.id_tienda,\n          piezas: proyecto.piezas,\n          resultados_optimizacion: proyecto.resultados_optimizacion,\n          resumen: proyecto.resumen,\n          nombre_proyecto: proyecto.nombre_proyecto || 'Proyecto sin nombre',\n          estado: 'activo',\n        })\n        .select('id_proyecto')\n        .single();\n\n      if (error) {\n        console.error('Error al crear proyecto:', error);\n        return { success: false, error: error.message };\n      }\n\n      return { success: true, id_proyecto: data.id_proyecto };\n    }\n  } catch (error) {\n    console.error('Error en guardarProyectoOptimizador:', error);\n    return { success: false, error: 'Error al guardar el proyecto' };\n  }\n}\n\n/**\n * Obtiene el proyecto activo del usuario\n */\nexport async function obtenerProyectoActivo(): Promise<ProyectoOptimizador | null> {\n  try {\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    const { data, error } = await supabase\n      .from('optimizador_proyectos_temp')\n      .select('*')\n      .eq('id_usuario', userData.user.id)\n      .eq('estado', 'activo')\n      .order('fecha_creacion', { ascending: false })\n      .limit(1)\n      .single();\n\n    if (error || !data) return null;\n\n    return data as ProyectoOptimizador;\n  } catch (error) {\n    console.error('Error al obtener proyecto activo:', error);\n    return null;\n  }\n}\n\n/**\n * Obtiene un proyecto por ID\n */\nexport async function obtenerProyectoPorId(id_proyecto: string): Promise<ProyectoOptimizador | null> {\n  try {\n    const { data, error } = await supabase\n      .from('optimizador_proyectos_temp')\n      .select('*')\n      .eq('id_proyecto', id_proyecto)\n      .single();\n\n    if (error || !data) return null;\n\n    return data as ProyectoOptimizador;\n  } catch (error) {\n    console.error('Error al obtener proyecto:', error);\n    return null;\n  }\n}\n\n/**\n * Marca un proyecto como cotizado\n */\nexport async function marcarProyectoCotizado(\n  id_proyecto: string,\n  id_cotizacion: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    const { error } = await supabase\n      .from('optimizador_proyectos_temp')\n      .update({\n        estado: 'cotizado',\n        id_cotizacion,\n      })\n      .eq('id_proyecto', id_proyecto);\n\n    if (error) {\n      console.error('Error al marcar proyecto como cotizado:', error);\n      return { success: false, error: error.message };\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error en marcarProyectoCotizado:', error);\n    return { success: false, error: 'Error al actualizar el proyecto' };\n  }\n}\n\n/**\n * Elimina un proyecto\n */\nexport async function eliminarProyecto(id_proyecto: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    const { error } = await supabase\n      .from('optimizador_proyectos_temp')\n      .delete()\n      .eq('id_proyecto', id_proyecto);\n\n    if (error) {\n      console.error('Error al eliminar proyecto:', error);\n      return { success: false, error: error.message };\n    }\n\n    return { success: true };\n  } catch (error) {\n    console.error('Error en eliminarProyecto:', error);\n    return { success: false, error: 'Error al eliminar el proyecto' };\n  }\n}\n\n/**\n * Limpia proyectos antiguos (m√°s de 7 d√≠as sin actividad)\n */\nexport async function limpiarProyectosAntiguos(): Promise<{ success: boolean; eliminados?: number; error?: string }> {\n  try {\n    const fechaLimite = new Date();\n    fechaLimite.setDate(fechaLimite.getDate() - 7);\n\n    const { data, error } = await supabase\n      .from('optimizador_proyectos_temp')\n      .delete()\n      .lt('updated_at', fechaLimite.toISOString())\n      .eq('estado', 'activo')\n      .select('id_proyecto');\n\n    if (error) {\n      console.error('Error al limpiar proyectos antiguos:', error);\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, eliminados: data?.length || 0 };\n  } catch (error) {\n    console.error('Error en limpiarProyectosAntiguos:', error);\n    return { success: false, error: 'Error al limpiar proyectos' };\n  }\n}\n","import { useState } from 'react';\nimport { useAuth } from '../../../hooks/useAuth';\nimport { useNotification } from '../../../hooks/useNotification';\nimport { BuscarClienteModal } from '../../clientes/components/BuscarClienteModal';\nimport BuscadorArticuloBlur from './BuscadorArticuloBlur';\nimport { Cliente } from '../../../types/cliente';\nimport { ResultadoOptimizacion, PiezaCorte } from '../../../types/optimizador';\nimport { CotizacionService } from '../../../services/cotizacionService';\nimport { useNavigate } from 'react-router-dom';\n// üÜï Importar servicio de proyectos\nimport { marcarProyectoCotizado } from '../../../services/optimizadorProyectoService';\n// üîß IMPORTAR SUPABASE\nimport { supabase } from '../../../lib/supabase';\n\n// üÜï Tipo para items adicionales del inventario\ninterface ItemAdicional {\n  id: string;\n  inventario_id: number;\n  codigo: string;\n  descripcion: string;\n  cantidad: number;\n  precio_unitario: number;\n  subtotal: number;\n}\n\ninterface CrearCotizacionModalProps {\n  resultado: ResultadoOptimizacion;\n  piezas: PiezaCorte[];\n  proyectoId: string | null;\n  onCerrar: () => void;\n}\n\nexport default function CrearCotizacionModal({ \n  resultado, \n  piezas,\n  proyectoId,\n  onCerrar \n}: CrearCotizacionModalProps) {\n  const { currentStore } = useAuth();\n  const { showNotification } = useNotification();\n  const navigate = useNavigate();\n  \n  const [clienteSeleccionado, setClienteSeleccionado] = useState<Cliente | null>(null);\n  const [mostrarBuscarCliente, setMostrarBuscarCliente] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [moneda, setMoneda] = useState('CRC');\n  const [tipoCambio, setTipoCambio] = useState(520);\n  const [margenUtilidad, setMargenUtilidad] = useState(20);\n  const [diasVencimiento, setDiasVencimiento] = useState(15);\n  const [notasAdicionales, setNotasAdicionales] = useState('');\n  \n  // üÜï Estado para items adicionales del inventario\n  const [itemsAdicionales, setItemsAdicionales] = useState<ItemAdicional[]>([]);\n\n  const handleSeleccionarCliente = (cliente: Cliente) => {\n    if (!cliente || !cliente.id) {\n      showNotification('error', 'Cliente seleccionado inv√°lido');\n      return;\n    }\n    console.log('‚úÖ Cliente seleccionado:', cliente);\n    setClienteSeleccionado(cliente);\n    setMostrarBuscarCliente(false);\n  };\n\n  // üÜï Agregar item adicional del inventario\n  const handleAgregarItemAdicional = (articulo: any) => {\n    const nuevoItem: ItemAdicional = {\n      id: Math.random().toString(36).substr(2, 9),\n      inventario_id: articulo.id,\n      codigo: articulo.codigo_articulo,\n      descripcion: articulo.descripcion_articulo,\n      cantidad: 1,\n      precio_unitario: articulo.precio_unitario || 0,\n      subtotal: articulo.precio_unitario || 0\n    };\n    setItemsAdicionales([...itemsAdicionales, nuevoItem]);\n    showNotification('success', 'Item agregado');\n  };\n\n  // üÜï Actualizar cantidad de item adicional\n  const handleActualizarCantidadItem = (itemId: string, nuevaCantidad: number) => {\n    setItemsAdicionales(itemsAdicionales.map(item => {\n      if (item.id === itemId) {\n        return {\n          ...item,\n          cantidad: nuevaCantidad,\n          subtotal: nuevaCantidad * item.precio_unitario\n        };\n      }\n      return item;\n    }));\n  };\n\n  // üÜï Actualizar precio de item adicional\n  const handleActualizarPrecioItem = (itemId: string, nuevoPrecio: number) => {\n    setItemsAdicionales(itemsAdicionales.map(item => {\n      if (item.id === itemId) {\n        return {\n          ...item,\n          precio_unitario: nuevoPrecio,\n          subtotal: item.cantidad * nuevoPrecio\n        };\n      }\n      return item;\n    }));\n  };\n\n  // üÜï Eliminar item adicional\n  const handleEliminarItemAdicional = (itemId: string) => {\n    setItemsAdicionales(itemsAdicionales.filter(item => item.id !== itemId));\n    showNotification('success', 'Item eliminado');\n  };\n\n  const calcularPrecioConMargen = (costo: number) => {\n    if (typeof costo !== 'number' || isNaN(costo) || costo < 0) {\n      return 0;\n    }\n    if (margenUtilidad >= 100) {\n      showNotification('warning', 'El margen de utilidad no puede ser 100% o mayor');\n      return costo;\n    }\n    return costo / (1 - margenUtilidad / 100);\n  };\n\n  const formatCurrency = (value: number, currency: string) => {\n    const symbol = currency === 'CRC' ? '‚Ç°' : '$';\n    return `${symbol}${value.toLocaleString('es-CR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  };\n\n  const handleCrearCotizacion = async () => {\n    if (!clienteSeleccionado || !resultado) return;\n\n    try {\n      setLoading(true);\n      console.log('üìã [OPT_QUOTE] Creando cotizaci√≥n desde optimizador...', {\n        cliente: clienteSeleccionado.nombre_razon_social,\n        proyecto_id: proyectoId,\n        total_piezas: piezas.length,\n        items_adicionales: itemsAdicionales.length,\n        costo_total: resultado.costo_total,\n        margen: margenUtilidad\n      });\n\n      // üÜï Obtener precios de CNC desde inventario\n      const codigosCNC = new Set<string>();\n      piezas.forEach(pieza => {\n        if (pieza.cnc1_codigo) codigosCNC.add(pieza.cnc1_codigo);\n        if (pieza.cnc2_codigo) codigosCNC.add(pieza.cnc2_codigo);\n      });\n\n      const preciosCNCMap = new Map<string, number>();\n      if (codigosCNC.size > 0) {\n        console.log('üîç [CNC] Buscando precios para c√≥digos:', Array.from(codigosCNC));\n        \n        const { data: inventarioCNC, error: errorCNC } = await supabase\n          .from('inventario')\n          .select('codigo_articulo, precio_articulo')\n          .in('codigo_articulo', Array.from(codigosCNC))\n          .eq('tienda_id', currentStore?.id);\n\n        if (errorCNC) {\n          console.error('‚ùå [CNC] Error obteniendo precios:', errorCNC);\n        } else if (inventarioCNC) {\n          inventarioCNC.forEach(item => {\n            preciosCNCMap.set(item.codigo_articulo, item.precio_articulo || 0);\n            console.log(`üí∞ [CNC] ${item.codigo_articulo}: ‚Ç°${item.precio_articulo}`);\n          });\n        }\n      }\n\n      console.log('üí∞ [CNC] Precios de CNC obtenidos:', Array.from(preciosCNCMap.entries()));\n\n      // Calcular el costo por pieza basado en el √°rea y material\n      const costoTotalMateriales = resultado.costo_total_materiales || resultado.costo_total || 0;\n      const costoTotalTapacantos = resultado.costo_total_tapacantos || 0;\n      const costoTotalCNC = resultado.costo_total_hh || 0;\n      \n      const areaTotal = piezas.reduce((sum, pieza) => {\n        return sum + (pieza.ancho * pieza.largo);\n      }, 0);\n\n      console.log('üí∞ [COSTOS] Costos del resultado:', {\n        materiales: costoTotalMateriales,\n        tapacantos: costoTotalTapacantos,\n        cnc: costoTotalCNC,\n        total: resultado.costo_total\n      });\n\n      // üÜï TABLA 1: Items del Optimizador (piezas cortadas)\n      const itemsOptimizador = piezas.map((pieza, index) => {\n        const areaPieza = pieza.ancho * pieza.largo;\n        \n        // üÜï Calcular costos individuales de la pieza\n        const costoMaterial = pieza.costo_material || (areaTotal > 0 ? (areaPieza / areaTotal) * costoTotalMateriales : 0);\n        const costoTapacantos = pieza.costo_tapacantos || 0;\n        \n        // üîß NORMALIZAR C√ìDIGOS CNC - Parsear strings \"77788 x 2\" a codigo + cantidad\n        const parseCNC = (cncValue: any): { codigo: string; cantidad: number } => {\n          if (!cncValue) return { codigo: '', cantidad: 0 };\n          \n          const str = String(cncValue).trim();\n          \n          // Si es \"-\" o \"Sin CNC\" o vac√≠o\n          if (!str || str === '-' || str === 'Sin CNC' || str === '0') {\n            return { codigo: '', cantidad: 0 };\n          }\n          \n          // Si tiene formato \"CODIGO x CANTIDAD\" (ej: \"77788 x 2\")\n          if (str.includes(' x ')) {\n            const parts = str.split(' x ');\n            const codigo = parts[0].trim();\n            const cantidad = parseInt(parts[1]) || 0;\n            return { codigo, cantidad };\n          }\n          \n          // Si es solo el c√≥digo (sin cantidad)\n          return { codigo: str, cantidad: 1 };\n        };\n\n        const cnc1 = parseCNC(pieza.cnc1_codigo || pieza.cnc1);\n        const cnc2 = parseCNC(pieza.cnc2_codigo || pieza.cnc2);\n\n        console.log(`üîß [PARSE CNC] Pieza \"${pieza.descripcion}\":`, {\n          cnc1_original: pieza.cnc1_codigo || pieza.cnc1,\n          cnc1_parseado: cnc1,\n          cnc2_original: pieza.cnc2_codigo || pieza.cnc2,\n          cnc2_parseado: cnc2\n        });\n\n        // üîß CALCULAR COSTO DE CNC DESDE INVENTARIO\n        let costoCNC = 0;\n        if (cnc1.codigo && cnc1.codigo !== '0' && cnc1.codigo !== 'Sin CNC') {\n          const precioCNC1 = preciosCNCMap.get(cnc1.codigo) || 0;\n          costoCNC += precioCNC1 * cnc1.cantidad;\n          console.log(`üí∞ [CNC1] ${cnc1.codigo}: ${precioCNC1} x ${cnc1.cantidad} = ${precioCNC1 * cnc1.cantidad}`);\n        }\n        if (cnc2.codigo && cnc2.codigo !== '0' && cnc2.codigo !== 'Sin CNC') {\n          const precioCNC2 = preciosCNCMap.get(cnc2.codigo) || 0;\n          costoCNC += precioCNC2 * cnc2.cantidad;\n          console.log(`üí∞ [CNC2] ${cnc2.codigo}: ${precioCNC2} x ${cnc2.cantidad} = ${precioCNC2 * cnc2.cantidad}`);\n        }\n\n        const costoTotal = costoMaterial + costoTapacantos + costoCNC;\n        const precioConMargen = costoTotal * (1 + margenUtilidad / 100);\n\n        console.log(`üí∞ [PIEZA ${index + 1}] \"${pieza.descripcion}\":`, {\n          costo_material: costoMaterial.toFixed(2),\n          costo_tapacantos: costoTapacantos.toFixed(2),\n          costo_cnc: costoCNC.toFixed(2),\n          costo_total: costoTotal.toFixed(2),\n          precio_con_margen: precioConMargen.toFixed(2),\n          cnc1_codigo: cnc1.codigo,\n          cnc1_cantidad: cnc1.cantidad,\n          cnc2_codigo: cnc2.codigo,\n          cnc2_cantidad: cnc2.cantidad\n        });\n\n        // Obtener tapacantos\n        const tapacantosSup = pieza.tapacantos.find(tc => tc.lado === 'superior' || tc.lado === 'largo_sup');\n        const tapacantosInf = pieza.tapacantos.find(tc => tc.lado === 'inferior' || tc.lado === 'largo_inf');\n        const tapacantosIzq = pieza.tapacantos.find(tc => tc.lado === 'izquierdo' || tc.lado === 'ancho_inf');\n        const tapacantosDer = pieza.tapacantos.find(tc => tc.lado === 'derecho' || tc.lado === 'ancho_sup');\n\n        return {\n          descripcion: pieza.descripcion || `Pieza ${index + 1}`,\n          largo: pieza.largo,\n          ancho: pieza.ancho,\n          cantidad: pieza.cantidad || 1,\n          material_codigo: pieza.material_codigo || '',\n          material_nombre: pieza.material_nombre || '',\n          veta: pieza.veta || 'horizontal',\n          tapacanto_superior: tapacantosSup?.codigo || '',\n          tapacanto_inferior: tapacantosInf?.codigo || '',\n          tapacanto_izquierdo: tapacantosIzq?.codigo || '',\n          tapacanto_derecho: tapacantosDer?.codigo || '',\n          // üîß GUARDAR SOLO C√ìDIGOS Y CANTIDADES (sin texto concatenado)\n          cnc1_codigo: cnc1.codigo,\n          cnc1_cantidad: cnc1.cantidad,\n          cnc2_codigo: cnc2.codigo,\n          cnc2_cantidad: cnc2.cantidad,\n          // üÜï Guardar costos individuales\n          costo_material: costoMaterial,\n          costo_tapacantos: costoTapacantos,\n          costo_cnc: costoCNC,\n          costo_total: costoTotal,\n          precio_unitario: precioConMargen,\n          subtotal: precioConMargen * (pieza.cantidad || 1)\n        };\n      });\n\n      // üÜï LOG DE DEPURACI√ìN: Mostrar piezas con CNC antes de guardar\n      console.log('üíæ [GUARDAR] Piezas con CNC:', itemsOptimizador.map(item => ({\n        descripcion: item.descripcion,\n        cnc1_codigo: item.cnc1_codigo,\n        cnc1_cantidad: item.cnc1_cantidad,\n        cnc2_codigo: item.cnc2_codigo,\n        cnc2_cantidad: item.cnc2_cantidad\n      })));\n\n      // üÜï TABLA 2: Items Adicionales del Inventario\n      const itemsInventario = itemsAdicionales.map(item => ({\n        inventario_id: item.inventario_id,\n        codigo: item.codigo,\n        descripcion: item.descripcion,\n        cantidad: item.cantidad,\n        precio_unitario: item.precio_unitario,\n        subtotal: item.subtotal\n      }));\n\n      // Calcular totales\n      const subtotalOptimizador = itemsOptimizador.reduce((sum, item) => sum + item.subtotal, 0);\n      const subtotalInventario = itemsInventario.reduce((sum, item) => sum + item.subtotal, 0);\n      const subtotal = subtotalOptimizador + subtotalInventario;\n      const totalImpuestos = subtotal * 0.13;\n      const total = subtotal + totalImpuestos;\n\n      console.log('üí∞ [OPT_QUOTE] Totales calculados:', {\n        subtotal_optimizador: subtotalOptimizador.toFixed(2),\n        subtotal_inventario: subtotalInventario.toFixed(2),\n        subtotal_total: subtotal.toFixed(2),\n        impuestos: totalImpuestos.toFixed(2),\n        total: total.toFixed(2),\n        items_optimizador: itemsOptimizador.length,\n        items_inventario: itemsInventario.length\n      });\n\n      // Generar notas con m√©tricas del optimizador\n      const notas = `M√âTRICAS DEL OPTIMIZADOR 2D:\n\nüì¶ Total de Piezas: ${piezas.length}\nüìã L√°minas Utilizadas: ${resultado.total_laminas || 0}\nüìä Aprovechamiento Global: ${resultado.porcentaje_aprovechamiento_global?.toFixed(2) || 0}%\nü™µ Materiales Diferentes: ${resultado.resultados_por_material?.length || 1}\nüí∞ Costo Total Materiales: ${formatCurrency(costoTotalMateriales, moneda)}\nüí∞ Costo Total Tapacantos: ${formatCurrency(costoTotalTapacantos, moneda)}\nüí∞ Costo Total CNC: ${formatCurrency(costoTotalCNC, moneda)}\nüìà Margen Aplicado: ${margenUtilidad}%\n${itemsAdicionales.length > 0 ? `\\nüîß Items Adicionales: ${itemsAdicionales.length}` : ''}\nüíµ Precio Total: ${formatCurrency(total, moneda)}\n\n${notasAdicionales || ''}`;\n\n      // üÜï Preparar datos de cotizaci√≥n con TABLAS SEPARADAS\n      const cotizacionData = {\n        cliente_id: clienteSeleccionado.id,\n        fecha_emision: new Date().toISOString().split('T')[0],\n        fecha_vencimiento: new Date(Date.now() + diasVencimiento * 24 * 60 * 60 * 1000)\n          .toISOString()\n          .split('T')[0],\n        moneda: moneda,\n        tipo_cambio: tipoCambio,\n        subtotal: subtotal,\n        descuento: 0,\n        impuestos: totalImpuestos,\n        total: total,\n        estado: 'borrador',\n        notas: notas,\n        // üÜï TABLA 1: Items del Optimizador\n        items_optimizador: itemsOptimizador,\n        // üÜï TABLA 2: Items del Inventario\n        items_inventario: itemsInventario,\n        metadata: {\n          tipo: 'optimizador',\n          proyecto_id: proyectoId,\n          margen_utilidad: margenUtilidad,\n          costo_total_materiales: costoTotalMateriales,\n          costo_total_tapacantos: costoTotalTapacantos,\n          costo_total_cnc: costoTotalCNC,\n          items_adicionales_count: itemsAdicionales.length,\n          metricas: {\n            total_piezas: piezas.length,\n            laminas_usadas: resultado.total_laminas,\n            aprovechamiento: resultado.porcentaje_aprovechamiento_global,\n            materiales_unicos: resultado.resultados_por_material?.length || 1\n          }\n        }\n      };\n\n      console.log('üíæ [OPT_QUOTE] Datos preparados para enviar (TABLAS SEPARADAS):', {\n        tiene_metadata: true,\n        tipo_metadata: cotizacionData.metadata.tipo,\n        items_optimizador: itemsOptimizador.length,\n        items_inventario: itemsInventario.length,\n        estructura: {\n          tabla_1: 'items_optimizador (piezas cortadas)',\n          tabla_2: 'items_inventario (art√≠culos adicionales)'\n        }\n      });\n\n      const cotizacionCreada = await CotizacionService.crearCotizacion(cotizacionData);\n\n      console.log('‚úÖ [OPT_QUOTE] Cotizaci√≥n creada:', cotizacionCreada);\n\n      // üÜï Marcar proyecto como cotizado\n      if (proyectoId) {\n        await marcarProyectoCotizado(proyectoId, cotizacionCreada.id.toString());\n        console.log('‚úÖ Proyecto marcado como cotizado');\n      }\n\n      showNotification('success', 'Cotizaci√≥n creada exitosamente');\n\n      // Redirigir a la p√°gina de cotizaci√≥n del optimizador\n      navigate(`/cotizaciones/optimizador/${cotizacionCreada.id}`);\n      onCerrar();\n\n    } catch (error: any) {\n      console.error('‚ùå [OPT_QUOTE] Error al crear cotizaci√≥n:', error);\n      showNotification('error', error.message || 'Error al crear la cotizaci√≥n');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // üÜï Calcular preview de totales (optimizador + items adicionales)\n  const costoTotal = resultado?.costo_total || 0;\n  const precioTotalOptimizador = calcularPrecioConMargen(costoTotal);\n  const subtotalItemsAdicionales = itemsAdicionales.reduce((sum, item) => sum + item.subtotal, 0);\n  const subtotal = precioTotalOptimizador + subtotalItemsAdicionales;\n  const impuestos = subtotal * 0.13;\n  const totalFinal = subtotal + impuestos;\n\n  return (\n    <>\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n        <div className=\"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] flex flex-col\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">\n                Crear Cotizaci√≥n desde Optimizador\n              </h2>\n              <p className=\"text-sm text-gray-600 mt-1\">\n                Genera una cotizaci√≥n con todas las piezas optimizadas + items adicionales\n              </p>\n            </div>\n            <button\n              onClick={onCerrar}\n              className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n            >\n              <i className=\"ri-close-line text-2xl\"></i>\n            </button>\n          </div>\n\n          {/* Body */}\n          <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n            {/* Selecci√≥n de Cliente */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Cliente *\n              </label>\n              {clienteSeleccionado ? (\n                <div className=\"flex items-center justify-between p-4 bg-teal-50 border border-teal-200 rounded-lg\">\n                  <div>\n                    <p className=\"font-medium text-gray-900\">\n                      {clienteSeleccionado.nombre_razon_social || clienteSeleccionado.razon_social || clienteSeleccionado.nombre || 'Sin nombre'}\n                    </p>\n                    <p className=\"text-sm text-gray-600\">\n                      {clienteSeleccionado.identificacion || clienteSeleccionado.cedula || 'Sin identificaci√≥n'}\n                    </p>\n                    {clienteSeleccionado.telefono && (\n                      <p className=\"text-xs text-gray-500 mt-1\">\n                        üìû {clienteSeleccionado.telefono}\n                      </p>\n                    )}\n                  </div>\n                  <button\n                    onClick={() => setClienteSeleccionado(null)}\n                    className=\"text-teal-600 hover:text-teal-700 text-sm font-medium whitespace-nowrap\"\n                  >\n                    Cambiar\n                  </button>\n                </div>\n              ) : (\n                <button\n                  onClick={() => setMostrarBuscarCliente(true)}\n                  className=\"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-teal-500 hover:bg-teal-50 transition-colors text-gray-600 hover:text-teal-600 flex items-center justify-center gap-2 whitespace-nowrap\"\n                >\n                  <i className=\"ri-search-line\"></i>\n                  Buscar Cliente\n                </button>\n              )}\n            </div>\n\n            {/* üÜï Secci√≥n de Items Adicionales del Inventario */}\n            <div className=\"bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg p-4 border border-purple-200\">\n              <h3 className=\"text-sm font-semibold text-purple-900 mb-3 flex items-center gap-2\">\n                <i className=\"ri-add-box-line\"></i>\n                Items Adicionales del Inventario\n              </h3>\n              \n              {/* Buscador de art√≠culos - üîß PASAR tiendaActual */}\n              <BuscadorArticuloBlur\n                onSeleccionar={handleAgregarItemAdicional}\n                placeholder=\"Buscar art√≠culo del inventario...\"\n                tiendaActual={currentStore}\n              />\n\n              {/* Tabla de items adicionales */}\n              {itemsAdicionales.length > 0 && (\n                <div className=\"mt-4 bg-white rounded-lg border border-purple-200 overflow-hidden\">\n                  <table className=\"w-full text-sm\">\n                    <thead className=\"bg-purple-100\">\n                      <tr>\n                        <th className=\"px-3 py-2 text-left text-xs font-semibold text-purple-900\">C√≥digo</th>\n                        <th className=\"px-3 py-2 text-left text-xs font-semibold text-purple-900\">Descripci√≥n</th>\n                        <th className=\"px-3 py-2 text-center text-xs font-semibold text-purple-900 w-24\">Cantidad</th>\n                        <th className=\"px-3 py-2 text-right text-xs font-semibold text-purple-900 w-32\">Precio Unit.</th>\n                        <th className=\"px-3 py-2 text-right text-xs font-semibold text-purple-900 w-32\">Subtotal</th>\n                        <th className=\"px-3 py-2 text-center text-xs font-semibold text-purple-900 w-16\">Acci√≥n</th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-purple-100\">\n                      {itemsAdicionales.map((item) => (\n                        <tr key={item.id} className=\"hover:bg-purple-50\">\n                          <td className=\"px-3 py-2 text-gray-900 font-medium\">{item.codigo}</td>\n                          <td className=\"px-3 py-2 text-gray-700\">{item.descripcion}</td>\n                          <td className=\"px-3 py-2\">\n                            <input\n                              type=\"number\"\n                              min=\"1\"\n                              value={item.cantidad}\n                              onChange={(e) => handleActualizarCantidadItem(item.id, parseInt(e.target.value) || 1)}\n                              className=\"w-full px-2 py-1 border border-gray-300 rounded text-center focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                            />\n                          </td>\n                          <td className=\"px-3 py-2\">\n                            <input\n                              type=\"number\"\n                              step=\"0.01\"\n                              min=\"0\"\n                              value={item.precio_unitario}\n                              onChange={(e) => handleActualizarPrecioItem(item.id, parseFloat(e.target.value) || 0)}\n                              className=\"w-full px-2 py-1 border border-gray-300 rounded text-right focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                            />\n                          </td>\n                          <td className=\"px-3 py-2 text-right font-medium text-gray-900\">\n                            {formatCurrency(item.subtotal, moneda)}\n                          </td>\n                          <td className=\"px-3 py-2 text-center\">\n                            <button\n                              onClick={() => handleEliminarItemAdicional(item.id)}\n                              className=\"text-red-600 hover:text-red-700 transition-colors\"\n                              title=\"Eliminar\"\n                            >\n                              <i className=\"ri-delete-bin-line\"></i>\n                            </button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              )}\n            </div>\n\n            {/* Configuraci√≥n de Moneda */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Moneda\n                </label>\n                <select\n                  value={moneda}\n                  onChange={(e) => setMoneda(e.target.value)}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                >\n                  <option value=\"CRC\">‚Ç° Colones (CRC)</option>\n                  <option value=\"USD\">$ D√≥lares (USD)</option>\n                </select>\n              </div>\n\n              {moneda === 'USD' && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Tipo de Cambio\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={tipoCambio}\n                    onChange={(e) => setTipoCambio(parseFloat(e.target.value) || 0)}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n                  />\n                </div>\n              )}\n            </div>\n\n            {/* Margen de Utilidad */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Margen de Utilidad (%) - Solo para piezas del optimizador\n              </label>\n              <div className=\"flex items-center gap-4\">\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"99\"\n                  step=\"1\"\n                  value={margenUtilidad}\n                  onChange={(e) => setMargenUtilidad(parseFloat(e.target.value) || 0)}\n                  className=\"flex-1\"\n                />\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  min=\"0\"\n                  max=\"99\"\n                  value={margenUtilidad}\n                  onChange={(e) => setMargenUtilidad(parseFloat(e.target.value) || 0)}\n                  className=\"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-center\"\n                />\n                <span className=\"text-gray-600 font-medium whitespace-nowrap\">%</span>\n              </div>\n              <p className=\"text-xs text-gray-600 mt-2\">\n                Este margen se aplicar√° sobre el costo total calculado por el optimizador. Los items adicionales usan el precio configurado.\n              </p>\n            </div>\n\n            {/* D√≠as de Vencimiento */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                D√≠as de Vencimiento\n              </label>\n              <input\n                type=\"number\"\n                min=\"1\"\n                value={diasVencimiento}\n                onChange={(e) => setDiasVencimiento(parseInt(e.target.value) || 15)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n              />\n            </div>\n\n            {/* Resumen de Costos */}\n            <div className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n              <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">\n                üìä Resumen de Costos\n              </h3>\n              \n              <div className=\"space-y-2 text-sm\">\n                {/* Piezas del Optimizador */}\n                <div className=\"flex justify-between text-blue-600\">\n                  <span>Piezas del Optimizador ({piezas.length}):</span>\n                  <span className=\"font-medium\">\n                    {formatCurrency(precioTotalOptimizador, moneda)}\n                  </span>\n                </div>\n\n                {/* Items Adicionales */}\n                {itemsAdicionales.length > 0 && (\n                  <div className=\"flex justify-between text-purple-600\">\n                    <span>Items Adicionales ({itemsAdicionales.length}):</span>\n                    <span className=\"font-medium\">\n                      {formatCurrency(subtotalItemsAdicionales, moneda)}\n                    </span>\n                  </div>\n                )}\n\n                <div className=\"border-t border-gray-300 pt-2\"></div>\n\n                {/* Subtotal */}\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Subtotal:</span>\n                  <span className=\"font-medium text-gray-900\">\n                    {formatCurrency(subtotal, moneda)}\n                  </span>\n                </div>\n\n                {/* IVA */}\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">IVA (13%):</span>\n                  <span className=\"font-medium text-gray-900\">\n                    {formatCurrency(impuestos, moneda)}\n                  </span>\n                </div>\n\n                <div className=\"border-t border-gray-300 pt-2\"></div>\n\n                {/* Total */}\n                <div className=\"flex justify-between text-lg\">\n                  <span className=\"font-semibold text-gray-900\">Total:</span>\n                  <span className=\"font-bold text-teal-600\">\n                    {formatCurrency(totalFinal, moneda)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Informaci√≥n de Piezas */}\n            <div className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\n              <h3 className=\"text-sm font-semibold text-blue-900 mb-2\">\n                üì¶ Informaci√≥n del Proyecto\n              </h3>\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                <div>\n                  <span className=\"text-blue-700\">Total de Piezas:</span>\n                  <span className=\"ml-2 font-medium text-blue-900\">{piezas?.length || 0}</span>\n                </div>\n                <div>\n                  <span className=\"text-blue-700\">L√°minas Utilizadas:</span>\n                  <span className=\"ml-2 font-medium text-blue-900\">{resultado?.total_laminas || 0}</span>\n                </div>\n                <div>\n                  <span className=\"text-blue-700\">Aprovechamiento:</span>\n                  <span className=\"ml-2 font-medium text-blue-900\">\n                    {(resultado?.porcentaje_aprovechamiento_global || 0).toFixed(1)}%\n                  </span>\n                </div>\n                <div>\n                  <span className=\"text-blue-700\">Items Adicionales:</span>\n                  <span className=\"ml-2 font-medium text-blue-900\">\n                    {itemsAdicionales.length}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-6 border-t border-gray-200 bg-gray-50\">\n            <div className=\"flex justify-end gap-3\">\n              <button\n                onClick={onCerrar}\n                disabled={loading}\n                className=\"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap\"\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={handleCrearCotizacion}\n                disabled={!clienteSeleccionado || loading}\n                className=\"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 whitespace-nowrap\"\n              >\n                {loading ? (\n                  <>\n                    <i className=\"ri-loader-4-line animate-spin\"></i>\n                    Creando...\n                  </>\n                ) : (\n                  <>\n                    <i className=\"ri-file-text-line\"></i>\n                    Crear Cotizaci√≥n\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Modal de Buscar Cliente */}\n      {mostrarBuscarCliente && (\n        <BuscarClienteModal\n          onSelect={handleSeleccionarCliente}\n          onCancel={() => setMostrarBuscarCliente(false)}\n        />\n      )}\n    </>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { useAuth } from '../../hooks/useAuth';\nimport OptimizadorLayout from './components/OptimizadorLayout';\nimport SelectorModo from './components/SelectorModo';\nimport SelectorProductoBOM from './components/SelectorProductoBOM';\nimport EditorPiezas from './components/EditorPiezas';\nimport VisualizadorCortes from './components/VisualizadorCortes';\nimport PanelResultados from './components/PanelResultados';\nimport ConfiguracionModal from './components/ConfiguracionModal';\nimport ExportarExcelModal from './components/ExportarExcelModal';\nimport ImportarExcelModal from './components/ImportarExcelModal';\nimport CrearCotizacionModal from './components/CrearCotizacionModal';\nimport { \n  ProyectoOptimizador, \n  ModoOptimizador, \n  PiezaCorte,\n  ConfiguracionCorte,\n  ResultadoOptimizacion,\n  ArticuloInventario\n} from '../../types/optimizador';\nimport { \n  optimizarCortes,\n  cargarPiezasDesdeBOM,\n  buscarArticulosInventario\n} from '../../services/optimizadorService';\n// üÜï Importar servicio de proyectos temporales\nimport {\n  guardarProyectoOptimizador,\n  obtenerProyectoActivo,\n  PiezaOptimizador,\n  ResultadoMaterial,\n  ResumenProyecto\n} from '../../services/optimizadorProyectoService';\nimport { useNotification } from '../../hooks/useNotification';\nimport * as XLSX from 'xlsx';\n\nexport default function OptimizadorPage() {\n  const { currentStore, user } = useAuth();\n  const { showNotification } = useNotification();\n  \n  const [modo, setModo] = useState<ModoOptimizador>('manual');\n  const [piezas, setPiezas] = useState<PiezaCorte[]>([]);\n  const [configuracion, setConfiguracion] = useState<ConfiguracionCorte>({\n    espesor_sierra: 3,\n    margen_seguridad: 5,\n    permitir_rotacion: true,\n    optimizar_desperdicio: true\n  });\n  const [resultado, setResultado] = useState<ResultadoOptimizacion | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [mostrarConfiguracion, setMostrarConfiguracion] = useState(false);\n  const [showExport, setShowExport] = useState(false);\n  const [showCrearCotizacion, setShowCrearCotizacion] = useState(false);\n  const [productoBOM, setProductoBOM] = useState<{id: number; nombre: string} | null>(null);\n  // üÜï ID del proyecto temporal actual\n  const [proyectoId, setProyectoId] = useState<string | null>(null);\n\n  // üÜï Cargar proyecto activo al iniciar\n  useEffect(() => {\n    cargarProyectoActivo();\n  }, []);\n\n  const cargarProyectoActivo = async () => {\n    try {\n      const proyecto = await obtenerProyectoActivo();\n      if (proyecto) {\n        console.log('üìÇ Proyecto activo cargado:', proyecto);\n        setProyectoId(proyecto.id_proyecto || null);\n        // Convertir piezas del formato de BD al formato de la app\n        if (proyecto.piezas && proyecto.piezas.length > 0) {\n          const piezasConvertidas = proyecto.piezas.map((p: PiezaOptimizador) => ({\n            id: Math.random().toString(36).substr(2, 9),\n            descripcion: p.descripcion,\n            largo: p.largo,\n            ancho: p.ancho,\n            cantidad: p.cantidad,\n            veta: p.veta,\n            material_codigo: p.codigo_material,\n            material_nombre: p.nombre_material,\n            tapacantos: [\n              { lado: 'largo_sup', codigo: p.tapacanto_superior },\n              { lado: 'largo_inf', codigo: p.tapacanto_inferior },\n              { lado: 'ancho_inf', codigo: p.tapacanto_izquierdo },\n              { lado: 'ancho_sup', codigo: p.tapacanto_derecho }\n            ],\n            cnc1: p.cnc1,\n            cnc1_codigo: p.cnc1_codigo || '', // üÜï Cargar c√≥digo CNC1\n            cnc1_cantidad: p.cnc1_cantidad || 0, // üÜï Cargar cantidad CNC1\n            cnc2: p.cnc2,\n            cnc2_codigo: p.cnc2_codigo || '', // üÜï Cargar c√≥digo CNC2\n            cnc2_cantidad: p.cnc2_cantidad || 0 // üÜï Cargar cantidad CNC2\n          }));\n          setPiezas(piezasConvertidas as PiezaCorte[]);\n          console.log('‚úÖ Piezas cargadas con CNC:', piezasConvertidas.map(p => ({\n            descripcion: p.descripcion,\n            cnc1: p.cnc1_codigo ? `${p.cnc1_codigo} x ${p.cnc1_cantidad}` : '-',\n            cnc2: p.cnc2_codigo ? `${p.cnc2_codigo} x ${p.cnc2_cantidad}` : '-'\n          })));\n        }\n      }\n    } catch (error) {\n      console.error('Error cargando proyecto activo:', error);\n    }\n  };\n\n  // üÜï Guardar proyecto autom√°ticamente cuando cambian piezas o resultados\n  useEffect(() => {\n    if (piezas.length > 0 || resultado) {\n      guardarProyectoAutomaticamente();\n    }\n  }, [piezas, resultado]);\n\n  const guardarProyectoAutomaticamente = async () => {\n    try {\n      // Convertir piezas al formato de BD\n      const piezasParaBD: PiezaOptimizador[] = piezas.map(p => ({\n        descripcion: p.descripcion || '',\n        largo: p.largo,\n        ancho: p.ancho,\n        cantidad: p.cantidad,\n        veta: p.veta,\n        tapacanto_superior: p.tapacantos.find(tc => tc.lado === 'largo_sup')?.codigo || '',\n        tapacanto_inferior: p.tapacantos.find(tc => tc.lado === 'largo_inf')?.codigo || '',\n        tapacanto_izquierdo: p.tapacantos.find(tc => tc.lado === 'ancho_inf')?.codigo || '',\n        tapacanto_derecho: p.tapacantos.find(tc => tc.lado === 'ancho_sup')?.codigo || '',\n        cnc1: p.cnc1 || '',\n        cnc1_codigo: p.cnc1_codigo || '', // üÜï Guardar c√≥digo CNC1\n        cnc1_cantidad: p.cnc1_cantidad || 0, // üÜï Guardar cantidad CNC1\n        cnc2: p.cnc2 || '',\n        cnc2_codigo: p.cnc2_codigo || '', // üÜï Guardar c√≥digo CNC2\n        cnc2_cantidad: p.cnc2_cantidad || 0, // üÜï Guardar cantidad CNC2\n        codigo_material: p.material_codigo || '',\n        nombre_material: p.material_nombre || '',\n        precio_unitario: 0,\n        subtotal: 0\n      }));\n\n      console.log('üíæ [GUARDAR] Piezas con CNC:', piezasParaBD.map(p => ({\n        descripcion: p.descripcion,\n        cnc1: p.cnc1_codigo ? `${p.cnc1_codigo} x ${p.cnc1_cantidad}` : '-',\n        cnc2: p.cnc2_codigo ? `${p.cnc2_codigo} x ${p.cnc2_cantidad}` : '-'\n      })));\n\n      // Convertir resultados al formato de BD\n      const resultadosParaBD: Record<string, ResultadoMaterial> = {};\n      if (resultado?.resultados_por_material) {\n        resultado.resultados_por_material.forEach(rm => {\n          resultadosParaBD[rm.codigo_material] = {\n            codigo_material: rm.codigo_material,\n            nombre_material: rm.nombre_material,\n            dimensiones: rm.dimensiones,\n            precio_lamina: rm.precio_lamina,\n            laminas_usadas: rm.laminas_usadas,\n            aprovechamiento_promedio: rm.aprovechamiento_promedio,\n            total_piezas: rm.total_piezas,\n            costo_total: rm.costo_total,\n            area_utilizada: rm.area_utilizada,\n            area_sobrante: rm.area_sobrante,\n            detalle_laminas: rm.detalle_laminas\n          };\n        });\n      }\n\n      // Preparar resumen\n      const resumen: ResumenProyecto = {\n        total_laminas: resultado?.total_laminas || 0,\n        aprovechamiento_promedio: resultado?.porcentaje_aprovechamiento_global || 0,\n        total_piezas: piezas.length,\n        costo_total: resultado?.costo_total || 0,\n        costo_materiales: resultado?.costo_materiales || 0,\n        costo_tapacantos: resultado?.costo_tapacantos || 0,\n        costo_horas_maquina: resultado?.costo_horas_maquina || 0,\n        area_utilizada: resultado?.area_utilizada || 0,\n        area_sobrante: resultado?.area_sobrante || 0\n      };\n\n      const respuesta = await guardarProyectoOptimizador({\n        id_proyecto: proyectoId || undefined,\n        piezas: piezasParaBD,\n        resultados_optimizacion: resultadosParaBD,\n        resumen: resumen,\n        nombre_proyecto: `Proyecto ${new Date().toLocaleDateString()}`\n      });\n\n      if (respuesta.success && respuesta.id_proyecto) {\n        setProyectoId(respuesta.id_proyecto);\n        console.log('‚úÖ Proyecto guardado autom√°ticamente:', respuesta.id_proyecto);\n      }\n    } catch (error) {\n      console.error('Error guardando proyecto autom√°ticamente:', error);\n    }\n  };\n\n  const handleCambiarModo = (nuevoModo: ModoOptimizador) => {\n    setModo(nuevoModo);\n    setPiezas([]);\n    setResultado(null);\n    setProductoBOM(null);\n  };\n\n  const handleProductoBOMSelect = async (productoId: number, productoNombre: string) => {\n    setLoading(true);\n    try {\n      const { data, error } = await cargarPiezasDesdeBOM(productoId, currentStore);\n      \n      if (error) throw error;\n      \n      if (data && data.length > 0) {\n        setPiezas(data);\n        setProductoBOM({ id: productoId, nombre: productoNombre });\n        showNotification('success', `Se cargaron ${data.length} piezas desde el BOM`);\n      } else {\n        showNotification('warning', 'El producto no tiene piezas v√°lidas en el BOM');\n      }\n    } catch (error) {\n      console.error('Error cargando BOM:', error);\n      showNotification('error', 'Error al cargar las piezas del BOM');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleExportarExcel = () => {\n    setShowExport(true);\n  };\n\n  const handleAgregarPieza = (pieza: PiezaCorte) => {\n    setPiezas([...piezas, pieza]);\n    setResultado(null);\n  };\n\n  const handleEditarPieza = (index: number, piezaEditada: PiezaCorte) => {\n    const nuevasPiezas = [...piezas];\n    nuevasPiezas[index] = piezaEditada;\n    setPiezas(nuevasPiezas);\n    setResultado(null);\n  };\n\n  const handleEliminarPieza = (index: number) => {\n    const nuevasPiezas = piezas.filter((_, i) => i !== index);\n    setPiezas(nuevasPiezas);\n    setResultado(null);\n  };\n\n  const handleOptimizar = async () => {\n    console.log('üéØ [OPTIMIZAR] Bot√≥n presionado', {\n      total_piezas: piezas.length,\n      piezas: piezas.map(p => ({\n        descripcion: p.descripcion,\n        material: p.material_codigo,\n        dimensiones: `${p.largo}x${p.ancho}`,\n        tiene_dimensiones_lamina: !!(p.material_largo_lamina_mm && p.material_ancho_lamina_mm)\n      }))\n    });\n\n    // üÜï Validar que todas las piezas tengan material asignado\n    const piezasSinMaterial = piezas.filter(p => !p.material_codigo);\n    if (piezasSinMaterial.length > 0) {\n      console.error('‚ùå [OPTIMIZAR] Piezas sin material:', piezasSinMaterial);\n      showNotification('error', `Hay ${piezasSinMaterial.length} pieza(s) sin material asignado`);\n      return;\n    }\n\n    // üÜï Validar que todas las piezas con material tengan dimensiones de l√°mina\n    const piezasSinDimensiones = piezas.filter(p => \n      p.material_codigo && (!p.material_largo_lamina_mm || !p.material_ancho_lamina_mm)\n    );\n    if (piezasSinDimensiones.length > 0) {\n      console.error('‚ùå [OPTIMIZAR] Piezas sin dimensiones de l√°mina:', piezasSinDimensiones);\n      showNotification('error', \n        `Hay ${piezasSinDimensiones.length} pieza(s) cuyo material no tiene dimensiones de l√°mina configuradas en inventario`\n      );\n      return;\n    }\n\n    if (piezas.length === 0) {\n      console.warn('‚ö†Ô∏è [OPTIMIZAR] No hay piezas para optimizar');\n      showNotification('error', 'Debes agregar al menos una pieza');\n      return;\n    }\n\n    console.log('‚úÖ [OPTIMIZAR] Validaciones pasadas, iniciando optimizaci√≥n...');\n    setLoading(true);\n    \n    try {\n      console.log('üöÄ [OPTIMIZAR] Llamando a optimizarCortes...');\n      const resultadoOptimizacion = await optimizarCortes(piezas, configuracion, currentStore);\n      \n      console.log('üìä [OPTIMIZAR] Resultado obtenido:', {\n        total_laminas: resultadoOptimizacion.total_laminas,\n        laminas: resultadoOptimizacion.laminas.length,\n        aprovechamiento: resultadoOptimizacion.porcentaje_aprovechamiento_global,\n        materiales: resultadoOptimizacion.resultados_por_material?.length || 0,\n        piezas_sin_asignar: resultadoOptimizacion.piezas_sin_asignar.length\n      });\n      \n      setResultado(resultadoOptimizacion);\n      \n      if (resultadoOptimizacion.piezas_sin_asignar.length > 0) {\n        showNotification('warning', \n          `Optimizaci√≥n completada. ${resultadoOptimizacion.piezas_sin_asignar.length} piezas no pudieron ser asignadas`\n        );\n      } else {\n        showNotification('success', \n          `Optimizaci√≥n completada. Se utilizaron ${resultadoOptimizacion.total_laminas} l√°minas con ${resultadoOptimizacion.porcentaje_aprovechamiento_global.toFixed(1)}% de aprovechamiento`\n        );\n      }\n    } catch (error) {\n      console.error('‚ùå [OPTIMIZAR] Error en optimizaci√≥n:', error);\n      showNotification('error', 'Error al optimizar los cortes: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n      console.log('üèÅ [OPTIMIZAR] Proceso finalizado');\n    }\n  };\n\n  const handleLimpiar = () => {\n    setPiezas([]);\n    setResultado(null);\n    setProductoBOM(null);\n    setProyectoId(null); // üÜï Limpiar ID del proyecto\n  };\n\n  // üÜï Funci√≥n para exportar piezas a Excel\n  const handleGuardarProyecto = () => {\n    if (piezas.length === 0) {\n      showNotification('warning', 'No hay piezas para exportar');\n      return;\n    }\n\n    try {\n      // Preparar datos para Excel\n      const datosExcel = piezas.map((pieza) => {\n        const largoInf = pieza.tapacantos.find(tc => tc.lado === 'largo_inf');\n        const largoSup = pieza.tapacantos.find(tc => tc.lado === 'largo_sup');\n        const anchoInf = pieza.tapacantos.find(tc => tc.lado === 'ancho_inf');\n        const anchoSup = pieza.tapacantos.find(tc => tc.lado === 'ancho_sup');\n\n        return {\n          'Descripci√≥n': pieza.descripcion || '',\n          'Material': pieza.material_codigo || '',\n          'Largo': pieza.largo,\n          'Ancho': pieza.ancho,\n          'Cantidad': pieza.cantidad,\n          'Veta': pieza.veta, // S, X o N\n          'Largo inferior': largoInf?.codigo || '',\n          'Largo superior': largoSup?.codigo || '',\n          'Ancho inferior': anchoInf?.codigo || '',\n          'Ancho superior': anchoSup?.codigo || '',\n          'CNC1': pieza.cnc1 || '',\n          'CNC2': pieza.cnc2 || ''\n        };\n      });\n\n      // Crear workbook\n      const ws = XLSX.utils.json_to_sheet(datosExcel);\n      const wb = XLSX.utils.book_new();\n      \n      // Ajustar anchos de columna\n      ws['!cols'] = [\n        { wch: 30 }, // Descripci√≥n\n        { wch: 15 }, // Material\n        { wch: 10 }, // Largo\n        { wch: 10 }, // Ancho\n        { wch: 10 }, // Cantidad\n        { wch: 8 },  // Veta\n        { wch: 15 }, // Largo inferior\n        { wch: 15 }, // Largo superior\n        { wch: 15 }, // Ancho inferior\n        { wch: 15 }, // Ancho superior\n        { wch: 20 }, // CNC1\n        { wch: 20 }  // CNC2\n      ];\n\n      XLSX.utils.book_append_sheet(wb, ws, 'Piezas');\n\n      // Generar nombre de archivo con fecha\n      const fecha = new Date().toISOString().split('T')[0];\n      const nombreArchivo = `Proyecto_Optimizador_${fecha}.xlsx`;\n\n      // Descargar archivo\n      XLSX.writeFile(wb, nombreArchivo);\n\n      showNotification('success', `Proyecto exportado: ${nombreArchivo}`);\n    } catch (error) {\n      console.error('Error exportando proyecto:', error);\n      showNotification('error', 'Error al exportar el proyecto');\n    }\n  };\n\n  // üÜï Funci√≥n para importar piezas desde Excel\n  const handleCargarProyecto = (piezasImportadas: PiezaCorte[]) => {\n    setPiezas(piezasImportadas);\n    setResultado(null);\n    showNotification('success', `Se cargaron ${piezasImportadas.length} piezas desde el archivo`);\n  };\n\n  return (\n    <OptimizadorLayout>\n      <div className=\"space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Optimizador de Cortes</h1>\n            <p className=\"text-sm text-gray-600 mt-1\">\n              Optimiza el corte de l√°minas para minimizar desperdicios\n            </p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            {/* üÜï Bot√≥n Crear Cotizaci√≥n */}\n            {resultado && (\n              <button \n                onClick={() => setShowCrearCotizacion(true)}\n                className=\"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors flex items-center gap-2 whitespace-nowrap\"\n              >\n                <i className=\"ri-file-text-line\"></i>\n                Crear Cotizaci√≥n\n              </button>\n            )}\n            \n            {/* üÜï Bot√≥n Guardar Proyecto (Exportar Excel) */}\n            <button \n              onClick={handleGuardarProyecto}\n              disabled={piezas.length === 0}\n              className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 whitespace-nowrap disabled:bg-gray-300 disabled:cursor-not-allowed\"\n            >\n              <i className=\"ri-file-excel-2-line\"></i>\n              Guardar Proyecto\n            </button>\n            \n            {/* üÜï Bot√≥n Cargar Proyecto (Importar Excel) */}\n            <ImportarExcelModal onImportar={handleCargarProyecto} />\n          </div>\n        </div>\n\n        {/* Selector de Modo */}\n        <SelectorModo modo={modo} onCambiarModo={handleCambiarModo} productoBOM={productoBOM} />\n\n        {/* Configuraci√≥n */}\n        <div className=\"bg-white rounded-lg shadow-sm border p-4\">\n          <button\n            onClick={() => setMostrarConfiguracion(!mostrarConfiguracion)}\n            className=\"w-full flex items-center justify-between text-left\"\n          >\n            <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n              <i className=\"ri-settings-3-line text-blue-600\"></i>\n              Configuraci√≥n de Corte\n            </h3>\n            <i className={`ri-arrow-${mostrarConfiguracion ? 'up' : 'down'}-s-line text-gray-600`}></i>\n          </button>\n          {mostrarConfiguracion && (\n            <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {/* Espesor de Sierra */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Espesor de Sierra (Kerf) - mm\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  min=\"0\"\n                  value={configuracion.espesor_sierra}\n                  onChange={(e) => setConfiguracion({ ...configuracion, espesor_sierra: parseFloat(e.target.value) || 0 })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  Espacio que ocupa la sierra al cortar. T√≠picamente 3-4 mm.\n                </p>\n              </div>\n\n              {/* Margen de Seguridad */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Margen de Seguridad - mm\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"1\"\n                  min=\"0\"\n                  value={configuracion.margen_seguridad}\n                  onChange={(e) => setConfiguracion({ ...configuracion, margen_seguridad: parseFloat(e.target.value) || 0 })}\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                />\n                <p className=\"text-xs text-gray-600 mt-1\">\n                  Espacio adicional entre piezas para evitar errores de corte.\n                </p>\n              </div>\n\n              {/* Permitir Rotaci√≥n */}\n              <div className=\"flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                <input\n                  type=\"checkbox\"\n                  id=\"permitir_rotacion\"\n                  checked={configuracion.permitir_rotacion}\n                  onChange={(e) => setConfiguracion({ ...configuracion, permitir_rotacion: e.target.checked })}\n                  className=\"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                />\n                <div className=\"flex-1\">\n                  <label htmlFor=\"permitir_rotacion\" className=\"block text-sm font-medium text-gray-900 cursor-pointer\">\n                    Permitir Rotaci√≥n de Piezas\n                  </label>\n                  <p className=\"text-xs text-gray-600 mt-1\">\n                    Permite rotar piezas 90¬∞ para mejor aprovechamiento.\n                  </p>\n                </div>\n              </div>\n\n              {/* Optimizar Desperdicio */}\n              <div className=\"flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200\">\n                <input\n                  type=\"checkbox\"\n                  id=\"optimizar_desperdicio\"\n                  checked={configuracion.optimizar_desperdicio}\n                  onChange={(e) => setConfiguracion({ ...configuracion, optimizar_desperdicio: e.target.checked })}\n                  className=\"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                />\n                <div className=\"flex-1\">\n                  <label htmlFor=\"optimizar_desperdicio\" className=\"block text-sm font-medium text-gray-900 cursor-pointer\">\n                    Optimizar Desperdicio\n                  </label>\n                  <p className=\"text-xs text-gray-600 mt-1\">\n                    Intenta minimizar el desperdicio agrupando piezas de forma m√°s eficiente.\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* üÜï LAYOUT REORGANIZADO: Ancho completo */}\n        <div className=\"space-y-6\">\n          {/* Editor de Piezas - Ancho completo */}\n          <div className=\"w-full\">\n            <EditorPiezas\n              modo={modo}\n              piezas={piezas}\n              laminaBase={null}\n              onCargarBOM={handleProductoBOMSelect}\n              onAgregarPieza={handleAgregarPieza}\n              onEditarPieza={handleEditarPieza}\n              onEliminarPieza={handleEliminarPieza}\n              onSeleccionarLamina={() => {}}\n              onLimpiar={handleLimpiar}\n            />\n          </div>\n\n          {/* Bot√≥n Optimizar */}\n          <div className=\"flex justify-center\">\n            <button\n              onClick={handleOptimizar}\n              disabled={piezas.length === 0 || loading}\n              className=\"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 text-lg font-semibold whitespace-nowrap\"\n            >\n              {loading ? (\n                <>\n                  <i className=\"ri-loader-4-line animate-spin\"></i>\n                  Optimizando...\n                </>\n              ) : (\n                <>\n                  <i className=\"ri-scissors-cut-line\"></i>\n                  Optimizar Cortes\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Visualizador de Cortes - Ancho completo */}\n          {resultado && (\n            <div className=\"w-full\">\n              <VisualizadorCortes\n                resultado={resultado}\n                configuracion={configuracion}\n              />\n            </div>\n          )}\n\n          {/* Panel de Resultados - Ancho completo, debajo del visualizador */}\n          {resultado && (\n            <div className=\"w-full\">\n              <PanelResultados\n                resultado={resultado}\n                onExportar={handleExportarExcel}\n              />\n            </div>\n          )}\n        </div>\n\n        {/* Modal de Exportar Excel */}\n        {showExport && resultado && (\n          <ExportarExcelModal\n            resultado={resultado}\n            piezas={piezas}\n            laminaBase={null}\n            onCerrar={() => setShowExport(false)}\n          />\n        )}\n\n        {/* üÜï Modal de Crear Cotizaci√≥n - Pasar proyectoId */}\n        {showCrearCotizacion && resultado && (\n          <CrearCotizacionModal\n            resultado={resultado}\n            piezas={piezas}\n            proyectoId={proyectoId}\n            onCerrar={() => setShowCrearCotizacion(false)}\n          />\n        )}\n      </div>\n    </OptimizadorLayout>\n  );\n}\n"],"names":["OptimizadorLayout","children","jsxs","jsx","Sidebar","TopBar","MobileNav","SelectorModo","modo","onCambiarModo","productoBOM","getProductos","filters","currentStore","query","supabase","data","error","SelectorProductoBOM","onSeleccionar","tiendaActual","useAuth","productos","setProductos","useState","busqueda","setBusqueda","loading","setLoading","useEffect","cargarProductos","productosFiltrados","p","e","producto","buscarArticulosInventario","search","tipo","searchTerm","item","categoriaIds","categoriasMap","categoriasData","cat","nombreCategoria","categoriaData","categoriaError","resultCodigo","resultDescripcion","combinedData","uniqueData","articulosValidos","tieneEspesor","tieneLargo","tieneAncho","l","tc","art","cargarPiezasDesdeBOM","productoId","bomItems","bomError","inv","largo","ancho","determinarVetaAutomatica","generarColorAleatorio","calcularDimensionesCorte","pieza","inventarioTapacantos","largoOriginal","anchoOriginal","ajusteLargo","ajusteAncho","grosor","largoCorte","anchoCorte","obtenerInfoTapacantos","codigosTapacantos","infoMap","codigo","info","optimizarCortes","piezas","config","piezasConDimensionesCorte","erroresValidacion","resultado","piezaActualizada","mensajeError","piezasPorMaterial","resultadosPorMaterial","todasLasLaminas","todasPiezasSinAsignar","contadorLaminasGlobal","piezasDelMaterial","codigoMaterial","primeraPieza","laminaBaseMaterial","laminas","piezasSinAsignar","optimizarGrupoDePiezas","totalLaminas","areaTotalUtilizada","sum","areaTotalSobrante","porcentajePromedio","costoTotalLaminas","piezasValidasTotal","calcularResultadoGlobal","crearNuevaLamina","id","laminaBase","calcularMetricasLamina","lamina","areaTotal","areaUtilizada","costoPiezas","piezaLargo","piezaAncho","areaPieza","calcularCostosPieza","areaLamina","costoTapacanto","segundosCorte","costoHHPorSegundo","porcentajeGlobal","costoTotalMateriales","costoTotalTapacantos","costoTotalHH","costoTotal","colores","contadorInicial","laminaCounter","ladoLargoLamina","ladoCortoLamina","piezasExpandidas","i","piezasValidas","piezasInvalidas","espacioCorte","largoParaValidar","anchoParaValidar","ladoLargoPieza","ladoCortoPieza","esValida","razonInvalida","piezasOrdenadas","a","b","areaA","iteracion","MAX_ITERACIONES","laminasSinPiezas","MAX_LAMINAS_VACIAS","colocarPiezasEnLamina","laminaMinima","piezasColocadas","espaciosLibres","intentosSinExito","MAX_INTENTOS","piezaColocada","mejorEspacio","mejorDesperdicio","mejorRotacion","j","espacio","orientacionesPermitidas","obtenerOrientacionesPermitidas","orientacion","piezaLargoConEspacio","piezaAnchoConEspacio","desperdicio","rotada","espacioDerechaAncho","espacioArribaAlto","orientaciones","BuscadorArticuloBlur","tipoArticulo","onCancelar","placeholder","permitirLimpiar","onLimpiar","articulos","setArticulos","mostrarResultados","setMostrarResultados","busquedaRealizada","setBusquedaRealizada","inputRef","useRef","containerRef","timer","buscarArticulos","handleClickOutside","event","handleSeleccionar","articulo","handleKeyDown","TablaPiezas","onEditar","onEliminar","onDuplicar","editandoIndex","setEditandoIndex","editandoCampo","setEditandoCampo","handleCambiarValor","index","campo","valor","piezaActual","piezaEditada","handleSeleccionarMaterial","handleSeleccionarTapacanto","lado","tapacantos","indiceTC","handleSeleccionarCNC","obtenerTapacanto","handleDuplicar","calcularDimensionesCorteEstimadas","totalPiezas","area","getVetaIcon","direccion","vetaInfo","dimensionesCorte","tieneAjuste","Fragment","COLORES_PIEZAS","ImportarExcelModal","onImportar","showNotification","useNotification","mostrarModal","setMostrarModal","archivo","setArchivo","previsualizacion","setPrevisualizacion","cargando","setCargando","handleSeleccionarArchivo","file","leerArchivo","reader","workbook","XLSX.read","sheetName","worksheet","jsonData","XLSX.utils","handleImportar","normalizarCodigo","str","codigosMateriales","codigosCNC","row","materialCodigo","tcSup","tcInf","tcIzq","tcDer","cnc1","cnc2","materialesMap","materiales","materialExacto","m","c","tapacantosMap","tapacantoExacto","cncMap","todosCNC","errorCNC","cnc","piezasImportadas","descripcion","cantidad","veta","cnc1Codigo","cnc1Cantidad","cnc2Codigo","cnc2Cantidad","material","tapacanto","vetaNormalizada","vetaStr","color","mensajeErrores","mensajeCompleto","descargarPlantilla","plantilla","ws","wb","XLSX.writeFile","key","value","EditorPiezas","onCargarBOM","onAgregarPieza","onEditarPieza","onEliminarPieza","onSeleccionarLamina","showImportModal","setShowImportModal","React","handleDuplicarPieza","piezaOriginal","piezaDuplicada","handleAgregarNuevaPieza","colorAleatorio","nuevaPieza","handleImportarPiezas","VisualizadorCortes","canvasRef","laminaSeleccionada","setLaminaSeleccionada","laminaActual","contadorLaminas","resultadoMaterial","dibujarLamina","canvas","ctx","canvasWidth","canvasHeight","padding","escalaX","escalaY","escala","laminaWidth","laminaHeight","offsetX","offsetY","areasOcupadas","piezasDibujadas","x","y","w","numLineas","lineaY","lineaX","flechaSize","flechaX","flechaY","arrowY","arrowX","sobrantes","piezaMasDerecha","max","derechaX","derechaW","piezaMasAlta","superiorY","superiorH","s","sobrante","sx","sy","sw","sh","h","totalLaminasReal","r","laminaActualParaLista","PanelResultados","onExportar","materialResult","formatCurrency","ExportarExcelModal","onCerrar","nombreArchivo","setNombreArchivo","exportando","setExportando","exportarExcel","resumenData","wsResumen","detallePiezasData","largoInf","largoSup","anchoInf","anchoSup","totalM2","totalTapacantos","totalHH","totalCosto","wsDetalle","detalleLaminasData","wsLaminas","sinAsignarData","wsSinAsignar","guardarProyectoOptimizador","proyecto","userData","tiendaData","obtenerProyectoActivo","marcarProyectoCotizado","id_proyecto","id_cotizacion","CrearCotizacionModal","proyectoId","navigate","useNavigate","clienteSeleccionado","setClienteSeleccionado","mostrarBuscarCliente","setMostrarBuscarCliente","moneda","setMoneda","tipoCambio","setTipoCambio","margenUtilidad","setMargenUtilidad","diasVencimiento","setDiasVencimiento","notasAdicionales","setNotasAdicionales","itemsAdicionales","setItemsAdicionales","handleSeleccionarCliente","cliente","handleAgregarItemAdicional","nuevoItem","handleActualizarCantidadItem","itemId","nuevaCantidad","handleActualizarPrecioItem","nuevoPrecio","handleEliminarItemAdicional","calcularPrecioConMargen","costo","currency","handleCrearCotizacion","preciosCNCMap","inventarioCNC","costoTotalCNC","itemsOptimizador","costoMaterial","costoTapacantos","parseCNC","cncValue","parts","costoCNC","precioCNC1","precioCNC2","precioConMargen","tapacantosSup","tapacantosInf","tapacantosIzq","tapacantosDer","itemsInventario","subtotalOptimizador","subtotalInventario","subtotal","totalImpuestos","total","notas","cotizacionData","cotizacionCreada","CotizacionService","precioTotalOptimizador","subtotalItemsAdicionales","impuestos","totalFinal","BuscarClienteModal","OptimizadorPage","user","setModo","setPiezas","configuracion","setConfiguracion","setResultado","mostrarConfiguracion","setMostrarConfiguracion","showExport","setShowExport","showCrearCotizacion","setShowCrearCotizacion","setProductoBOM","setProyectoId","cargarProyectoActivo","piezasConvertidas","guardarProyectoAutomaticamente","piezasParaBD","resultadosParaBD","rm","resumen","respuesta","handleCambiarModo","nuevoModo","handleProductoBOMSelect","productoNombre","handleExportarExcel","handleAgregarPieza","handleEditarPieza","nuevasPiezas","handleEliminarPieza","_","handleOptimizar","piezasSinMaterial","piezasSinDimensiones","resultadoOptimizacion","handleLimpiar","handleGuardarProyecto","datosExcel","handleCargarProyecto"],"mappings":"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"}