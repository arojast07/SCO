{"version":3,"file":"page-Ds07GqrT.js","sources":["../../src/types/pedido.ts","../../src/pages/pedidos/components/PedidosTable.tsx","../../src/pages/pedidos/components/PedidosFilters.tsx","../../src/pages/cotizaciones/components/BuscarProductoModal.tsx","../../src/pages/pedidos/components/PedidoForm.tsx","../../src/components/facturacion/ModalFacturarPedido.tsx","../../src/hooks/useAdvancedPermissions.ts","../../src/hooks/useRobustPermissions.ts","../../src/pages/pedidos/page.tsx"],"sourcesContent":["export interface Pedido {\n  id: number;\n  codigo: string;\n  cliente_id: number;\n  cliente?: {\n    id: number;\n    nombre: string;\n    nombre_razon_social?: string;\n    identificacion: string;\n    email?: string;\n    telefono?: string;\n    direccion?: string;\n  };\n  moneda: string;\n  tipo_cambio: number;\n  estado: 'borrador' | 'confirmado' | 'facturado' | 'cancelado' | 'vencido';\n  referencia_cotizacion_id?: number;\n  cotizacion?: {\n    id: number;\n    numero_cotizacion: string;\n  };\n  factura_id?: number;\n  factura_estado_hacienda?: string;\n  notas?: string;\n  subtotal: number;\n  descuento_total: number;\n  impuesto_total: number;\n  total: number;\n  created_by: number;\n  approved_by?: number;\n  confirmado_at?: string;\n  facturado_at?: string;\n  cancelado_at?: string;\n  created_at: string;\n  updated_at: string;\n  items: PedidoItem[];\n}\n\nexport interface PedidoItem {\n  id?: number;\n  pedido_id?: number;\n  item_type: 'inventario' | 'producto' | 'servicio';\n  item_id?: number;\n  codigo_articulo?: string;\n  descripcion: string;\n  unidad: string;\n  cantidad: number;\n  precio_unitario: number;\n  descuento_porcentaje: number;\n  descuento_monto: number;\n  impuesto_porcentaje: number;\n  impuesto_monto: number;\n  subtotal_linea: number;\n  total_linea: number;\n  meta_json?: {\n    bom_items?: Array<{\n      id: number;\n      codigo: string;\n      descripcion: string;\n      cantidad_por_unidad: number;\n      cantidad_total: number;\n      unidad: string;\n      precio_unitario: number;\n      total: number;\n    }>;\n  };\n}\n\nexport interface InventarioReserva {\n  id: number;\n  articulo_id: number;\n  articulo?: {\n    codigo: string;\n    descripcion: string;\n    unidad: string;\n    stock_actual: number;\n  };\n  pedido_id?: number;\n  cotizacion_id?: number;\n  cantidad: number;\n  cantidad_consumida: number;\n  vence_at: string;\n  estado: 'activa' | 'liberada' | 'consumida';\n  notas?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface CreatePedidoRequest {\n  cliente_id: number;\n  moneda?: string;\n  tipo_cambio?: number;\n  referencia_cotizacion_id?: number;\n  notas?: string;\n  items: Omit<PedidoItem, 'id' | 'pedido_id' | 'subtotal_linea' | 'total_linea' | 'descuento_monto' | 'impuesto_monto'>[];\n}\n\nexport interface UpdatePedidoRequest extends Partial<CreatePedidoRequest> {\n  id: number;\n}\n\nexport interface PedidoFilters {\n  cliente_id?: number;\n  estado?: string;\n  fecha_desde?: string;\n  fecha_hasta?: string;\n  search?: string;\n}\n\nexport const ESTADOS_PEDIDO = {\n  borrador: { label: 'Borrador', color: 'bg-gray-100 text-gray-800' },\n  confirmado: { label: 'Confirmado', color: 'bg-blue-100 text-blue-800' },\n  facturado: { label: 'Facturado', color: 'bg-green-100 text-green-800' },\n  cancelado: { label: 'Cancelado', color: 'bg-red-100 text-red-800' },\n  vencido: { label: 'Vencido', color: 'bg-orange-100 text-orange-800' }\n} as const;","import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { formatCurrency } from '../../../lib/currency';\nimport { ESTADOS_PEDIDO, type Pedido } from '../../../types/pedido';\nimport { supabase } from '../../../lib/supabase';\n\ninterface PedidosTableProps {\n  pedidos: Pedido[];\n  loading: boolean;\n  onEdit: (pedido: Pedido) => void;\n  onConfirmar: (id: number) => void;\n  onCancelar: (id: number) => void;\n  onFacturar: (pedido: Pedido) => void;\n}\n\nexport default function PedidosTable({ \n  pedidos, \n  loading, \n  onEdit, \n  onConfirmar, \n  onCancelar, \n  onFacturar \n}: PedidosTableProps) {\n  const navigate = useNavigate();\n  const [showPrintWarning, setShowPrintWarning] = useState(false);\n  const [warningMessage, setWarningMessage] = useState('');\n  const [checkingFactura, setCheckingFactura] = useState(false);\n\n  const handlePrint = async (pedido: Pedido) => {\n    // Si el pedido est√° facturado, verificar el estado de Hacienda\n    if (pedido.estado === 'facturado' && pedido.factura_id) {\n      try {\n        setCheckingFactura(true);\n\n        // Obtener el estado actual de la factura desde la base de datos\n        const { data: factura, error } = await supabase\n          .from('facturas_electronicas')\n          .select('id, consecutivo, clave, estado_local, estado_hacienda')\n          .eq('id', pedido.factura_id)\n          .single();\n\n        if (error) {\n          console.error('Error obteniendo factura:', error);\n          setWarningMessage('Error al verificar el estado de la factura. Por favor intente nuevamente.');\n          setShowPrintWarning(true);\n          setCheckingFactura(false);\n          return;\n        }\n\n        if (!factura) {\n          setWarningMessage('No se encontr√≥ la factura asociada a este pedido.');\n          setShowPrintWarning(true);\n          setCheckingFactura(false);\n          return;\n        }\n\n        // Verificar si la factura fue aprobada por Hacienda\n        const estadosAprobados = ['aceptado', 'aceptada', 'aprobado', 'aprobada'];\n        const facturaAprobada = estadosAprobados.includes(factura.estado_hacienda?.toLowerCase() || '');\n\n        if (facturaAprobada) {\n          // Navegar a la p√°gina de impresi√≥n de factura en la misma pesta√±a\n          navigate(`/facturacion/${pedido.factura_id}/print`);\n        } else {\n          // Mostrar advertencia\n          setWarningMessage(\n            `Por favor revisar el estatus de la factura. Se puede imprimir una vez sea aprobada por Hacienda.\\n\\nEstado actual: ${factura.estado_hacienda || factura.estado_local || 'Pendiente'}\\nConsecutivo: ${factura.consecutivo || 'N/A'}`\n          );\n          setShowPrintWarning(true);\n        }\n\n        setCheckingFactura(false);\n      } catch (error) {\n        console.error('Error verificando factura:', error);\n        setWarningMessage('Error al verificar el estado de la factura. Por favor intente nuevamente.');\n        setShowPrintWarning(true);\n        setCheckingFactura(false);\n      }\n    } else {\n      // Si no est√° facturado, navegar a la p√°gina de impresi√≥n del pedido\n      navigate(`/pedidos/${pedido.id}/print`);\n    }\n  };\n\n  const handleDelete = (pedidoId: number) => {\n    if (window.confirm('¬øEst√°s seguro de que deseas eliminar este pedido?')) {\n      // Aqu√≠ ir√≠a la l√≥gica de eliminaci√≥n\n      console.log('Eliminar pedido:', pedidoId);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <div className=\"animate-pulse space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <div key={i} className=\"h-12 bg-gray-200 rounded\"></div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (pedidos.length === 0) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6 text-center\">\n        <div className=\"text-gray-500\">\n          <i className=\"ri-file-list-3-line text-4xl mb-4\"></i>\n          <p>No hay pedidos registrados</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Pedido\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Cliente\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Estado\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Total\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Fecha\n                </th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Acciones\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"bg-white divide-y divide-gray-200\">\n              {pedidos.map((pedido) => (\n                <tr key={pedido.id} className=\"hover:bg-gray-50\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                    {pedido.codigo}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div>\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {pedido.cliente?.nombre_razon_social || pedido.cliente?.nombre || 'Sin cliente'}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {pedido.cliente?.identificacion || 'Sin identificaci√≥n'}\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${ESTADOS_PEDIDO[pedido.estado].color}`}>\n                      {ESTADOS_PEDIDO[pedido.estado].label}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                    {formatCurrency(pedido.total, pedido.moneda)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                    {new Date(pedido.created_at).toLocaleDateString()}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <div className=\"flex items-center justify-end space-x-2\">\n                      {/* Bot√≥n Editar - Solo si est√° en borrador o confirmado */}\n                      {(pedido.estado === 'borrador' || pedido.estado === 'confirmado') && (\n                        <button\n                          onClick={() => onEdit(pedido)}\n                          className=\"text-blue-600 hover:text-blue-900 p-2 rounded hover:bg-blue-50 transition-colors cursor-pointer\"\n                          title=\"Editar pedido\"\n                        >\n                          <i className=\"ri-edit-line text-lg\"></i>\n                        </button>\n                      )}\n\n                      {/* Bot√≥n Imprimir */}\n                      <button\n                        onClick={() => handlePrint(pedido)}\n                        disabled={checkingFactura}\n                        className={`p-2 rounded transition-colors cursor-pointer ${\n                          checkingFactura \n                            ? 'text-gray-400 cursor-not-allowed' \n                            : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\n                        }`}\n                        title={pedido.estado === 'facturado' ? 'Imprimir factura' : 'Imprimir pedido'}\n                      >\n                        {checkingFactura ? (\n                          <i className=\"ri-loader-4-line text-lg animate-spin\"></i>\n                        ) : (\n                          <i className=\"ri-printer-line text-lg\"></i>\n                        )}\n                      </button>\n\n                      {/* Bot√≥n Confirmar - Solo si est√° en borrador */}\n                      {pedido.estado === 'borrador' && (\n                        <button\n                          onClick={() => onConfirmar(pedido.id)}\n                          className=\"text-green-600 hover:text-green-900 p-2 rounded hover:bg-green-50 transition-colors cursor-pointer\"\n                          title=\"Confirmar pedido\"\n                        >\n                          <i className=\"ri-check-line text-lg\"></i>\n                        </button>\n                      )}\n\n                      {/* Bot√≥n Facturar - Solo si est√° confirmado */}\n                      {pedido.estado === 'confirmado' && (\n                        <button\n                          onClick={() => onFacturar(pedido)}\n                          className=\"text-emerald-600 hover:text-emerald-900 p-2 rounded hover:bg-emerald-50 transition-colors cursor-pointer\"\n                          title=\"Facturar pedido\"\n                        >\n                          <i className=\"ri-bill-line text-lg\"></i>\n                        </button>\n                      )}\n\n                      {/* Bot√≥n Cancelar - Solo si est√° en borrador o confirmado */}\n                      {(pedido.estado === 'borrador' || pedido.estado === 'confirmado') && (\n                        <button\n                          onClick={() => onCancelar(pedido.id)}\n                          className=\"text-orange-600 hover:text-orange-900 p-2 rounded hover:bg-orange-50 transition-colors cursor-pointer\"\n                          title=\"Cancelar pedido\"\n                        >\n                          <i className=\"ri-close-line text-lg\"></i>\n                        </button>\n                      )}\n\n                      {/* Bot√≥n Eliminar - Solo si est√° en borrador o cancelado */}\n                      {(pedido.estado === 'borrador' || pedido.estado === 'cancelado') && (\n                        <button\n                          onClick={() => handleDelete(pedido.id)}\n                          className=\"text-red-600 hover:text-red-900 p-2 rounded hover:bg-red-50 transition-colors cursor-pointer\"\n                          title=\"Eliminar pedido\"\n                        >\n                          <i className=\"ri-delete-bin-line text-lg\"></i>\n                        </button>\n                      )}\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Modal de advertencia para impresi√≥n */}\n      {showPrintWarning && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6\">\n            <div className=\"flex items-start mb-4\">\n              <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0\">\n                <i className=\"ri-error-warning-line text-2xl text-yellow-600\"></i>\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Factura Pendiente de Aprobaci√≥n</h3>\n                <p className=\"text-gray-600 whitespace-pre-line\">{warningMessage}</p>\n              </div>\n            </div>\n            <div className=\"flex justify-end mt-6\">\n              <button\n                onClick={() => setShowPrintWarning(false)}\n                className=\"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors cursor-pointer whitespace-nowrap\"\n              >\n                Entendido\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport type { PedidoFilters } from '../../../types/pedido';\n\ninterface PedidosFiltersProps {\n  filters: PedidoFilters;\n  onFiltersChange: (filters: PedidoFilters) => void;\n}\n\nexport default function PedidosFilters({ filters, onFiltersChange }: PedidosFiltersProps) {\n  const [clientes, setClientes] = useState<Array<{ id: number; nombre_razon_social: string }>>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    loadClientes();\n  }, []);\n\n  const loadClientes = async () => {\n    setLoading(true);\n    try {\n      const { data, error } = await supabase\n        .from('clientes')\n        .select('id, nombre_razon_social')\n        .order('nombre_razon_social');\n\n      if (error) throw error;\n      setClientes(data || []);\n    } catch (error) {\n      console.error('Error al cargar clientes:', error);\n      // Optionally add user notification here\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFilterChange = (key: keyof PedidoFilters, value: string) => {\n    const newFilters = {\n      ...filters,\n      [key]: value || undefined\n    };\n    onFiltersChange(newFilters);\n  };\n\n  const clearFilters = () => {\n    onFiltersChange({});\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg shadow p-4\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n        {/* B√∫squeda */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Buscar\n          </label>\n          <div className=\"relative\">\n            <input\n              type=\"text\"\n              value={filters.search || ''}\n              onChange={(e) => handleFilterChange('search', e.target.value)}\n              placeholder=\"C√≥digo, notas...\"\n              className=\"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            />\n            <i className=\"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\"></i>\n          </div>\n        </div>\n\n        {/* Cliente */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Cliente\n          </label>\n          <select\n            value={filters.cliente_id || ''}\n            onChange={(e) => handleFilterChange('cliente_id', e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            disabled={loading}\n          >\n            <option value=\"\">Todos los clientes</option>\n            {clientes.map((cliente) => (\n              <option key={cliente.id} value={cliente.id}>\n                {cliente.nombre_razon_social}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        {/* Estado */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Estado\n          </label>\n          <select\n            value={filters.estado || ''}\n            onChange={(e) => handleFilterChange('estado', e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          >\n            <option value=\"\">Todos los estados</option>\n            <option value=\"borrador\">Borrador</option>\n            <option value=\"confirmado\">Confirmado</option>\n            <option value=\"facturado\">Facturado</option>\n            <option value=\"cancelado\">Cancelado</option>\n            <option value=\"vencido\">Vencido</option>\n          </select>\n        </div>\n\n        {/* Fecha desde */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Fecha desde\n          </label>\n          <input\n            type=\"date\"\n            value={filters.fecha_desde || ''}\n            onChange={(e) => handleFilterChange('fecha_desde', e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        </div>\n\n        {/* Fecha hasta */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n            Fecha hasta\n          </label>\n          <input\n            type=\"date\"\n            value={filters.fecha_hasta || ''}\n            onChange={(e) => handleFilterChange('fecha_hasta', e.target.value)}\n            min={filters.fecha_desde || undefined}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        </div>\n      </div>\n\n      {/* Bot√≥n limpiar filtros */}\n      <div className=\"mt-4 flex justify-end\">\n        <button\n          onClick={clearFilters}\n          className=\"text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          <i className=\"ri-close-line\"></i>\n          Limpiar filtros\n        </button>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\n\ninterface BuscarProductoModalProps {\n  onSelect: (producto: any) => void;\n  onClose: () => void;\n}\n\nexport function BuscarProductoModal({ onSelect, onClose }: BuscarProductoModalProps) {\n  const [productos, setProductos] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [busqueda, setBusqueda] = useState('');\n  const [categoria, setCategoria] = useState('');\n  const [categorias, setCategorias] = useState<any[]>([]);\n\n  useEffect(() => {\n    cargarCategorias();\n    cargarProductos();\n  }, []);\n\n  useEffect(() => {\n    cargarProductos();\n  }, [busqueda, categoria]);\n\n  const cargarCategorias = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('categorias')\n        .select('id, nombre')\n        .order('nombre');\n\n      if (error) throw error;\n      setCategorias(data || []);\n    } catch (error) {\n      console.error('Error cargando categor√≠as:', error);\n    }\n  };\n\n  const cargarProductos = async () => {\n    try {\n      setLoading(true);\n      let query = supabase\n        .from('productos')\n        .select('id_producto, codigo_producto, descripcion_producto, categoria_id, costo_total_bom')\n        .eq('activo', true);\n\n      if (busqueda.trim()) {\n        query = query.or(`codigo_producto.ilike.%${busqueda}%,descripcion_producto.ilike.%${busqueda}%`);\n      }\n\n      if (categoria) {\n        query = query.eq('categoria_id', categoria);\n      }\n\n      const { data, error } = await query.limit(50);\n\n      if (error) throw error;\n      setProductos(data || []);\n    } catch (error) {\n      console.error('Error cargando productos:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden\">\n        <div className=\"p-6 border-b border-gray-200\">\n          <div className=\"flex justify-between items-center\">\n            <h2 className=\"text-xl font-semibold text-gray-900\">Buscar Producto</h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-600 cursor-pointer\"\n            >\n              <i className=\"ri-close-line text-xl\"></i>\n            </button>\n          </div>\n        </div>\n\n        <div className=\"p-6\">\n          {/* Filtros */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Buscar por c√≥digo o nombre\n              </label>\n              <div className=\"relative\">\n                <input\n                  type=\"text\"\n                  value={busqueda}\n                  onChange={(e) => setBusqueda(e.target.value)}\n                  placeholder=\"Escriba para buscar...\"\n                  className=\"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                />\n                <i className=\"ri-search-line absolute left-3 top-2.5 text-gray-400 text-sm\"></i>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Categor√≠a\n              </label>\n              <select\n                value={categoria}\n                onChange={(e) => setCategoria(e.target.value)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm pr-8\"\n              >\n                <option value=\"\">Todas las categor√≠as</option>\n                {categorias.map((cat) => (\n                  <option key={cat.id} value={cat.id}>\n                    {cat.nombre}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          {/* Lista de productos */}\n          <div className=\"border border-gray-200 rounded-lg overflow-hidden max-h-96 overflow-y-auto\">\n            {loading ? (\n              <div className=\"p-8 text-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n                <p className=\"mt-2 text-gray-600\">Cargando productos...</p>\n              </div>\n            ) : productos.length === 0 ? (\n              <div className=\"p-8 text-center\">\n                <i className=\"ri-inbox-line text-4xl text-gray-400 mb-4\"></i>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No hay productos</h3>\n                <p className=\"text-gray-600\">No se encontraron productos con los criterios de b√∫squeda.</p>\n              </div>\n            ) : (\n              <table className=\"min-w-full divide-y divide-gray-200\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                      C√≥digo\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                      Descripci√≥n\n                    </th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">\n                      Precio\n                    </th>\n                    <th className=\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase\">\n                      Acci√≥n\n                    </th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {productos.map((producto) => (\n                    <tr key={producto.id_producto} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{producto.codigo_producto}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{producto.descripcion_producto}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">\n                        ${(producto.costo_total_bom || 0).toLocaleString('es-CR', { minimumFractionDigits: 2 })}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-center\">\n                        <button\n                          onClick={() => onSelect(producto)}\n                          className=\"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 cursor-pointer whitespace-nowrap\"\n                        >\n                          Seleccionar\n                        </button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../../lib/supabase';\nimport { pedidoService } from '../../../services/pedidoService';\nimport { CotizacionService } from '../../../services/cotizacionService';\nimport { BuscarClienteModal } from '../../clientes/components/BuscarClienteModal';\nimport { BuscarProductoModal } from '../../cotizaciones/components/BuscarProductoModal';\nimport { formatCurrency } from '../../../lib/currency';\nimport type { Pedido, PedidoItem, CreatePedidoRequest, UpdatePedidoRequest } from '../../../types/pedido';\n\ninterface PedidoFormProps {\n  pedido?: Pedido | null;\n  onSave: () => void;\n  onCancel: () => void;\n}\n\nexport function PedidoForm({ pedido, onSave, onCancel }: PedidoFormProps) {\n  const [formData, setFormData] = useState({\n    cliente_id: 0,\n    moneda: 'CRC',\n    tipo_cambio: 520.0,\n    notas: '',\n    items: [] as PedidoItem[]\n  });\n  \n  const [cliente, setCliente] = useState<any>(null);\n  const [showClienteModal, setShowClienteModal] = useState(false);\n  const [showProductoModal, setShowProductoModal] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [actualizandoTipoCambio, setActualizandoTipoCambio] = useState(false);\n  const [mensajeTipoCambio, setMensajeTipoCambio] = useState('Tipo de cambio seg√∫n Banco Central de Costa Rica (BCCR). Haga clic en actualizar para obtener el valor m√°s reciente.');\n  const [totales, setTotales] = useState({\n    subtotal: 0,\n    descuento_total: 0,\n    impuesto_total: 0,\n    total: 0\n  });\n\n  useEffect(() => {\n    // Obtener tipo de cambio autom√°ticamente al cargar\n    obtenerTipoCambio();\n    \n    if (pedido) {\n      // Mapear correctamente los items del pedido\n      const itemsMapeados = (pedido.items || []).map(item => ({\n        item_type: item.item_type || 'producto',\n        item_id: item.item_id || 0,\n        codigo_articulo: item.codigo_articulo || '',\n        descripcion: item.descripcion || 'Sin descripci√≥n',\n        unidad: item.unidad || 'UND',\n        cantidad: item.cantidad || 1,\n        precio_unitario: item.precio_unit || item.precio_unitario || 0,\n        descuento_porcentaje: item.descuento_pct || item.descuento_porcentaje || 0,\n        descuento_monto: 0,\n        impuesto_porcentaje: item.impuesto_pct || item.impuesto_porcentaje || 13,\n        impuesto_monto: 0,\n        subtotal_linea: item.total || item.total_linea || 0,\n        total_linea: item.total || item.total_linea || 0,\n        meta_json: item.meta_json\n      }));\n\n      setFormData({\n        cliente_id: pedido.cliente_id,\n        moneda: pedido.moneda,\n        tipo_cambio: pedido.tipo_cambio,\n        notas: pedido.notas || '',\n        items: itemsMapeados\n      });\n      setCliente(pedido.cliente);\n    }\n  }, [pedido]);\n\n  useEffect(() => {\n    calculateTotales();\n  }, [formData.items]);\n\n  // Funci√≥n para obtener tipo de cambio del BCCR\n  const obtenerTipoCambio = async () => {\n    try {\n      setActualizandoTipoCambio(true);\n      \n      // Usar el mismo m√©todo que cotizaciones para obtener tipo de cambio del BCCR\n      const tipoCambio = await CotizacionService.obtenerTipoCambioBCCR();\n      \n      setFormData(prev => ({\n        ...prev,\n        tipo_cambio: tipoCambio\n      }));\n      \n      // Actualizar el mensaje informativo\n      setMensajeTipoCambio(`üí∞ Tipo de cambio actualizado seg√∫n BCCR: ‚Ç°${tipoCambio.toFixed(2)} por USD`);\n    } catch (error) {\n      console.error('Error obteniendo tipo de cambio:', error);\n      setMensajeTipoCambio('‚ùå Error al obtener tipo de cambio del BCCR. Usando valor por defecto.');\n    } finally {\n      setActualizandoTipoCambio(false);\n    }\n  };\n\n  const calculateTotales = () => {\n    let subtotal = 0;\n    let descuento_total = 0;\n    let impuesto_total = 0;\n\n    formData.items.forEach(item => {\n      const itemSubtotal = item.cantidad * item.precio_unitario;\n      const itemDescuento = itemSubtotal * (item.descuento_porcentaje / 100);\n      const itemSubtotalConDescuento = itemSubtotal - itemDescuento;\n      const itemImpuesto = itemSubtotalConDescuento * (item.impuesto_porcentaje / 100);\n\n      subtotal += itemSubtotal;\n      descuento_total += itemDescuento;\n      impuesto_total += itemImpuesto;\n    });\n\n    const total = subtotal - descuento_total + impuesto_total;\n\n    setTotales({\n      subtotal,\n      descuento_total,\n      impuesto_total,\n      total\n    });\n  };\n\n  const handleClienteSelect = (clienteSeleccionado: any) => {\n    setCliente(clienteSeleccionado);\n    setFormData(prev => ({\n      ...prev,\n      cliente_id: clienteSeleccionado.id\n    }));\n    setShowClienteModal(false);\n  };\n\n  const handleProductoSelect = async (producto: any) => {\n    try {\n      console.log('Producto seleccionado:', producto);\n      \n      // Obtener componentes BOM si es un producto\n      let bomItems = [];\n      if (producto.tipo === 'producto' || producto.id_producto) {\n        const { data: bom, error } = await supabase\n          .from('bom_items')\n          .select(`\n            *,\n            articulo:inventario(codigo, descripcion, unidad, precio_venta)\n          `)\n          .eq('producto_id', producto.id_producto || producto.id);\n\n        if (!error && bom) {\n          bomItems = bom.map((bomItem: any) => ({\n            id: bomItem.articulo_id,\n            codigo: bomItem.articulo.codigo,\n            descripcion: bomItem.articulo.descripcion,\n            cantidad_por_unidad: bomItem.cantidad,\n            cantidad_total: bomItem.cantidad * 1,\n            unidad: bomItem.articulo.unidad,\n            precio_unitario: bomItem.articulo.precio_venta || 0,\n            total: (bomItem.articulo.precio_venta || 0) * bomItem.cantidad\n          }));\n        }\n      }\n\n      // Mapear correctamente los campos del producto\n      const nuevoItem: PedidoItem = {\n        item_type: producto.tipo === 'producto' || producto.id_producto ? 'producto' : 'inventario',\n        item_id: producto.id_producto || producto.id,\n        codigo_articulo: producto.codigo_producto || producto.codigo || '',\n        descripcion: producto.descripcion_producto || producto.descripcion || producto.nombre || 'Sin descripci√≥n',\n        unidad: producto.unidad || 'UND',\n        cantidad: 1,\n        precio_unitario: producto.costo_total_bom || producto.precio_venta || 0,\n        descuento_porcentaje: 0,\n        descuento_monto: 0,\n        impuesto_porcentaje: 13,\n        impuesto_monto: 0,\n        subtotal_linea: producto.costo_total_bom || producto.precio_venta || 0,\n        total_linea: (producto.costo_total_bom || producto.precio_venta || 0) * 1.13,\n        meta_json: bomItems.length > 0 ? { bom_items: bomItems } : undefined\n      };\n\n      console.log('Nuevo item creado:', nuevoItem);\n\n      setFormData(prev => ({\n        ...prev,\n        items: [...prev.items, nuevoItem]\n      }));\n    } catch (error) {\n      console.error('Error al agregar producto:', error);\n      alert('Error al agregar producto: ' + (error as Error).message);\n    }\n    setShowProductoModal(false);\n  };\n\n  const updateItem = (index: number, field: keyof PedidoItem, value: any) => {\n    const newItems = [...formData.items];\n    newItems[index] = { ...newItems[index], [field]: value };\n\n    // Recalcular totales del item\n    const item = newItems[index];\n    const itemSubtotal = item.cantidad * item.precio_unitario;\n    const itemDescuento = itemSubtotal * (item.descuento_porcentaje / 100);\n    const itemSubtotalConDescuento = itemSubtotal - itemDescuento;\n    const itemImpuesto = itemSubtotalConDescuento * (item.impuesto_porcentaje / 100);\n\n    newItems[index].subtotal_linea = itemSubtotal;\n    newItems[index].descuento_monto = itemDescuento;\n    newItems[index].impuesto_monto = itemImpuesto;\n    newItems[index].total_linea = itemSubtotalConDescuento + itemImpuesto;\n\n    // Actualizar cantidades BOM si aplica\n    if (field === 'cantidad' && item.meta_json?.bom_items) {\n      const updatedBomItems = item.meta_json.bom_items.map(bomItem => ({\n        ...bomItem,\n        cantidad_total: bomItem.cantidad_por_unidad * item.cantidad,\n        total: bomItem.precio_unitario * bomItem.cantidad_por_unidad * item.cantidad\n      }));\n      newItems[index].meta_json = { bom_items: updatedBomItems };\n    }\n\n    setFormData(prev => ({\n      ...prev,\n      items: newItems\n    }));\n  };\n\n  const removeItem = (index: number) => {\n    setFormData(prev => ({\n      ...prev,\n      items: prev.items.filter((_, i) => i !== index)\n    }));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.cliente_id) {\n      alert('Debe seleccionar un cliente');\n      return;\n    }\n\n    if (formData.items.length === 0) {\n      alert('Debe agregar al menos un art√≠culo');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const createData = {\n        cliente_id: formData.cliente_id,\n        moneda: formData.moneda,\n        tipo_cambio: formData.tipo_cambio,\n        notas: formData.notas,\n        subtotal: totales.subtotal,\n        descuento_total: totales.descuento_total,\n        impuesto_total: totales.impuesto_total,\n        total: totales.total,\n        items: formData.items.map(item => ({\n          item_type: item.item_type,\n          item_id: item.item_id,\n          descripcion: item.descripcion || 'Sin descripci√≥n',\n          unidad: item.unidad || 'UND',\n          cantidad: item.cantidad || 1,\n          precio_unit: item.precio_unitario || 0,\n          descuento_pct: item.descuento_porcentaje || 0,\n          impuesto_pct: item.impuesto_porcentaje || 0,\n          total: item.total_linea || 0,\n          meta_json: item.meta_json\n        }))\n      };\n\n      if (pedido) {\n        await pedidoService.updatePedido(pedido.id, createData);\n      } else {\n        await pedidoService.createPedido(createData);\n      }\n\n      onSave();\n    } catch (error) {\n      console.error('Error al guardar pedido:', error);\n      alert('Error al guardar pedido: ' + (error as Error).message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"bg-white rounded-lg shadow\">\n          {/* Header */}\n          <div className=\"px-6 py-4 border-b border-gray-200 flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                {pedido ? `Editar Pedido ${pedido.codigo}` : 'Nuevo Pedido'}\n              </h1>\n              {pedido && (\n                <p className=\"text-sm text-gray-500\">\n                  Estado: <span className=\"font-medium\">{pedido.estado}</span>\n                </p>\n              )}\n            </div>\n            <div className=\"flex gap-2\">\n              <button\n                type=\"button\"\n                onClick={onCancel}\n                className=\"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 whitespace-nowrap\"\n              >\n                Cancelar\n              </button>\n              <button\n                type=\"submit\"\n                form=\"pedido-form\"\n                disabled={loading}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 whitespace-nowrap\"\n              >\n                {loading ? 'Guardando...' : 'Guardar'}\n              </button>\n            </div>\n          </div>\n\n          <form id=\"pedido-form\" onSubmit={handleSubmit} className=\"p-6 space-y-6\">\n            {/* Informaci√≥n del Cliente */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Cliente *\n                </label>\n                <div className=\"flex gap-2\">\n                  <div className=\"flex-1 p-3 border border-gray-300 rounded-lg bg-gray-50\">\n                    {cliente ? (\n                      <div>\n                        <div className=\"font-medium\">{cliente.nombre_razon_social}</div>\n                        <div className=\"text-sm text-gray-500\">{cliente.identificacion}</div>\n                      </div>\n                    ) : (\n                      <span className=\"text-gray-500\">Seleccionar cliente</span>\n                    )}\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowClienteModal(true)}\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\n                  >\n                    <i className=\"ri-search-line\"></i>\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Moneda\n                  </label>\n                  <select\n                    value={formData.moneda}\n                    onChange={(e) => setFormData(prev => ({ ...prev, moneda: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <option value=\"CRC\">Colones (CRC)</option>\n                    <option value=\"USD\">D√≥lares (USD)</option>\n                  </select>\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Tipo de Cambio\n                  </label>\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={formData.tipo_cambio}\n                      onChange={(e) => setFormData(prev => ({ ...prev, tipo_cambio: parseFloat(e.target.value) || 1 }))}\n                      className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                      placeholder=\"520.00\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={obtenerTipoCambio}\n                      disabled={actualizandoTipoCambio}\n                      className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap\"\n                    >\n                      {actualizandoTipoCambio ? (\n                        <i className=\"ri-loader-4-line animate-spin\"></i>\n                      ) : (\n                        <i className=\"ri-refresh-line\"></i>\n                      )}\n                    </button>\n                  </div>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {mensajeTipoCambio}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Notas */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Notas\n              </label>\n              <textarea\n                value={formData.notas}\n                onChange={(e) => setFormData(prev => ({ ...prev, notas: e.target.value }))}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                placeholder=\"Notas adicionales del pedido...\"\n              />\n            </div>\n\n            {/* Items */}\n            <div>\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-lg font-medium text-gray-900\">Items del Pedido</h3>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowProductoModal(true)}\n                  className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 whitespace-nowrap\"\n                >\n                  <i className=\"ri-add-line\"></i>\n                  Agregar Item\n                </button>\n              </div>\n\n              {formData.items.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <i className=\"ri-shopping-cart-line text-4xl mb-2\"></i>\n                  <p>No hay items agregados</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {formData.items.map((item, index) => (\n                    <div key={index} className=\"border border-gray-200 rounded-lg p-4\">\n                      <div className=\"grid grid-cols-1 lg:grid-cols-6 gap-4 items-start\">\n                        <div className=\"lg:col-span-2\">\n                          <label className=\"block text-xs font-medium text-gray-500 mb-1\">\n                            Descripci√≥n\n                          </label>\n                          <div className=\"text-sm font-medium\">{item.descripcion || 'Sin descripci√≥n'}</div>\n                          <div className=\"text-xs text-gray-500\">{item.codigo_articulo || 'Sin c√≥digo'}</div>\n                        </div>\n\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-500 mb-1\">\n                            Cantidad\n                          </label>\n                          <input\n                            type=\"number\"\n                            step=\"0.001\"\n                            value={item.cantidad}\n                            onChange={(e) => updateItem(index, 'cantidad', parseFloat(e.target.value) || 0)}\n                            className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-500 mb-1\">\n                            Precio Unit.\n                          </label>\n                          <input\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={item.precio_unitario}\n                            onChange={(e) => updateItem(index, 'precio_unitario', parseFloat(e.target.value) || 0)}\n                            className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-xs font-medium text-gray-500 mb-1\">\n                            Desc. %\n                          </label>\n                          <input\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={item.descuento_porcentaje}\n                            onChange={(e) => updateItem(index, 'descuento_porcentaje', parseFloat(e.target.value) || 0)}\n                            className=\"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                          />\n                        </div>\n\n                        <div className=\"flex items-end justify-between\">\n                          <div>\n                            <label className=\"block text-xs font-medium text-gray-500 mb-1\">\n                              Total\n                            </label>\n                            <div className=\"text-sm font-medium\">\n                              {formatCurrency(item.total_linea, formData.moneda)}\n                            </div>\n                          </div>\n                          <button\n                            type=\"button\"\n                            onClick={() => removeItem(index)}\n                            className=\"text-red-600 hover:text-red-800 p-1\"\n                          >\n                            <i className=\"ri-delete-bin-line\"></i>\n                          </button>\n                        </div>\n                      </div>\n\n                      {/* Componentes BOM */}\n                      {item.meta_json?.bom_items && item.meta_json.bom_items.length > 0 && (\n                        <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">√çtems utilizados:</h4>\n                          <div className=\"bg-blue-50 rounded p-3\">\n                            <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-2 text-xs font-medium text-gray-600 mb-2\">\n                              <div>C√≥digo</div>\n                              <div>Descripci√≥n</div>\n                              <div>Cant. x Unidad</div>\n                              <div>Cant. Total</div>\n                              <div>Total</div>\n                            </div>\n                            {item.meta_json.bom_items.map((bomItem, bomIndex) => (\n                              <div key={bomIndex} className=\"grid grid-cols-1 lg:grid-cols-5 gap-2 text-xs text-gray-700 py-1\">\n                                <div>{bomItem.codigo}</div>\n                                <div>{bomItem.descripcion}</div>\n                                <div>{bomItem.cantidad_por_unidad} {bomItem.unidad}</div>\n                                <div>{bomItem.cantidad_total} {bomItem.unidad}</div>\n                                <div>{formatCurrency(bomItem.total, formData.moneda)}</div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Totales */}\n            {formData.items.length > 0 && (\n              <div className=\"border-t pt-6\">\n                <div className=\"max-w-md ml-auto space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Subtotal:</span>\n                    <span>{formatCurrency(totales.subtotal, formData.moneda)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Descuento:</span>\n                    <span>-{formatCurrency(totales.descuento_total, formData.moneda)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>Impuesto:</span>\n                    <span>{formatCurrency(totales.impuesto_total, formData.moneda)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-lg font-semibold border-t pt-2\">\n                    <span>Total:</span>\n                    <span>{formatCurrency(totales.total, formData.moneda)}</span>\n                  </div>\n                </div>\n              </div>\n            )}\n          </form>\n        </div>\n      </div>\n\n      {/* Modales */}\n      {showClienteModal && (\n        <BuscarClienteModal\n          onSelect={handleClienteSelect}\n          onClose={() => setShowClienteModal(false)}\n        />\n      )}\n\n      {showProductoModal && (\n        <BuscarProductoModal\n          onSelect={handleProductoSelect}\n          onClose={() => setShowProductoModal(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default PedidoForm;\n","import { useState } from 'react';\nimport { useNotification } from '../../hooks/useNotification';\nimport ConfirmationDialog from '../base/ConfirmationDialog';\nimport { supabase } from '../../lib/supabase';\n\ninterface FacturacionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  pedido: any;\n  onSuccess: () => void;\n}\n\nexport default function ModalFacturarPedido({ isOpen, onClose, pedido, onSuccess }: FacturacionModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [showValidationDialog, setShowValidationDialog] = useState(false);\n  const [showSuccessDialog, setShowSuccessDialog] = useState(false);\n  const [showErrorDialog, setShowErrorDialog] = useState(false);\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n  const [successMessage, setSuccessMessage] = useState('');\n  const [errorMessage, setErrorMessage] = useState('');\n  const { showNotification } = useNotification();\n\n  const validarDatos = () => {\n    const errores: string[] = [];\n    \n    if (!pedido) {\n      errores.push('No se ha seleccionado un pedido');\n    }\n    \n    if (!pedido?.cliente_id) {\n      errores.push('El pedido debe tener un cliente asignado');\n    }\n    \n    // Verificar items - puede estar en items o pedido_items\n    const items = pedido?.items || pedido?.pedido_items || [];\n    if (items.length === 0) {\n      errores.push('El pedido debe tener al menos un item');\n    }\n    \n    if (!pedido?.total || pedido.total <= 0) {\n      errores.push('El pedido debe tener un total v√°lido');\n    }\n    \n    if (pedido?.estado !== 'confirmado') {\n      errores.push('Solo se pueden facturar pedidos confirmados');\n    }\n    \n    return errores;\n  };\n\n  const handleEmitirFactura = async () => {\n    const errores = validarDatos();\n    \n    if (errores.length > 0) {\n      setValidationErrors(errores);\n      setShowValidationDialog(true);\n      return;\n    }\n\n    setLoading(true);\n    \n    try {\n      console.log('üì§ Emitiendo factura para pedido:', pedido.id);\n\n      // Obtener items del pedido (puede estar en items o pedido_items)\n      const items = pedido.items || pedido.pedido_items || [];\n\n      // Generar correlation ID para trazabilidad\n      const correlationId = crypto.randomUUID();\n      console.log('üîç Correlation ID:', correlationId);\n\n      // Llamar a la Edge Function de Supabase usando fetch directo para mejor manejo de errores\n      const supabaseUrl = import.meta.env.VITE_PUBLIC_SUPABASE_URL;\n      const supabaseAnonKey = import.meta.env.VITE_PUBLIC_SUPABASE_ANON_KEY;\n      \n      // Obtener el token de sesi√≥n\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      const response = await fetch(`${supabaseUrl}/functions/v1/facturar-pedido`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token || supabaseAnonKey}`,\n          'apikey': supabaseAnonKey,\n          'x-correlation-id': correlationId\n        },\n        body: JSON.stringify({\n          pedido_id: pedido.id,\n          tipo_documento: '01', // 01 = Factura Electr√≥nica\n          condicion_venta: '01', // 01 = Contado\n          medio_pago: '01', // 01 = Efectivo\n          moneda: 'CRC',\n          tipo_cambio: 1,\n          observaciones: null,\n          items: items.map((item: any) => ({\n            item_type: item.item_type || 'producto',\n            item_id: item.item_id,\n            descripcion: item.descripcion,\n            unidad: item.unidad || 'UND',\n            cantidad: item.cantidad,\n            precio_unitario: item.precio_unit || item.precio_unitario,\n            descuento_porcentaje: item.descuento_pct || item.descuento_porcentaje || 0,\n            impuesto_porcentaje: item.impuesto_pct || item.impuesto_porcentaje || 13,\n            total: item.total\n          }))\n        })\n      });\n\n      console.log('üì° Response status:', response.status);\n      console.log('üì° Response ok:', response.ok);\n\n      // Leer el cuerpo de la respuesta\n      const responseText = await response.text();\n      console.log('üìÑ Response body:', responseText);\n\n      let resultado;\n      try {\n        resultado = JSON.parse(responseText);\n      } catch (parseError) {\n        console.error('‚ùå Error parseando respuesta:', parseError);\n        setErrorMessage(`‚ùå Error al procesar respuesta del servidor:\\n\\n${responseText}\\n\\nID de seguimiento: ${correlationId}`);\n        setShowErrorDialog(true);\n        return;\n      }\n\n      console.log('üì• Respuesta parseada:', resultado);\n\n      // Si la respuesta HTTP no es OK (2xx)\n      if (!response.ok) {\n        console.error('‚ùå Error HTTP:', response.status, resultado);\n        \n        let errorDetails = '';\n        \n        if (resultado.code) {\n          errorDetails = `C√≥digo: ${resultado.code}\\n`;\n        }\n        \n        if (resultado.message) {\n          errorDetails += resultado.message;\n        } else {\n          errorDetails += 'Error desconocido';\n        }\n        \n        if (resultado.pgError) {\n          errorDetails += `\\n\\nError de base de datos:\\n`;\n          errorDetails += `‚Ä¢ C√≥digo: ${resultado.pgError.code || 'N/A'}\\n`;\n          errorDetails += `‚Ä¢ Mensaje: ${resultado.pgError.message || 'N/A'}\\n`;\n          if (resultado.pgError.details) {\n            errorDetails += `‚Ä¢ Detalles: ${resultado.pgError.details}\\n`;\n          }\n          if (resultado.pgError.hint) {\n            errorDetails += `‚Ä¢ Sugerencia: ${resultado.pgError.hint}\\n`;\n          }\n        }\n        \n        if (resultado.stage) {\n          errorDetails += `\\n\\nEtapa: ${resultado.stage}`;\n        }\n        \n        errorDetails += `\\n\\nID de seguimiento: ${resultado.correlationId || correlationId}`;\n        \n        setErrorMessage(`‚ùå Error al emitir factura:\\n\\n${errorDetails}`);\n        setShowErrorDialog(true);\n        return;\n      }\n      \n      // Verificar si la respuesta indica √©xito\n      if (resultado && resultado.success) {\n        setSuccessMessage(`‚úÖ Factura ${resultado.consecutivo} creada exitosamente\\n\\nEstado: ${resultado.estado}\\nClave: ${resultado.clave}\\n\\nID: ${resultado.factura_id}`);\n        setShowSuccessDialog(true);\n      } else if (resultado && resultado.ok === false) {\n        // La Edge Function devolvi√≥ un error estructurado\n        const errorMsg = resultado.message || 'Error desconocido';\n        const errorCode = resultado.code || 'UNKNOWN';\n        const correlationIdResp = resultado.correlationId || correlationId;\n        \n        let detailedError = `C√≥digo: ${errorCode}\\n${errorMsg}`;\n        \n        if (resultado.pgError) {\n          detailedError += `\\n\\nError de base de datos:\\n${JSON.stringify(resultado.pgError, null, 2)}`;\n        }\n        \n        detailedError += `\\n\\nID de seguimiento: ${correlationIdResp}`;\n        \n        setErrorMessage(`‚ùå Error al emitir factura:\\n\\n${detailedError}`);\n        setShowErrorDialog(true);\n      } else {\n        // Respuesta inesperada\n        setErrorMessage(`‚ùå Respuesta inesperada del servidor:\\n\\n${JSON.stringify(resultado, null, 2)}\\n\\nID de seguimiento: ${correlationId}`);\n        setShowErrorDialog(true);\n      }\n    } catch (error) {\n      console.error('üí• Error inesperado emitiendo factura:', error);\n      \n      let errorMsg = 'Error inesperado al emitir factura';\n      \n      if (error instanceof Error) {\n        errorMsg += `:\\n\\n${error.message}`;\n        \n        if (error.stack) {\n          console.error('Stack trace:', error.stack);\n        }\n      } else {\n        errorMsg += `:\\n\\n${String(error)}`;\n      }\n      \n      setErrorMessage(errorMsg);\n      setShowErrorDialog(true);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSuccessConfirm = () => {\n    setShowSuccessDialog(false);\n    onSuccess();\n    onClose();\n  };\n\n  const handleErrorConfirm = () => {\n    setShowErrorDialog(false);\n  };\n\n  if (!isOpen) return null;\n\n  // Obtener nombre del cliente correctamente\n  const nombreCliente = pedido?.cliente?.nombre_razon_social || pedido?.cliente?.nombre || 'Sin nombre';\n  \n  // Obtener items correctamente (puede estar en items o pedido_items)\n  const items = pedido?.items || pedido?.pedido_items || [];\n\n  return (\n    <>\n      {/* Modal Principal */}\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n        <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4\">\n          <div className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Emitir Factura Electr√≥nica\n              </h3>\n              <button\n                onClick={onClose}\n                className=\"text-gray-400 hover:text-gray-600\"\n                disabled={loading}\n              >\n                <i className=\"ri-close-line text-xl\"></i>\n              </button>\n            </div>\n\n            <div className=\"mb-6\">\n              <p className=\"text-gray-600 mb-2\">\n                ¬øDeseas emitir una factura electr√≥nica para el pedido #{pedido?.codigo}?\n              </p>\n              <div className=\"bg-gray-50 rounded-lg p-3\">\n                <div className=\"text-sm text-gray-700\">\n                  <div><strong>Cliente:</strong> {nombreCliente}</div>\n                  <div><strong>Total:</strong> ‚Ç°{pedido?.total?.toLocaleString() || '0'}</div>\n                  <div><strong>Items:</strong> {items.length}</div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex space-x-3\">\n              <button\n                onClick={onClose}\n                className=\"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors cursor-pointer whitespace-nowrap\"\n                disabled={loading}\n              >\n                Cancelar\n              </button>\n              <button\n                onClick={handleEmitirFactura}\n                disabled={loading}\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 cursor-pointer whitespace-nowrap\"\n              >\n                {loading ? (\n                  <>\n                    <i className=\"ri-loader-4-line animate-spin mr-2\"></i>\n                    Procesando...\n                  </>\n                ) : (\n                  <>\n                    <i className=\"ri-bill-line mr-2\"></i>\n                    Emitir Factura\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Dialog de Errores de Validaci√≥n */}\n      <ConfirmationDialog\n        isOpen={showValidationDialog}\n        onClose={() => setShowValidationDialog(false)}\n        onConfirm={() => setShowValidationDialog(false)}\n        title=\"Errores de Validaci√≥n\"\n        message={\n          <div className=\"space-y-2\">\n            <p className=\"text-gray-600 mb-3\">Se encontraron los siguientes errores:</p>\n            <ul className=\"list-disc list-inside space-y-1 text-sm text-red-600\">\n              {validationErrors.map((error, index) => (\n                <li key={index}>{error}</li>\n              ))}\n            </ul>\n          </div>\n        }\n        type=\"error\"\n        confirmText=\"Entendido\"\n        showCancel={false}\n      />\n\n      {/* Dialog de √âxito */}\n      <ConfirmationDialog\n        isOpen={showSuccessDialog}\n        onClose={handleSuccessConfirm}\n        onConfirm={handleSuccessConfirm}\n        title=\"Factura Emitida Exitosamente\"\n        message={\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mx-auto mb-4\">\n              <i className=\"ri-check-line text-2xl text-green-600\"></i>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-gray-600 whitespace-pre-line\">{successMessage}</p>\n            </div>\n          </div>\n        }\n        type=\"success\"\n        confirmText=\"Continuar\"\n        showCancel={false}\n      />\n\n      {/* Dialog de Error */}\n      <ConfirmationDialog\n        isOpen={showErrorDialog}\n        onClose={handleErrorConfirm}\n        onConfirm={handleErrorConfirm}\n        title=\"Error al Emitir Factura\"\n        message={\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mx-auto mb-4\">\n              <i className=\"ri-close-line text-2xl text-red-600\"></i>\n            </div>\n            <div className=\"text-center\">\n              <p className=\"text-gray-600 whitespace-pre-line text-left\">{errorMessage}</p>\n            </div>\n          </div>\n        }\n        type=\"error\"\n        confirmText=\"Cerrar\"\n        showCancel={false}\n      />\n    </>\n  );\n}\n","\nimport { useAuth } from './useAuth';\nimport { PermissionKey } from '../types/permissions';\n\ninterface PermissionCheckOptions {\n  resourceOwnerId?: string;\n  strict?: boolean;\n}\n\nexport const useAdvancedPermissions = () => {\n  const { user, hasPermission } = useAuth();\n\n  const checkPermission = (\n    permission: PermissionKey, \n    options: PermissionCheckOptions = {}\n  ): boolean => {\n    const { resourceOwnerId, strict = false } = options;\n\n    // Si no hay usuario autenticado, denegar acceso\n    if (!user) return false;\n\n    // Verificar permiso directo\n    if (hasPermission(permission)) return true;\n\n    // Si es un permiso \"own\", verificar si el usuario es el propietario\n    if (permission.includes(':own') && resourceOwnerId) {\n      return user.id === resourceOwnerId;\n    }\n\n    // Si no tiene el permiso espec√≠fico, verificar si tiene el permiso general\n    if (permission.includes(':own')) {\n      const generalPermission = permission.replace(':own', '') as PermissionKey;\n      if (hasPermission(generalPermission)) return true;\n    }\n\n    // En modo estricto, solo permitir permisos exactos\n    if (strict) return false;\n\n    // Verificar permisos de nivel superior\n    const [module, action] = permission.split(':');\n    \n    // Si tiene permisos de administrador del m√≥dulo\n    if (hasPermission(`${module}:admin` as PermissionKey)) return true;\n    \n    // Si es Admin completo\n    if (user.rol === 'Admin') return true;\n\n    return false;\n  };\n\n  const canView = (module: string, resourceOwnerId?: string) => {\n    return checkPermission(`${module}:view` as PermissionKey, { resourceOwnerId }) ||\n           checkPermission(`${module}:view:own` as PermissionKey, { resourceOwnerId });\n  };\n\n  const canCreate = (module: string) => {\n    return checkPermission(`${module}:create` as PermissionKey);\n  };\n\n  const canEdit = (module: string, resourceOwnerId?: string) => {\n    return checkPermission(`${module}:edit` as PermissionKey, { resourceOwnerId }) ||\n           checkPermission(`${module}:edit:own` as PermissionKey, { resourceOwnerId });\n  };\n\n  const canDelete = (module: string, resourceOwnerId?: string) => {\n    return checkPermission(`${module}:delete` as PermissionKey, { resourceOwnerId }) ||\n           checkPermission(`${module}:delete:own` as PermissionKey, { resourceOwnerId });\n  };\n\n  const canPerformAction = (module: string, action: string, resourceOwnerId?: string) => {\n    return checkPermission(`${module}:${action}` as PermissionKey, { resourceOwnerId });\n  };\n\n  // Funciones espec√≠ficas por m√≥dulo\n  const permissions = {\n    // Clientes\n    clientes: {\n      canView: (resourceOwnerId?: string) => canView('clientes', resourceOwnerId),\n      canCreate: () => canCreate('clientes'),\n      canEdit: (resourceOwnerId?: string) => canEdit('clientes', resourceOwnerId),\n      canDelete: (resourceOwnerId?: string) => canDelete('clientes', resourceOwnerId),\n      canImport: () => checkPermission('clientes:import'),\n      canExport: () => checkPermission('clientes:export'),\n      canAssign: () => checkPermission('clientes:assign'),\n    },\n\n    // Cotizaciones\n    cotizaciones: {\n      canView: (resourceOwnerId?: string) => canView('cotizaciones', resourceOwnerId),\n      canCreate: () => canCreate('cotizaciones'),\n      canEdit: (resourceOwnerId?: string) => canEdit('cotizaciones', resourceOwnerId),\n      canDelete: (resourceOwnerId?: string) => canDelete('cotizaciones', resourceOwnerId),\n      canApprove: () => checkPermission('cotizaciones:approve'),\n      canReject: () => checkPermission('cotizaciones:reject'),\n      canConvert: () => checkPermission('cotizaciones:convert'),\n      canDuplicate: () => checkPermission('cotizaciones:duplicate'),\n      canExport: () => checkPermission('cotizaciones:export'),\n      canPrint: () => checkPermission('cotizaciones:print'),\n    },\n\n    // Pedidos\n    pedidos: {\n      canView: (resourceOwnerId?: string) => canView('pedidos', resourceOwnerId),\n      canCreate: () => canCreate('pedidos'),\n      canEdit: (resourceOwnerId?: string) => canEdit('pedidos', resourceOwnerId),\n      canDelete: (resourceOwnerId?: string) => canDelete('pedidos', resourceOwnerId),\n      canConfirm: () => checkPermission('pedidos:confirm'),\n      canCancel: () => checkPermission('pedidos:cancel'),\n      canInvoice: () => checkPermission('pedidos:invoice'),\n      canPrint: () => checkPermission('pedidos:print'),\n    },\n\n    // Inventario\n    inventario: {\n      canView: () => checkPermission('inventario:view'),\n      canCreate: () => canCreate('inventario'),\n      canEdit: () => canEdit('inventario'),\n      canDelete: () => canDelete('inventario'),\n      canAdjust: () => checkPermission('inventario:adjust'),\n      canTransfer: () => checkPermission('inventario:transfer'),\n      canImport: () => checkPermission('inventario:import'),\n      canExport: () => checkPermission('inventario:export'),\n      canManageCategories: () => checkPermission('inventario:categories'),\n      canManageThresholds: () => checkPermission('inventario:thresholds'),\n    },\n\n    // Productos\n    productos: {\n      canView: () => checkPermission('productos:view'),\n      canCreate: () => canCreate('productos'),\n      canEdit: () => canEdit('productos'),\n      canDelete: () => canDelete('productos'),\n      canManageBOM: () => checkPermission('productos:bom'),\n      canManagePricing: () => checkPermission('productos:pricing'),\n      canExport: () => checkPermission('productos:export'),\n    },\n\n    // Facturaci√≥n\n    facturas: {\n      canView: (resourceOwnerId?: string) => canView('facturas', resourceOwnerId),\n      canCreate: () => canCreate('facturas'),\n      canEdit: (resourceOwnerId?: string) => canEdit('facturas', resourceOwnerId),\n      canDelete: (resourceOwnerId?: string) => canDelete('facturas', resourceOwnerId),\n      canSend: () => checkPermission('facturas:send'),\n      canCancel: () => checkPermission('facturas:cancel'),\n      canPrint: () => checkPermission('facturas:print'),\n      canExport: () => checkPermission('facturas:export'),\n      canConfig: () => checkPermission('facturas:config'),\n    },\n\n    // Mantenimiento\n    mantenimiento: {\n      canView: () => checkPermission('mantenimiento:view'),\n      canViewAlerts: () => checkPermission('mantenimiento:alerts'),\n      canManageThresholds: () => checkPermission('mantenimiento:thresholds'),\n      canManageReplenishment: () => checkPermission('mantenimiento:replenishment'),\n      canViewPredictions: () => checkPermission('mantenimiento:predictions'),\n      canConfig: () => checkPermission('mantenimiento:config'),\n    },\n\n    // Seguridad\n    seguridad: {\n      canView: () => checkPermission('seguridad:view'),\n      canViewUsers: () => checkPermission('seguridad:users:view'),\n      canCreateUsers: () => checkPermission('seguridad:users:create'),\n      canEditUsers: () => checkPermission('seguridad:users:edit'),\n      canDeleteUsers: () => checkPermission('seguridad:users:delete'),\n      canActivateUsers: () => checkPermission('seguridad:users:activate'),\n      canViewRoles: () => checkPermission('seguridad:roles:view'),\n      canCreateRoles: () => checkPermission('seguridad:roles:create'),\n      canEditRoles: () => checkPermission('seguridad:roles:edit'),\n      canDeleteRoles: () => checkPermission('seguridad:roles:delete'),\n      canViewPermissions: () => checkPermission('seguridad:permissions:view'),\n      canCreatePermissions: () => checkPermission('seguridad:permissions:create'),\n      canEditPermissions: () => checkPermission('seguridad:permissions:edit'),\n      canDeletePermissions: () => checkPermission('seguridad:permissions:delete'),\n      canAssignPermissions: () => checkPermission('seguridad:permissions:assign'),\n    },\n\n    // Dashboard\n    dashboard: {\n      canView: () => checkPermission('dashboard:view'),\n      canViewStats: () => checkPermission('dashboard:stats'),\n      canViewCharts: () => checkPermission('dashboard:charts'),\n      canExport: () => checkPermission('dashboard:export'),\n    },\n\n    // Perfil\n    perfil: {\n      canView: () => checkPermission('perfil:view'),\n      canEdit: () => checkPermission('perfil:edit'),\n      canChangePassword: () => checkPermission('perfil:password'),\n    },\n  };\n\n  return {\n    checkPermission,\n    canView,\n    canCreate,\n    canEdit,\n    canDelete,\n    canPerformAction,\n    permissions,\n  };\n};\n","import { useAuth } from './useAuth';\n\nexport const useRobustPermissions = () => {\n  const { permissions, profile } = useAuth();\n\n  console.log('[DEBUG PERMISOS] üîç useRobustPermissions - permisos finales:', permissions);\n  console.log('[DEBUG PERMISOS] üîç useRobustPermissions - total permisos:', permissions.length);\n\n  /**\n   * Verifica si el usuario tiene un permiso espec√≠fico\n   * Reconoce permisos con sufijo :own como v√°lidos para operaciones b√°sicas\n   */\n  const hasPermission = (permission: string): boolean => {\n    if (!permission) return true;\n\n    // Verificaci√≥n directa\n    if (permissions.includes(permission)) {\n      return true;\n    }\n\n    // Si el permiso solicitado es de tipo :view, :create, :edit, :delete\n    // tambi√©n aceptar la variante :own\n    const ownVariant = `${permission}:own`;\n    if (permissions.includes(ownVariant)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  /**\n   * Verifica si el usuario puede leer un m√≥dulo\n   * Acepta tanto module:view como module:view:own\n   */\n  const canRead = (module: string): boolean => {\n    const viewPermission = `${module}:view`;\n    const viewOwnPermission = `${module}:view:own`;\n    \n    return permissions.includes(viewPermission) || permissions.includes(viewOwnPermission);\n  };\n\n  /**\n   * Verifica si el usuario puede escribir en un m√≥dulo\n   * Acepta tanto module:create/edit/delete como module:create:own/edit:own/delete:own\n   */\n  const canWrite = (module: string): boolean => {\n    const createPermission = `${module}:create`;\n    const createOwnPermission = `${module}:create:own`;\n    const editPermission = `${module}:edit`;\n    const editOwnPermission = `${module}:edit:own`;\n    \n    return permissions.includes(createPermission) || \n           permissions.includes(createOwnPermission) ||\n           permissions.includes(editPermission) ||\n           permissions.includes(editOwnPermission);\n  };\n\n  /**\n   * Verifica si el usuario puede eliminar en un m√≥dulo\n   * Acepta tanto module:delete como module:delete:own\n   */\n  const canDelete = (module: string): boolean => {\n    const deletePermission = `${module}:delete`;\n    const deleteOwnPermission = `${module}:delete:own`;\n    \n    return permissions.includes(deletePermission) || permissions.includes(deleteOwnPermission);\n  };\n\n  const isAdmin = profile?.rol === 'Admin';\n\n  return {\n    permissions,\n    hasPermission,\n    canRead,\n    canWrite,\n    canDelete,\n    isAdmin,\n  };\n};\n","import { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { pedidoService } from '../../services/pedidoService';\nimport { ESTADOS_PEDIDO, type Pedido } from '../../types/pedido';\nimport PedidosLayout from './components/PedidosLayout';\nimport PedidosTable from './components/PedidosTable';\nimport PedidosFilters from './components/PedidosFilters';\nimport PedidoForm from './components/PedidoForm';\nimport ModalFacturarPedido from '../../components/facturacion/ModalFacturarPedido';\nimport AdvancedPermissionWrapper from '../../components/base/AdvancedPermissionWrapper';\nimport AdvancedPermissionButton from '../../components/base/AdvancedPermissionButton';\nimport { useAdvancedPermissions } from '../../hooks/useAdvancedPermissions';\nimport { RobustPermissionWrapper, PermissionButtonWrapper } from '../../components/security/RobustPermissionWrapper';\nimport { useRobustPermissions } from '../../hooks/useRobustPermissions';\nimport Sidebar from '../../components/feature/Sidebar';\nimport TopBar from '../../components/feature/TopBar';\n\nexport default function PedidosPage() {\n  const [pedidos, setPedidos] = useState<Pedido[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showForm, setShowForm] = useState(false);\n  const [editingPedido, setEditingPedido] = useState<Pedido | null>(null);\n  const [showFacturarModal, setShowFacturarModal] = useState(false);\n  const [pedidoToFacturar, setPedidoToFacturar] = useState<Pedido | null>(null);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [filters, setFilters] = useState({\n    estado: '',\n    cliente_id: null as number | null,\n    fecha_desde: '',\n    fecha_hasta: ''\n  });\n\n  const { permissions } = useAdvancedPermissions();\n  const { canView, canCreate } = useRobustPermissions();\n\n  useEffect(() => {\n    loadPedidos();\n  }, [filters]);\n\n  const loadPedidos = async () => {\n    setLoading(true);\n    try {\n      const data = await pedidoService.getPedidos(filters);\n      setPedidos(data);\n    } catch (error) {\n      console.error('Error cargando pedidos:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreatePedido = () => {\n    setEditingPedido(null);\n    setShowForm(true);\n  };\n\n  const handleEditPedido = (pedido: Pedido) => {\n    setEditingPedido(pedido);\n    setShowForm(true);\n  };\n\n  const handleSavePedido = async () => {\n    setShowForm(false);\n    setEditingPedido(null);\n    await loadPedidos();\n  };\n\n  const handleConfirmarPedido = async (id: number) => {\n    if (!confirm('¬øEst√° seguro de confirmar este pedido? Esto crear√° reservas de inventario.')) {\n      return;\n    }\n\n    try {\n      // Obtener el usuario actual (necesario para el servicio)\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        alert('Error: Usuario no autenticado');\n        return;\n      }\n\n      // Usar el m√©todo espec√≠fico confirmarPedido del servicio\n      await pedidoService.confirmarPedido(id, user.id);\n      \n      // Mostrar mensaje de √©xito\n      alert('Pedido confirmado exitosamente');\n      \n      // Recargar la lista\n      await loadPedidos();\n    } catch (error) {\n      console.error('Error confirmando pedido:', error);\n      alert('Error al confirmar pedido: ' + (error instanceof Error ? error.message : 'Error desconocido'));\n    }\n  };\n\n  const handleCancelarPedido = async (id: number) => {\n    if (!confirm('¬øEst√° seguro de cancelar este pedido? Esto liberar√° las reservas de inventario.')) {\n      return;\n    }\n\n    try {\n      // Usar el m√©todo espec√≠fico cancelarPedido del servicio\n      await pedidoService.cancelarPedido(id);\n      \n      // Mostrar mensaje de √©xito\n      alert('Pedido cancelado exitosamente');\n      \n      // Recargar la lista\n      await loadPedidos();\n    } catch (error) {\n      console.error('Error cancelando pedido:', error);\n      alert('Error al cancelar pedido: ' + (error instanceof Error ? error.message : 'Error desconocido'));\n    }\n  };\n\n  const handleFacturarPedido = (pedido: Pedido) => {\n    if (pedido.estado !== 'confirmado') {\n      alert('Solo se pueden facturar pedidos confirmados');\n      return;\n    }\n\n    setPedidoToFacturar(pedido);\n    setShowFacturarModal(true);\n  };\n\n  const handleFacturacionExitosa = async () => {\n    setShowFacturarModal(false);\n    setPedidoToFacturar(null);\n    await loadPedidos();\n  };\n\n  if (showForm) {\n    return (\n      <div className=\"flex h-screen bg-gray-50\">\n        <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n        \n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <TopBar onMenuClick={() => setSidebarOpen(!sidebarOpen)} />\n          \n          <main className=\"flex-1 overflow-y-auto\">\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n              <PedidoForm\n                pedido={editingPedido}\n                onSave={handleSavePedido}\n                onCancel={() => {\n                  setShowForm(false);\n                  setEditingPedido(null);\n                }}\n              />\n            </div>\n          </main>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"flex h-screen bg-gray-50\">\n        <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n        \n        <div className=\"flex-1 flex flex-col overflow-hidden\">\n          <TopBar onMenuClick={() => setSidebarOpen(!sidebarOpen)} />\n          \n          <main className=\"flex-1 overflow-y-auto\">\n            <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n              <div className=\"space-y-6\">\n                <div className=\"flex justify-between items-center\">\n                  <h1 className=\"text-2xl font-bold text-gray-900\">Gesti√≥n de Pedidos</h1>\n                  <button\n                    onClick={handleCreatePedido}\n                    className=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap\"\n                  >\n                    <i className=\"ri-add-line mr-2\"></i>\n                    Nuevo Pedido\n                  </button>\n                </div>\n\n                <PedidosFilters\n                  filters={filters}\n                  onFiltersChange={setFilters}\n                />\n\n                <PedidosTable\n                  pedidos={pedidos}\n                  loading={loading}\n                  onEdit={handleEditPedido}\n                  onConfirmar={handleConfirmarPedido}\n                  onCancelar={handleCancelarPedido}\n                  onFacturar={handleFacturarPedido}\n                />\n              </div>\n            </div>\n          </main>\n        </div>\n      </div>\n\n      {/* Modal de Facturaci√≥n */}\n      {showFacturarModal && pedidoToFacturar && (\n        <ModalFacturarPedido\n          pedido={pedidoToFacturar}\n          isOpen={showFacturarModal}\n          onClose={() => {\n            setShowFacturarModal(false);\n            setPedidoToFacturar(null);\n          }}\n          onSuccess={handleFacturacionExitosa}\n        />\n      )}\n    </>\n  );\n}\n"],"names":["ESTADOS_PEDIDO","PedidosTable","pedidos","loading","onEdit","onConfirmar","onCancelar","onFacturar","navigate","useNavigate","showPrintWarning","setShowPrintWarning","useState","warningMessage","setWarningMessage","checkingFactura","setCheckingFactura","handlePrint","pedido","factura","error","supabase","handleDelete","pedidoId","jsx","_","i","jsxs","Fragment","PedidosFilters","filters","onFiltersChange","clientes","setClientes","setLoading","useEffect","loadClientes","data","handleFilterChange","key","value","newFilters","clearFilters","e","cliente","BuscarProductoModal","onSelect","onClose","productos","setProductos","busqueda","setBusqueda","categoria","setCategoria","categorias","setCategorias","cargarCategorias","cargarProductos","query","cat","producto","PedidoForm","onSave","onCancel","formData","setFormData","setCliente","showClienteModal","setShowClienteModal","showProductoModal","setShowProductoModal","actualizandoTipoCambio","setActualizandoTipoCambio","mensajeTipoCambio","setMensajeTipoCambio","totales","setTotales","obtenerTipoCambio","itemsMapeados","item","calculateTotales","tipoCambio","CotizacionService","prev","subtotal","descuento_total","impuesto_total","itemSubtotal","itemDescuento","itemImpuesto","total","handleClienteSelect","clienteSeleccionado","handleProductoSelect","bomItems","bom","bomItem","nuevoItem","updateItem","index","field","newItems","itemSubtotalConDescuento","updatedBomItems","removeItem","handleSubmit","createData","pedidoService","bomIndex","formatCurrency","BuscarClienteModal","ModalFacturarPedido","isOpen","onSuccess","showValidationDialog","setShowValidationDialog","showSuccessDialog","setShowSuccessDialog","showErrorDialog","setShowErrorDialog","validationErrors","setValidationErrors","successMessage","setSuccessMessage","errorMessage","setErrorMessage","useNotification","validarDatos","errores","handleEmitirFactura","items","correlationId","supabaseUrl","supabaseAnonKey","session","response","responseText","resultado","parseError","errorDetails","errorMsg","errorCode","correlationIdResp","detailedError","handleSuccessConfirm","handleErrorConfirm","nombreCliente","ConfirmationDialog","useAdvancedPermissions","user","hasPermission","useAuth","checkPermission","permission","options","resourceOwnerId","strict","generalPermission","module","action","canView","canCreate","canEdit","canDelete","useRobustPermissions","permissions","profile","ownVariant","canRead","viewPermission","viewOwnPermission","canWrite","createPermission","createOwnPermission","editPermission","editOwnPermission","deletePermission","deleteOwnPermission","isAdmin","PedidosPage","setPedidos","showForm","setShowForm","editingPedido","setEditingPedido","showFacturarModal","setShowFacturarModal","pedidoToFacturar","setPedidoToFacturar","sidebarOpen","setSidebarOpen","setFilters","loadPedidos","handleCreatePedido","handleEditPedido","handleSavePedido","handleConfirmarPedido","id","handleCancelarPedido","handleFacturarPedido","handleFacturacionExitosa","Sidebar","TopBar"],"mappings":"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"}